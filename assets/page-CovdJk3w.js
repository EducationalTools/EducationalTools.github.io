const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bun-sqlite-dialect-CUyp5lZ1.js","assets/chunk-UIGDSWPH-BVQp00Zd.js","assets/button-BtmAzGuo.js","assets/index-DstcrvaX.js","assets/bundle-mjs-BJeS7sC5.js","assets/utils-DL16pZsE.js","assets/card-BDP7RXBL.js","assets/empty-BPlBv7sK.js","assets/input-CFSxLv1b.js","assets/constants-hDAxwCjT.js","assets/createLucideIcon-Bmk5bfkH.js","assets/ConvexAuthState-DQPI8SxW.js","assets/auth-client-CkxdHvhw.js","assets/index-DveFINiG.js","assets/index-DdRqjIto.js","assets/sha2-3zd_KfSO.js","assets/alert-dialog-Dxd0_0Kt.js","assets/index-jf6C1AH_.js","assets/index-PsY7313p.js","assets/index-DdfkXwL2.js","assets/state-Cxcn9RdD.js","assets/experimental-check-BwBX2eWT.js","assets/arrow-right-DcOxzzrK.js","assets/copy-BPHNvrM9.js","assets/node-sqlite-dialect-CMtbNv9Z.js"])))=>i.map(i=>d[i]);
import{p as M,A as Ag,w as kg,z as Tg,a as Oi}from"./chunk-UIGDSWPH-BVQp00Zd.js";import{B as Jn}from"./button-BtmAzGuo.js";import{C as Jd,a as Gd,b as Qd,c as Yd}from"./card-BDP7RXBL.js";import{E as Sg,a as Rg,b as Ig,c as Og,d as $g}from"./empty-BPlBv7sK.js";import{I as Sa}from"./input-CFSxLv1b.js";import{c as Cg}from"./utils-DL16pZsE.js";import{p as $e,c as qc,d as Zs,e as Ls,i as xg,f as Ug,a as dn,b as Xd,m as $i,N as zs,A as Pg}from"./constants-hDAxwCjT.js";import{g as We,e as Ze,i as Su,b as Ru,B as ve,c as jc,d as di,f as Tp,h as Sp,j as ne,k as mt,l as Iu,m as el,E as Dg,a as Lg}from"./auth-client-CkxdHvhw.js";import{t as ln}from"./index-DveFINiG.js";import{c as dt,j as Ft,g as Ho,v as At,p as Ko,d as Br,e as zg,u as qg,f as tl,b as jg}from"./ConvexAuthState-DQPI8SxW.js";import{e as Rp,f as rl,g as Ou,h as nl,i as Wg,j as Ip,k as Nr,l as sl,m as il,q as ol,r as Ra,t as ie,a as Op,v as Mg,o as al,s as cl}from"./sha2-3zd_KfSO.js";import{A as ul,a as dl,b as ll,c as hl,d as fl,e as pl,f as ml,g as wl,h as yl}from"./alert-dialog-Dxd0_0Kt.js";import{i as Vg}from"./experimental-check-BwBX2eWT.js";import{c as $u}from"./createLucideIcon-Bmk5bfkH.js";import{A as Fg}from"./arrow-right-DcOxzzrK.js";import{C as Zg}from"./copy-BPHNvrM9.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Hg=$u("archive",Bg);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kg=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],Jg=$u("clipboard",Kg);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Qg=$u("trash",Gg);function Ci({className:e,...t}){return M.jsx("div",{"data-slot":"skeleton",className:Cg("bg-accent animate-pulse rounded-md",e),...t})}var Yg=Object.defineProperty,Xg=(e,t,r)=>t in e?Yg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ie=(e,t,r)=>Xg(e,typeof t!="symbol"?t+"":t,r);class qt{constructor({isOptional:t}){Ie(this,"type"),Ie(this,"fieldPaths"),Ie(this,"isOptional"),Ie(this,"isConvexValidator"),this.isOptional=t,this.isConvexValidator=!0}}class Cu extends qt{constructor({isOptional:t,tableName:r}){if(super({isOptional:t}),Ie(this,"tableName"),Ie(this,"kind","id"),typeof r!="string")throw new Error("v.id(tableName) requires a string");this.tableName=r}get json(){return{type:"id",tableName:this.tableName}}asOptional(){return new Cu({isOptional:"optional",tableName:this.tableName})}}class lo extends qt{constructor(){super(...arguments),Ie(this,"kind","float64")}get json(){return{type:"number"}}asOptional(){return new lo({isOptional:"optional"})}}class ho extends qt{constructor(){super(...arguments),Ie(this,"kind","int64")}get json(){return{type:"bigint"}}asOptional(){return new ho({isOptional:"optional"})}}class xu extends qt{constructor(){super(...arguments),Ie(this,"kind","boolean")}get json(){return{type:this.kind}}asOptional(){return new xu({isOptional:"optional"})}}class Uu extends qt{constructor(){super(...arguments),Ie(this,"kind","bytes")}get json(){return{type:this.kind}}asOptional(){return new Uu({isOptional:"optional"})}}class Pu extends qt{constructor(){super(...arguments),Ie(this,"kind","string")}get json(){return{type:this.kind}}asOptional(){return new Pu({isOptional:"optional"})}}class Du extends qt{constructor(){super(...arguments),Ie(this,"kind","null")}get json(){return{type:this.kind}}asOptional(){return new Du({isOptional:"optional"})}}class Lu extends qt{constructor(){super(...arguments),Ie(this,"kind","any")}get json(){return{type:this.kind}}asOptional(){return new Lu({isOptional:"optional"})}}class mn extends qt{constructor({isOptional:t,fields:r}){super({isOptional:t}),Ie(this,"fields"),Ie(this,"kind","object"),globalThis.Object.values(r).forEach(n=>{if(!n.isConvexValidator)throw new Error("v.object() entries must be validators")}),this.fields=r}get json(){return{type:this.kind,value:globalThis.Object.fromEntries(globalThis.Object.entries(this.fields).map(([t,r])=>[t,{fieldType:r.json,optional:r.isOptional==="optional"}]))}}asOptional(){return new mn({isOptional:"optional",fields:this.fields})}omit(...t){const r={...this.fields};for(const n of t)delete r[n];return new mn({isOptional:this.isOptional,fields:r})}pick(...t){const r={};for(const n of t)r[n]=this.fields[n];return new mn({isOptional:this.isOptional,fields:r})}partial(){const t={};for(const[r,n]of globalThis.Object.entries(this.fields))t[r]=n.asOptional();return new mn({isOptional:this.isOptional,fields:t})}extend(t){return new mn({isOptional:this.isOptional,fields:{...this.fields,...t}})}}class zu extends qt{constructor({isOptional:t,value:r}){if(super({isOptional:t}),Ie(this,"value"),Ie(this,"kind","literal"),typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&typeof r!="bigint")throw new Error("v.literal(value) must be a string, number, or boolean");this.value=r}get json(){return{type:this.kind,value:dt(this.value)}}asOptional(){return new zu({isOptional:"optional",value:this.value})}}class qu extends qt{constructor({isOptional:t,element:r}){super({isOptional:t}),Ie(this,"element"),Ie(this,"kind","array"),this.element=r}get json(){return{type:this.kind,value:this.element.json}}asOptional(){return new qu({isOptional:"optional",element:this.element})}}class ju extends qt{constructor({isOptional:t,key:r,value:n}){if(super({isOptional:t}),Ie(this,"key"),Ie(this,"value"),Ie(this,"kind","record"),r.isOptional==="optional")throw new Error("Record validator cannot have optional keys");if(n.isOptional==="optional")throw new Error("Record validator cannot have optional values");if(!r.isConvexValidator||!n.isConvexValidator)throw new Error("Key and value of v.record() but be validators");this.key=r,this.value=n}get json(){return{type:this.kind,keys:this.key.json,values:{fieldType:this.value.json,optional:!1}}}asOptional(){return new ju({isOptional:"optional",key:this.key,value:this.value})}}class Wu extends qt{constructor({isOptional:t,members:r}){super({isOptional:t}),Ie(this,"members"),Ie(this,"kind","union"),r.forEach(n=>{if(!n.isConvexValidator)throw new Error("All members of v.union() must be validators")}),this.members=r}get json(){return{type:this.kind,value:this.members.map(t=>t.json)}}asOptional(){return new Wu({isOptional:"optional",members:this.members})}}function $p(e){return!!e.isConvexValidator}function Cp(e){return $p(e)?e:N.object(e)}const N={id:e=>new Cu({isOptional:"required",tableName:e}),null:()=>new Du({isOptional:"required"}),number:()=>new lo({isOptional:"required"}),float64:()=>new lo({isOptional:"required"}),bigint:()=>new ho({isOptional:"required"}),int64:()=>new ho({isOptional:"required"}),boolean:()=>new xu({isOptional:"required"}),string:()=>new Pu({isOptional:"required"}),bytes:()=>new Uu({isOptional:"required"}),literal:e=>new zu({isOptional:"required",value:e}),array:e=>new qu({isOptional:"required",element:e}),object:e=>new mn({isOptional:"required",fields:e}),record:(e,t)=>new ju({isOptional:"required",key:e,value:t}),union:(...e)=>new Wu({isOptional:"required",members:e}),any:()=>new Lu({isOptional:"required"}),optional:e=>e.asOptional()};function Ia(e,t,r){return{...Ho(t),args:dt(Ko(r)),version:At,requestId:e}}function eb(e){return{runQuery:async(t,r)=>{const n=await $e("1.0/actions/query",Ia(e,t,r));return Ft(n)},runMutation:async(t,r)=>{const n=await $e("1.0/actions/mutation",Ia(e,t,r));return Ft(n)},runAction:async(t,r)=>{const n=await $e("1.0/actions/action",Ia(e,t,r));return Ft(n)}}}var tb=Object.defineProperty,rb=(e,t,r)=>t in e?tb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gl=(e,t,r)=>rb(e,typeof t!="symbol"?t+"":t,r);class nb{constructor(){gl(this,"_isExpression"),gl(this,"_value")}}function de(e,t,r,n){if(e===void 0)throw new TypeError(`Must provide arg ${t} \`${n}\` to \`${r}\``)}function sb(e,t,r,n){if(!Number.isInteger(e)||e<0)throw new TypeError(`Arg ${t} \`${n}\` to \`${r}\` must be a non-negative integer`)}var ib=Object.defineProperty,ob=(e,t,r)=>t in e?ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Wc=(e,t,r)=>ob(e,typeof t!="symbol"?t+"":t,r);function ab(e){return async(t,r,n)=>{if(de(t,1,"vectorSearch","tableName"),de(r,2,"vectorSearch","indexName"),de(n,3,"vectorSearch","query"),!n.vector||!Array.isArray(n.vector)||n.vector.length===0)throw Error("`vector` must be a non-empty Array in vectorSearch");return await new cb(e,t+"."+r,n).collect()}}class cb{constructor(t,r,n){Wc(this,"requestId"),Wc(this,"state"),this.requestId=t;const s=n.filter?Yi(n.filter(ub)):null;this.state={type:"preparing",query:{indexName:r,limit:n.limit,vector:n.vector,expressions:s}}}async collect(){if(this.state.type==="consumed")throw new Error("This query is closed and can't emit any more values.");const t=this.state.query;this.state={type:"consumed"};const{results:r}=await $e("1.0/actions/vectorSearch",{requestId:this.requestId,version:At,query:t});return r}}let Qi=class extends nb{constructor(t){super(),Wc(this,"inner"),this.inner=t}serialize(){return this.inner}};function Yi(e){return e instanceof Qi?e.serialize():{$literal:Br(e)}}const ub={eq(e,t){if(typeof e!="string")throw new Error("The first argument to `q.eq` must be a field name.");return new Qi({$eq:[Yi(new Qi({$field:e})),Yi(t)]})},or(...e){return new Qi({$or:e.map(Yi)})}};function Mu(e){return{getUserIdentity:async()=>await $e("1.0/getUserIdentity",{requestId:e})}}var db=Object.defineProperty,lb=(e,t,r)=>t in e?db(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bl=(e,t,r)=>lb(e,typeof t!="symbol"?t+"":t,r);class hb{constructor(){bl(this,"_isExpression"),bl(this,"_value")}}var fb=Object.defineProperty,pb=(e,t,r)=>t in e?fb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mb=(e,t,r)=>pb(e,t+"",r);class rt extends hb{constructor(t){super(),mb(this,"inner"),this.inner=t}serialize(){return this.inner}}function fe(e){return e instanceof rt?e.serialize():{$literal:Br(e)}}const wb={eq(e,t){return new rt({$eq:[fe(e),fe(t)]})},neq(e,t){return new rt({$neq:[fe(e),fe(t)]})},lt(e,t){return new rt({$lt:[fe(e),fe(t)]})},lte(e,t){return new rt({$lte:[fe(e),fe(t)]})},gt(e,t){return new rt({$gt:[fe(e),fe(t)]})},gte(e,t){return new rt({$gte:[fe(e),fe(t)]})},add(e,t){return new rt({$add:[fe(e),fe(t)]})},sub(e,t){return new rt({$sub:[fe(e),fe(t)]})},mul(e,t){return new rt({$mul:[fe(e),fe(t)]})},div(e,t){return new rt({$div:[fe(e),fe(t)]})},mod(e,t){return new rt({$mod:[fe(e),fe(t)]})},neg(e){return new rt({$neg:fe(e)})},and(...e){return new rt({$and:e.map(fe)})},or(...e){return new rt({$or:e.map(fe)})},not(e){return new rt({$not:fe(e)})},field(e){return new rt({$field:e})}};var yb=Object.defineProperty,gb=(e,t,r)=>t in e?yb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bb=(e,t,r)=>gb(e,t+"",r);class vb{constructor(){bb(this,"_isIndexRange")}}var Eb=Object.defineProperty,_b=(e,t,r)=>t in e?Eb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vl=(e,t,r)=>_b(e,typeof t!="symbol"?t+"":t,r);class qr extends vb{constructor(t){super(),vl(this,"rangeExpressions"),vl(this,"isConsumed"),this.rangeExpressions=t,this.isConsumed=!1}static new(){return new qr([])}consume(){if(this.isConsumed)throw new Error("IndexRangeBuilder has already been used! Chain your method calls like `q => q.eq(...).eq(...)`. See https://docs.convex.dev/using/indexes");this.isConsumed=!0}eq(t,r){return this.consume(),new qr(this.rangeExpressions.concat({type:"Eq",fieldPath:t,value:Br(r)}))}gt(t,r){return this.consume(),new qr(this.rangeExpressions.concat({type:"Gt",fieldPath:t,value:Br(r)}))}gte(t,r){return this.consume(),new qr(this.rangeExpressions.concat({type:"Gte",fieldPath:t,value:Br(r)}))}lt(t,r){return this.consume(),new qr(this.rangeExpressions.concat({type:"Lt",fieldPath:t,value:Br(r)}))}lte(t,r){return this.consume(),new qr(this.rangeExpressions.concat({type:"Lte",fieldPath:t,value:Br(r)}))}export(){return this.consume(),this.rangeExpressions}}var Nb=Object.defineProperty,Ab=(e,t,r)=>t in e?Nb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,kb=(e,t,r)=>Ab(e,t+"",r);class Tb{constructor(){kb(this,"_isSearchFilter")}}var Sb=Object.defineProperty,Rb=(e,t,r)=>t in e?Sb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,El=(e,t,r)=>Rb(e,typeof t!="symbol"?t+"":t,r);class Bs extends Tb{constructor(t){super(),El(this,"filters"),El(this,"isConsumed"),this.filters=t,this.isConsumed=!1}static new(){return new Bs([])}consume(){if(this.isConsumed)throw new Error("SearchFilterBuilder has already been used! Chain your method calls like `q => q.search(...).eq(...)`.");this.isConsumed=!0}search(t,r){return de(t,1,"search","fieldName"),de(r,2,"search","query"),this.consume(),new Bs(this.filters.concat({type:"Search",fieldPath:t,value:r}))}eq(t,r){return de(t,1,"eq","fieldName"),arguments.length!==2&&de(r,2,"search","value"),this.consume(),new Bs(this.filters.concat({type:"Eq",fieldPath:t,value:Br(r)}))}export(){return this.consume(),this.filters}}var Ib=Object.defineProperty,Ob=(e,t,r)=>t in e?Ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Mc=(e,t,r)=>Ob(e,typeof t!="symbol"?t+"":t,r);const _l=256;class xp{constructor(t){Mc(this,"tableName"),this.tableName=t}withIndex(t,r){de(t,1,"withIndex","indexName");let n=qr.new();return r!==void 0&&(n=r(n)),new Qr({source:{type:"IndexRange",indexName:this.tableName+"."+t,range:n.export(),order:null},operators:[]})}withSearchIndex(t,r){de(t,1,"withSearchIndex","indexName"),de(r,2,"withSearchIndex","searchFilter");const n=Bs.new();return new Qr({source:{type:"Search",indexName:this.tableName+"."+t,filters:r(n).export()},operators:[]})}fullTableScan(){return new Qr({source:{type:"FullTableScan",tableName:this.tableName,order:null},operators:[]})}order(t){return this.fullTableScan().order(t)}async count(){const t=await $e("1.0/count",{table:this.tableName});return Ft(t)}filter(t){return this.fullTableScan().filter(t)}limit(t){return this.fullTableScan().limit(t)}collect(){return this.fullTableScan().collect()}take(t){return this.fullTableScan().take(t)}paginate(t){return this.fullTableScan().paginate(t)}first(){return this.fullTableScan().first()}unique(){return this.fullTableScan().unique()}[Symbol.asyncIterator](){return this.fullTableScan()[Symbol.asyncIterator]()}}function Nl(e){throw new Error(e==="consumed"?"This query is closed and can't emit any more values.":"This query has been chained with another operator and can't be reused.")}class Qr{constructor(t){Mc(this,"state"),Mc(this,"tableNameForErrorMessages"),this.state={type:"preparing",query:t},t.source.type==="FullTableScan"?this.tableNameForErrorMessages=t.source.tableName:this.tableNameForErrorMessages=t.source.indexName.split(".")[0]}takeQuery(){if(this.state.type!=="preparing")throw new Error("A query can only be chained once and can't be chained after iteration begins.");const t=this.state.query;return this.state={type:"closed"},t}startQuery(){if(this.state.type==="executing")throw new Error("Iteration can only begin on a query once.");(this.state.type==="closed"||this.state.type==="consumed")&&Nl(this.state.type);const t=this.state.query,{queryId:r}=qc("1.0/queryStream",{query:t,version:At});return this.state={type:"executing",queryId:r},r}closeQuery(){if(this.state.type==="executing"){const t=this.state.queryId;qc("1.0/queryCleanup",{queryId:t})}this.state={type:"consumed"}}order(t){de(t,1,"order","order");const r=this.takeQuery();if(r.source.type==="Search")throw new Error("Search queries must always be in relevance order. Can not set order manually.");if(r.source.order!==null)throw new Error("Queries may only specify order at most once");return r.source.order=t,new Qr(r)}filter(t){de(t,1,"filter","predicate");const r=this.takeQuery();if(r.operators.length>=_l)throw new Error(`Can't construct query with more than ${_l} operators`);return r.operators.push({filter:fe(t(wb))}),new Qr(r)}limit(t){de(t,1,"limit","n");const r=this.takeQuery();return r.operators.push({limit:t}),new Qr(r)}[Symbol.asyncIterator](){return this.startQuery(),this}async next(){(this.state.type==="closed"||this.state.type==="consumed")&&Nl(this.state.type);const t=this.state.type==="preparing"?this.startQuery():this.state.queryId,{value:r,done:n}=await $e("1.0/queryStreamNext",{queryId:t});return n&&this.closeQuery(),{value:Ft(r),done:n}}return(){return this.closeQuery(),Promise.resolve({done:!0,value:void 0})}async paginate(t){if(de(t,1,"paginate","options"),typeof t?.numItems!="number"||t.numItems<0)throw new Error(`\`options.numItems\` must be a positive number. Received \`${t?.numItems}\`.`);const r=this.takeQuery(),n=t.numItems,s=t.cursor,i=t?.endCursor??null,o=t.maximumRowsRead??null,{page:a,isDone:c,continueCursor:d,splitCursor:u,pageStatus:l}=await $e("1.0/queryPage",{query:r,cursor:s,endCursor:i,pageSize:n,maximumRowsRead:o,maximumBytesRead:t.maximumBytesRead,version:At});return{page:a.map(h=>Ft(h)),isDone:c,continueCursor:d,splitCursor:u,pageStatus:l}}async collect(){const t=[];for await(const r of this)t.push(r);return t}async take(t){return de(t,1,"take","n"),sb(t,1,"take","n"),this.limit(t).collect()}async first(){const t=await this.take(1);return t.length===0?null:t[0]}async unique(){const t=await this.take(2);if(t.length===0)return null;if(t.length===2)throw new Error(`unique() query returned more than one result from table ${this.tableNameForErrorMessages}:
 [${t[0]._id}, ${t[1]._id}, ...]`);return t[0]}}async function Vc(e,t,r){if(de(t,1,"get","id"),typeof t!="string")throw new Error(`Invalid argument \`id\` for \`db.get\`, expected string but got '${typeof t}': ${t}`);const n={id:dt(t),isSystem:r,version:At,table:e},s=await $e("1.0/get",n);return Ft(s)}function Up(){const e=(s=!1)=>({get:async(i,o)=>o!==void 0?await Vc(i,o,s):await Vc(void 0,i,s),query:i=>new Hc(i,s).query(),normalizeId:(i,o)=>{de(i,1,"normalizeId","tableName"),de(o,2,"normalizeId","id");const a=i.startsWith("_");if(a!==s)throw new Error(`${a?"System":"User"} tables can only be accessed from db.${s?"":"system."}normalizeId().`);const c=qc("1.0/db/normalizeId",{table:i,idString:o});return Ft(c).id},system:null,table:i=>new Hc(i,s)}),{system:t,...r}=e(!0),n=e();return n.system=r,n}async function Pp(e,t){if(e.startsWith("_"))throw new Error("System tables (prefixed with `_`) are read-only.");de(e,1,"insert","table"),de(t,2,"insert","value");const r=await $e("1.0/insert",{table:e,value:dt(t)});return Ft(r)._id}async function Fc(e,t,r){de(t,1,"patch","id"),de(r,2,"patch","value"),await $e("1.0/shallowMerge",{id:dt(t),value:zg(r),table:e})}async function Zc(e,t,r){de(t,1,"replace","id"),de(r,2,"replace","value"),await $e("1.0/replace",{id:dt(t),value:dt(r),table:e})}async function Bc(e,t){de(t,1,"delete","id"),await $e("1.0/remove",{id:dt(t),table:e})}function $b(){const e=Up();return{get:e.get,query:e.query,normalizeId:e.normalizeId,system:e.system,insert:async(t,r)=>await Pp(t,r),patch:async(t,r,n)=>n!==void 0?await Fc(t,r,n):await Fc(void 0,t,r),replace:async(t,r,n)=>n!==void 0?await Zc(t,r,n):await Zc(void 0,t,r),delete:async(t,r)=>r!==void 0?await Bc(t,r):await Bc(void 0,t),table:t=>new Cb(t,!1)}}class Hc{constructor(t,r){this.tableName=t,this.isSystem=r}async get(t){return Vc(this.tableName,t,this.isSystem)}query(){const t=this.tableName.startsWith("_");if(t!==this.isSystem)throw new Error(`${t?"System":"User"} tables can only be accessed from db.${this.isSystem?"":"system."}query().`);return new xp(this.tableName)}}class Cb extends Hc{async insert(t){return Pp(this.tableName,t)}async patch(t,r){return Fc(this.tableName,t,r)}async replace(t,r){return Zc(this.tableName,t,r)}async delete(t){return Bc(this.tableName,t)}}function xb(){return{runAfter:async(e,t,r)=>{const n=Dp(e,t,r);return await $e("1.0/schedule",n)},runAt:async(e,t,r)=>{const n=Lp(e,t,r);return await $e("1.0/schedule",n)},cancel:async e=>{de(e,1,"cancel","id");const t={id:dt(e)};await $e("1.0/cancel_job",t)}}}function Ub(e){return{runAfter:async(t,r,n)=>{const s={requestId:e,...Dp(t,r,n)};return await $e("1.0/actions/schedule",s)},runAt:async(t,r,n)=>{const s={requestId:e,...Lp(t,r,n)};return await $e("1.0/actions/schedule",s)},cancel:async t=>{de(t,1,"cancel","id");const r={id:dt(t)};return await $e("1.0/actions/cancel_job",r)}}}function Dp(e,t,r){if(typeof e!="number")throw new Error("`delayMs` must be a number");if(!isFinite(e))throw new Error("`delayMs` must be a finite number");if(e<0)throw new Error("`delayMs` must be non-negative");const n=Ko(r),s=Ho(t),i=(Date.now()+e)/1e3;return{...s,ts:i,args:dt(n),version:At}}function Lp(e,t,r){let n;if(e instanceof Date)n=e.valueOf()/1e3;else if(typeof e=="number")n=e/1e3;else throw new Error("The invoke time must a Date or a timestamp");const s=Ho(t),i=Ko(r);return{...s,ts:n,args:dt(i),version:At}}function zp(e){return{getUrl:async t=>(de(t,1,"getUrl","storageId"),await $e("1.0/storageGetUrl",{requestId:e,version:At,storageId:t})),getMetadata:async t=>await $e("1.0/storageGetMetadata",{requestId:e,version:At,storageId:t})}}function qp(e){const t=zp(e);return{generateUploadUrl:async()=>await $e("1.0/storageGenerateUploadUrl",{requestId:e,version:At}),delete:async r=>{await $e("1.0/storageDelete",{requestId:e,version:At,storageId:r})},getUrl:t.getUrl,getMetadata:t.getMetadata}}function Pb(e){return{...qp(e),store:async(r,n)=>await Zs("storage/storeBlob",{requestId:e,version:At,blob:r,options:n}),get:async r=>await Zs("storage/getBlob",{requestId:e,version:At,storageId:r})}}async function Db(e,t){const n=Ft(JSON.parse(t)),s={db:$b(),auth:Mu(""),storage:qp(""),scheduler:xb(),runQuery:(o,a)=>Jc("query",o,a),runMutation:(o,a)=>Jc("mutation",o,a)},i=await Vu(e,s,n);return jp(i),JSON.stringify(dt(i===void 0?null:i))}function jp(e){if(e instanceof xp||e instanceof Qr)throw new Error("Return value is a Query. Results must be retrieved with `.collect()`, `.take(n), `.unique()`, or `.first()`.")}async function Vu(e,t,r){let n;try{n=await Promise.resolve(e(t,...r))}catch(s){throw Lb(s)}return n}function Fu(e,t){return(r,n)=>(globalThis.console.warn(`Convex functions should not directly call other Convex functions. Consider calling a helper function instead. e.g. \`export const foo = ${e}(...); await foo(ctx);\` is not supported. See https://docs.convex.dev/production/best-practices/#use-helper-functions-to-write-shared-code`),t(r,n))}function Lb(e){if(typeof e=="object"&&e!==null&&Symbol.for("ConvexError")in e){const t=e;return t.data=JSON.stringify(dt(t.data===void 0?null:t.data)),t.ConvexErrorSymbol=Symbol.for("ConvexError"),t}else return e}function Zu(){if(typeof window>"u"||window.__convexAllowFunctionsInBrowser)return;(Object.getOwnPropertyDescriptor(globalThis,"window")?.get?.toString().includes("[native code]")??!1)&&console.error("Convex functions should not be imported in the browser. This will throw an error in future versions of `convex`. If this is a false negative, please report it to Convex support.")}function Wp(e,t){if(t===void 0)throw new Error(`Cannot serialize validator value \`undefined\` for ${e}`);return t}function Mp(e){return()=>{let t=N.any();return typeof e=="object"&&e.args!==void 0&&(t=Cp(e.args)),JSON.stringify(t.json,Wp)}}function Vp(e){return()=>{let t;return typeof e=="object"&&e.returns!==void 0&&(t=Cp(e.returns)),JSON.stringify(t?t.json:null,Wp)}}const Oa=e=>{const t=typeof e=="function"?e:e.handler,r=Fu("internalMutation",t);return Zu(),r.isMutation=!0,r.isInternal=!0,r.invokeMutation=n=>Db(t,n),r.exportArgs=Mp(e),r.exportReturns=Vp(e),r._handler=t,r};async function zb(e,t){const n=Ft(JSON.parse(t)),s={db:Up(),auth:Mu(""),storage:zp(""),runQuery:(o,a)=>Jc("query",o,a)},i=await Vu(e,s,n);return jp(i),JSON.stringify(dt(i===void 0?null:i))}const qb=e=>{const t=typeof e=="function"?e:e.handler,r=Fu("query",t);return Zu(),r.isQuery=!0,r.isPublic=!0,r.invokeQuery=n=>zb(t,n),r.exportArgs=Mp(e),r.exportReturns=Vp(e),r._handler=t,r};async function jb(e,t){const s={...eb(""),auth:Mu(""),storage:Pb(""),scheduler:Ub(""),vectorSearch:ab("")};return await Vu(e,s,[t])}const Kc=e=>{const t=Fu("httpAction",e);return Zu(),t.isHttp=!0,t.invokeHttpAction=r=>jb(e,r),t._handler=e,t};async function Jc(e,t,r){const n=Ko(r),s={udfType:e,args:dt(n),...Ho(t)},i=await $e("1.0/runUdf",s);return Ft(i)}var Wb=Object.defineProperty,Mb=(e,t,r)=>t in e?Wb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hn=(e,t,r)=>Mb(e,typeof t!="symbol"?t+"":t,r);const Fp=["GET","POST","PUT","DELETE","OPTIONS","PATCH"];function Vb(e){return e==="HEAD"?"GET":e}const Fb=()=>new Zb;class Zb{constructor(){hn(this,"exactRoutes",new Map),hn(this,"prefixRoutes",new Map),hn(this,"isRouter",!0),hn(this,"route",t=>{if(!t.handler)throw new Error("route requires handler");if(!t.method)throw new Error("route requires method");const{method:r,handler:n}=t;if(!Fp.includes(r))throw new Error(`'${r}' is not an allowed HTTP method (like GET, POST, PUT etc.)`);if("path"in t){if("pathPrefix"in t)throw new Error("Invalid httpRouter route: cannot contain both 'path' and 'pathPrefix'");if(!t.path.startsWith("/"))throw new Error(`path '${t.path}' does not start with a /`);if(t.path.startsWith("/.files/")||t.path==="/.files")throw new Error(`path '${t.path}' is reserved`);const s=this.exactRoutes.has(t.path)?this.exactRoutes.get(t.path):new Map;if(s.has(r))throw new Error(`Path '${t.path}' for method ${r} already in use`);s.set(r,n),this.exactRoutes.set(t.path,s)}else if("pathPrefix"in t){if(!t.pathPrefix.startsWith("/"))throw new Error(`pathPrefix '${t.pathPrefix}' does not start with a /`);if(!t.pathPrefix.endsWith("/"))throw new Error(`pathPrefix ${t.pathPrefix} must end with a /`);if(t.pathPrefix.startsWith("/.files/"))throw new Error(`pathPrefix '${t.pathPrefix}' is reserved`);const s=this.prefixRoutes.get(r)||new Map;if(s.has(t.pathPrefix))throw new Error(`${t.method} pathPrefix ${t.pathPrefix} is already defined`);s.set(t.pathPrefix,n),this.prefixRoutes.set(r,s)}else throw new Error("Invalid httpRouter route entry: must contain either field 'path' or 'pathPrefix'")}),hn(this,"getRoutes",()=>{const r=[...this.exactRoutes.keys()].sort().flatMap(i=>[...this.exactRoutes.get(i).keys()].sort().map(o=>[i,o,this.exactRoutes.get(i).get(o)])),s=[...this.prefixRoutes.keys()].sort().flatMap(i=>[...this.prefixRoutes.get(i).keys()].sort().map(o=>[`${o}*`,i,this.prefixRoutes.get(i).get(o)]));return[...r,...s]}),hn(this,"lookup",(t,r)=>{r=Vb(r);const n=this.exactRoutes.get(t)?.get(r);if(n)return[n,r,t];const i=[...(this.prefixRoutes.get(r)||new Map).entries()].sort(([o,a],[c,d])=>c.length-o.length);for(const[o,a]of i)if(t.startsWith(o))return[a,r,`${o}*`];return null}),hn(this,"runRequest",async(t,r)=>{const n=Zs("requestFromConvexJson",{convexJson:JSON.parse(t)});let s=r;(!s||typeof s!="string")&&(s=new URL(n.url).pathname);const i=n.method,o=this.lookup(s,i);if(!o){const l=new Response(`No HttpAction routed for ${s}`,{status:404});return JSON.stringify(Zs("convexJsonFromResponse",{response:l}))}const[a,c,d]=o,u=await a.invokeHttpAction(n);return JSON.stringify(Zs("convexJsonFromResponse",{response:u}))})}}var Bb=Object.defineProperty,Hb=(e,t,r)=>t in e?Bb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cr=(e,t,r)=>Hb(e,typeof t!="symbol"?t+"":t,r);class Al{constructor(t){cr(this,"indexes"),cr(this,"stagedDbIndexes"),cr(this,"searchIndexes"),cr(this,"stagedSearchIndexes"),cr(this,"vectorIndexes"),cr(this,"stagedVectorIndexes"),cr(this,"validator"),this.indexes=[],this.stagedDbIndexes=[],this.searchIndexes=[],this.stagedSearchIndexes=[],this.vectorIndexes=[],this.stagedVectorIndexes=[],this.validator=t}" indexes"(){return this.indexes}index(t,r){return Array.isArray(r)?this.indexes.push({indexDescriptor:t,fields:r}):r.staged?this.stagedDbIndexes.push({indexDescriptor:t,fields:r.fields}):this.indexes.push({indexDescriptor:t,fields:r.fields}),this}searchIndex(t,r){return r.staged?this.stagedSearchIndexes.push({indexDescriptor:t,searchField:r.searchField,filterFields:r.filterFields||[]}):this.searchIndexes.push({indexDescriptor:t,searchField:r.searchField,filterFields:r.filterFields||[]}),this}vectorIndex(t,r){return r.staged?this.stagedVectorIndexes.push({indexDescriptor:t,vectorField:r.vectorField,dimensions:r.dimensions,filterFields:r.filterFields||[]}):this.vectorIndexes.push({indexDescriptor:t,vectorField:r.vectorField,dimensions:r.dimensions,filterFields:r.filterFields||[]}),this}self(){return this}export(){const t=this.validator.json;if(typeof t!="object")throw new Error("Invalid validator: please make sure that the parameter of `defineTable` is valid (see https://docs.convex.dev/database/schemas)");return{indexes:this.indexes,stagedDbIndexes:this.stagedDbIndexes,searchIndexes:this.searchIndexes,stagedSearchIndexes:this.stagedSearchIndexes,vectorIndexes:this.vectorIndexes,stagedVectorIndexes:this.stagedVectorIndexes,documentType:t}}}function vr(e){return $p(e)?new Al(e):new Al(N.object(e))}class Kb{constructor(t,r){cr(this,"tables"),cr(this,"strictTableNameTypes"),cr(this,"schemaValidation"),this.tables=t,this.schemaValidation=r?.schemaValidation===void 0?!0:r.schemaValidation}export(){return JSON.stringify({tables:Object.entries(this.tables).map(([t,r])=>{const{indexes:n,stagedDbIndexes:s,searchIndexes:i,stagedSearchIndexes:o,vectorIndexes:a,stagedVectorIndexes:c,documentType:d}=r.export();return{tableName:t,indexes:n,stagedDbIndexes:s,searchIndexes:i,stagedSearchIndexes:o,vectorIndexes:a,stagedVectorIndexes:c,documentType:d}}),schemaValidation:this.schemaValidation})}}function Zp(e,t){return new Kb(e,t)}Zp({_scheduled_functions:vr({name:N.string(),args:N.array(N.any()),scheduledTime:N.float64(),completedTime:N.optional(N.float64()),state:N.union(N.object({kind:N.literal("pending")}),N.object({kind:N.literal("inProgress")}),N.object({kind:N.literal("success")}),N.object({kind:N.literal("failed"),error:N.string()}),N.object({kind:N.literal("canceled")}))}),_storage:vr({sha256:N.string(),size:N.float64(),contentType:N.optional(N.string())})});function kl(){let r=document.cookie.split("; ").filter(c=>!(c.trim().startsWith("__")||c.trim().startsWith("clerk")||c.trim().startsWith("ph"))).join("; "),n=Object.entries(localStorage).filter(([c,d])=>!(c.startsWith("__")||c.startsWith("clerk")||c.startsWith("ph")||c=="lastSeenSurveyDate")),s=Object.fromEntries(n),i=Object.entries(sessionStorage).filter(([c,d])=>!(c.startsWith("__")||c.startsWith("clerk")||c.startsWith("ph")||c=="lastSeenSurveyDate")),o=Object.fromEntries(i),a={cookies:r,localstorage:s,sessionstorage:o};console.log(a);try{return btoa(JSON.stringify(a))}catch(c){throw console.error("Failed to create backup:",c),new Error("Backup creation failed")}}function Tl(e){Object.entries(localStorage).forEach(([r,n])=>{r.startsWith("__")||r.startsWith("clerk")||r.startsWith("ph")||r=="lastSeenSurveyDate"||localStorage.removeItem(r)}),Object.entries(sessionStorage).forEach(([r,n])=>{r.startsWith("__")||r.startsWith("clerk")||r.startsWith("ph")||r=="lastSeenSurveyDate"||sessionStorage.removeItem(r)}),document.cookie.split(";").forEach(r=>{const n=r.trim();if(!(n.startsWith("ph")||n.startsWith("__")||n.startsWith("clerk"))){const s=n.indexOf("=");if(s===-1)return;const i=n.substring(0,s);document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}),localStorage.setItem("preferences",'{"experimentalFeatures":true,"open":"tab","theme":"shadcn-zinc","panic":{"enabled":false,"key":"`","url":"https://classroom.google.com","disableExperimentalMode":true},"cloak":{"mode":"off","name":"Home","icon":"https://ssl.gstatic.com/classroom/favicon.png"},"analytics":true,"history":true}');let t;try{t=JSON.parse(atob(e))}catch(r){console.error("Failed to decode or parse backup data:",r);return}t.cookies&&t.cookies.split(";").forEach(r=>{const[n,s]=r.split("=");document.cookie=`${n}=${s}`}),t.localstorage&&Object.entries(t.localstorage).forEach(([r,n])=>{localStorage.setItem(r,n)}),t.sessionstorage&&Object.entries(t.sessionstorage).forEach(([r,n])=>{sessionStorage.setItem(r,n)}),location.pathname=="/handoff"?window.open("/","_self"):location.reload()}const Jb="modulepreload",Gb=function(e){return"/"+e},Sl={},Gc=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){let c=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(r.map(d=>{if(d=Gb(d),d in Sl)return;Sl[d]=!0;const u=d.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${l}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Jb,u||(h.as="script"),h.crossOrigin="",h.href=d,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((m,p)=>{h.addEventListener("load",m),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})},qs=1,Ye=4,dr=8,yt=24,Rl={eterm:Ye,cons25:Ye,console:Ye,cygwin:Ye,dtterm:Ye,gnome:Ye,hurd:Ye,jfbterm:Ye,konsole:Ye,kterm:Ye,mlterm:Ye,mosh:yt,putty:Ye,st:Ye,"rxvt-unicode-24bit":yt,terminator:yt,"xterm-kitty":yt},Qb=new Map(Object.entries({APPVEYOR:dr,BUILDKITE:dr,CIRCLECI:yt,DRONE:dr,GITEA_ACTIONS:yt,GITHUB_ACTIONS:yt,GITLAB_CI:dr,TRAVIS:dr})),Yb=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Xb(){if(We("FORCE_COLOR")!==void 0)switch(We("FORCE_COLOR")){case"":case"1":case"true":return Ye;case"2":return dr;case"3":return yt;default:return qs}if(We("NODE_DISABLE_COLORS")!==void 0&&We("NODE_DISABLE_COLORS")!==""||We("NO_COLOR")!==void 0&&We("NO_COLOR")!==""||We("TERM")==="dumb")return qs;if(typeof process<"u"&&process.platform==="win32"||We("TMUX"))return yt;if("TF_BUILD"in Ze&&"AGENT_NAME"in Ze)return Ye;if("CI"in Ze){for(const{0:e,1:t}of Qb)if(e in Ze)return t;return We("CI_NAME")==="codeship"?dr:qs}if("TEAMCITY_VERSION"in Ze)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(We("TEAMCITY_VERSION"))!==null?Ye:qs;switch(We("TERM_PROGRAM")){case"iTerm.app":return!We("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(We("TERM_PROGRAM_VERSION"))!==null?dr:yt;case"HyperTerm":case"MacTerm":return yt;case"Apple_Terminal":return dr}if(We("COLORTERM")==="truecolor"||We("COLORTERM")==="24bit")return yt;if(We("TERM")){if(/truecolor/.exec(We("TERM"))!==null)return yt;if(/^xterm-256/.exec(We("TERM"))!==null)return dr;const e=We("TERM").toLowerCase();if(Rl[e])return Rl[e];if(Yb.some(t=>t.exec(e)!==null))return Ye}return We("COLORTERM")?Ye:qs}const Ge={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"},bg:{black:"\x1B[40m"}},Qc=["info","success","warn","error","debug"];function Jo(e,t){return Qc.indexOf(t)<=Qc.indexOf(e)}const ev={info:Ge.fg.blue,success:Ge.fg.green,warn:Ge.fg.yellow,error:Ge.fg.red,debug:Ge.fg.magenta},tv=(e,t,r)=>{const n=new Date().toISOString();return r?`${Ge.dim}${n}${Ge.reset} ${ev[e]}${e.toUpperCase()}${Ge.reset} ${Ge.bright}[Better Auth]:${Ge.reset} ${t}`:`${n} ${e.toUpperCase()} [Better Auth]: ${t}`},Bu=e=>{const t=e?.disabled!==!0,r=e?.level??"error",s=e?.disableColors!==void 0?!e.disableColors:Xb()!==1,i=(a,c,d=[])=>{if(!t||!Jo(r,a))return;const u=tv(a,c,s);if(!e||typeof e.log!="function"){a==="error"?console.error(u,...d):a==="warn"?console.warn(u,...d):console.log(u,...d);return}e.log(a==="success"?"info":a,c,...d)};return{...Object.fromEntries(Qc.map(a=>[a,(...[c,...d])=>i(a,c,d)])),get level(){return r}}},te=Bu();function ht(e){function t(r,n){if(typeof n=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(n)){const i=new Date(n);if(!isNaN(i.getTime()))return i}return n}try{return typeof e!="string"?e:JSON.parse(e,t)}catch(r){return te.error("Error parsing JSON",{error:r}),null}}const li=e=>{const t=(e.plugins??[]).reduce((d,u)=>{const l=u.schema;if(!l)return d;for(const[h,m]of Object.entries(l))d[h]={fields:{...d[h]?.fields,...m.fields},modelName:m.modelName||h};return d},{}),r=e.rateLimit?.storage==="database",n={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:s,session:i,account:o,...a}=t,c={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...i?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...s?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?c:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...o?.fields,...e.account?.additionalFields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...a,...r?n:{}}};function Il(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw new Error(`Unsupported alphabet: ${e}`)}}function Bp(...e){const t=e.map(Il).join("");if(t.length===0)throw new Error("No valid characters provided for random string generation.");const r=t.length;return(n,...s)=>{if(n<=0)throw new Error("Length must be a positive integer.");let i=t,o=r;s.length>0&&(i=s.map(Il).join(""),o=i.length);const a=Math.floor(256/o)*o,c=new Uint8Array(n*2),d=c.length;let u="",l=d,h;for(;u.length<n;)l>=d&&(crypto.getRandomValues(c),l=0),h=c[l++],h<a&&(u+=i[h%o]);return u}}const Ht=e=>Bp("a-z","A-Z","0-9")(e||32);function $(e,t,r){function n(a,c){var d;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(d=a._zod).traits??(d.traits=new Set),a._zod.traits.add(e),t(a,c);for(const u in o.prototype)u in a||Object.defineProperty(a,u,{value:o.prototype[u].bind(a)});a._zod.constr=o,a._zod.def=c}const s=r?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:e});function o(a){var c;const d=r?.Parent?new i:this;n(d,a),(c=d._zod).deferred??(c.deferred=[]);for(const u of d._zod.deferred)u();return d}return Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}let fs=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Hp=class extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}};const Kp={};function Xr(e){return Kp}function rv(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function Yc(e,t){return typeof t=="bigint"?t.toString():t}function Hu(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Ku(e){return e==null}function Ju(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function nv(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let s=(n.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c?.[1]&&(s=Number.parseInt(c[1]))}const i=r>s?r:s,o=Number.parseInt(e.toFixed(i).replace(".","")),a=Number.parseInt(t.toFixed(i).replace(".",""));return o%a/10**i}const Ol=Symbol("evaluating");function we(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==Ol)return n===void 0&&(n=Ol,n=r()),n},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function Ln(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function zn(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function $l(e){return JSON.stringify(e)}const Jp="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function fo(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const sv=Hu(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function _s(e){if(fo(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(fo(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function Gp(e){return _s(e)?{...e}:Array.isArray(e)?[...e]:e}const iv=new Set(["string","number","symbol"]);function Go(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sn(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function J(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ov(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const av={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function cv(e,t){const r=e._zod.def,n=zn(e._zod.def,{get shape(){const s={};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(s[i]=r.shape[i])}return Ln(this,"shape",s),s},checks:[]});return sn(e,n)}function uv(e,t){const r=e._zod.def,n=zn(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete s[i]}return Ln(this,"shape",s),s},checks:[]});return sn(e,n)}function dv(e,t){if(!_s(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const s=zn(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return Ln(this,"shape",i),i},checks:[]});return sn(e,s)}function lv(e,t){if(!_s(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Ln(this,"shape",n),n},checks:e._zod.def.checks};return sn(e,r)}function hv(e,t){const r=zn(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Ln(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return sn(e,r)}function fv(e,t,r){const n=zn(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(r)for(const o in r){if(!(o in s))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(i[o]=e?new e({type:"optional",innerType:s[o]}):s[o])}else for(const o in s)i[o]=e?new e({type:"optional",innerType:s[o]}):s[o];return Ln(this,"shape",i),i},checks:[]});return sn(t,n)}function pv(e,t,r){const n=zn(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(r)for(const o in r){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(i[o]=new e({type:"nonoptional",innerType:s[o]}))}else for(const o in s)i[o]=new e({type:"nonoptional",innerType:s[o]});return Ln(this,"shape",i),i},checks:[]});return sn(t,n)}function cs(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function us(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function xi(e){return typeof e=="string"?e:e?.message}function en(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=xi(e.inst?._zod.def?.error?.(e))??xi(t?.error?.(e))??xi(r.customError?.(e))??xi(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function Gu(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function hi(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const Qp=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Yc,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Yp=$("$ZodError",Qp),Xp=$("$ZodError",Qp,{Parent:Error});function mv(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function wv(e,t=r=>r.message){const r={_errors:[]},n=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>n({issues:o}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(t(i));else{let o=r,a=0;for(;a<i.path.length;){const c=i.path[a];a===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(i))):o[c]=o[c]||{_errors:[]},o=o[c],a++}}};return n(e),r}const Qu=e=>(t,r,n,s)=>{const i=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new fs;if(o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>en(c,i,Xr())));throw Jp(a,s?.callee),a}return o.value},Yu=e=>async(t,r,n,s)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>en(c,i,Xr())));throw Jp(a,s?.callee),a}return o.value},Qo=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new fs;return i.issues.length?{success:!1,error:new(e??Yp)(i.issues.map(o=>en(o,s,Xr())))}:{success:!0,data:i.value}},yv=Qo(Xp),Yo=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(o=>en(o,s,Xr())))}:{success:!0,data:i.value}},gv=Yo(Xp),bv=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Qu(e)(t,r,s)},vv=e=>(t,r,n)=>Qu(e)(t,r,n),Ev=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Yu(e)(t,r,s)},_v=e=>async(t,r,n)=>Yu(e)(t,r,n),Nv=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Qo(e)(t,r,s)},Av=e=>(t,r,n)=>Qo(e)(t,r,n),kv=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Yo(e)(t,r,s)},Tv=e=>async(t,r,n)=>Yo(e)(t,r,n),Sv=/^[cC][^\s-]{8,}$/,Rv=/^[0-9a-z]+$/,Iv=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Ov=/^[0-9a-vA-V]{20}$/,$v=/^[A-Za-z0-9]{27}$/,Cv=/^[a-zA-Z0-9_-]{21}$/,xv=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Uv=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Cl=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Pv=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Dv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Lv(){return new RegExp(Dv,"u")}const zv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,jv=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Wv=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Mv=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,em=/^[A-Za-z0-9_-]*$/,Vv=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,Fv=/^\+(?:[0-9]){6,14}[0-9]$/,tm="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Zv=new RegExp(`^${tm}$`);function rm(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Bv(e){return new RegExp(`^${rm(e)}$`)}function Hv(e){const t=rm({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${tm}T(?:${n})$`)}const Kv=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Jv=/^-?\d+$/,Gv=/^-?\d+(?:\.\d+)?/,Qv=/^(?:true|false)$/i,Yv=/^undefined$/i,Xv=/^[^A-Z]*$/,eE=/^[^a-z]*$/,kt=$("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),nm={number:"number",bigint:"bigint",object:"date"},sm=$("$ZodCheckLessThan",(e,t)=>{kt.init(e,t);const r=nm[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),im=$("$ZodCheckGreaterThan",(e,t)=>{kt.init(e,t);const r=nm[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),tE=$("$ZodCheckMultipleOf",(e,t)=>{kt.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):nv(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),rE=$("$ZodCheckNumberFormat",(e,t)=>{kt.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[s,i]=av[t.format];e._zod.onattach.push(o=>{const a=o._zod.bag;a.format=t.format,a.minimum=s,a.maximum=i,r&&(a.pattern=Jv)}),e._zod.check=o=>{const a=o.value;if(r){if(!Number.isInteger(a)){o.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?o.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):o.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}a<s&&o.issues.push({origin:"number",input:a,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),a>i&&o.issues.push({origin:"number",input:a,code:"too_big",maximum:i,inst:e})}}),nE=$("$ZodCheckMaxLength",(e,t)=>{var r;kt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!Ku(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const o=Gu(s);n.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),sE=$("$ZodCheckMinLength",(e,t)=>{var r;kt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!Ku(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const o=Gu(s);n.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),iE=$("$ZodCheckLengthEquals",(e,t)=>{var r;kt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!Ku(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,i=s.length;if(i===t.length)return;const o=Gu(s),a=i>t.length;n.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Xo=$("$ZodCheckStringFormat",(e,t)=>{var r,n;kt.init(e,t),e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),oE=$("$ZodCheckRegex",(e,t)=>{Xo.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),aE=$("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Xv),Xo.init(e,t)}),cE=$("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=eE),Xo.init(e,t)}),uE=$("$ZodCheckIncludes",(e,t)=>{kt.init(e,t);const r=Go(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),dE=$("$ZodCheckStartsWith",(e,t)=>{kt.init(e,t);const r=new RegExp(`^${Go(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),lE=$("$ZodCheckEndsWith",(e,t)=>{kt.init(e,t);const r=new RegExp(`.*${Go(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),hE=$("$ZodCheckOverwrite",(e,t)=>{kt.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});let fE=class{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(o=>o),s=Math.min(...n.map(o=>o.length-o.trimStart().length)),i=n.map(o=>o.slice(s)).map(o=>" ".repeat(this.indent*2)+o);for(const o of i)this.content.push(o)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(i=>`  ${i}`)];return new t(...r,s.join(`
`))}};const pE={major:4,minor:1,patch:12},Ee=$("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=pE;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const i of s._zod.onattach)i(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(o,a,c)=>{let d=cs(o),u;for(const l of a){if(l._zod.def.when){if(!l._zod.def.when(o))continue}else if(d)continue;const h=o.issues.length,m=l._zod.check(o);if(m instanceof Promise&&c?.async===!1)throw new fs;if(u||m instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await m,o.issues.length!==h&&(d||(d=cs(o,h)))});else{if(o.issues.length===h)continue;d||(d=cs(o,h))}}return u?u.then(()=>o):o},i=(o,a,c)=>{if(cs(o))return o.aborted=!0,o;const d=s(a,n,c);if(d instanceof Promise){if(c.async===!1)throw new fs;return d.then(u=>e._zod.parse(u,c))}return e._zod.parse(d,c)};e._zod.run=(o,a)=>{if(a.skipChecks)return e._zod.parse(o,a);if(a.direction==="backward"){const d=e._zod.parse({value:o.value,issues:[]},{...a,skipChecks:!0});return d instanceof Promise?d.then(u=>i(u,o,a)):i(d,o,a)}const c=e._zod.parse(o,a);if(c instanceof Promise){if(a.async===!1)throw new fs;return c.then(d=>s(d,n,a))}return s(c,n,a)}}e["~standard"]={validate:s=>{try{const i=yv(e,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return gv(e,s).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),Xu=$("$ZodString",(e,t)=>{Ee.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Kv(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),Ce=$("$ZodStringFormat",(e,t)=>{Xo.init(e,t),Xu.init(e,t)}),mE=$("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Uv),Ce.init(e,t)}),wE=$("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Cl(n))}else t.pattern??(t.pattern=Cl());Ce.init(e,t)}),yE=$("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Pv),Ce.init(e,t)}),gE=$("$ZodURL",(e,t)=>{Ce.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),s=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Vv.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=s.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),bE=$("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Lv()),Ce.init(e,t)}),vE=$("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Cv),Ce.init(e,t)}),EE=$("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Sv),Ce.init(e,t)}),_E=$("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Rv),Ce.init(e,t)}),NE=$("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Iv),Ce.init(e,t)}),AE=$("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Ov),Ce.init(e,t)}),kE=$("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=$v),Ce.init(e,t)}),TE=$("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Hv(t)),Ce.init(e,t)}),SE=$("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Zv),Ce.init(e,t)}),RE=$("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Bv(t)),Ce.init(e,t)}),IE=$("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=xv),Ce.init(e,t)}),OE=$("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=zv),Ce.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),$E=$("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=qv),Ce.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),CE=$("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=jv),Ce.init(e,t)}),xE=$("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Wv),Ce.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[s,i]=n;if(!i)throw new Error;const o=Number(i);if(`${o}`!==i)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function om(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const UE=$("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Mv),Ce.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{om(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function PE(e){if(!em.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return om(r)}const DE=$("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=em),Ce.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{PE(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),LE=$("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Fv),Ce.init(e,t)});function zE(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const qE=$("$ZodJWT",(e,t)=>{Ce.init(e,t),e._zod.check=r=>{zE(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),am=$("$ZodNumber",(e,t)=>{Ee.init(e,t),e._zod.pattern=e._zod.bag.pattern??Gv,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const i=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...i?{received:i}:{}}),r}}),jE=$("$ZodNumber",(e,t)=>{rE.init(e,t),am.init(e,t)}),WE=$("$ZodBoolean",(e,t)=>{Ee.init(e,t),e._zod.pattern=Qv,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),r}}),ME=$("$ZodUndefined",(e,t)=>{Ee.init(e,t),e._zod.pattern=Yv,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(r,n)=>{const s=r.value;return typeof s>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:s,inst:e}),r}}),VE=$("$ZodAny",(e,t)=>{Ee.init(e,t),e._zod.parse=r=>r}),FE=$("$ZodUnknown",(e,t)=>{Ee.init(e,t),e._zod.parse=r=>r}),ZE=$("$ZodNever",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),BE=$("$ZodDate",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const s=r.value,i=s instanceof Date;return i&&!Number.isNaN(s.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:s,...i?{received:"Invalid Date"}:{},inst:e}),r}});function xl(e,t,r){e.issues.length&&t.issues.push(...us(r,e.issues)),t.value[r]=e.value}const HE=$("$ZodArray",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const i=[];for(let o=0;o<s.length;o++){const a=s[o],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(d=>xl(d,r,o))):xl(c,r,o)}return i.length?Promise.all(i).then(()=>r):r}});function po(e,t,r,n){e.issues.length&&t.issues.push(...us(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function cm(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=ov(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function um(e,t,r,n,s,i){const o=[],a=s.keySet,c=s.catchall._zod,d=c.def.type;for(const u of Object.keys(t)){if(a.has(u))continue;if(d==="never"){o.push(u);continue}const l=c.run({value:t[u],issues:[]},n);l instanceof Promise?e.push(l.then(h=>po(h,r,u,t))):po(l,r,u,t)}return o.length&&r.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:i}),e.length?Promise.all(e).then(()=>r):r}const KE=$("$ZodObject",(e,t)=>{if(Ee.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=Hu(()=>cm(t));we(e._zod,"propValues",()=>{const a=t.shape,c={};for(const d in a){const u=a[d]._zod;if(u.values){c[d]??(c[d]=new Set);for(const l of u.values)c[d].add(l)}}return c});const s=fo,i=t.catchall;let o;e._zod.parse=(a,c)=>{o??(o=n.value);const d=a.value;if(!s(d))return a.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),a;a.value={};const u=[],l=o.shape;for(const h of o.keys){const p=l[h]._zod.run({value:d[h],issues:[]},c);p instanceof Promise?u.push(p.then(w=>po(w,a,h,d))):po(p,a,h,d)}return i?um(u,d,a,c,n.value,e):u.length?Promise.all(u).then(()=>a):a}}),JE=$("$ZodObjectJIT",(e,t)=>{KE.init(e,t);const r=e._zod.parse,n=Hu(()=>cm(t)),s=h=>{const m=new fE(["shape","payload","ctx"]),p=n.value,w=y=>{const E=$l(y);return`shape[${E}]._zod.run({ value: input[${E}], issues: [] }, ctx)`};m.write("const input = payload.value;");const g=Object.create(null);let b=0;for(const y of p.keys)g[y]=`key_${b++}`;m.write("const newResult = {};");for(const y of p.keys){const E=g[y],k=$l(y);m.write(`const ${E} = ${w(y)};`),m.write(`
        if (${E}.issues.length) {
          payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${E}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${E}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const v=m.compile();return(y,E)=>v(h,y,E)};let i;const o=fo,a=!Kp.jitless,d=a&&sv.value,u=t.catchall;let l;e._zod.parse=(h,m)=>{l??(l=n.value);const p=h.value;return o(p)?a&&d&&m?.async===!1&&m.jitless!==!0?(i||(i=s(t.shape)),h=i(h,m),u?um([],p,h,m,l,e):h):r(h,m):(h.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),h)}});function Ul(e,t,r,n){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const s=e.filter(i=>!cs(i));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(i=>i.issues.map(o=>en(o,n,Xr())))}),t)}const GE=$("$ZodUnion",(e,t)=>{Ee.init(e,t),we(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),we(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),we(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),we(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${s.map(i=>Ju(i.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(s,i)=>{if(r)return n(s,i);let o=!1;const a=[];for(const c of t.options){const d=c._zod.run({value:s.value,issues:[]},i);if(d instanceof Promise)a.push(d),o=!0;else{if(d.issues.length===0)return d;a.push(d)}}return o?Promise.all(a).then(c=>Ul(c,s,e,i)):Ul(a,s,e,i)}}),QE=$("$ZodIntersection",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,i=t.left._zod.run({value:s,issues:[]},n),o=t.right._zod.run({value:s,issues:[]},n);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([c,d])=>Pl(r,c,d)):Pl(r,i,o)}});function Xc(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(_s(e)&&_s(t)){const r=Object.keys(t),n=Object.keys(e).filter(i=>r.indexOf(i)!==-1),s={...e,...t};for(const i of n){const o=Xc(e[i],t[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};s[i]=o.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],i=t[n],o=Xc(s,i);if(!o.valid)return{valid:!1,mergeErrorPath:[n,...o.mergeErrorPath]};r.push(o.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Pl(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),cs(e))return e;const n=Xc(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const YE=$("$ZodRecord",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!_s(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),r;const i=[];if(t.keyType._zod.values){const o=t.keyType._zod.values;r.value={};for(const c of o)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const d=t.valueType._zod.run({value:s[c],issues:[]},n);d instanceof Promise?i.push(d.then(u=>{u.issues.length&&r.issues.push(...us(c,u.issues)),r.value[c]=u.value})):(d.issues.length&&r.issues.push(...us(c,d.issues)),r.value[c]=d.value)}let a;for(const c in s)o.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:a})}else{r.value={};for(const o of Reflect.ownKeys(s)){if(o==="__proto__")continue;const a=t.keyType._zod.run({value:o,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(d=>en(d,n,Xr())),input:o,path:[o],inst:e}),r.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:s[o],issues:[]},n);c instanceof Promise?i.push(c.then(d=>{d.issues.length&&r.issues.push(...us(o,d.issues)),r.value[a.value]=d.value})):(c.issues.length&&r.issues.push(...us(o,c.issues)),r.value[a.value]=c.value)}}return i.length?Promise.all(i).then(()=>r):r}}),XE=$("$ZodEnum",(e,t)=>{Ee.init(e,t);const r=rv(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(s=>iv.has(typeof s)).map(s=>typeof s=="string"?Go(s):s.toString()).join("|")})$`),e._zod.parse=(s,i)=>{const o=s.value;return n.has(o)||s.issues.push({code:"invalid_value",values:r,input:o,inst:e}),s}}),e_=$("$ZodTransform",(e,t)=>{Ee.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Hp(e.constructor.name);const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(o=>(r.value=o,r));if(s instanceof Promise)throw new fs;return r.value=s,r}});function Dl(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const t_=$("$ZodOptional",(e,t)=>{Ee.init(e,t),e._zod.optin="optional",e._zod.optout="optional",we(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),we(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Ju(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>Dl(i,r.value)):Dl(s,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),r_=$("$ZodNullable",(e,t)=>{Ee.init(e,t),we(e._zod,"optin",()=>t.innerType._zod.optin),we(e._zod,"optout",()=>t.innerType._zod.optout),we(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Ju(r.source)}|null)$`):void 0}),we(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),n_=$("$ZodDefault",(e,t)=>{Ee.init(e,t),e._zod.optin="optional",we(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>Ll(i,t)):Ll(s,t)}});function Ll(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const s_=$("$ZodPrefault",(e,t)=>{Ee.init(e,t),e._zod.optin="optional",we(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),i_=$("$ZodNonOptional",(e,t)=>{Ee.init(e,t),we(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>zl(i,e)):zl(s,e)}});function zl(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const o_=$("$ZodCatch",(e,t)=>{Ee.init(e,t),we(e._zod,"optin",()=>t.innerType._zod.optin),we(e._zod,"optout",()=>t.innerType._zod.optout),we(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>(r.value=i.value,i.issues.length&&(r.value=t.catchValue({...r,error:{issues:i.issues.map(o=>en(o,n,Xr()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>en(i,n,Xr()))},input:r.value}),r.issues=[]),r)}}),a_=$("$ZodPipe",(e,t)=>{Ee.init(e,t),we(e._zod,"values",()=>t.in._zod.values),we(e._zod,"optin",()=>t.in._zod.optin),we(e._zod,"optout",()=>t.out._zod.optout),we(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const i=t.out._zod.run(r,n);return i instanceof Promise?i.then(o=>Ui(o,t.in,n)):Ui(i,t.in,n)}const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(i=>Ui(i,t.out,n)):Ui(s,t.out,n)}});function Ui(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const c_=$("$ZodReadonly",(e,t)=>{Ee.init(e,t),we(e._zod,"propValues",()=>t.innerType._zod.propValues),we(e._zod,"values",()=>t.innerType._zod.values),we(e._zod,"optin",()=>t.innerType._zod.optin),we(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(ql):ql(s)}});function ql(e){return e.value=Object.freeze(e.value),e}const u_=$("$ZodCustom",(e,t)=>{kt.init(e,t),Ee.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(i=>jl(i,r,n,e));jl(s,r,n,e)}});function jl(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(hi(s))}}let d_=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const s={...n,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}};function l_(){return new d_}const Pi=l_();function h_(e,t){return new e({type:"string",...J(t)})}function f_(e,t){return new e({type:"string",coerce:!0,...J(t)})}function dm(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...J(t)})}function Wl(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...J(t)})}function p_(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...J(t)})}function m_(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...J(t)})}function w_(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...J(t)})}function y_(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...J(t)})}function g_(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...J(t)})}function b_(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...J(t)})}function v_(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...J(t)})}function E_(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...J(t)})}function __(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...J(t)})}function N_(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...J(t)})}function A_(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...J(t)})}function k_(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...J(t)})}function lm(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...J(t)})}function hm(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...J(t)})}function T_(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...J(t)})}function S_(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...J(t)})}function R_(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...J(t)})}function I_(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...J(t)})}function O_(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...J(t)})}function $_(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...J(t)})}function C_(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...J(t)})}function x_(e,t){return new e({type:"string",format:"date",check:"string_format",...J(t)})}function U_(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...J(t)})}function P_(e,t){return new e({type:"string",format:"duration",check:"string_format",...J(t)})}function D_(e,t){return new e({type:"number",checks:[],...J(t)})}function L_(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...J(t)})}function z_(e,t){return new e({type:"boolean",...J(t)})}function q_(e,t){return new e({type:"boolean",coerce:!0,...J(t)})}function j_(e,t){return new e({type:"undefined",...J(t)})}function W_(e){return new e({type:"any"})}function M_(e){return new e({type:"unknown"})}function V_(e,t){return new e({type:"never",...J(t)})}function F_(e,t){return new e({type:"date",...J(t)})}function Ml(e,t){return new sm({check:"less_than",...J(t),value:e,inclusive:!1})}function Xi(e,t){return new sm({check:"less_than",...J(t),value:e,inclusive:!0})}function Vl(e,t){return new im({check:"greater_than",...J(t),value:e,inclusive:!1})}function eo(e,t){return new im({check:"greater_than",...J(t),value:e,inclusive:!0})}function Fl(e,t){return new tE({check:"multiple_of",...J(t),value:e})}function fm(e,t){return new nE({check:"max_length",...J(t),maximum:e})}function mo(e,t){return new sE({check:"min_length",...J(t),minimum:e})}function pm(e,t){return new iE({check:"length_equals",...J(t),length:e})}function Z_(e,t){return new oE({check:"string_format",format:"regex",...J(t),pattern:e})}function B_(e){return new aE({check:"string_format",format:"lowercase",...J(e)})}function H_(e){return new cE({check:"string_format",format:"uppercase",...J(e)})}function K_(e,t){return new uE({check:"string_format",format:"includes",...J(t),includes:e})}function J_(e,t){return new dE({check:"string_format",format:"starts_with",...J(t),prefix:e})}function G_(e,t){return new lE({check:"string_format",format:"ends_with",...J(t),suffix:e})}function Ni(e){return new hE({check:"overwrite",tx:e})}function Q_(e){return Ni(t=>t.normalize(e))}function Y_(){return Ni(e=>e.trim())}function X_(){return Ni(e=>e.toLowerCase())}function eN(){return Ni(e=>e.toUpperCase())}function tN(e,t,r){return new e({type:"array",element:t,...J(r)})}function rN(e,t,r){const n=J(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function nN(e,t,r){return new e({type:"custom",check:"custom",fn:t,...J(r)})}function sN(e){const t=iN(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(hi(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(hi(s))}},e(r.value,r)));return t}function iN(e,t){const r=new kt({check:"custom",...J(t)});return r._zod.check=e,r}const oN=$("ZodISODateTime",(e,t)=>{TE.init(e,t),Pe.init(e,t)});function aN(e){return C_(oN,e)}const cN=$("ZodISODate",(e,t)=>{SE.init(e,t),Pe.init(e,t)});function uN(e){return x_(cN,e)}const dN=$("ZodISOTime",(e,t)=>{RE.init(e,t),Pe.init(e,t)});function lN(e){return U_(dN,e)}const hN=$("ZodISODuration",(e,t)=>{IE.init(e,t),Pe.init(e,t)});function fN(e){return P_(hN,e)}const pN=(e,t)=>{Yp.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>wv(e,r)},flatten:{value:r=>mv(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,Yc,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,Yc,2)}},isEmpty:{get(){return e.issues.length===0}}})},Kt=$("ZodError",pN,{Parent:Error}),mN=Qu(Kt),wN=Yu(Kt),yN=Qo(Kt),gN=Yo(Kt),bN=bv(Kt),vN=vv(Kt),EN=Ev(Kt),_N=_v(Kt),NN=Nv(Kt),AN=Av(Kt),kN=kv(Kt),TN=Tv(Kt),xe=$("ZodType",(e,t)=>(Ee.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(zn(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>sn(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>mN(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>yN(e,r,n),e.parseAsync=async(r,n)=>wN(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>gN(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>bN(e,r,n),e.decode=(r,n)=>vN(e,r,n),e.encodeAsync=async(r,n)=>EN(e,r,n),e.decodeAsync=async(r,n)=>_N(e,r,n),e.safeEncode=(r,n)=>NN(e,r,n),e.safeDecode=(r,n)=>AN(e,r,n),e.safeEncodeAsync=async(r,n)=>kN(e,r,n),e.safeDecodeAsync=async(r,n)=>TN(e,r,n),e.refine=(r,n)=>e.check(mA(r,n)),e.superRefine=r=>e.check(wA(r)),e.overwrite=r=>e.check(Ni(r)),e.optional=()=>fi(e),e.nullable=()=>Kl(e),e.nullish=()=>fi(Kl(e)),e.nonoptional=r=>uA(e,r),e.array=()=>Et(e),e.or=r=>Hs([e,r]),e.and=r=>eA(e,r),e.transform=r=>Jl(e,nA(r)),e.default=r=>oA(e,r),e.prefault=r=>cA(e,r),e.catch=r=>lA(e,r),e.pipe=r=>Jl(e,r),e.readonly=()=>pA(e),e.describe=r=>{const n=e.clone();return Pi.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Pi.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Pi.get(e);const n=e.clone();return Pi.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),mm=$("_ZodString",(e,t)=>{Xu.init(e,t),xe.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Z_(...n)),e.includes=(...n)=>e.check(K_(...n)),e.startsWith=(...n)=>e.check(J_(...n)),e.endsWith=(...n)=>e.check(G_(...n)),e.min=(...n)=>e.check(mo(...n)),e.max=(...n)=>e.check(fm(...n)),e.length=(...n)=>e.check(pm(...n)),e.nonempty=(...n)=>e.check(mo(1,...n)),e.lowercase=n=>e.check(B_(n)),e.uppercase=n=>e.check(H_(n)),e.trim=()=>e.check(Y_()),e.normalize=(...n)=>e.check(Q_(...n)),e.toLowerCase=()=>e.check(X_()),e.toUpperCase=()=>e.check(eN())}),wm=$("ZodString",(e,t)=>{Xu.init(e,t),mm.init(e,t),e.email=r=>e.check(dm(ym,r)),e.url=r=>e.check(g_(SN,r)),e.jwt=r=>e.check($_(MN,r)),e.emoji=r=>e.check(b_(RN,r)),e.guid=r=>e.check(Wl(Zl,r)),e.uuid=r=>e.check(p_(Di,r)),e.uuidv4=r=>e.check(m_(Di,r)),e.uuidv6=r=>e.check(w_(Di,r)),e.uuidv7=r=>e.check(y_(Di,r)),e.nanoid=r=>e.check(v_(IN,r)),e.guid=r=>e.check(Wl(Zl,r)),e.cuid=r=>e.check(E_(ON,r)),e.cuid2=r=>e.check(__($N,r)),e.ulid=r=>e.check(N_(CN,r)),e.base64=r=>e.check(R_(qN,r)),e.base64url=r=>e.check(I_(jN,r)),e.xid=r=>e.check(A_(xN,r)),e.ksuid=r=>e.check(k_(UN,r)),e.ipv4=r=>e.check(lm(gm,r)),e.ipv6=r=>e.check(hm(bm,r)),e.cidrv4=r=>e.check(T_(LN,r)),e.cidrv6=r=>e.check(S_(zN,r)),e.e164=r=>e.check(O_(WN,r)),e.datetime=r=>e.check(aN(r)),e.date=r=>e.check(uN(r)),e.time=r=>e.check(lN(r)),e.duration=r=>e.check(fN(r))});function S(e){return h_(wm,e)}const Pe=$("ZodStringFormat",(e,t)=>{Ce.init(e,t),mm.init(e,t)}),ym=$("ZodEmail",(e,t)=>{yE.init(e,t),Pe.init(e,t)});function ea(e){return dm(ym,e)}const Zl=$("ZodGUID",(e,t)=>{mE.init(e,t),Pe.init(e,t)}),Di=$("ZodUUID",(e,t)=>{wE.init(e,t),Pe.init(e,t)}),SN=$("ZodURL",(e,t)=>{gE.init(e,t),Pe.init(e,t)}),RN=$("ZodEmoji",(e,t)=>{bE.init(e,t),Pe.init(e,t)}),IN=$("ZodNanoID",(e,t)=>{vE.init(e,t),Pe.init(e,t)}),ON=$("ZodCUID",(e,t)=>{EE.init(e,t),Pe.init(e,t)}),$N=$("ZodCUID2",(e,t)=>{_E.init(e,t),Pe.init(e,t)}),CN=$("ZodULID",(e,t)=>{NE.init(e,t),Pe.init(e,t)}),xN=$("ZodXID",(e,t)=>{AE.init(e,t),Pe.init(e,t)}),UN=$("ZodKSUID",(e,t)=>{kE.init(e,t),Pe.init(e,t)}),gm=$("ZodIPv4",(e,t)=>{OE.init(e,t),Pe.init(e,t)});function PN(e){return lm(gm,e)}const bm=$("ZodIPv6",(e,t)=>{$E.init(e,t),Pe.init(e,t)});function DN(e){return hm(bm,e)}const LN=$("ZodCIDRv4",(e,t)=>{CE.init(e,t),Pe.init(e,t)}),zN=$("ZodCIDRv6",(e,t)=>{xE.init(e,t),Pe.init(e,t)}),qN=$("ZodBase64",(e,t)=>{UE.init(e,t),Pe.init(e,t)}),jN=$("ZodBase64URL",(e,t)=>{DE.init(e,t),Pe.init(e,t)}),WN=$("ZodE164",(e,t)=>{LE.init(e,t),Pe.init(e,t)}),MN=$("ZodJWT",(e,t)=>{qE.init(e,t),Pe.init(e,t)}),vm=$("ZodNumber",(e,t)=>{am.init(e,t),xe.init(e,t),e.gt=(n,s)=>e.check(Vl(n,s)),e.gte=(n,s)=>e.check(eo(n,s)),e.min=(n,s)=>e.check(eo(n,s)),e.lt=(n,s)=>e.check(Ml(n,s)),e.lte=(n,s)=>e.check(Xi(n,s)),e.max=(n,s)=>e.check(Xi(n,s)),e.int=n=>e.check(Bl(n)),e.safe=n=>e.check(Bl(n)),e.positive=n=>e.check(Vl(0,n)),e.nonnegative=n=>e.check(eo(0,n)),e.negative=n=>e.check(Ml(0,n)),e.nonpositive=n=>e.check(Xi(0,n)),e.multipleOf=(n,s)=>e.check(Fl(n,s)),e.step=(n,s)=>e.check(Fl(n,s)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function Tr(e){return D_(vm,e)}const VN=$("ZodNumberFormat",(e,t)=>{jE.init(e,t),vm.init(e,t)});function Bl(e){return L_(VN,e)}const Em=$("ZodBoolean",(e,t)=>{WE.init(e,t),xe.init(e,t)});function Xt(e){return z_(Em,e)}const FN=$("ZodUndefined",(e,t)=>{ME.init(e,t),xe.init(e,t)});function Hl(e){return j_(FN,e)}const ZN=$("ZodAny",(e,t)=>{VE.init(e,t),xe.init(e,t)});function gt(){return W_(ZN)}const BN=$("ZodUnknown",(e,t)=>{FE.init(e,t),xe.init(e,t)});function eu(){return M_(BN)}const HN=$("ZodNever",(e,t)=>{ZE.init(e,t),xe.init(e,t)});function KN(e){return V_(HN,e)}const JN=$("ZodDate",(e,t)=>{BE.init(e,t),xe.init(e,t),e.min=(n,s)=>e.check(eo(n,s)),e.max=(n,s)=>e.check(Xi(n,s));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function fr(e){return F_(JN,e)}const GN=$("ZodArray",(e,t)=>{HE.init(e,t),xe.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(mo(r,n)),e.nonempty=r=>e.check(mo(1,r)),e.max=(r,n)=>e.check(fm(r,n)),e.length=(r,n)=>e.check(pm(r,n)),e.unwrap=()=>e.element});function Et(e,t){return tN(GN,e,t)}const QN=$("ZodObject",(e,t)=>{JE.init(e,t),xe.init(e,t),we(e,"shape",()=>t.shape),e.keyof=()=>Mt(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:eu()}),e.loose=()=>e.clone({...e._zod.def,catchall:eu()}),e.strict=()=>e.clone({...e._zod.def,catchall:KN()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>dv(e,r),e.safeExtend=r=>lv(e,r),e.merge=r=>hv(e,r),e.pick=r=>cv(e,r),e.omit=r=>uv(e,r),e.partial=(...r)=>fv(_m,e,r[0]),e.required=(...r)=>pv(Nm,e,r[0])});function G(e,t){const r={type:"object",shape:e??{},...J(t)};return new QN(r)}const YN=$("ZodUnion",(e,t)=>{GE.init(e,t),xe.init(e,t),e.options=t.options});function Hs(e,t){return new YN({type:"union",options:e,...J(t)})}const XN=$("ZodIntersection",(e,t)=>{QE.init(e,t),xe.init(e,t)});function eA(e,t){return new XN({type:"intersection",left:e,right:t})}const tA=$("ZodRecord",(e,t)=>{YE.init(e,t),xe.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function _t(e,t,r){return new tA({type:"record",keyType:e,valueType:t,...J(r)})}const tu=$("ZodEnum",(e,t)=>{XE.init(e,t),xe.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const i={};for(const o of n)if(r.has(o))i[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new tu({...t,checks:[],...J(s),entries:i})},e.exclude=(n,s)=>{const i={...t.entries};for(const o of n)if(r.has(o))delete i[o];else throw new Error(`Key ${o} not found in enum`);return new tu({...t,checks:[],...J(s),entries:i})}});function Mt(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new tu({type:"enum",entries:r,...J(t)})}const rA=$("ZodTransform",(e,t)=>{e_.init(e,t),xe.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Hp(e.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(hi(i,r.value,t));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),r.issues.push(hi(o))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(i=>(r.value=i,r)):(r.value=s,r)}});function nA(e){return new rA({type:"transform",transform:e})}const _m=$("ZodOptional",(e,t)=>{t_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function fi(e){return new _m({type:"optional",innerType:e})}const sA=$("ZodNullable",(e,t)=>{r_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Kl(e){return new sA({type:"nullable",innerType:e})}const iA=$("ZodDefault",(e,t)=>{n_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function oA(e,t){return new iA({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Gp(t)}})}const aA=$("ZodPrefault",(e,t)=>{s_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function cA(e,t){return new aA({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Gp(t)}})}const Nm=$("ZodNonOptional",(e,t)=>{i_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function uA(e,t){return new Nm({type:"nonoptional",innerType:e,...J(t)})}const dA=$("ZodCatch",(e,t)=>{o_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function lA(e,t){return new dA({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const hA=$("ZodPipe",(e,t)=>{a_.init(e,t),xe.init(e,t),e.in=t.in,e.out=t.out});function Jl(e,t){return new hA({type:"pipe",in:e,out:t})}const fA=$("ZodReadonly",(e,t)=>{c_.init(e,t),xe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function pA(e){return new fA({type:"readonly",innerType:e})}const Am=$("ZodCustom",(e,t)=>{u_.init(e,t),xe.init(e,t)});function ss(e,t){return rN(Am,e??(()=>!0),t)}function mA(e,t={}){return nN(Am,e,t)}function wA(e){return sN(e)}function Wt(e){return f_(wm,e)}function Gl(e){return q_(Em,e)}function Nn(){const e=typeof globalThis<"u"&&globalThis.crypto;if(e&&typeof e.subtle=="object"&&e.subtle!=null)return e.subtle;throw new Error("crypto.subtle must be defined")}const wo=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function Ql(){return{root:{key:""},static:new wo}}function ed(e){return e.split("/").filter(Boolean)}function km(e,t){const r=new wo;for(const[n,s]of t){const i=n<0?e.slice(-1*n).join("/"):e[n];if(typeof s=="string")r[s]=i;else{const o=i.match(s);if(o)for(const a in o.groups)r[a]=o.groups[a]}}return r}function Yl(e,t="",r,n){const s=ed(r);let i=e.root,o=0;const a=[];for(let d=0;d<s.length;d++){const u=s[d];if(u.startsWith("**")){i.wildcard||(i.wildcard={key:"**"}),i=i.wildcard,a.push([-d,u.split(":")[1]||"_",u.length===2]);break}if(u==="*"||u.includes(":")){i.param||(i.param={key:"*"}),i=i.param;const h=u==="*";a.push([d,h?`_${o++}`:yA(u),h]);continue}const l=i.static?.[u];if(l)i=l;else{const h={key:u};i.static||(i.static=new wo),i.static[u]=h,i=h}}const c=a.length>0;i.methods||(i.methods=new wo),i.methods[t]||(i.methods[t]=[]),i.methods[t].push({data:n||null,paramsMap:c?a:void 0}),c||(e.static[r]=i)}function yA(e){if(!e.includes(":",1))return e.slice(1);const t=e.replace(/:(\w+)/g,(r,n)=>`(?<${n}>\\w+)`);return new RegExp(`^${t}$`)}function gA(e,t="",r,n){r[r.length-1]==="/"&&(r=r.slice(0,-1));const s=e.static[r];if(s&&s.methods){const a=s.methods[t]||s.methods[""];if(a!==void 0)return a[0]}const i=ed(r),o=ru(e,e.root,t,i,0)?.[0];if(o!==void 0)return{data:o.data,params:o.paramsMap?km(i,o.paramsMap):void 0}}function ru(e,t,r,n,s){if(s===n.length){if(t.methods){const o=t.methods[r]||t.methods[""];if(o)return o}if(t.param&&t.param.methods){const o=t.param.methods[r]||t.param.methods[""];if(o){const a=o[0].paramsMap;if(a?.[a?.length-1]?.[2])return o}}if(t.wildcard&&t.wildcard.methods){const o=t.wildcard.methods[r]||t.wildcard.methods[""];if(o){const a=o[0].paramsMap;if(a?.[a?.length-1]?.[2])return o}}return}const i=n[s];if(t.static){const o=t.static[i];if(o){const a=ru(e,o,r,n,s+1);if(a)return a}}if(t.param){const o=ru(e,t.param,r,n,s+1);if(o)return o}if(t.wildcard&&t.wildcard.methods)return t.wildcard.methods[r]||t.wildcard.methods[""]}function bA(e,t="",r,n){r[r.length-1]==="/"&&(r=r.slice(0,-1));const s=ed(r);return nu(e,e.root,t,s,0).map(o=>({data:o.data,params:o.paramsMap?km(s,o.paramsMap):void 0}))}function nu(e,t,r,n,s,i=[]){const o=n[s];if(t.wildcard&&t.wildcard.methods){const c=t.wildcard.methods[r]||t.wildcard.methods[""];c&&i.push(...c)}if(t.param&&(nu(e,t.param,r,n,s+1,i),s===n.length&&t.param.methods)){const c=t.param.methods[r]||t.param.methods[""];c&&i.push(...c)}const a=t.static?.[o];if(a&&nu(e,a,r,n,s+1,i),s===n.length&&t.methods){const c=t.methods[r]||t.methods[""];c&&i.push(...c)}return i}var vA=Object.defineProperty,EA=(e,t)=>{for(var r in t)vA(e,r,{get:t[r],enumerable:!0})};function _A(){const e=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return e===void 0?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(e,"writable")?e.writable:e.set!==void 0}function NA(e){const t=e.split(`
    at `);return t.length<=1?e:(t.splice(1,1),t.join(`
    at `))}function AA(e,t){class r extends e{#e;constructor(...s){if(_A()){const o=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...s),Error.stackTraceLimit=o}else super(...s);const i=new Error().stack;i&&(this.#e=NA(i.replace(/^Error/,this.name)))}get errorStack(){return this.#e}}return Object.defineProperty(r.prototype,"constructor",{get(){return t},enumerable:!1,configurable:!0}),r}var kA={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},TA=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t=void 0,r={},n=typeof e=="number"?e:kA[e]){super(t?.message,t?.cause?{cause:t.cause}:void 0),this.status=e,this.body=t,this.headers=r,this.statusCode=n,this.name="APIError",this.status=e,this.headers=r,this.statusCode=n,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0}},_=AA(TA,Error);async function SA(e){const t=e.headers.get("content-type")||"";if(e.body){if(t.includes("application/json"))return await e.json();if(t.includes("application/x-www-form-urlencoded")){const r=await e.formData(),n={};return r.forEach((s,i)=>{n[i]=s.toString()}),n}if(t.includes("multipart/form-data")){const r=await e.formData(),n={};return r.forEach((s,i)=>{n[i]=s}),n}return t.includes("text/plain")?await e.text():t.includes("application/octet-stream")?await e.arrayBuffer():t.includes("application/pdf")||t.includes("image/")||t.includes("video/")?await e.blob():t.includes("application/stream")||e.body instanceof ReadableStream?e.body:await e.text()}}function yo(e){return e instanceof _||e?.name==="APIError"}function RA(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}function IA(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function OA(e,t,r){let n=0;const s=new WeakMap;return JSON.stringify(e,(o,a)=>{if(typeof a=="bigint")return a.toString();if(typeof a=="object"&&a!==null){if(s.has(a))return`[Circular ref-${s.get(a)}]`;s.set(a,n++)}return a},r)}function $A(e){return!e||typeof e!="object"?!1:"_flag"in e&&e._flag==="json"}function An(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach((i,o)=>{e.headers.set(o,i)}),e;if($A(e)){const i=e.body,o=e.routerResponse;if(o instanceof Response)return o;const a=new Headers({...o?.headers,...e.headers,...t?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(i),{...o,headers:a,status:e.status??t?.status??o?.status,statusText:t?.statusText??o?.statusText})}if(yo(e))return An(e.body,{status:t?.status??e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let n=e,s=new Headers(t?.headers);return e?typeof e=="string"?(n=e,s.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(n=e,s.set("Content-Type","application/octet-stream")):e instanceof Blob?(n=e,s.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?n=e:e instanceof URLSearchParams?(n=e,s.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(n=e,s.set("Content-Type","application/octet-stream")):IA(e)&&(n=OA(e),s.set("Content-Type","application/json")):(e===null&&(n=JSON.stringify(null)),s.set("content-type","application/json")),new Response(n,{...t,headers:s})}async function CA(e,t={}){let r={body:t.body,query:t.query};if(e.body){const n=await e.body["~standard"].validate(t.body);if(n.issues)return{data:null,error:Xl(n.issues,"body")};r.body=n.value}if(e.query){const n=await e.query["~standard"].validate(t.query);if(n.issues)return{data:null,error:Xl(n.issues,"query")};r.query=n.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}function Xl(e,t){for(const r of e)r.message;return{message:`Invalid ${t} parameters`}}var td={name:"HMAC",hash:"SHA-256"},Tm=async e=>{const t=typeof e=="string"?new TextEncoder().encode(e):e;return await Nn().importKey("raw",t,td,!1,["sign","verify"])},xA=async(e,t,r)=>{try{const n=atob(e),s=new Uint8Array(n.length);for(let i=0,o=n.length;i<o;i++)s[i]=n.charCodeAt(i);return await Nn().verify(td,r,s,new TextEncoder().encode(t))}catch{return!1}},UA=async(e,t)=>{const r=await Tm(t),n=await Nn().sign(td.name,r,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n)))},PA=async(e,t)=>{const r=await UA(e,t);return e=`${e}.${r}`,e=encodeURIComponent(e),e},eh=(e,t)=>{let r=e;if(t)if(t==="secure")r="__Secure-"+e;else if(t==="host")r="__Host-"+e;else return;return r};function DA(e){if(typeof e!="string")throw new TypeError("argument str must be a string");const t=new Map;let r=0;for(;r<e.length;){const n=e.indexOf("=",r);if(n===-1)break;let s=e.indexOf(";",r);if(s===-1)s=e.length;else if(s<n){r=e.lastIndexOf(";",n-1)+1;continue}const i=e.slice(r,n).trim();if(!t.has(i)){let o=e.slice(n+1,s).trim();o.codePointAt(0)===34&&(o=o.slice(1,-1)),t.set(i,RA(o))}r=s+1}return t}var Sm=(e,t,r={})=>{let n;if(r?.prefix==="secure"?n=`${`__Secure-${e}`}=${t}`:r?.prefix==="host"?n=`${`__Host-${e}`}=${t}`:n=`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),r.path!=="/"&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");n+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&r.prefix!=="host"&&(n+=`; Domain=${r.domain}`),r.path&&(n+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");n+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite&&(n+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),n+="; Partitioned"),n},LA=(e,t,r)=>(t=encodeURIComponent(t),Sm(e,t,r)),Rm=async(e,t,r,n)=>(t=await PA(t,r),Sm(e,t,n)),Im=async(e,{options:t,path:r})=>{const n=new Headers,{data:s,error:i}=await CA(t,e);if(i)throw new _(400,{message:i.message,code:"VALIDATION_ERROR"});const o="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,a=o?.get("cookie"),c=a?DA(a):void 0,d={...e,body:s.body,query:s.query,path:e.path||r,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(u,l)=>{n.set(u,l)},getHeader:u=>o?o.get(u):null,getCookie:(u,l)=>{const h=eh(u,l);return h&&c?.get(h)||null},getSignedCookie:async(u,l,h)=>{const m=eh(u,h);if(!m)return null;const p=c?.get(m);if(!p)return null;const w=p.lastIndexOf(".");if(w<1)return null;const g=p.substring(0,w),b=p.substring(w+1);if(b.length!==44||!b.endsWith("="))return null;const v=await Tm(l);return await xA(b,g,v)?g:!1},setCookie:(u,l,h)=>{const m=LA(u,l,h);return n.append("set-cookie",m),m},setSignedCookie:async(u,l,h,m)=>{const p=await Rm(u,l,h,m);return n.append("set-cookie",p),p},redirect:u=>(n.set("location",u),new _("FOUND",void 0,n)),error:(u,l,h)=>new _(u,l,h),json:(u,l)=>e.asResponse?{body:l?.body||u,routerResponse:l,_flag:"json"}:u,responseHeaders:n};for(const u of t.use||[]){const l=await u({...d,returnHeaders:!0,asResponse:!1});l.response&&Object.assign(d.context,l.response),l.headers&&l.headers.forEach((h,m)=>{d.responseHeaders.set(m,h)})}return d};function ps(e,t){const r=async n=>{const s=n,i=typeof e=="function"?e:t,a=await Im(s,{options:typeof e=="function"?{}:e,path:"/"});if(!i)throw new Error("handler must be defined");const c=await i(a),d=a.responseHeaders;return s.returnHeaders?{headers:d,response:c}:c};return r.options=typeof e=="function"?{}:e,r}ps.create=e=>{function t(r,n){if(typeof r=="function")return ps({use:e?.use},r);if(!n)throw new Error("Middleware handler is required");return ps({...r,method:"*",use:[...e?.use||[],...r.use||[]]},n)}return t};var go=(e,t,r)=>{const n=async(...s)=>{const i=s[0]||{},o=await Im(i,{options:t,path:e}),a=await r(o).catch(async d=>{if(yo(d)){const u=t.onAPIError;if(u&&await u(d),i.asResponse)return d}throw d}),c=o.responseHeaders;return i.asResponse?An(a,{headers:c}):i.returnHeaders?{headers:c,response:a}:a};return n.options=t,n.path=e,n};go.create=e=>(t,r,n)=>go(t,{...r,use:[...r?.use||[],...e?.use||[]]},n);function X(e,t,r){function n(a,c){var d;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(d=a._zod).traits??(d.traits=new Set),a._zod.traits.add(e),t(a,c);for(const u in o.prototype)u in a||Object.defineProperty(a,u,{value:o.prototype[u].bind(a)});a._zod.constr=o,a._zod.def=c}const s=r?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:e});function o(a){var c;const d=r?.Parent?new i:this;n(d,a),(c=d._zod).deferred??(c.deferred=[]);for(const u of d._zod.deferred)u();return d}return Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}var pi=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},Om={};function Sn(e){return Om}var nt={};EA(nt,{BIGINT_FORMAT_RANGES:()=>XA,Class:()=>ck,NUMBER_FORMAT_RANGES:()=>YA,aborted:()=>ms,allowsEval:()=>xm,assert:()=>MA,assertEqual:()=>zA,assertIs:()=>jA,assertNever:()=>WA,assertNotEqual:()=>qA,assignProp:()=>nd,cached:()=>rd,captureStackTrace:()=>sd,cleanEnum:()=>ak,cleanRegex:()=>ra,clone:()=>on,createTransparentProxy:()=>QA,defineLazy:()=>Oe,esc:()=>is,escapeRegex:()=>Pm,extend:()=>rk,finalizeIssue:()=>tn,floatSafeRemainder:()=>FA,getElementAtPath:()=>ZA,getEnumValues:()=>$m,getLengthableOrigin:()=>sa,getParsedType:()=>JA,getSizableOrigin:()=>ok,isObject:()=>bo,isPlainObject:()=>vo,issue:()=>zm,joinValues:()=>VA,jsonStringifyReplacer:()=>Cm,merge:()=>nk,normalizeParams:()=>qn,nullish:()=>ta,numKeys:()=>KA,omit:()=>tk,optionalKeys:()=>Lm,partial:()=>sk,pick:()=>ek,prefixIssues:()=>na,primitiveTypes:()=>GA,promiseAllObject:()=>BA,propertyKeyTypes:()=>Um,randomString:()=>HA,required:()=>ik,stringifyPrimitive:()=>Dm,unwrapMessage:()=>Vs});function zA(e){return e}function qA(e){return e}function jA(e){}function WA(e){throw new Error}function MA(e){}function $m(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function VA(e,t="|"){return e.map(r=>Dm(r)).join(t)}function Cm(e,t){return typeof t=="bigint"?t.toString():t}function rd(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ta(e){return e==null}function ra(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function FA(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,s=r>n?r:n,i=Number.parseInt(e.toFixed(s).replace(".","")),o=Number.parseInt(t.toFixed(s).replace(".",""));return i%o/10**s}function Oe(e,t,r){Object.defineProperty(e,t,{get(){{const n=r();return e[t]=n,n}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function nd(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ZA(e,t){return t?t.reduce((r,n)=>r?.[n],e):e}function BA(e){const t=Object.keys(e),r=t.map(n=>e[n]);return Promise.all(r).then(n=>{const s={};for(let i=0;i<t.length;i++)s[t[i]]=n[i];return s})}function HA(e=10){const t="abcdefghijklmnopqrstuvwxyz";let r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}function is(e){return JSON.stringify(e)}var sd=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function bo(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}var xm=rd(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function vo(e){if(bo(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(bo(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function KA(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}var JA=e=>{const t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(e)?"array":e===null?"null":e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?"promise":typeof Map<"u"&&e instanceof Map?"map":typeof Set<"u"&&e instanceof Set?"set":typeof Date<"u"&&e instanceof Date?"date":typeof File<"u"&&e instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${t}`)}},Um=new Set(["string","number","symbol"]),GA=new Set(["string","number","bigint","boolean","symbol","undefined"]);function Pm(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function on(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function qn(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function QA(e){let t;return new Proxy({},{get(r,n,s){return t??(t=e()),Reflect.get(t,n,s)},set(r,n,s,i){return t??(t=e()),Reflect.set(t,n,s,i)},has(r,n){return t??(t=e()),Reflect.has(t,n)},deleteProperty(r,n){return t??(t=e()),Reflect.deleteProperty(t,n)},ownKeys(r){return t??(t=e()),Reflect.ownKeys(t)},getOwnPropertyDescriptor(r,n){return t??(t=e()),Reflect.getOwnPropertyDescriptor(t,n)},defineProperty(r,n,s){return t??(t=e()),Reflect.defineProperty(t,n,s)}})}function Dm(e){return typeof e=="bigint"?e.toString()+"n":typeof e=="string"?`"${e}"`:`${e}`}function Lm(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}var YA={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},XA={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function ek(e,t){const r={},n=e._zod.def;for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(r[s]=n.shape[s])}return on(e,{...e._zod.def,shape:r,checks:[]})}function tk(e,t){const r={...e._zod.def.shape},n=e._zod.def;for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete r[s]}return on(e,{...e._zod.def,shape:r,checks:[]})}function rk(e,t){if(!vo(t))throw new Error("Invalid input to extend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return nd(this,"shape",n),n},checks:[]};return on(e,r)}function nk(e,t){return on(e,{...e._zod.def,get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return nd(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function sk(e,t,r){const n=t._zod.def.shape,s={...n};if(r)for(const i in r){if(!(i in n))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=e?new e({type:"optional",innerType:n[i]}):n[i])}else for(const i in n)s[i]=e?new e({type:"optional",innerType:n[i]}):n[i];return on(t,{...t._zod.def,shape:s,checks:[]})}function ik(e,t,r){const n=t._zod.def.shape,s={...n};if(r)for(const i in r){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=new e({type:"nonoptional",innerType:n[i]}))}else for(const i in n)s[i]=new e({type:"nonoptional",innerType:n[i]});return on(t,{...t._zod.def,shape:s,checks:[]})}function ms(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function na(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Vs(e){return typeof e=="string"?e:e?.message}function tn(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=Vs(e.inst?._zod.def?.error?.(e))??Vs(t?.error?.(e))??Vs(r.customError?.(e))??Vs(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function ok(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function sa(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function zm(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}function ak(e){return Object.entries(e).filter(([t,r])=>Number.isNaN(Number.parseInt(t,10))).map(t=>t[1])}var ck=class{constructor(...e){}},qm=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Cm,2)},enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},jm=X("$ZodError",qm),Wm=X("$ZodError",qm,{Parent:Error});function uk(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function dk(e,t){const r=t||function(i){return i.message},n={_errors:[]},s=i=>{for(const o of i.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(a=>s({issues:a}));else if(o.code==="invalid_key")s({issues:o.issues});else if(o.code==="invalid_element")s({issues:o.issues});else if(o.path.length===0)n._errors.push(r(o));else{let a=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(r(o))):a[d]=a[d]||{_errors:[]},a=a[d],c++}}};return s(e),n}var lk=e=>(t,r,n,s)=>{const i=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new pi;if(o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>tn(c,i,Sn())));throw sd(a,s?.callee),a}return o.value},hk=e=>async(t,r,n,s)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>tn(c,i,Sn())));throw sd(a,s?.callee),a}return o.value},Mm=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new pi;return i.issues.length?{success:!1,error:new(e??jm)(i.issues.map(o=>tn(o,s,Sn())))}:{success:!0,data:i.value}},fk=Mm(Wm),Vm=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(o=>tn(o,s,Sn())))}:{success:!0,data:i.value}},pk=Vm(Wm),Is=X("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),mk=X("$ZodCheckMaxLength",(e,t)=>{var r;Is.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!ta(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const o=sa(s);n.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),wk=X("$ZodCheckMinLength",(e,t)=>{var r;Is.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!ta(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const o=sa(s);n.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),yk=X("$ZodCheckLengthEquals",(e,t)=>{var r;Is.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!ta(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,i=s.length;if(i===t.length)return;const o=sa(s),a=i>t.length;n.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),gk=X("$ZodCheckOverwrite",(e,t)=>{Is.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}}),bk=class{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(o=>o),s=Math.min(...n.map(o=>o.length-o.trimStart().length)),i=n.map(o=>o.slice(s)).map(o=>" ".repeat(this.indent*2)+o);for(const o of i)this.content.push(o)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(i=>`  ${i}`)];return new t(...r,s.join(`
`))}},vk={major:4,minor:0,patch:0},Qe=X("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=vk;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const i of s._zod.onattach)i(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,o,a)=>{let c=ms(i),d;for(const u of o){if(u._zod.def.when){if(!u._zod.def.when(i))continue}else if(c)continue;const l=i.issues.length,h=u._zod.check(i);if(h instanceof Promise&&a?.async===!1)throw new pi;if(d||h instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await h,i.issues.length!==l&&(c||(c=ms(i,l)))});else{if(i.issues.length===l)continue;c||(c=ms(i,l))}}return d?d.then(()=>i):i};e._zod.run=(i,o)=>{const a=e._zod.parse(i,o);if(a instanceof Promise){if(o.async===!1)throw new pi;return a.then(c=>s(c,n,o))}return s(a,n,o)}}e["~standard"]={validate:s=>{try{const i=fk(e,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return pk(e,s).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),Ek=X("$ZodUnknown",(e,t)=>{Qe.init(e,t),e._zod.parse=r=>r}),_k=X("$ZodNever",(e,t)=>{Qe.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function th(e,t,r){e.issues.length&&t.issues.push(...na(r,e.issues)),t.value[r]=e.value}var Nk=X("$ZodArray",(e,t)=>{Qe.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const i=[];for(let o=0;o<s.length;o++){const a=s[o],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(d=>th(d,r,o))):th(c,r,o)}return i.length?Promise.all(i).then(()=>r):r}});function Li(e,t,r){e.issues.length&&t.issues.push(...na(r,e.issues)),t.value[r]=e.value}function rh(e,t,r,n){e.issues.length?n[r]===void 0?r in n?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...na(r,e.issues)):e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}var Ak=X("$ZodObject",(e,t)=>{Qe.init(e,t);const r=rd(()=>{const l=Object.keys(t.shape);for(const m of l)if(!(t.shape[m]instanceof Qe))throw new Error(`Invalid element at key "${m}": expected a Zod schema`);const h=Lm(t.shape);return{shape:t.shape,keys:l,keySet:new Set(l),numKeys:l.length,optionalKeys:new Set(h)}});Oe(e._zod,"propValues",()=>{const l=t.shape,h={};for(const m in l){const p=l[m]._zod;if(p.values){h[m]??(h[m]=new Set);for(const w of p.values)h[m].add(w)}}return h});const n=l=>{const h=new bk(["shape","payload","ctx"]),m=r.value,p=v=>{const y=is(v);return`shape[${y}]._zod.run({ value: input[${y}], issues: [] }, ctx)`};h.write("const input = payload.value;");const w=Object.create(null);let g=0;for(const v of m.keys)w[v]=`key_${g++}`;h.write("const newResult = {}");for(const v of m.keys)if(m.optionalKeys.has(v)){const y=w[v];h.write(`const ${y} = ${p(v)};`);const E=is(v);h.write(`
        if (${y}.issues.length) {
          if (input[${E}] === undefined) {
            if (${E} in input) {
              newResult[${E}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${y}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${E}, ...iss.path] : [${E}],
              }))
            );
          }
        } else if (${y}.value === undefined) {
          if (${E} in input) newResult[${E}] = undefined;
        } else {
          newResult[${E}] = ${y}.value;
        }
        `)}else{const y=w[v];h.write(`const ${y} = ${p(v)};`),h.write(`
          if (${y}.issues.length) payload.issues = payload.issues.concat(${y}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${is(v)}, ...iss.path] : [${is(v)}]
          })));`),h.write(`newResult[${is(v)}] = ${y}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const b=h.compile();return(v,y)=>b(l,v,y)};let s;const i=bo,o=!Om.jitless,c=o&&xm.value,d=t.catchall;let u;e._zod.parse=(l,h)=>{u??(u=r.value);const m=l.value;if(!i(m))return l.issues.push({expected:"object",code:"invalid_type",input:m,inst:e}),l;const p=[];if(o&&c&&h?.async===!1&&h.jitless!==!0)s||(s=n(t.shape)),l=s(l,h);else{l.value={};const y=u.shape;for(const E of u.keys){const k=y[E],A=k._zod.run({value:m[E],issues:[]},h),R=k._zod.optin==="optional"&&k._zod.optout==="optional";A instanceof Promise?p.push(A.then(T=>R?rh(T,l,E,m):Li(T,l,E))):R?rh(A,l,E,m):Li(A,l,E)}}if(!d)return p.length?Promise.all(p).then(()=>l):l;const w=[],g=u.keySet,b=d._zod,v=b.def.type;for(const y of Object.keys(m)){if(g.has(y))continue;if(v==="never"){w.push(y);continue}const E=b.run({value:m[y],issues:[]},h);E instanceof Promise?p.push(E.then(k=>Li(k,l,y))):Li(E,l,y)}return w.length&&l.issues.push({code:"unrecognized_keys",keys:w,input:m,inst:e}),p.length?Promise.all(p).then(()=>l):l}});function nh(e,t,r,n){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(s=>s.issues.map(i=>tn(i,n,Sn())))}),t}var kk=X("$ZodUnion",(e,t)=>{Qe.init(e,t),Oe(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),Oe(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),Oe(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),Oe(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>ra(n.source)).join("|")})$`)}}),e._zod.parse=(r,n)=>{let s=!1;const i=[];for(const o of t.options){const a=o._zod.run({value:r.value,issues:[]},n);if(a instanceof Promise)i.push(a),s=!0;else{if(a.issues.length===0)return a;i.push(a)}}return s?Promise.all(i).then(o=>nh(o,r,e,n)):nh(i,r,e,n)}}),Tk=X("$ZodIntersection",(e,t)=>{Qe.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,i=t.left._zod.run({value:s,issues:[]},n),o=t.right._zod.run({value:s,issues:[]},n);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([c,d])=>sh(r,c,d)):sh(r,i,o)}});function su(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(vo(e)&&vo(t)){const r=Object.keys(t),n=Object.keys(e).filter(i=>r.indexOf(i)!==-1),s={...e,...t};for(const i of n){const o=su(e[i],t[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};s[i]=o.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],i=t[n],o=su(s,i);if(!o.valid)return{valid:!1,mergeErrorPath:[n,...o.mergeErrorPath]};r.push(o.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function sh(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),ms(e))return e;const n=su(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}var Sk=X("$ZodEnum",(e,t)=>{Qe.init(e,t);const r=$m(t.entries);e._zod.values=new Set(r),e._zod.pattern=new RegExp(`^(${r.filter(n=>Um.has(typeof n)).map(n=>typeof n=="string"?Pm(n):n.toString()).join("|")})$`),e._zod.parse=(n,s)=>{const i=n.value;return e._zod.values.has(i)||n.issues.push({code:"invalid_value",values:r,input:i,inst:e}),n}}),Rk=X("$ZodTransform",(e,t)=>{Qe.init(e,t),e._zod.parse=(r,n)=>{const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(o=>(r.value=o,r));if(s instanceof Promise)throw new pi;return r.value=s,r}}),Ik=X("$ZodOptional",(e,t)=>{Qe.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Oe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Oe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${ra(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>t.innerType._zod.optin==="optional"?t.innerType._zod.run(r,n):r.value===void 0?r:t.innerType._zod.run(r,n)}),Ok=X("$ZodNullable",(e,t)=>{Qe.init(e,t),Oe(e._zod,"optin",()=>t.innerType._zod.optin),Oe(e._zod,"optout",()=>t.innerType._zod.optout),Oe(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${ra(r.source)}|null)$`):void 0}),Oe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),$k=X("$ZodDefault",(e,t)=>{Qe.init(e,t),e._zod.optin="optional",Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>ih(i,t)):ih(s,t)}});function ih(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}var Ck=X("$ZodPrefault",(e,t)=>{Qe.init(e,t),e._zod.optin="optional",Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),xk=X("$ZodNonOptional",(e,t)=>{Qe.init(e,t),Oe(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>oh(i,e)):oh(s,e)}});function oh(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}var Uk=X("$ZodCatch",(e,t)=>{Qe.init(e,t),e._zod.optin="optional",Oe(e._zod,"optout",()=>t.innerType._zod.optout),Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>(r.value=i.value,i.issues.length&&(r.value=t.catchValue({...r,error:{issues:i.issues.map(o=>tn(o,n,Sn()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>tn(i,n,Sn()))},input:r.value}),r.issues=[]),r)}}),Pk=X("$ZodPipe",(e,t)=>{Qe.init(e,t),Oe(e._zod,"values",()=>t.in._zod.values),Oe(e._zod,"optin",()=>t.in._zod.optin),Oe(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(r,n)=>{const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(i=>ah(i,t,n)):ah(s,t,n)}});function ah(e,t,r){return ms(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}var Dk=X("$ZodReadonly",(e,t)=>{Qe.init(e,t),Oe(e._zod,"propValues",()=>t.innerType._zod.propValues),Oe(e._zod,"values",()=>t.innerType._zod.values),Oe(e._zod,"optin",()=>t.innerType._zod.optin),Oe(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(ch):ch(s)}});function ch(e){return e.value=Object.freeze(e.value),e}var Lk=X("$ZodCustom",(e,t)=>{Is.init(e,t),Qe.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(i=>uh(i,r,n,e));uh(s,r,n,e)}});function uh(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(zm(s))}}var zk=class{constructor(){this._map=new Map,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}};function qk(){return new zk}var zi=qk();function jk(e){return new e({type:"unknown"})}function Wk(e,t){return new e({type:"never",...qn(t)})}function Mk(e,t){return new mk({check:"max_length",...qn(t),maximum:e})}function dh(e,t){return new wk({check:"min_length",...qn(t),minimum:e})}function Vk(e,t){return new yk({check:"length_equals",...qn(t),length:e})}function Fk(e){return new gk({check:"overwrite",tx:e})}function Zk(e,t,r){return new e({type:"array",element:t,...qn(r)})}function Bk(e,t,r){return new e({type:"custom",check:"custom",fn:t,...qn(r)})}var Hk=(e,t)=>{jm.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>dk(e,r)},flatten:{value:r=>uk(e,r)},addIssue:{value:r=>e.issues.push(r)},addIssues:{value:r=>e.issues.push(...r)},isEmpty:{get(){return e.issues.length===0}}})},ia=X("ZodError",Hk,{Parent:Error}),Kk=lk(ia),Jk=hk(ia),Gk=Mm(ia),Qk=Vm(ia),ot=X("ZodType",(e,t)=>(Qe.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),e.clone=(r,n)=>on(e,r,n),e.brand=()=>e,e.register=(r,n)=>(r.add(e,n),e),e.parse=(r,n)=>Kk(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>Gk(e,r,n),e.parseAsync=async(r,n)=>Jk(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>Qk(e,r,n),e.spa=e.safeParseAsync,e.refine=(r,n)=>e.check(NT(r,n)),e.superRefine=r=>e.check(AT(r)),e.overwrite=r=>e.check(Fk(r)),e.optional=()=>hh(e),e.nullable=()=>fh(e),e.nullish=()=>hh(fh(e)),e.nonoptional=r=>mT(e,r),e.array=()=>rT(e),e.or=r=>sT([e,r]),e.and=r=>oT(e,r),e.transform=r=>ph(e,uT(r)),e.default=r=>hT(e,r),e.prefault=r=>pT(e,r),e.catch=r=>yT(e,r),e.pipe=r=>ph(e,r),e.readonly=()=>vT(e),e.describe=r=>{const n=e.clone();return zi.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return zi.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return zi.get(e);const n=e.clone();return zi.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Yk=X("ZodUnknown",(e,t)=>{Ek.init(e,t),ot.init(e,t)});function lh(){return jk(Yk)}var Xk=X("ZodNever",(e,t)=>{_k.init(e,t),ot.init(e,t)});function eT(e){return Wk(Xk,e)}var tT=X("ZodArray",(e,t)=>{Nk.init(e,t),ot.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(dh(r,n)),e.nonempty=r=>e.check(dh(1,r)),e.max=(r,n)=>e.check(Mk(r,n)),e.length=(r,n)=>e.check(Vk(r,n)),e.unwrap=()=>e.element});function rT(e,t){return Zk(tT,e,t)}var Eo=X("ZodObject",(e,t)=>{Ak.init(e,t),ot.init(e,t),nt.defineLazy(e,"shape",()=>t.shape),e.keyof=()=>aT(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:lh()}),e.loose=()=>e.clone({...e._zod.def,catchall:lh()}),e.strict=()=>e.clone({...e._zod.def,catchall:eT()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>nt.extend(e,r),e.merge=r=>nt.merge(e,r),e.pick=r=>nt.pick(e,r),e.omit=r=>nt.omit(e,r),e.partial=(...r)=>nt.partial(Ks,e,r[0]),e.required=(...r)=>nt.required(Fm,e,r[0])}),nT=X("ZodUnion",(e,t)=>{kk.init(e,t),ot.init(e,t),e.options=t.options});function sT(e,t){return new nT({type:"union",options:e,...nt.normalizeParams(t)})}var iT=X("ZodIntersection",(e,t)=>{Tk.init(e,t),ot.init(e,t)});function oT(e,t){return new iT({type:"intersection",left:e,right:t})}var iu=X("ZodEnum",(e,t)=>{Sk.init(e,t),ot.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const i={};for(const o of n)if(r.has(o))i[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new iu({...t,checks:[],...nt.normalizeParams(s),entries:i})},e.exclude=(n,s)=>{const i={...t.entries};for(const o of n)if(r.has(o))delete i[o];else throw new Error(`Key ${o} not found in enum`);return new iu({...t,checks:[],...nt.normalizeParams(s),entries:i})}});function aT(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new iu({type:"enum",entries:r,...nt.normalizeParams(t)})}var cT=X("ZodTransform",(e,t)=>{Rk.init(e,t),ot.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=i=>{if(typeof i=="string")r.issues.push(nt.issue(i,r.value,t));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),o.continue??(o.continue=!0),r.issues.push(nt.issue(o))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(i=>(r.value=i,r)):(r.value=s,r)}});function uT(e){return new cT({type:"transform",transform:e})}var Ks=X("ZodOptional",(e,t)=>{Ik.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType});function hh(e){return new Ks({type:"optional",innerType:e})}var dT=X("ZodNullable",(e,t)=>{Ok.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType});function fh(e){return new dT({type:"nullable",innerType:e})}var lT=X("ZodDefault",(e,t)=>{$k.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function hT(e,t){return new lT({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}var fT=X("ZodPrefault",(e,t)=>{Ck.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType});function pT(e,t){return new fT({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}var Fm=X("ZodNonOptional",(e,t)=>{xk.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType});function mT(e,t){return new Fm({type:"nonoptional",innerType:e,...nt.normalizeParams(t)})}var wT=X("ZodCatch",(e,t)=>{Uk.init(e,t),ot.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function yT(e,t){return new wT({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}var gT=X("ZodPipe",(e,t)=>{Pk.init(e,t),ot.init(e,t),e.in=t.in,e.out=t.out});function ph(e,t){return new gT({type:"pipe",in:e,out:t})}var bT=X("ZodReadonly",(e,t)=>{Dk.init(e,t),ot.init(e,t)});function vT(e){return new bT({type:"readonly",innerType:e})}var ET=X("ZodCustom",(e,t)=>{Lk.init(e,t),ot.init(e,t)});function _T(e){const t=new Is({check:"custom"});return t._zod.check=e,t}function NT(e,t={}){return Bk(ET,e,t)}function AT(e){const t=_T(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(nt.issue(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(nt.issue(s))}},e(r.value,r)));return t}var $a={};function Zm(e){switch(e.constructor.name){case"ZodString":return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array";default:return"string"}}function mh(e){const t=[];return e.metadata?.openapi?.parameters?(t.push(...e.metadata.openapi.parameters),t):(e.query instanceof Eo&&Object.entries(e.query.shape).forEach(([r,n])=>{n instanceof Eo&&t.push({name:r,in:"query",schema:{type:Zm(n),..."minLength"in n&&n.minLength?{minLength:n.minLength}:{},description:n.description}})}),t)}function kT(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof Eo||e.body instanceof Ks)){const t=e.body.shape;if(!t)return;const r={},n=[];return Object.entries(t).forEach(([s,i])=>{i instanceof Eo&&(r[s]={type:Zm(i),description:i.description},i instanceof Ks||n.push(s))}),{required:e.body instanceof Ks?!1:!!e.body,content:{"application/json":{schema:{type:"object",properties:r,required:n}}}}}}function wh(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function TT(e,t){const r={schemas:{}};return Object.entries(e).forEach(([s,i])=>{const o=i.options;if(!o.metadata?.SERVER_ONLY&&(o.method==="GET"&&($a[i.path]={get:{tags:["Default",...o.metadata?.openapi?.tags||[]],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:mh(o),responses:wh(o.metadata?.openapi?.responses)}}),o.method==="POST")){const a=kT(o);$a[i.path]={post:{tags:["Default",...o.metadata?.openapi?.tags||[]],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:mh(o),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:wh(o.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:r,security:[{apiKeyCookie:[]}],servers:[{url:t?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:$a}}var ST=(e,t)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    <\/script>
	 <script>
      var configuration = {
	  	favicon: ${t?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(t.logo)}`:void 0} ,
	   	theme: ${t?.theme||"saturn"},
        metaData: {
			title: ${t?.title||"Open API Reference"},
			description: ${t?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    <\/script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"><\/script>
  </body>
</html>`,RT=(e,t)=>{if(!t?.openapi?.disabled){const i={path:"/api/reference",...t?.openapi};e.openapi=go(i.path,{method:"GET"},async o=>{const a=await TT(e);return new Response(ST(a,i.scalar),{headers:{"Content-Type":"text/html"}})})}const r=Ql(),n=Ql();for(const i of Object.values(e)){if(!i.options||i.options?.metadata?.SERVER_ONLY)continue;const o=Array.isArray(i.options?.method)?i.options.method:[i.options?.method];for(const a of o)Yl(r,a,i.path,i)}if(t?.routerMiddleware?.length)for(const{path:i,middleware:o}of t.routerMiddleware)Yl(n,"*",i,o);const s=async i=>{const o=new URL(i.url),a=t?.basePath?o.pathname.split(t.basePath).reduce((h,m,p)=>(p!==0&&(p>1?h.push(`${t.basePath}${m}`):h.push(m)),h),[]).join(""):o.pathname;if(!a?.length)return new Response(null,{status:404,statusText:"Not Found"});const c=gA(r,i.method,a);if(!c?.data)return new Response(null,{status:404,statusText:"Not Found"});const d={};o.searchParams.forEach((h,m)=>{m in d?Array.isArray(d[m])?d[m].push(h):d[m]=[d[m],h]:d[m]=h});const u=c.data,l={path:a,method:i.method,headers:i.headers,params:c.params?JSON.parse(JSON.stringify(c.params)):{},request:i,body:u.options.disableBody?void 0:await SA(u.options.cloneRequest?i.clone():i),query:d,_flag:"router",asResponse:!0,context:t?.routerContext};try{const h=bA(n,"*",a);if(h?.length)for(const{data:p,params:w}of h){const g=await p({...l,params:w,asResponse:!1});if(g instanceof Response)return g}return await u(l)}catch(h){if(t?.onError)try{const m=await t.onError(h);if(m instanceof Response)return An(m)}catch(m){if(yo(m))return An(m);throw m}if(t?.throwError)throw h;return yo(h)?An(h):(console.error("# SERVER_ERROR: ",h),new Response(null,{status:500,statusText:"Internal Server Error"}))}};return{handler:async i=>{const o=await t?.onRequest?.(i);if(o instanceof Response)return o;const a=o instanceof Request?o:i,c=await s(a),d=await t?.onResponse?.(c);return d instanceof Response?d:c},endpoints:e}};function _o(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function Bm(e,t,r){let n="",s=0,i=0;for(const o of e)for(s=s<<8|o,i+=8;i>=6;)i-=6,n+=t[s>>i&63];if(i>0&&(n+=t[s<<6-i&63]),r){const o=(4-n.length%4)%4;n+="=".repeat(o)}return n}function Hm(e,t){const r=new Map;for(let o=0;o<t.length;o++)r.set(t[o],o);const n=[];let s=0,i=0;for(const o of e){if(o==="=")break;const a=r.get(o);if(a===void 0)throw new Error(`Invalid Base64 character: ${o}`);s=s<<6|a,i+=6,i>=8&&(i-=8,n.push(s>>i&255))}return Uint8Array.from(n)}const er={encode(e,t={}){const r=_o(!1),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return Bm(n,r,t.padding??!0)},decode(e){typeof e!="string"&&(e=new TextDecoder().decode(e));const t=e.includes("-")||e.includes("_"),r=_o(t);return Hm(e,r)}},jn={encode(e,t={}){const r=_o(!0),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return Bm(n,r,t.padding??!0)},decode(e){const t=e.includes("-")||e.includes("_"),r=_o(t);return Hm(e,r)}};function Wn(e,t){return{digest:async r=>{const n=new TextEncoder,s=typeof r=="string"?n.encode(r):r,i=await Nn().digest(e,s);return t==="hex"?Array.from(new Uint8Array(i)).map(c=>c.toString(16).padStart(2,"0")).join(""):t==="base64"||t==="base64url"||t==="base64urlnopad"?t.includes("url")?jn.encode(i,{padding:t!=="base64urlnopad"}):er.encode(i):i}}}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function IT(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ou(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function to(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Je(e,t,r=""){const n=IT(e),s=e?.length,i=t!==void 0;if(!n||i&&s!==t){const o=r&&`"${r}" `,a=i?` of length ${t}`:"",c=n?`length=${s}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return e}function yh(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function OT(e,t){Je(e,void 0,"output");const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Yr(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Ns(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function $T(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}const CT=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,Km=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",xT=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function UT(e){if(Je(e),Km)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=xT[e[r]];return t}const yr={_0:48,_9:57,A:65,F:70,a:97,f:102};function gh(e){if(e>=yr._0&&e<=yr._9)return e-yr._0;if(e>=yr.A&&e<=yr.F)return e-(yr.A-10);if(e>=yr.a&&e<=yr.f)return e-(yr.a-10)}function PT(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Km)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let s=0,i=0;s<r;s++,i+=2){const o=gh(e.charCodeAt(i)),a=gh(e.charCodeAt(i+1));if(o===void 0||a===void 0){const c=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function DT(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function LT(...e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];Je(s),t+=s.length}const r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){const i=e[n];r.set(i,s),s+=i.length}return r}function zT(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function qT(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const jT=(e,t)=>{function r(n,...s){if(Je(n,void 0,"key"),!CT)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const u=s[0];Je(u,e.varSizeNonce?void 0:e.nonceLength,"nonce")}const i=e.tagLength;i&&s[1]!==void 0&&Je(s[1],void 0,"AAD");const o=t(n,...s),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Je(l,void 0,"output")}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Je(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Je(u),i&&u.length<i)throw new Error('"ciphertext" expected length bigger than tagLength='+i);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,e),r};function bh(e,t,r=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&!MT(t))throw new Error("invalid output, must be aligned");return t}function WT(e,t,r){ou(r);const n=new Uint8Array(16),s=$T(n);return s.setBigUint64(0,BigInt(t),r),s.setBigUint64(8,BigInt(e),r),n}function MT(e){return e.byteOffset%4===0}function No(e){return Uint8Array.from(e)}function VT(e=32){const t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}function Jm(e,t=VT){const{nonceLength:r}=e;to(r);const n=(s,i)=>{const o=LT(s,i);return i.fill(0),o};return((s,...i)=>({encrypt(o){Je(o);const a=t(r),c=e(s,a,...i).encrypt(o);return c instanceof Promise?c.then(d=>n(a,d)):n(a,c)},decrypt(o){Je(o);const a=o.subarray(0,r),c=o.subarray(r);return e(s,a,...i).decrypt(c)}}))}const Gm=e=>Uint8Array.from(e.split(""),t=>t.charCodeAt(0)),FT=Gm("expand 16-byte k"),ZT=Gm("expand 32-byte k"),BT=Yr(FT),HT=Yr(ZT);function H(e,t){return e<<t|e>>>32-t}function au(e){return e.byteOffset%4===0}const qi=64,KT=16,Qm=2**32-1,vh=Uint32Array.of();function JT(e,t,r,n,s,i,o,a){const c=s.length,d=new Uint8Array(qi),u=Yr(d),l=au(s)&&au(i),h=l?Yr(s):vh,m=l?Yr(i):vh;for(let p=0;p<c;o++){if(e(t,r,n,u,o,a),o>=Qm)throw new Error("arx: counter overflow");const w=Math.min(qi,c-p);if(l&&w===qi){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let b=0,v;b<KT;b++)v=g+b,m[v]=h[v]^u[b];p+=qi;continue}for(let g=0,b;g<w;g++)b=p+g,i[b]=s[b]^d[g];p+=w}}function GT(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=zT({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return to(s),to(o),ou(i),ou(r),(a,c,d,u,l=0)=>{Je(a,void 0,"key"),Je(c,void 0,"nonce"),Je(d,void 0,"data");const h=d.length;if(u===void 0&&(u=new Uint8Array(h)),Je(u,void 0,"output"),to(l),l<0||l>=Qm)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const m=[];let p=a.length,w,g;if(p===32)m.push(w=No(a)),g=HT;else if(p===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),g=BT,m.push(w);else throw Je(a,32,"arx key"),new Error("invalid key size");au(c)||m.push(c=No(c));const b=Yr(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(g,b,Yr(c.subarray(0,16)),b),c=c.subarray(16)}const v=16-s;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const E=new Uint8Array(12);E.set(c,i?0:12-c.length),c=E,m.push(c)}const y=Yr(c);return JT(e,g,b,y,d,u,l,o),Ns(...m),u}}function tt(e,t){return e[t++]&255|(e[t++]&255)<<8}class QT{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(t){t=No(Je(t,32,"key"));const r=tt(t,0),n=tt(t,2),s=tt(t,4),i=tt(t,6),o=tt(t,8),a=tt(t,10),c=tt(t,12),d=tt(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|d<<8)&8191,this.r[9]=d>>>5&127;for(let u=0;u<8;u++)this.pad[u]=tt(t,16+2*u)}process(t,r,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],d=o[2],u=o[3],l=o[4],h=o[5],m=o[6],p=o[7],w=o[8],g=o[9],b=tt(t,r+0),v=tt(t,r+2),y=tt(t,r+4),E=tt(t,r+6),k=tt(t,r+8),A=tt(t,r+10),R=tt(t,r+12),T=tt(t,r+14);let L=i[0]+(b&8191),P=i[1]+((b>>>13|v<<3)&8191),W=i[2]+((v>>>10|y<<6)&8191),j=i[3]+((y>>>7|E<<9)&8191),V=i[4]+((E>>>4|k<<12)&8191),I=i[5]+(k>>>1&8191),C=i[6]+((k>>>14|A<<2)&8191),z=i[7]+((A>>>11|R<<5)&8191),U=i[8]+((R>>>8|T<<8)&8191),q=i[9]+(T>>>5|s),O=0,D=O+L*a+P*(5*g)+W*(5*w)+j*(5*p)+V*(5*m);O=D>>>13,D&=8191,D+=I*(5*h)+C*(5*l)+z*(5*u)+U*(5*d)+q*(5*c),O+=D>>>13,D&=8191;let B=O+L*c+P*a+W*(5*g)+j*(5*w)+V*(5*p);O=B>>>13,B&=8191,B+=I*(5*m)+C*(5*h)+z*(5*l)+U*(5*u)+q*(5*d),O+=B>>>13,B&=8191;let F=O+L*d+P*c+W*a+j*(5*g)+V*(5*w);O=F>>>13,F&=8191,F+=I*(5*p)+C*(5*m)+z*(5*h)+U*(5*l)+q*(5*u),O+=F>>>13,F&=8191;let se=O+L*u+P*d+W*c+j*a+V*(5*g);O=se>>>13,se&=8191,se+=I*(5*w)+C*(5*p)+z*(5*m)+U*(5*h)+q*(5*l),O+=se>>>13,se&=8191;let Le=O+L*l+P*u+W*d+j*c+V*a;O=Le>>>13,Le&=8191,Le+=I*(5*g)+C*(5*w)+z*(5*p)+U*(5*m)+q*(5*h),O+=Le>>>13,Le&=8191;let he=O+L*h+P*l+W*u+j*d+V*c;O=he>>>13,he&=8191,he+=I*a+C*(5*g)+z*(5*w)+U*(5*p)+q*(5*m),O+=he>>>13,he&=8191;let jt=O+L*m+P*h+W*l+j*u+V*d;O=jt>>>13,jt&=8191,jt+=I*c+C*a+z*(5*g)+U*(5*w)+q*(5*p),O+=jt>>>13,jt&=8191;let Bn=O+L*p+P*m+W*h+j*l+V*u;O=Bn>>>13,Bn&=8191,Bn+=I*d+C*c+z*a+U*(5*g)+q*(5*w),O+=Bn>>>13,Bn&=8191;let Hn=O+L*w+P*p+W*m+j*h+V*l;O=Hn>>>13,Hn&=8191,Hn+=I*u+C*d+z*c+U*a+q*(5*g),O+=Hn>>>13,Hn&=8191;let Kn=O+L*g+P*w+W*p+j*m+V*h;O=Kn>>>13,Kn&=8191,Kn+=I*l+C*u+z*d+U*c+q*a,O+=Kn>>>13,Kn&=8191,O=(O<<2)+O|0,O=O+D|0,D=O&8191,O=O>>>13,B+=O,i[0]=D,i[1]=B,i[2]=F,i[3]=se,i[4]=Le,i[5]=he,i[6]=jt,i[7]=Bn,i[8]=Hn,i[9]=Kn}finalize(){const{h:t,pad:r}=this,n=new Uint16Array(10);let s=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=s,s=t[a]>>>13,t[a]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,n[0]=t[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)t[a]=t[a]&i|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let o=t[0]+r[0];t[0]=o&65535;for(let a=1;a<8;a++)o=(t[a]+r[a]|0)+(o>>>16)|0,t[a]=o&65535;Ns(n)}update(t){yh(this),Je(t),t=No(t);const{buffer:r,blockLen:n}=this,s=t.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(t,i);continue}r.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Ns(this.h,this.r,this.buffer,this.pad)}digestInto(t){yh(this),OT(t,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)t[i++]=n[o]>>>0,t[i++]=n[o]>>>8;return t}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}}function YT(e){const t=(n,s)=>e(s).update(n).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}const XT=YT(e=>new QT(e));function eS(e,t,r,n,s,i=20){let o=e[0],a=e[1],c=e[2],d=e[3],u=t[0],l=t[1],h=t[2],m=t[3],p=t[4],w=t[5],g=t[6],b=t[7],v=s,y=r[0],E=r[1],k=r[2],A=o,R=a,T=c,L=d,P=u,W=l,j=h,V=m,I=p,C=w,z=g,U=b,q=v,O=y,D=E,B=k;for(let se=0;se<i;se+=2)A=A+P|0,q=H(q^A,16),I=I+q|0,P=H(P^I,12),A=A+P|0,q=H(q^A,8),I=I+q|0,P=H(P^I,7),R=R+W|0,O=H(O^R,16),C=C+O|0,W=H(W^C,12),R=R+W|0,O=H(O^R,8),C=C+O|0,W=H(W^C,7),T=T+j|0,D=H(D^T,16),z=z+D|0,j=H(j^z,12),T=T+j|0,D=H(D^T,8),z=z+D|0,j=H(j^z,7),L=L+V|0,B=H(B^L,16),U=U+B|0,V=H(V^U,12),L=L+V|0,B=H(B^L,8),U=U+B|0,V=H(V^U,7),A=A+W|0,B=H(B^A,16),z=z+B|0,W=H(W^z,12),A=A+W|0,B=H(B^A,8),z=z+B|0,W=H(W^z,7),R=R+j|0,q=H(q^R,16),U=U+q|0,j=H(j^U,12),R=R+j|0,q=H(q^R,8),U=U+q|0,j=H(j^U,7),T=T+V|0,O=H(O^T,16),I=I+O|0,V=H(V^I,12),T=T+V|0,O=H(O^T,8),I=I+O|0,V=H(V^I,7),L=L+P|0,D=H(D^L,16),C=C+D|0,P=H(P^C,12),L=L+P|0,D=H(D^L,8),C=C+D|0,P=H(P^C,7);let F=0;n[F++]=o+A|0,n[F++]=a+R|0,n[F++]=c+T|0,n[F++]=d+L|0,n[F++]=u+P|0,n[F++]=l+W|0,n[F++]=h+j|0,n[F++]=m+V|0,n[F++]=p+I|0,n[F++]=w+C|0,n[F++]=g+z|0,n[F++]=b+U|0,n[F++]=v+q|0,n[F++]=y+O|0,n[F++]=E+D|0,n[F++]=k+B|0}function tS(e,t,r,n){let s=e[0],i=e[1],o=e[2],a=e[3],c=t[0],d=t[1],u=t[2],l=t[3],h=t[4],m=t[5],p=t[6],w=t[7],g=r[0],b=r[1],v=r[2],y=r[3];for(let k=0;k<20;k+=2)s=s+c|0,g=H(g^s,16),h=h+g|0,c=H(c^h,12),s=s+c|0,g=H(g^s,8),h=h+g|0,c=H(c^h,7),i=i+d|0,b=H(b^i,16),m=m+b|0,d=H(d^m,12),i=i+d|0,b=H(b^i,8),m=m+b|0,d=H(d^m,7),o=o+u|0,v=H(v^o,16),p=p+v|0,u=H(u^p,12),o=o+u|0,v=H(v^o,8),p=p+v|0,u=H(u^p,7),a=a+l|0,y=H(y^a,16),w=w+y|0,l=H(l^w,12),a=a+l|0,y=H(y^a,8),w=w+y|0,l=H(l^w,7),s=s+d|0,y=H(y^s,16),p=p+y|0,d=H(d^p,12),s=s+d|0,y=H(y^s,8),p=p+y|0,d=H(d^p,7),i=i+u|0,g=H(g^i,16),w=w+g|0,u=H(u^w,12),i=i+u|0,g=H(g^i,8),w=w+g|0,u=H(u^w,7),o=o+l|0,b=H(b^o,16),h=h+b|0,l=H(l^h,12),o=o+l|0,b=H(b^o,8),h=h+b|0,l=H(l^h,7),a=a+c|0,v=H(v^a,16),m=m+v|0,c=H(c^m,12),a=a+c|0,v=H(v^a,8),m=m+v|0,c=H(c^m,7);let E=0;n[E++]=s,n[E++]=i,n[E++]=o,n[E++]=a,n[E++]=g,n[E++]=b,n[E++]=v,n[E++]=y}const rS=GT(eS,{counterRight:!1,counterLength:8,extendNonceFn:tS,allowShortKeys:!1}),nS=new Uint8Array(16),Eh=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(nS.subarray(r))},sS=new Uint8Array(32);function _h(e,t,r,n,s){s!==void 0&&Je(s,void 0,"AAD");const i=e(t,r,sS),o=WT(n.length,s?s.length:0,!0),a=XT.create(i);s&&Eh(a,s),Eh(a,n),a.update(o);const c=a.digest();return Ns(i,o),c}const iS=e=>(t,r,n)=>({encrypt(i,o){const a=i.length;o=bh(a+16,o,!1),o.set(i);const c=o.subarray(0,-16);e(t,r,c,c,1);const d=_h(e,t,r,c,n);return o.set(d,a),Ns(d),o},decrypt(i,o){o=bh(i.length-16,o,!1);const a=i.subarray(0,-16),c=i.subarray(-16),d=_h(e,t,r,a,n);if(!qT(c,d))throw new Error("invalid tag");return o.set(i.subarray(0,-16)),e(t,r,o,o,1),Ns(d),o}}),Ym=jT({blockSize:64,nonceLength:24,tagLength:16},iS(rS)),Ao=new TextEncoder,Rn=new TextDecoder;function Xm(...e){const t=e.reduce((s,{length:i})=>s+i,0),r=new Uint8Array(t);let n=0;for(const s of e)r.set(s,n),n+=s.length;return r}function ws(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);if(n>127)throw new TypeError("non-ASCII string encountered in encode()");t[r]=n}return t}function oS(e){if(Uint8Array.prototype.toBase64)return e.toBase64();const t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))}function aS(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function kn(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:Rn.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=Rn.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return aS(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function ro(e){let t=e;return typeof t=="string"&&(t=Ao.encode(t)),Uint8Array.prototype.toBase64?t.toBase64({alphabet:"base64url",omitPadding:!0}):oS(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Lt extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(t,r){super(t,r),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class ir extends Lt{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(t,r,n="unspecified",s="unspecified"){super(t,{cause:{claim:n,reason:s,payload:r}}),this.claim=n,this.reason=s,this.payload=r}}class cu extends Lt{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(t,r,n="unspecified",s="unspecified"){super(t,{cause:{claim:n,reason:s,payload:r}}),this.claim=n,this.reason=s,this.payload=r}}class cS extends Lt{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class Ut extends Lt{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class ze extends Lt{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class ur extends Lt{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class ew extends Lt{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class tw extends Lt{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(t="no applicable key found in the JSON Web Key Set",r){super(t,r)}}class uS extends Lt{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(t="multiple matching keys found in the JSON Web Key Set",r){super(t,r)}}class dS extends Lt{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(t="request timed out",r){super(t,r)}}class lS extends Lt{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(t="signature verification failed",r){super(t,r)}}const or=(e,t="algorithm.name")=>new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),Gn=(e,t)=>e.name===t;function Ca(e){return parseInt(e.name.slice(4),10)}function hS(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function fS(e,t){if(t&&!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function pS(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if(!Gn(e.algorithm,"HMAC"))throw or("HMAC");const n=parseInt(t.slice(2),10);if(Ca(e.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Gn(e.algorithm,"RSASSA-PKCS1-v1_5"))throw or("RSASSA-PKCS1-v1_5");const n=parseInt(t.slice(2),10);if(Ca(e.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Gn(e.algorithm,"RSA-PSS"))throw or("RSA-PSS");const n=parseInt(t.slice(2),10);if(Ca(e.algorithm.hash)!==n)throw or(`SHA-${n}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Gn(e.algorithm,"Ed25519"))throw or("Ed25519");break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{if(!Gn(e.algorithm,t))throw or(t);break}case"ES256":case"ES384":case"ES512":{if(!Gn(e.algorithm,"ECDSA"))throw or("ECDSA");const n=hS(t);if(e.algorithm.namedCurve!==n)throw or(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}fS(e,r)}function rw(e,t,...r){if(r=r.filter(Boolean),r.length>2){const n=r.pop();e+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const nw=(e,...t)=>rw("Key must be ",e,...t),sw=(e,t,...r)=>rw(`Key for the ${e} algorithm must be `,t,...r),id=e=>e?.[Symbol.toStringTag]==="CryptoKey",od=e=>e?.[Symbol.toStringTag]==="KeyObject",iw=e=>id(e)||od(e);function ow(...e){const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const n of t){const s=Object.keys(n);if(!r||r.size===0){r=new Set(s);continue}for(const i of s){if(r.has(i))return!1;r.add(i)}}return!0}const mS=e=>typeof e=="object"&&e!==null;function tr(e){if(!mS(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function aw(e,t){if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}function wS(e){let t,r;switch(e.kty){case"AKP":{switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new Ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new Ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new Ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Ut('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}async function no(e){if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=wS(e),n={...e};return n.kty!=="AKP"&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??!(e.d||e.priv),e.key_ops??r)}async function oa(e,t,r){if(!tr(e))throw new TypeError("JWK must be an object");let n;switch(t??=e.alg,n??=e.ext,e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return kn(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new Ut('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return no({...e,alg:t,ext:n});case"AKP":{if(typeof e.alg!="string"||!e.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(t!==void 0&&t!==e.alg)throw new TypeError("JWK alg and alg option value mismatch");return no({...e,ext:n})}case"EC":case"OKP":return no({...e,alg:t,ext:n});default:throw new Ut('Unsupported "kty" (Key Type) Parameter value')}}function cw(e,t,r,n,s){if(s.crit!==void 0&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(o=>typeof o!="string"||o.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...t.entries()]):i=t;for(const o of n.crit){if(!i.has(o))throw new Ut(`Extension Header Parameter "${o}" is not recognized`);if(s[o]===void 0)throw new e(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&n[o]===void 0)throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(n.crit)}function yS(e,t){if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}const ad=e=>tr(e)&&typeof e.kty=="string",gS=e=>e.kty!=="oct"&&(e.kty==="AKP"&&typeof e.priv=="string"||typeof e.d=="string"),bS=e=>e.kty!=="oct"&&e.d===void 0&&e.priv===void 0,vS=e=>e.kty==="oct"&&typeof e.k=="string";let ys;const Nh=async(e,t,r,n=!1)=>{ys||=new WeakMap;let s=ys.get(e);if(s?.[r])return s[r];const i=await no({...t,alg:r});return n&&Object.freeze(e),s?s[r]=i:ys.set(e,{[r]:i}),i},ES=(e,t)=>{ys||=new WeakMap;let r=ys.get(e);if(r?.[t])return r[t];const n=e.type==="public",s=!!n;let i;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}i=e.toCryptoKey(e.asymmetricKeyType,s,n?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":{if(t!==e.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,s,[n?"verify":"sign"])}}if(e.asymmetricKeyType==="rsa"){let o;switch(t){case"RSA-OAEP":o="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":o="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":o="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":o="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:o},s,n?["encrypt"]:["decrypt"]);i=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:o},s,[n?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const a=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!a)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&a==="P-256"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:a},s,[n?"verify":"sign"])),t==="ES384"&&a==="P-384"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:a},s,[n?"verify":"sign"])),t==="ES512"&&a==="P-521"&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:a},s,[n?"verify":"sign"])),t.startsWith("ECDH-ES")&&(i=e.toCryptoKey({name:"ECDH",namedCurve:a},s,n?[]:["deriveBits"]))}if(!i)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=i:ys.set(e,{[t]:i}),i};async function uw(e,t){if(e instanceof Uint8Array||id(e))return e;if(od(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return ES(e,t)}catch(n){if(n instanceof TypeError)throw n}let r=e.export({format:"jwk"});return Nh(e,r,t)}if(ad(e))return e.k?kn(e.k):Nh(e,e,t,!0);throw new Error("unreachable")}const os=e=>e?.[Symbol.toStringTag],uu=(e,t,r)=>{if(t.use!==void 0){let n;switch(r){case"sign":case"verify":n="sig";break;case"encrypt":case"decrypt":n="enc";break}if(t.use!==n)throw new TypeError(`Invalid key for this operation, its "use" must be "${n}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case(r==="sign"||r==="verify"):case e==="dir":case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?n=r==="encrypt"?"wrapKey":"unwrapKey":n=r;break;case(r==="encrypt"&&e.startsWith("RSA")):n="wrapKey";break;case r==="decrypt":n=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(n&&t.key_ops?.includes?.(n)===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0},_S=(e,t,r)=>{if(!(t instanceof Uint8Array)){if(ad(t)){if(vS(t)&&uu(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!iw(t))throw new TypeError(sw(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${os(t)} instances for symmetric algorithms must be of type "secret"`)}},NS=(e,t,r)=>{if(ad(t))switch(r){case"decrypt":case"sign":if(gS(t)&&uu(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(bS(t)&&uu(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!iw(t))throw new TypeError(sw(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${os(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(r){case"sign":throw new TypeError(`${os(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${os(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(r){case"verify":throw new TypeError(`${os(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${os(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function dw(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":_S(e,t,r);break;default:NS(e,t,r)}}async function AS(e){if(od(e))if(e.type==="secret")e=e.export();else return e.export({format:"jwk"});if(e instanceof Uint8Array)return{kty:"oct",k:ro(e)};if(!id(e))throw new TypeError(nw(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:r,alg:n,use:s,...i}=await crypto.subtle.exportKey("jwk",e);return i.kty==="AKP"&&(i.alg=n),i}async function Ah(e){return AS(e)}function lw(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new Ut(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function hw(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(nw(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return pS(t,e,r),t}async function kS(e,t,r,n){const s=await hw(e,t,"verify");aw(e,s);const i=lw(e,s.algorithm);try{return await crypto.subtle.verify(i,s,r,n)}catch{return!1}}async function TS(e,t,r){if(!tr(e))throw new ze("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new ze('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new ze("JWS Protected Header incorrect type");if(e.payload===void 0)throw new ze("JWS Payload missing");if(typeof e.signature!="string")throw new ze("JWS Signature missing or incorrect type");if(e.header!==void 0&&!tr(e.header))throw new ze("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const g=kn(e.protected);n=JSON.parse(Rn.decode(g))}catch{throw new ze("JWS Protected Header is invalid")}if(!ow(n,e.header))throw new ze("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...n,...e.header},i=cw(ze,new Map([["b64",!0]]),r?.crit,n,s);let o=!0;if(i.has("b64")&&(o=n.b64,typeof o!="boolean"))throw new ze('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=s;if(typeof a!="string"||!a)throw new ze('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=r&&yS("algorithms",r.algorithms);if(c&&!c.has(a))throw new cS('"alg" (Algorithm) Header Parameter value not allowed');if(o){if(typeof e.payload!="string")throw new ze("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new ze("JWS Payload must be a string or an Uint8Array instance");let d=!1;typeof t=="function"&&(t=await t(n,e),d=!0),dw(a,t,"verify");const u=Xm(e.protected!==void 0?ws(e.protected):new Uint8Array,ws("."),typeof e.payload=="string"?o?ws(e.payload):Ao.encode(e.payload):e.payload);let l;try{l=kn(e.signature)}catch{throw new ze("Failed to base64url decode the signature")}const h=await uw(t,a);if(!await kS(a,h,l,u))throw new lS;let p;if(o)try{p=kn(e.payload)}catch{throw new ze("Failed to base64url decode the payload")}else typeof e.payload=="string"?p=Ao.encode(e.payload):p=e.payload;const w={payload:p};return e.protected!==void 0&&(w.protectedHeader=n),e.header!==void 0&&(w.unprotectedHeader=e.header),d?{...w,key:h}:w}async function SS(e,t,r){if(e instanceof Uint8Array&&(e=Rn.decode(e)),typeof e!="string")throw new ze("Compact JWS must be a string or Uint8Array");const{0:n,1:s,2:i,length:o}=e.split(".");if(o!==3)throw new ze("Invalid Compact JWS");const a=await TS({payload:s,protected:n,signature:i},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof t=="function"?{...c,key:a.key}:c}const zr=e=>Math.floor(e.getTime()/1e3),fw=60,pw=fw*60,cd=pw*24,RS=cd*7,IS=cd*365.25,OS=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Js(e){const t=OS.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let s;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(r*fw);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(r*pw);break;case"day":case"days":case"d":s=Math.round(r*cd);break;case"week":case"weeks":case"w":s=Math.round(r*RS);break;default:s=Math.round(r*IS);break}return t[1]==="-"||t[4]==="ago"?-s:s}function fn(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}const kh=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,$S=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function CS(e,t,r={}){let n;try{n=JSON.parse(Rn.decode(t))}catch{}if(!tr(n))throw new ur("JWT Claims Set must be a top-level JSON object");const{typ:s}=r;if(s&&(typeof e.typ!="string"||kh(e.typ)!==kh(s)))throw new ir('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:i=[],issuer:o,subject:a,audience:c,maxTokenAge:d}=r,u=[...i];d!==void 0&&u.push("iat"),c!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),o!==void 0&&u.push("iss");for(const p of new Set(u.reverse()))if(!(p in n))throw new ir(`missing required "${p}" claim`,n,p,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(n.iss))throw new ir('unexpected "iss" claim value',n,"iss","check_failed");if(a&&n.sub!==a)throw new ir('unexpected "sub" claim value',n,"sub","check_failed");if(c&&!$S(n.aud,typeof c=="string"?[c]:c))throw new ir('unexpected "aud" claim value',n,"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=Js(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:h}=r,m=zr(h||new Date);if((n.iat!==void 0||d)&&typeof n.iat!="number")throw new ir('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new ir('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>m+l)throw new ir('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new ir('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=m-l)throw new cu('"exp" claim timestamp check failed',n,"exp","check_failed")}if(d){const p=m-n.iat,w=typeof d=="number"?d:Js(d);if(p-l>w)throw new cu('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(p<0-l)throw new ir('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}class xS{#e;constructor(t){if(!tr(t))throw new TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(t)}data(){return Ao.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(t){this.#e.iss=t}get sub(){return this.#e.sub}set sub(t){this.#e.sub=t}get aud(){return this.#e.aud}set aud(t){this.#e.aud=t}set jti(t){this.#e.jti=t}set nbf(t){typeof t=="number"?this.#e.nbf=fn("setNotBefore",t):t instanceof Date?this.#e.nbf=fn("setNotBefore",zr(t)):this.#e.nbf=zr(new Date)+Js(t)}set exp(t){typeof t=="number"?this.#e.exp=fn("setExpirationTime",t):t instanceof Date?this.#e.exp=fn("setExpirationTime",zr(t)):this.#e.exp=zr(new Date)+Js(t)}set iat(t){t===void 0?this.#e.iat=zr(new Date):t instanceof Date?this.#e.iat=fn("setIssuedAt",zr(t)):typeof t=="string"?this.#e.iat=fn("setIssuedAt",zr(new Date)+Js(t)):this.#e.iat=fn("setIssuedAt",t)}}async function aa(e,t,r){const n=await SS(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&n.protectedHeader.b64===!1)throw new ur("JWTs MUST NOT use unencoded payload");const i={payload:CS(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof t=="function"?{...i,key:n.key}:i}async function US(e,t,r){const n=await hw(e,t,"sign");aw(e,n);const s=await crypto.subtle.sign(lw(e,n.algorithm),n,r);return new Uint8Array(s)}class PS{#e;#t;#r;constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this.#e=t}setProtectedHeader(t){if(this.#t)throw new TypeError("setProtectedHeader can only be called once");return this.#t=t,this}setUnprotectedHeader(t){if(this.#r)throw new TypeError("setUnprotectedHeader can only be called once");return this.#r=t,this}async sign(t,r){if(!this.#t&&!this.#r)throw new ze("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ow(this.#t,this.#r))throw new ze("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...this.#t,...this.#r},s=cw(ze,new Map([["b64",!0]]),r?.crit,this.#t,n);let i=!0;if(s.has("b64")&&(i=this.#t.b64,typeof i!="boolean"))throw new ze('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=n;if(typeof o!="string"||!o)throw new ze('JWS "alg" (Algorithm) Header Parameter missing or invalid');dw(o,t,"sign");let a,c;i?(a=ro(this.#e),c=ws(a)):(c=this.#e,a="");let d,u;this.#t?(d=ro(JSON.stringify(this.#t)),u=ws(d)):(d="",u=new Uint8Array);const l=Xm(u,ws("."),c),h=await uw(t,o),m=await US(o,h,l),p={signature:ro(m),payload:a};return this.#r&&(p.header=this.#r),this.#t&&(p.protected=d),p}}class DS{#e;constructor(t){this.#e=new PS(t)}setProtectedHeader(t){return this.#e.setProtectedHeader(t),this}async sign(t,r){const n=await this.#e.sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}class ud{#e;#t;constructor(t={}){this.#t=new xS(t)}setIssuer(t){return this.#t.iss=t,this}setSubject(t){return this.#t.sub=t,this}setAudience(t){return this.#t.aud=t,this}setJti(t){return this.#t.jti=t,this}setNotBefore(t){return this.#t.nbf=t,this}setExpirationTime(t){return this.#t.exp=t,this}setIssuedAt(t){return this.#t.iat=t,this}setProtectedHeader(t){return this.#e=t,this}async sign(t,r){const n=new DS(this.#t.data());if(n.setProtectedHeader(this.#e),Array.isArray(this.#e?.crit)&&this.#e.crit.includes("b64")&&this.#e.b64===!1)throw new ur("JWTs MUST NOT use unencoded payload");return n.sign(t,r)}}function LS(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new Ut('Unsupported "alg" value for a JSON Web Key Set')}}function zS(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(qS)}function qS(e){return tr(e)}class jS{#e;#t=new WeakMap;constructor(t){if(!zS(t))throw new ew("JSON Web Key Set malformed");this.#e=structuredClone(t)}jwks(){return this.#e}async getKey(t,r){const{alg:n,kid:s}={...t,...r?.header},i=LS(n),o=this.#e.keys.filter(d=>{let u=i===d.kty;if(u&&typeof s=="string"&&(u=s===d.kid),u&&(typeof d.alg=="string"||i==="AKP")&&(u=n===d.alg),u&&typeof d.use=="string"&&(u=d.use==="sig"),u&&Array.isArray(d.key_ops)&&(u=d.key_ops.includes("verify")),u)switch(n){case"ES256":u=d.crv==="P-256";break;case"ES384":u=d.crv==="P-384";break;case"ES512":u=d.crv==="P-521";break;case"Ed25519":case"EdDSA":u=d.crv==="Ed25519";break}return u}),{0:a,length:c}=o;if(c===0)throw new tw;if(c!==1){const d=new uS,u=this.#t;throw d[Symbol.asyncIterator]=async function*(){for(const l of o)try{yield await Th(u,l,n)}catch{}},d}return Th(this.#t,a,n)}}async function Th(e,t,r){const n=e.get(t)||e.set(t,{}).get(t);if(n[r]===void 0){const s=await oa({...t,ext:!0},r);if(s instanceof Uint8Array||s.type!=="public")throw new ew("JSON Web Key Set members must be public keys");n[r]=s}return n[r]}function Sh(e){const t=new jS(e),r=async(n,s)=>t.getKey(n,s);return Object.defineProperties(r,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),r}function WS(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let du;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(du="jose/v6.1.1");const MS=Symbol();async function VS(e,t,r,n=fetch){const s=await n(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(i=>{throw i.name==="TimeoutError"?new dS:i});if(s.status!==200)throw new Lt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch{throw new Lt("Failed to parse the JSON Web Key Set HTTP response as JSON")}}const xa=Symbol();function FS(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!tr(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,tr))}class ZS{#e;#t;#r;#n;#s;#i;#c;#a;#o;#u;constructor(t,r){if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");this.#e=new URL(t.href),this.#t=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this.#r=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this.#n=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5,this.#c=new Headers(r?.headers),du&&!this.#c.has("User-Agent")&&this.#c.set("User-Agent",du),this.#c.has("accept")||(this.#c.set("accept","application/json"),this.#c.append("accept","application/jwk-set+json")),this.#a=r?.[MS],r?.[xa]!==void 0&&(this.#u=r?.[xa],FS(r?.[xa],this.#n)&&(this.#s=this.#u.uat,this.#o=Sh(this.#u.jwks)))}pendingFetch(){return!!this.#i}coolingDown(){return typeof this.#s=="number"?Date.now()<this.#s+this.#r:!1}fresh(){return typeof this.#s=="number"?Date.now()<this.#s+this.#n:!1}jwks(){return this.#o?.jwks()}async getKey(t,r){(!this.#o||!this.fresh())&&await this.reload();try{return await this.#o(t,r)}catch(n){if(n instanceof tw&&this.coolingDown()===!1)return await this.reload(),this.#o(t,r);throw n}}async reload(){this.#i&&WS()&&(this.#i=void 0),this.#i||=VS(this.#e.href,this.#c,AbortSignal.timeout(this.#t),this.#a).then(t=>{this.#o=Sh(t),this.#u&&(this.#u.uat=Date.now(),this.#u.jwks=t),this.#s=Date.now(),this.#i=void 0}).catch(t=>{throw this.#i=void 0,t}),await this.#i}}function BS(e,t){const r=new ZS(e,t),n=async(s,i)=>r.getKey(s,i);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>r.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>r.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}function mw(e){let t;if(typeof e=="string"){const r=e.split(".");(r.length===3||r.length===5)&&([t]=r)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw new Error;const r=JSON.parse(Rn.decode(kn(t)));if(!tr(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function an(e){if(typeof e!="string")throw new ur("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(r===5)throw new ur("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new ur("Invalid JWT");if(!t)throw new ur("JWTs must contain a payload");let n;try{n=kn(t)}catch{throw new ur("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Rn.decode(n))}catch{throw new ur("Failed to parse the decoded payload as JSON")}if(!tr(s))throw new ur("Invalid JWT Claims Set");return s}function Ua(e){const t=e?.modulusLength??2048;if(typeof t!="number"||t<2048)throw new Ut("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function HS(e,t){let r,n;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:Ua(t)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:Ua(t)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:Ua(t)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"Ed25519":case"EdDSA":{n=["sign","verify"],r={name:"Ed25519"};break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{n=["sign","verify"],r={name:e};break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveBits"];const s=t?.crv??"P-256";switch(s){case"P-256":case"P-384":case"P-521":{r={name:"ECDH",namedCurve:s};break}case"X25519":r={name:"X25519"};break;default:throw new Ut("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, and X25519")}break}default:throw new Ut('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(r,t?.extractable,n)}class ww{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(Rp(t),rl(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Ou(s)}update(t){return nl(this),this.iHash.update(t),this}digestInto(t){nl(this),rl(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const yw=(e,t,r)=>new ww(e,t).update(r).digest();yw.create=(e,t)=>new ww(e,t);function KS(e,t,r,n){Rp(e);const s=Ip({dkLen:32,asyncTick:10},n),{c:i,dkLen:o,asyncTick:a}=s;if(Nr(i,"c"),Nr(o,"dkLen"),Nr(a,"asyncTick"),i<1)throw new Error("iterations (c) must be >= 1");const c=sl(t,"password"),d=sl(r,"salt"),u=new Uint8Array(o),l=yw.create(e,c),h=l._cloneInto().update(d);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:l,PRFSalt:h}}function JS(e,t,r,n,s){return e.destroy(),t.destroy(),n&&n.destroy(),Ou(s),r}function gw(e,t,r,n){const{c:s,dkLen:i,DK:o,PRF:a,PRFSalt:c}=KS(e,t,r,n);let d;const u=new Uint8Array(4),l=Wg(u),h=new Uint8Array(a.outputLen);for(let m=1,p=0;p<i;m++,p+=a.outputLen){const w=o.subarray(p,p+a.outputLen);l.setInt32(0,m,!1),(d=c._cloneInto(d)).update(u).digestInto(h),w.set(h.subarray(0,w.length));for(let g=1;g<s;g++){a._cloneInto(d).update(h).digestInto(h);for(let b=0;b<w.length;b++)w[b]^=h[b]}}return JS(a,c,o,d,h)}function Rh(e,t,r,n,s,i){let o=e[t++]^r[n++],a=e[t++]^r[n++],c=e[t++]^r[n++],d=e[t++]^r[n++],u=e[t++]^r[n++],l=e[t++]^r[n++],h=e[t++]^r[n++],m=e[t++]^r[n++],p=e[t++]^r[n++],w=e[t++]^r[n++],g=e[t++]^r[n++],b=e[t++]^r[n++],v=e[t++]^r[n++],y=e[t++]^r[n++],E=e[t++]^r[n++],k=e[t++]^r[n++],A=o,R=a,T=c,L=d,P=u,W=l,j=h,V=m,I=p,C=w,z=g,U=b,q=v,O=y,D=E,B=k;for(let F=0;F<8;F+=2)P^=ie(A+q|0,7),I^=ie(P+A|0,9),q^=ie(I+P|0,13),A^=ie(q+I|0,18),C^=ie(W+R|0,7),O^=ie(C+W|0,9),R^=ie(O+C|0,13),W^=ie(R+O|0,18),D^=ie(z+j|0,7),T^=ie(D+z|0,9),j^=ie(T+D|0,13),z^=ie(j+T|0,18),L^=ie(B+U|0,7),V^=ie(L+B|0,9),U^=ie(V+L|0,13),B^=ie(U+V|0,18),R^=ie(A+L|0,7),T^=ie(R+A|0,9),L^=ie(T+R|0,13),A^=ie(L+T|0,18),j^=ie(W+P|0,7),V^=ie(j+W|0,9),P^=ie(V+j|0,13),W^=ie(P+V|0,18),U^=ie(z+C|0,7),I^=ie(U+z|0,9),C^=ie(I+U|0,13),z^=ie(C+I|0,18),q^=ie(B+D|0,7),O^=ie(q+B|0,9),D^=ie(O+q|0,13),B^=ie(D+O|0,18);s[i++]=o+A|0,s[i++]=a+R|0,s[i++]=c+T|0,s[i++]=d+L|0,s[i++]=u+P|0,s[i++]=l+W|0,s[i++]=h+j|0,s[i++]=m+V|0,s[i++]=p+I|0,s[i++]=w+C|0,s[i++]=g+z|0,s[i++]=b+U|0,s[i++]=v+q|0,s[i++]=y+O|0,s[i++]=E+D|0,s[i++]=k+B|0}function Pa(e,t,r,n,s){let i=n+0,o=n+16*s;for(let a=0;a<16;a++)r[o+a]=e[t+(2*s-1)*16+a];for(let a=0;a<s;a++,i+=16,t+=16)Rh(r,o,e,t,r,i),a>0&&(o+=16),Rh(r,i,e,t+=16,r,o)}function GS(e,t,r){const n=Ip({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:s,r:i,p:o,dkLen:a,asyncTick:c,maxmem:d,onProgress:u}=n;if(Nr(s,"N"),Nr(i,"r"),Nr(o,"p"),Nr(a,"dkLen"),Nr(c,"asyncTick"),Nr(d,"maxmem"),u!==void 0&&typeof u!="function")throw new Error("progressCb must be a function");const l=128*i,h=l/4,m=Math.pow(2,32);if(s<=1||(s&s-1)!==0||s>m)throw new Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(o<1||o>(m-1)*32/l)throw new Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(a<1||a>(m-1)*32)throw new Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(l*(s+o)>d)throw new Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+d);const w=gw(Op,e,t,{c:1,dkLen:l*o}),g=Ra(w),b=Ra(new Uint8Array(l*s)),v=Ra(new Uint8Array(l));let y=()=>{};if(u){const E=2*s*o,k=Math.max(Math.floor(E/1e4),1);let A=0;y=()=>{A++,u&&(!(A%k)||A===E)&&u(A/E)}}return{N:s,r:i,p:o,dkLen:a,blockSize32:h,V:b,B32:g,B:w,tmp:v,blockMixCb:y,asyncTick:c}}function QS(e,t,r,n,s){const i=gw(Op,e,r,{c:1,dkLen:t});return Ou(r,n,s),i}async function YS(e,t,r){const{N:n,r:s,p:i,dkLen:o,blockSize32:a,V:c,B32:d,B:u,tmp:l,blockMixCb:h,asyncTick:m}=GS(e,t,r);il(d);for(let p=0;p<i;p++){const w=a*p;for(let b=0;b<a;b++)c[b]=d[w+b];let g=0;await ol(n-1,m,()=>{Pa(c,g,c,g+=a,s),h()}),Pa(c,(n-1)*a,d,w,s),h(),await ol(n,m,()=>{const b=(d[w+a-16]&n-1)>>>0;for(let v=0;v<a;v++)l[v]=d[w+v]^c[b*a+v];Pa(l,0,d,w,s),h()})}return il(d),QS(e,o,u,c,l)}const XS="0123456789abcdef",ko={encode:e=>{if(typeof e=="string"&&(e=new TextEncoder().encode(e)),e.byteLength===0)return"";const t=new Uint8Array(e);let r="";for(const n of t)r+=n.toString(16).padStart(2,"0");return r},decode:e=>{if(!e)return"";if(typeof e=="string"){if(e.length%2!==0)throw new Error("Invalid hexadecimal string");if(!new RegExp(`^[${XS}]+$`).test(e))throw new Error("Invalid hexadecimal string");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}},Ct=Bp("a-z","0-9","A-Z","-_");function eR(e,t,r){return r==="update"?e===void 0&&t.onUpdate!==void 0?typeof t.onUpdate=="function"?t.onUpdate():t.onUpdate:e:e==null&&t.defaultValue!==void 0?typeof t.defaultValue=="function"?t.defaultValue():t.defaultValue:e}let ji=[],at=-1;const tR=e=>t=>t(e),To=({adapter:e,config:t})=>r=>{const n=Math.random().toString(36).substring(2,15),s={...t,supportsBooleans:t.supportsBooleans??!0,supportsDates:t.supportsDates??!0,supportsJSON:t.supportsJSON??!1,adapterName:t.adapterName??t.adapterId,supportsNumericIds:t.supportsNumericIds??!0,transaction:t.transaction??!1,disableTransformInput:t.disableTransformInput??!1,disableTransformOutput:t.disableTransformOutput??!1};if(r.advanced?.database?.useNumberId===!0&&s.supportsNumericIds===!1)throw new Error(`[${s.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);const i=li(r),o=({field:y,model:E})=>{if(y==="id"||y==="_id")return"id";const k=a(E);let A=i[k]?.fields[y];if(!A){const R=Object.entries(i[k].fields).find(([T,L])=>L.fieldName===y);R&&(A=R[1],y=R[0])}if(!A)throw u(`Field ${y} not found in model ${k}`),u("Schema:",i),new Error(`Field ${y} not found in model ${k}`);return y},a=y=>{if(s.usePlural&&y.charAt(y.length-1)==="s"){let k=y.slice(0,-1),A=i[k]?k:void 0;if(A||(A=Object.entries(i).find(([R,T])=>T.modelName===k)?.[0]),A)return A}let E=i[y]?y:void 0;if(E||(E=Object.entries(i).find(([k,A])=>A.modelName===y)?.[0]),!E)throw u(`Model "${y}" not found in schema`),u("Schema:",i),new Error(`Model "${y}" not found in schema`);return E},c=y=>{const E=a(y),k=s&&s.usePlural;return i&&i[E]&&i[E].modelName!==y?k?`${i[E].modelName}s`:i[E].modelName:k?`${y}s`:y};function d({model:y,field:E}){const k=a(y),A=o({model:k,field:E});return i[k]?.fields[A]?.fieldName||A}const u=(...y)=>{if(s.debugLogs===!0||typeof s.debugLogs=="object"){if(typeof s.debugLogs=="object"&&"isRunningAdapterTests"in s.debugLogs){s.debugLogs.isRunningAdapterTests&&(y.shift(),ji.push({instance:n,args:y}));return}if(typeof s.debugLogs=="object"&&s.debugLogs.logCondition&&!s.debugLogs.logCondition?.())return;if(typeof y[0]=="object"&&"method"in y[0]){const E=y.shift().method;if(typeof s.debugLogs=="object"){if(E==="create"&&!s.debugLogs.create)return;if(E==="update"&&!s.debugLogs.update)return;if(E==="updateMany"&&!s.debugLogs.updateMany)return;if(E==="findOne"&&!s.debugLogs.findOne)return;if(E==="findMany"&&!s.debugLogs.findMany)return;if(E==="delete"&&!s.debugLogs.delete)return;if(E==="deleteMany"&&!s.debugLogs.deleteMany)return;if(E==="count"&&!s.debugLogs.count)return}te.info(`[${s.adapterName}]`,...y)}else te.info(`[${s.adapterName}]`,...y)}},l=({customModelName:y,forceAllowId:E})=>{const k=!s.disableIdGeneration&&!r.advanced?.database?.useNumberId&&!E,A=a(y??"id");return{type:r.advanced?.database?.useNumberId?"number":"string",required:!!k,...k?{defaultValue(){if(s.disableIdGeneration)return;const R=r.advanced?.database?.useNumberId;let T=r.advanced?.database?.generateId;if(r.advanced?.generateId!==void 0&&(te.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),T=r.advanced?.generateId),!(T===!1||R))return T?T({model:A}):s.customIdGenerator?s.customIdGenerator({model:A}):Ht()}}:{}}},h=({model:y,field:E})=>{const k=a(y),A=o({field:E,model:k}),R=i[k].fields;return R.id=l({customModelName:k}),R[A]},m=async(y,E,k,A)=>{const R={},T=i[E].fields,L=s.mapKeysTransformInput??{};!s.disableIdGeneration&&!r.advanced?.database?.useNumberId&&(T.id=l({customModelName:E,forceAllowId:A&&"id"in y}));for(const P in T){const W=y[P],j=T[P];let V=L[P]||T[P].fieldName||P;if(W===void 0&&(j.defaultValue===void 0&&!j.transform?.input&&!(k==="update"&&j.onUpdate)||k==="update"&&!j.onUpdate))continue;let I=eR(W,j,k);j.transform?.input&&(I=await j.transform.input(I)),j.references?.field==="id"&&r.advanced?.database?.useNumberId?Array.isArray(I)?I=I.map(C=>C!==null?Number(C):null):I=I!==null?Number(I):null:s.supportsJSON===!1&&typeof I=="object"&&j.type==="json"?I=JSON.stringify(I):s.supportsDates===!1&&I instanceof Date&&j.type==="date"?I=I.toISOString():s.supportsBooleans===!1&&typeof I=="boolean"&&(I=I?1:0),s.customTransformInput&&(I=s.customTransformInput({data:I,action:k,field:V,fieldAttributes:j,model:E,schema:i,options:r})),I!==void 0&&(R[V]=I)}return R},p=async(y,E,k=[])=>{if(!y)return null;const A=s.mapKeysTransformOutput??{},R={},T=i[E].fields,L=Object.entries(A).find(([P,W])=>W==="id")?.[0];T[L??"id"]={type:r.advanced?.database?.useNumberId?"number":"string"};for(const P in T){if(k.length&&!k.includes(P))continue;const W=T[P];if(W){const j=W.fieldName||P;let V=y[Object.entries(A).find(([C,z])=>z===j)?.[0]||j];W.transform?.output&&(V=await W.transform.output(V));let I=A[P]||P;j==="id"||W.references?.field==="id"?typeof V<"u"&&V!==null&&(V=String(V)):s.supportsJSON===!1&&typeof V=="string"&&W.type==="json"?V=ht(V):s.supportsDates===!1&&typeof V=="string"&&W.type==="date"?V=new Date(V):s.supportsBooleans===!1&&typeof V=="number"&&W.type==="boolean"&&(V=V===1),s.customTransformOutput&&(V=s.customTransformOutput({data:V,field:I,fieldAttributes:W,select:k,model:E,schema:i,options:r})),R[I]=V}}return R},w=({model:y,where:E})=>{if(!E)return;const k=s.mapKeysTransformInput??{};return E.map(A=>{const{field:R,value:T,operator:L="eq",connector:P="AND"}=A;if(L==="in"&&!Array.isArray(T))throw new Error("Value must be an array");const W=a(y),j=o({field:R,model:y}),V=k[j]||d({field:j,model:W}),I=h({field:j,model:W});return(j==="id"||I.references?.field==="id")&&r.advanced?.database?.useNumberId?Array.isArray(T)?{operator:L,connector:P,field:V,value:T.map(Number)}:{operator:L,connector:P,field:V,value:Number(T)}:{operator:L,connector:P,field:V,value:T}})},g=e({options:r,schema:i,debugLog:u,getFieldName:d,getModelName:c,getDefaultModelName:a,getDefaultFieldName:o,getFieldAttributes:h,transformInput:m,transformOutput:p,transformWhereClause:w});let b=null;const v={transaction:async y=>(b||(s.transaction?(te.debug(`[${s.adapterName}] - Using provided transaction implementation.`),b=s.transaction):(typeof s.debugLogs=="object"&&"isRunningAdapterTests"in s.debugLogs&&s.debugLogs.isRunningAdapterTests||te.warn(`[${s.adapterName}] - Transactions are not supported. Executing operations sequentially.`),b=tR(v))),b(y)),create:async({data:y,model:E,select:k,forceAllowId:A=!1})=>{at++;let R=at;const T=c(E);if(E=a(E),"id"in y&&!A){te.warn(`[${s.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);const V=new Error().stack?.split(`
`).filter((I,C)=>C!==1).join(`
`).replace("Error:","Create method with `id` being called at:");console.log(V),y.id=void 0}u({method:"create"},`${Ne(R)} ${Ae(1,4)}`,`${ke("create")} ${Ke("Unsafe Input")}:`,{model:T,data:y});let L=y;s.disableTransformInput||(L=await m(y,E,"create",A)),u({method:"create"},`${Ne(R)} ${Ae(2,4)}`,`${ke("create")} ${Ke("Parsed Input")}:`,{model:T,data:L});const P=await g.create({data:L,model:T});u({method:"create"},`${Ne(R)} ${Ae(3,4)}`,`${ke("create")} ${Ke("DB Result")}:`,{model:T,res:P});let W=P;return s.disableTransformOutput||(W=await p(P,E,k)),u({method:"create"},`${Ne(R)} ${Ae(4,4)}`,`${ke("create")} ${Ke("Parsed Result")}:`,{model:T,data:W}),W},update:async({model:y,where:E,update:k})=>{at++;let A=at;y=a(y);const R=c(y),T=w({model:y,where:E});u({method:"update"},`${Ne(A)} ${Ae(1,4)}`,`${ke("update")} ${Ke("Unsafe Input")}:`,{model:R,data:k});let L=k;s.disableTransformInput||(L=await m(k,y,"update")),u({method:"update"},`${Ne(A)} ${Ae(2,4)}`,`${ke("update")} ${Ke("Parsed Input")}:`,{model:R,data:L});const P=await g.update({model:R,where:T,update:L});u({method:"update"},`${Ne(A)} ${Ae(3,4)}`,`${ke("update")} ${Ke("DB Result")}:`,{model:R,data:P});let W=P;return s.disableTransformOutput||(W=await p(P,y)),u({method:"update"},`${Ne(A)} ${Ae(4,4)}`,`${ke("update")} ${Ke("Parsed Result")}:`,{model:R,data:W}),W},updateMany:async({model:y,where:E,update:k})=>{at++;let A=at;const R=c(y),T=w({model:y,where:E});y=a(y),u({method:"updateMany"},`${Ne(A)} ${Ae(1,4)}`,`${ke("updateMany")} ${Ke("Unsafe Input")}:`,{model:R,data:k});let L=k;s.disableTransformInput||(L=await m(k,y,"update")),u({method:"updateMany"},`${Ne(A)} ${Ae(2,4)}`,`${ke("updateMany")} ${Ke("Parsed Input")}:`,{model:R,data:L});const P=await g.updateMany({model:R,where:T,update:L});return u({method:"updateMany"},`${Ne(A)} ${Ae(3,4)}`,`${ke("updateMany")} ${Ke("DB Result")}:`,{model:R,data:P}),u({method:"updateMany"},`${Ne(A)} ${Ae(4,4)}`,`${ke("updateMany")} ${Ke("Parsed Result")}:`,{model:R,data:P}),P},findOne:async({model:y,where:E,select:k})=>{at++;let A=at;const R=c(y),T=w({model:y,where:E});y=a(y),u({method:"findOne"},`${Ne(A)} ${Ae(1,3)}`,`${ke("findOne")}:`,{model:R,where:T,select:k});const L=await g.findOne({model:R,where:T,select:k});u({method:"findOne"},`${Ne(A)} ${Ae(2,3)}`,`${ke("findOne")} ${Ke("DB Result")}:`,{model:R,data:L});let P=L;return s.disableTransformOutput||(P=await p(L,y,k)),u({method:"findOne"},`${Ne(A)} ${Ae(3,3)}`,`${ke("findOne")} ${Ke("Parsed Result")}:`,{model:R,data:P}),P},findMany:async({model:y,where:E,limit:k,sortBy:A,offset:R})=>{at++;let T=at;const L=k??r.advanced?.database?.defaultFindManyLimit??100,P=c(y),W=w({model:y,where:E});y=a(y),u({method:"findMany"},`${Ne(T)} ${Ae(1,3)}`,`${ke("findMany")}:`,{model:P,where:W,limit:L,sortBy:A,offset:R});const j=await g.findMany({model:P,where:W,limit:L,sortBy:A,offset:R});u({method:"findMany"},`${Ne(T)} ${Ae(2,3)}`,`${ke("findMany")} ${Ke("DB Result")}:`,{model:P,data:j});let V=j;return s.disableTransformOutput||(V=await Promise.all(j.map(async I=>await p(I,y)))),u({method:"findMany"},`${Ne(T)} ${Ae(3,3)}`,`${ke("findMany")} ${Ke("Parsed Result")}:`,{model:P,data:V}),V},delete:async({model:y,where:E})=>{at++;let k=at;const A=c(y),R=w({model:y,where:E});y=a(y),u({method:"delete"},`${Ne(k)} ${Ae(1,2)}`,`${ke("delete")}:`,{model:A,where:R}),await g.delete({model:A,where:R}),u({method:"delete"},`${Ne(k)} ${Ae(2,2)}`,`${ke("delete")} ${Ke("DB Result")}:`,{model:A})},deleteMany:async({model:y,where:E})=>{at++;let k=at;const A=c(y),R=w({model:y,where:E});y=a(y),u({method:"deleteMany"},`${Ne(k)} ${Ae(1,2)}`,`${ke("deleteMany")} ${Ke("DeleteMany")}:`,{model:A,where:R});const T=await g.deleteMany({model:A,where:R});return u({method:"deleteMany"},`${Ne(k)} ${Ae(2,2)}`,`${ke("deleteMany")} ${Ke("DB Result")}:`,{model:A,data:T}),T},count:async({model:y,where:E})=>{at++;let k=at;const A=c(y),R=w({model:y,where:E});y=a(y),u({method:"count"},`${Ne(k)} ${Ae(1,2)}`,`${ke("count")}:`,{model:A,where:R});const T=await g.count({model:A,where:R});return u({method:"count"},`${Ne(k)} ${Ae(2,2)}`,`${ke("count")}:`,{model:A,data:T}),T},createSchema:g.createSchema?async(y,E)=>{const k=li(r);return r.secondaryStorage&&!r.session?.storeSessionInDatabase&&delete k.session,r.rateLimit&&r.rateLimit.storage==="database"&&(typeof r.rateLimit.enabled>"u"||r.rateLimit.enabled===!0)&&(k.ratelimit={modelName:r.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:r.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:r.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:r.rateLimit.fields?.lastRequest??"lastRequest"}}}),g.createSchema({file:E,tables:k})}:void 0,options:{adapterConfig:s,...g.options??{}},id:s.adapterId,...s.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){ji=ji.filter(y=>y.instance!==n)},printDebugLogs(){const y="".repeat(80),E=ji.filter(A=>A.instance===n);if(E.length===0)return;let k=E.reverse().map(A=>(A.args[0]=`
${A.args[0]}`,[...A.args,`
`])).reduce((A,R)=>[...R,...A],[`
${y}`]);console.log(...k)}}}:{}};return v};function Ne(e){return`${Ge.fg.magenta}#${e}${Ge.reset}`}function Ae(e,t){return`${Ge.bg.black}${Ge.fg.yellow}[${e}/${t}]${Ge.reset}`}function ke(e){return`${Ge.bright}${e}${Ge.reset}`}function Ke(e){return`${Ge.dim}(${e})${Ge.reset}`}async function Ih(e,t){const r=[];let n=0;e=await e;for(const s of e)r.push(t(s,n)),n+=1;return Promise.all(r)}const bw={done:!1,hasNext:!1};function Oh(e,...t){let r=e,n=t.map(i=>"lazy"in i?rR(i):void 0),s=0;for(;s<t.length;){if(n[s]===void 0||!nR(r)){let c=t[s];r=c(r),s+=1;continue}let i=[];for(let c=s;c<t.length;c++){let d=n[c];if(d===void 0||(i.push(d),d.isSingle))break}let o=[];for(let c of r)if(vw(c,o,i))break;let{isSingle:a}=i.at(-1);r=a?o[0]:o,s+=i.length}return r}function vw(e,t,r){if(r.length===0)return t.push(e),!1;let n=e,s=bw,i=!1;for(let[o,a]of r.entries()){let{index:c,items:d}=a;if(d.push(n),s=a(n,c,d),a.index+=1,s.hasNext){if(s.hasMany??!1){for(let u of s.next)if(vw(u,t,r.slice(o+1)))return!0;return i}n=s.next}if(!s.hasNext)break;s.done&&(i=!0)}return s.hasNext&&t.push(n),i}function rR(e){let{lazy:t,lazyArgs:r}=e,n=t(...r);return Object.assign(n,{isSingle:t.single??!1,index:0,items:[]})}function nR(e){return typeof e=="string"||typeof e=="object"&&!!e&&Symbol.iterator in e}function sR(e,t){let r=t.length-e.length;if(r===1){let[n,...s]=t;return Oh(n,{lazy:e,lazyArgs:s})}if(r===0){let n={lazy:e,lazyArgs:t};return Object.assign(s=>Oh(s,n),n)}throw Error("Wrong number of arguments")}const Ew={asc:(e,t)=>e>t,desc:(e,t)=>e<t};function iR(e,t){let[r,...n]=t;if(!oR(r)){let i=lu(...n);return e(r,i)}let s=lu(r,...n);return i=>e(i,s)}function lu(e,t,...r){let n=typeof e=="function"?e:e[0],s=typeof e=="function"?"asc":e[1],{[s]:i}=Ew,o=t===void 0?void 0:lu(t,...r);return(a,c)=>{let d=n(a),u=n(c);return i(d,u)?1:i(u,d)?-1:o?.(a,c)??0}}function oR(e){if($h(e))return!0;if(typeof e!="object"||!Array.isArray(e))return!1;let[t,r,...n]=e;return $h(t)&&typeof r=="string"&&r in Ew&&n.length===0}const $h=e=>typeof e=="function"&&e.length===1;function aR(e,...t){return typeof e=="string"||typeof e=="number"||typeof e=="symbol"?r=>Ch(r,e,...t):Ch(e,...t)}function Ch(e,...t){let r=e;for(let n of t){if(r==null)return;r=r[n]}return r}function cR(...e){return iR(uR,e)}const uR=(e,t)=>[...e].sort(t);function xh(...e){return sR(dR,e)}function dR(){let e=new Set;return t=>e.has(t)?bw:(e.add(t),{done:!1,hasNext:!0,next:t})}const lR=e=>"runMutation"in e,Qn=async(e,{limit:t,numItems:r}={})=>{const n={isDone:!1,cursor:null,docs:[],count:0},s=i=>{if(n.cursor=i.pageStatus==="SplitRecommended"||i.pageStatus==="SplitRequired"?i.splitCursor??i.continueCursor:i.continueCursor,i.page){n.docs.push(...i.page),n.isDone=t&&n.docs.length>=t||i.isDone;return}if(i.count){n.count+=i.count,n.isDone=t&&n.count>=t||i.isDone;return}n.isDone=i.isDone};do{const i=await e({paginationOpts:{numItems:Math.min(r??200,(t??200)-n.docs.length,200),cursor:n.cursor}});s(i)}while(!n.isDone);return n},ar=e=>e?.map(t=>t.value instanceof Date?{...t,value:t.value.getTime()}:t),hR=(e,t,r={})=>To({config:{adapterId:"convex",adapterName:"Convex Adapter",debugLogs:r.debugLogs||!1,disableIdGeneration:!0,transaction:!1,supportsNumericIds:!1,supportsJSON:!1,usePlural:!1,mapKeysTransformInput:{id:"_id"},mapKeysTransformOutput:{_id:"id"},supportsDates:!1,customTransformInput:({data:n,fieldAttributes:s})=>n&&s.type==="date"?new Date(n).getTime():n,customTransformOutput:({data:n,fieldAttributes:s})=>n&&s.type==="date"?new Date(n).getTime():n},adapter:({options:n})=>(n.telemetry={enabled:!1},{id:"convex",options:{isRunMutationCtx:lR(e)},createSchema:async({file:s,tables:i})=>{const{createSchema:o}=await Gc(async()=>{const{createSchema:a}=await import("./createSchema-C3JobZOR.js");return{createSchema:a}},[]);return o({file:s,tables:i})},create:async({model:s,data:i,select:o})=>{if(!("runMutation"in e))throw new Error("ctx is not a mutation ctx");const a=r.authFunctions?.onCreate&&r.triggers?.[s]?.onCreate?await Ls(r.authFunctions.onCreate):void 0;return e.runMutation(t.adapter.create,{input:{model:s,data:i},select:o,onCreateHandle:a})},findOne:async s=>{if(s.where?.every(i=>i.connector==="OR"))for(const i of s.where){const o=await e.runQuery(t.adapter.findOne,{...s,where:ar([i])});if(o)return o}return await e.runQuery(t.adapter.findOne,{...s,where:ar(s.where)})},findMany:async s=>{if(s.offset)throw new Error("offset not supported");if(s.where?.some(o=>o.connector==="OR")){const o=await Ih(s.where,async c=>Qn(async({paginationOpts:d})=>await e.runQuery(t.adapter.findMany,{...s,where:ar([c]),paginationOpts:d}),{limit:s.limit})),a=xh(o.flatMap(c=>c.docs));if(s.sortBy){const c=cR(a,[aR(s.sortBy.field),s.sortBy.direction]);return console.log(c),c}return a}return(await Qn(async({paginationOpts:o})=>await e.runQuery(t.adapter.findMany,{...s,where:ar(s.where),paginationOpts:o}),{limit:s.limit})).docs},count:async s=>{if(s.where?.some(o=>o.connector==="OR")){const o=await Ih(s.where,async c=>Qn(async({paginationOpts:d})=>await e.runQuery(t.adapter.findMany,{...s,where:ar([c]),paginationOpts:d})));return xh(o.flatMap(c=>c.docs)).length}return(await Qn(async({paginationOpts:o})=>await e.runQuery(t.adapter.findMany,{...s,where:ar(s.where),paginationOpts:o}))).docs.length},update:async s=>{if(!("runMutation"in e))throw new Error("ctx is not a mutation ctx");if(s.where?.length===1&&s.where[0].operator==="eq"){const i=r.authFunctions?.onUpdate&&r.triggers?.[s.model]?.onUpdate?await Ls(r.authFunctions.onUpdate):void 0;return e.runMutation(t.adapter.updateOne,{input:{model:s.model,where:ar(s.where),update:s.update},onUpdateHandle:i})}throw new Error("where clause not supported")},delete:async s=>{if(!("runMutation"in e))throw new Error("ctx is not a mutation ctx");const i=r.authFunctions?.onDelete&&r.triggers?.[s.model]?.onDelete?await Ls(r.authFunctions.onDelete):void 0;await e.runMutation(t.adapter.deleteOne,{input:{model:s.model,where:ar(s.where)},onDeleteHandle:i})},deleteMany:async s=>{if(!("runMutation"in e))throw new Error("ctx is not a mutation ctx");const i=r.authFunctions?.onDelete&&r.triggers?.[s.model]?.onDelete?await Ls(r.authFunctions.onDelete):void 0;return(await Qn(async({paginationOpts:a})=>await e.runMutation(t.adapter.deleteMany,{input:{...s,where:ar(s.where)},paginationOpts:a,onDeleteHandle:i}))).count},updateMany:async s=>{if(!("runMutation"in e))throw new Error("ctx is not a mutation ctx");const i=r.authFunctions?.onUpdate&&r.triggers?.[s.model]?.onUpdate?await Ls(r.authFunctions.onUpdate):void 0;return(await Qn(async({paginationOpts:a})=>await e.runMutation(t.adapter.updateMany,{input:{...s,where:ar(s.where)},paginationOpts:a,onUpdateHandle:i}))).count}})});N.string();N.float64();N.float64();N.boolean();N.int64();N.int64();N.any();N.null();N.bytes();N.optional(N.any());var fR=(function(){function e(t,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}})(),pR=mR(["",""],["",""]);function mR(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function wR(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Tt=(function(){function e(){for(var t=this,r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];return wR(this,e),this.tag=function(i){for(var o=arguments.length,a=Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return typeof i=="function"?t.interimTag.bind(t,i):typeof i=="string"?t.transformEndResult(i):(i=i.map(t.transformString.bind(t)),t.transformEndResult(i.reduce(t.processSubstitutions.bind(t,a))))},n.length>0&&Array.isArray(n[0])&&(n=n[0]),this.transformers=n.map(function(i){return typeof i=="function"?i():i}),this.tag}return fR(e,[{key:"interimTag",value:function(r,n){for(var s=arguments.length,i=Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];return this.tag(pR,r.apply(void 0,[n].concat(i)))}},{key:"processSubstitutions",value:function(r,n,s){var i=this.transformSubstitution(r.shift(),n);return"".concat(n,i,s)}},{key:"transformString",value:function(r){var n=function(i,o){return o.onString?o.onString(i):i};return this.transformers.reduce(n,r)}},{key:"transformSubstitution",value:function(r,n){var s=function(o,a){return a.onSubstitution?a.onSubstitution(o,n):o};return this.transformers.reduce(s,r)}},{key:"transformEndResult",value:function(r){var n=function(i,o){return o.onEndResult?o.onEndResult(i):i};return this.transformers.reduce(n,r)}}]),e})(),St=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return{onEndResult:function(n){if(t==="")return n.trim();if(t=t.toLowerCase(),t==="start"||t==="left")return n.replace(/^\s*/,"");if(t==="end"||t==="right")return n.replace(/\s*$/,"");throw new Error("Side not supported: "+t)}}};function yR(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}var cn=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"initial";return{onEndResult:function(n){if(t==="initial"){var s=n.match(/^[^\S\n]*(?=\S)/gm),i=s&&Math.min.apply(Math,yR(s.map(function(a){return a.length})));if(i){var o=new RegExp("^.{"+i+"}","gm");return n.replace(o,"")}return n}if(t==="all")return n.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+t)}}},Os=function(t,r){return{onEndResult:function(s){if(t==null||r==null)throw new Error("replaceResultTransformer requires at least 2 arguments.");return s.replace(t,r)}}},Yn=function(t,r){return{onSubstitution:function(s,i){if(t==null||r==null)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return s==null?s:s.toString().replace(t,r)}}},gR={separator:"",conjunction:"",serial:!1},wr=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:gR;return{onSubstitution:function(n,s){if(Array.isArray(n)){var i=n.length,o=t.separator,a=t.conjunction,c=t.serial,d=s.match(/(\n?[^\S\n]+)$/);if(d?n=n.join(o+d[1]):n=n.join(o+" "),a&&i>1){var u=n.lastIndexOf(o);n=n.slice(0,u)+(c?o:"")+" "+a+n.slice(u+1)}}return n}}},_w=function(t){return{onSubstitution:function(n,s){return typeof n=="string"&&n.includes(t)&&(n=n.split(t)),n}}},Uh=function(t){return t!=null&&!Number.isNaN(t)&&typeof t!="boolean"},bR=function(){return{onSubstitution:function(r){return Array.isArray(r)?r.filter(Uh):Uh(r)?r:""}}};new Tt(wr({separator:","}),cn,St);new Tt(wr({separator:",",conjunction:"and"}),cn,St);new Tt(wr({separator:",",conjunction:"or"}),cn,St);new Tt(_w(`
`),bR,wr,cn,St);new Tt(_w(`
`),wr,cn,St,Yn(/&/g,"&amp;"),Yn(/</g,"&lt;"),Yn(/>/g,"&gt;"),Yn(/"/g,"&quot;"),Yn(/'/g,"&#x27;"),Yn(/`/g,"&#x60;"));new Tt(Os(/(?:\n(?:\s*))+/g," "),St);new Tt(Os(/(?:\n\s*)/g,""),St);new Tt(wr({separator:","}),Os(/(?:\s+)/g," "),St);new Tt(wr({separator:",",conjunction:"or"}),Os(/(?:\s+)/g," "),St);new Tt(wr({separator:",",conjunction:"and"}),Os(/(?:\s+)/g," "),St);new Tt(wr,cn,St);new Tt(wr,Os(/(?:\s+)/g," "),St);new Tt(cn,St);new Tt(cn("all"),St);const vR=N.object({field:N.string(),operator:N.optional(N.union(N.literal("lt"),N.literal("lte"),N.literal("gt"),N.literal("gte"),N.literal("eq"),N.literal("in"),N.literal("not_in"),N.literal("ne"),N.literal("contains"),N.literal("starts_with"),N.literal("ends_with"))),value:N.union(N.string(),N.number(),N.boolean(),N.array(N.string()),N.array(N.number()),N.null()),connector:N.optional(N.union(N.literal("AND"),N.literal("OR")))});N.object({model:N.string(),where:N.optional(N.array(vR)),sortBy:N.optional(N.object({field:N.string(),direction:N.union(N.literal("asc"),N.literal("desc"))})),select:N.optional(N.array(N.string())),limit:N.optional(N.number()),offset:N.optional(N.number())});const ER=["Content-Range","Accept-Ranges"],_R=(e,t)=>{const r=new Map,n=new Map;return{http:e,route:s=>{const i=Fb();i.exactRoutes=e.exactRoutes,i.prefixRoutes=e.prefixRoutes;const o={...t,...s},a=Aw({originalHandler:s.handler,allowedMethods:[s.method],...o});if("path"in s){let c=r.get(s.path);c||(c=new Set,r.set(s.path,c)),c.add(s.method),i.route({path:s.path,method:s.method,handler:a}),NR(i,s,o,Array.from(c))}else{let c=n.get(s.pathPrefix);c||(c=new Set,n.set(s.pathPrefix,c)),c.add(s.method),i.route({pathPrefix:s.pathPrefix,method:s.method,handler:a}),AR(i,s,o,Array.from(c))}e.exactRoutes=new Map(i.exactRoutes),e.prefixRoutes=new Map(i.prefixRoutes)}}};function NR(e,t,r,n){const s=e.exactRoutes.get(t.path),i=Nw(n,r);s?.set("OPTIONS",i),e.exactRoutes.set(t.path,new Map(s))}function AR(e,t,r,n){const s=Nw(n,r),i=e.prefixRoutes.get("OPTIONS")||new Map;i.set(t.pathPrefix,s),e.prefixRoutes.set("OPTIONS",i)}function Nw(e,t){return Aw({...t,allowedMethods:e})}const kR=3600*24,Aw=({originalHandler:e,allowedMethods:t=["OPTIONS"],allowedOrigins:r=["*"],allowedHeaders:n=["Content-Type"],exposedHeaders:s=ER,allowCredentials:i=!1,browserCacheMaxAge:o=kR,enforceAllowOrigins:a=!1,debug:c=!1})=>{const u=Array.from(new Set(t.map(w=>w.toUpperCase()))).filter(w=>Fp.includes(w));if(u.length===0)throw new Error("No valid HTTP methods provided");const l=u.includes("OPTIONS")?u.join(", "):[...u].join(", "),h={Vary:"Origin"};i&&(h["Access-Control-Allow-Credentials"]="true"),s.length>0&&(h["Access-Control-Expose-Headers"]=s.join(", "));async function m(w){return Array.isArray(r)?r:await r(w)}async function p(w){const g=w.headers.get("origin");return g?(await m(w)).some(b=>{if(b==="*"||b===g)return!0;if(b.startsWith("*.")){const v=b.slice(1),y=b.slice(2);try{const E=new URL(g);return E.protocol==="https:"&&(E.hostname.endsWith(v)||E.hostname===y)}catch{return!1}}return!1}):!1}return Kc(async(w,g)=>{c&&console.log("CORS request",{path:g.url,origin:g.headers.get("origin"),headers:g.headers,method:g.method,body:g.body});const b=g.headers.get("origin"),v=await m(g);c&&console.log("allowed origins",v);let y=null;if((v.includes("*")&&b&&!i||b&&await p(g))&&(y=b),a&&!y)return console.error(`Request from origin ${b} blocked, missing from allowed origins: ${v.join()}`),new Response(null,{status:403});if(g.method==="OPTIONS"){const R=new Headers({...h,...y?{"Access-Control-Allow-Origin":y}:{},"Access-Control-Allow-Methods":l,"Access-Control-Allow-Headers":n.join(", "),"Access-Control-Max-Age":o.toString()});return c&&console.log("CORS OPTIONS response headers",R),new Response(null,{status:204,headers:R})}if(!e)throw new Error("No PublicHttpAction provider to CORS handler");const k=await("_handler"in e?e._handler:e)(w,g),A=new Headers(k.headers);return y&&A.set("Access-Control-Allow-Origin",y),Object.entries(h).forEach(([R,T])=>{A.set(R,T)}),c&&console.log("CORS response headers",A),new Response(k.body,{status:k.status,statusText:k.statusText,headers:A})})};var Wi={exports:{}},Da,Ph;function ca(){if(Ph)return Da;Ph=1;const e="2.0.0",t=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,s=t-6;return Da={MAX_LENGTH:t,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Da}var La,Dh;function ua(){if(Dh)return La;Dh=1;var e={};return La=typeof process=="object"&&e&&e.NODE_DEBUG&&/\bsemver\b/i.test(e.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{},La}var Lh;function Ai(){return Lh||(Lh=1,(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=ca(),i=ua();t=e.exports={};const o=t.re=[],a=t.safeRe=[],c=t.src=[],d=t.safeSrc=[],u=t.t={};let l=0;const h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[h,n]],p=g=>{for(const[b,v]of m)g=g.split(`${b}*`).join(`${b}{0,${v}}`).split(`${b}+`).join(`${b}{1,${v}}`);return g},w=(g,b,v)=>{const y=p(b),E=l++;i(g,E,b),u[g]=E,c[E]=b,d[E]=y,o[E]=new RegExp(b,v?"g":void 0),a[E]=new RegExp(y,v?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),w("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),w("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASEIDENTIFIER",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIER]})`),w("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NONNUMERICIDENTIFIER]}|${c[u.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),w("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),w("BUILDIDENTIFIER",`${h}+`),w("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),w("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),w("FULL",`^${c[u.FULLPLAIN]}$`),w("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),w("LOOSE",`^${c[u.LOOSEPLAIN]}$`),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),w("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),w("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),w("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),w("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),w("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),w("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),w("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),w("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?(?:${c[u.BUILD]})?(?:$|[^\\d])`),w("COERCERTL",c[u.COERCE],!0),w("COERCERTLFULL",c[u.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",w("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),w("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),w("LONECARET","(?:\\^)"),w("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",w("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),w("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),w("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),w("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),w("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),w("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Wi,Wi.exports)),Wi.exports}var za,zh;function dd(){if(zh)return za;zh=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return za=n=>n?typeof n!="object"?e:n:t,za}var qa,qh;function kw(){if(qh)return qa;qh=1;const e=/^[0-9]+$/,t=(n,s)=>{if(typeof n=="number"&&typeof s=="number")return n===s?0:n<s?-1:1;const i=e.test(n),o=e.test(s);return i&&o&&(n=+n,s=+s),n===s?0:i&&!o?-1:o&&!i?1:n<s?-1:1};return qa={compareIdentifiers:t,rcompareIdentifiers:(n,s)=>t(s,n)},qa}var ja,jh;function ft(){if(jh)return ja;jh=1;const e=ua(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:r}=ca(),{safeRe:n,t:s}=Ai(),i=dd(),{compareIdentifiers:o}=kw();class a{constructor(d,u){if(u=i(u),d instanceof a){if(d.loose===!!u.loose&&d.includePrerelease===!!u.includePrerelease)return d;d=d.version}else if(typeof d!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof d}".`);if(d.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",d,u),this.options=u,this.loose=!!u.loose,this.includePrerelease=!!u.includePrerelease;const l=d.trim().match(u.loose?n[s.LOOSE]:n[s.FULL]);if(!l)throw new TypeError(`Invalid Version: ${d}`);if(this.raw=d,this.major=+l[1],this.minor=+l[2],this.patch=+l[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");l[4]?this.prerelease=l[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const m=+h;if(m>=0&&m<r)return m}return h}):this.prerelease=[],this.build=l[5]?l[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(d){if(e("SemVer.compare",this.version,this.options,d),!(d instanceof a)){if(typeof d=="string"&&d===this.version)return 0;d=new a(d,this.options)}return d.version===this.version?0:this.compareMain(d)||this.comparePre(d)}compareMain(d){return d instanceof a||(d=new a(d,this.options)),this.major<d.major?-1:this.major>d.major?1:this.minor<d.minor?-1:this.minor>d.minor?1:this.patch<d.patch?-1:this.patch>d.patch?1:0}comparePre(d){if(d instanceof a||(d=new a(d,this.options)),this.prerelease.length&&!d.prerelease.length)return-1;if(!this.prerelease.length&&d.prerelease.length)return 1;if(!this.prerelease.length&&!d.prerelease.length)return 0;let u=0;do{const l=this.prerelease[u],h=d.prerelease[u];if(e("prerelease compare",u,l,h),l===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(l===void 0)return-1;if(l===h)continue;return o(l,h)}while(++u)}compareBuild(d){d instanceof a||(d=new a(d,this.options));let u=0;do{const l=this.build[u],h=d.build[u];if(e("build compare",u,l,h),l===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(l===void 0)return-1;if(l===h)continue;return o(l,h)}while(++u)}inc(d,u,l){if(d.startsWith("pre")){if(!u&&l===!1)throw new Error("invalid increment argument: identifier is empty");if(u){const h=`-${u}`.match(this.options.loose?n[s.PRERELEASELOOSE]:n[s.PRERELEASE]);if(!h||h[1]!==u)throw new Error(`invalid identifier: ${u}`)}}switch(d){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",u,l);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",u,l);break;case"prepatch":this.prerelease.length=0,this.inc("patch",u,l),this.inc("pre",u,l);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",u,l),this.inc("pre",u,l);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(l)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let m=this.prerelease.length;for(;--m>=0;)typeof this.prerelease[m]=="number"&&(this.prerelease[m]++,m=-2);if(m===-1){if(u===this.prerelease.join(".")&&l===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(u){let m=[u,h];l===!1&&(m=[u]),o(this.prerelease[0],u)===0?isNaN(this.prerelease[1])&&(this.prerelease=m):this.prerelease=m}break}default:throw new Error(`invalid increment argument: ${d}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return ja=a,ja}var Wa,Wh;function $s(){if(Wh)return Wa;Wh=1;const e=ft();return Wa=(r,n,s=!1)=>{if(r instanceof e)return r;try{return new e(r,n)}catch(i){if(!s)return null;throw i}},Wa}var Ma,Mh;function TR(){if(Mh)return Ma;Mh=1;const e=$s();return Ma=(r,n)=>{const s=e(r,n);return s?s.version:null},Ma}var Va,Vh;function SR(){if(Vh)return Va;Vh=1;const e=$s();return Va=(r,n)=>{const s=e(r.trim().replace(/^[=v]+/,""),n);return s?s.version:null},Va}var Fa,Fh;function RR(){if(Fh)return Fa;Fh=1;const e=ft();return Fa=(r,n,s,i,o)=>{typeof s=="string"&&(o=i,i=s,s=void 0);try{return new e(r instanceof e?r.version:r,s).inc(n,i,o).version}catch{return null}},Fa}var Za,Zh;function IR(){if(Zh)return Za;Zh=1;const e=$s();return Za=(r,n)=>{const s=e(r,null,!0),i=e(n,null,!0),o=s.compare(i);if(o===0)return null;const a=o>0,c=a?s:i,d=a?i:s,u=!!c.prerelease.length;if(!!d.prerelease.length&&!u){if(!d.patch&&!d.minor)return"major";if(d.compareMain(c)===0)return d.minor&&!d.patch?"minor":"patch"}const h=u?"pre":"";return s.major!==i.major?h+"major":s.minor!==i.minor?h+"minor":s.patch!==i.patch?h+"patch":"prerelease"},Za}var Ba,Bh;function OR(){if(Bh)return Ba;Bh=1;const e=ft();return Ba=(r,n)=>new e(r,n).major,Ba}var Ha,Hh;function $R(){if(Hh)return Ha;Hh=1;const e=ft();return Ha=(r,n)=>new e(r,n).minor,Ha}var Ka,Kh;function CR(){if(Kh)return Ka;Kh=1;const e=ft();return Ka=(r,n)=>new e(r,n).patch,Ka}var Ja,Jh;function xR(){if(Jh)return Ja;Jh=1;const e=$s();return Ja=(r,n)=>{const s=e(r,n);return s&&s.prerelease.length?s.prerelease:null},Ja}var Ga,Gh;function nr(){if(Gh)return Ga;Gh=1;const e=ft();return Ga=(r,n,s)=>new e(r,s).compare(new e(n,s)),Ga}var Qa,Qh;function UR(){if(Qh)return Qa;Qh=1;const e=nr();return Qa=(r,n,s)=>e(n,r,s),Qa}var Ya,Yh;function PR(){if(Yh)return Ya;Yh=1;const e=nr();return Ya=(r,n)=>e(r,n,!0),Ya}var Xa,Xh;function ld(){if(Xh)return Xa;Xh=1;const e=ft();return Xa=(r,n,s)=>{const i=new e(r,s),o=new e(n,s);return i.compare(o)||i.compareBuild(o)},Xa}var ec,ef;function DR(){if(ef)return ec;ef=1;const e=ld();return ec=(r,n)=>r.sort((s,i)=>e(s,i,n)),ec}var tc,tf;function LR(){if(tf)return tc;tf=1;const e=ld();return tc=(r,n)=>r.sort((s,i)=>e(i,s,n)),tc}var rc,rf;function da(){if(rf)return rc;rf=1;const e=nr();return rc=(r,n,s)=>e(r,n,s)>0,rc}var nc,nf;function hd(){if(nf)return nc;nf=1;const e=nr();return nc=(r,n,s)=>e(r,n,s)<0,nc}var sc,sf;function Tw(){if(sf)return sc;sf=1;const e=nr();return sc=(r,n,s)=>e(r,n,s)===0,sc}var ic,of;function Sw(){if(of)return ic;of=1;const e=nr();return ic=(r,n,s)=>e(r,n,s)!==0,ic}var oc,af;function fd(){if(af)return oc;af=1;const e=nr();return oc=(r,n,s)=>e(r,n,s)>=0,oc}var ac,cf;function pd(){if(cf)return ac;cf=1;const e=nr();return ac=(r,n,s)=>e(r,n,s)<=0,ac}var cc,uf;function Rw(){if(uf)return cc;uf=1;const e=Tw(),t=Sw(),r=da(),n=fd(),s=hd(),i=pd();return cc=(a,c,d,u)=>{switch(c){case"===":return typeof a=="object"&&(a=a.version),typeof d=="object"&&(d=d.version),a===d;case"!==":return typeof a=="object"&&(a=a.version),typeof d=="object"&&(d=d.version),a!==d;case"":case"=":case"==":return e(a,d,u);case"!=":return t(a,d,u);case">":return r(a,d,u);case">=":return n(a,d,u);case"<":return s(a,d,u);case"<=":return i(a,d,u);default:throw new TypeError(`Invalid operator: ${c}`)}},cc}var uc,df;function zR(){if(df)return uc;df=1;const e=ft(),t=$s(),{safeRe:r,t:n}=Ai();return uc=(i,o)=>{if(i instanceof e)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;o=o||{};let a=null;if(!o.rtl)a=i.match(o.includePrerelease?r[n.COERCEFULL]:r[n.COERCE]);else{const m=o.includePrerelease?r[n.COERCERTLFULL]:r[n.COERCERTL];let p;for(;(p=m.exec(i))&&(!a||a.index+a[0].length!==i.length);)(!a||p.index+p[0].length!==a.index+a[0].length)&&(a=p),m.lastIndex=p.index+p[1].length+p[2].length;m.lastIndex=-1}if(a===null)return null;const c=a[2],d=a[3]||"0",u=a[4]||"0",l=o.includePrerelease&&a[5]?`-${a[5]}`:"",h=o.includePrerelease&&a[6]?`+${a[6]}`:"";return t(`${c}.${d}.${u}${l}${h}`,o)},uc}var dc,lf;function qR(){if(lf)return dc;lf=1;class e{constructor(){this.max=1e3,this.map=new Map}get(r){const n=this.map.get(r);if(n!==void 0)return this.map.delete(r),this.map.set(r,n),n}delete(r){return this.map.delete(r)}set(r,n){if(!this.delete(r)&&n!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(r,n)}return this}}return dc=e,dc}var lc,hf;function sr(){if(hf)return lc;hf=1;const e=/\s+/g;class t{constructor(C,z){if(z=s(z),C instanceof t)return C.loose===!!z.loose&&C.includePrerelease===!!z.includePrerelease?C:new t(C.raw,z);if(C instanceof i)return this.raw=C.value,this.set=[[C]],this.formatted=void 0,this;if(this.options=z,this.loose=!!z.loose,this.includePrerelease=!!z.includePrerelease,this.raw=C.trim().replace(e," "),this.set=this.raw.split("||").map(U=>this.parseRange(U.trim())).filter(U=>U.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const U=this.set[0];if(this.set=this.set.filter(q=>!w(q[0])),this.set.length===0)this.set=[U];else if(this.set.length>1){for(const q of this.set)if(q.length===1&&g(q[0])){this.set=[q];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let C=0;C<this.set.length;C++){C>0&&(this.formatted+="||");const z=this.set[C];for(let U=0;U<z.length;U++)U>0&&(this.formatted+=" "),this.formatted+=z[U].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(C){const U=((this.options.includePrerelease&&m)|(this.options.loose&&p))+":"+C,q=n.get(U);if(q)return q;const O=this.options.loose,D=O?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];C=C.replace(D,j(this.options.includePrerelease)),o("hyphen replace",C),C=C.replace(c[d.COMPARATORTRIM],u),o("comparator trim",C),C=C.replace(c[d.TILDETRIM],l),o("tilde trim",C),C=C.replace(c[d.CARETTRIM],h),o("caret trim",C);let B=C.split(" ").map(he=>v(he,this.options)).join(" ").split(/\s+/).map(he=>W(he,this.options));O&&(B=B.filter(he=>(o("loose invalid filter",he,this.options),!!he.match(c[d.COMPARATORLOOSE])))),o("range list",B);const F=new Map,se=B.map(he=>new i(he,this.options));for(const he of se){if(w(he))return[he];F.set(he.value,he)}F.size>1&&F.has("")&&F.delete("");const Le=[...F.values()];return n.set(U,Le),Le}intersects(C,z){if(!(C instanceof t))throw new TypeError("a Range is required");return this.set.some(U=>b(U,z)&&C.set.some(q=>b(q,z)&&U.every(O=>q.every(D=>O.intersects(D,z)))))}test(C){if(!C)return!1;if(typeof C=="string")try{C=new a(C,this.options)}catch{return!1}for(let z=0;z<this.set.length;z++)if(V(this.set[z],C,this.options))return!0;return!1}}lc=t;const r=qR(),n=new r,s=dd(),i=la(),o=ua(),a=ft(),{safeRe:c,t:d,comparatorTrimReplace:u,tildeTrimReplace:l,caretTrimReplace:h}=Ai(),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:p}=ca(),w=I=>I.value==="<0.0.0-0",g=I=>I.value==="",b=(I,C)=>{let z=!0;const U=I.slice();let q=U.pop();for(;z&&U.length;)z=U.every(O=>q.intersects(O,C)),q=U.pop();return z},v=(I,C)=>(I=I.replace(c[d.BUILD],""),o("comp",I,C),I=A(I,C),o("caret",I),I=E(I,C),o("tildes",I),I=T(I,C),o("xrange",I),I=P(I,C),o("stars",I),I),y=I=>!I||I.toLowerCase()==="x"||I==="*",E=(I,C)=>I.trim().split(/\s+/).map(z=>k(z,C)).join(" "),k=(I,C)=>{const z=C.loose?c[d.TILDELOOSE]:c[d.TILDE];return I.replace(z,(U,q,O,D,B)=>{o("tilde",I,U,q,O,D,B);let F;return y(q)?F="":y(O)?F=`>=${q}.0.0 <${+q+1}.0.0-0`:y(D)?F=`>=${q}.${O}.0 <${q}.${+O+1}.0-0`:B?(o("replaceTilde pr",B),F=`>=${q}.${O}.${D}-${B} <${q}.${+O+1}.0-0`):F=`>=${q}.${O}.${D} <${q}.${+O+1}.0-0`,o("tilde return",F),F})},A=(I,C)=>I.trim().split(/\s+/).map(z=>R(z,C)).join(" "),R=(I,C)=>{o("caret",I,C);const z=C.loose?c[d.CARETLOOSE]:c[d.CARET],U=C.includePrerelease?"-0":"";return I.replace(z,(q,O,D,B,F)=>{o("caret",I,q,O,D,B,F);let se;return y(O)?se="":y(D)?se=`>=${O}.0.0${U} <${+O+1}.0.0-0`:y(B)?O==="0"?se=`>=${O}.${D}.0${U} <${O}.${+D+1}.0-0`:se=`>=${O}.${D}.0${U} <${+O+1}.0.0-0`:F?(o("replaceCaret pr",F),O==="0"?D==="0"?se=`>=${O}.${D}.${B}-${F} <${O}.${D}.${+B+1}-0`:se=`>=${O}.${D}.${B}-${F} <${O}.${+D+1}.0-0`:se=`>=${O}.${D}.${B}-${F} <${+O+1}.0.0-0`):(o("no pr"),O==="0"?D==="0"?se=`>=${O}.${D}.${B}${U} <${O}.${D}.${+B+1}-0`:se=`>=${O}.${D}.${B}${U} <${O}.${+D+1}.0-0`:se=`>=${O}.${D}.${B} <${+O+1}.0.0-0`),o("caret return",se),se})},T=(I,C)=>(o("replaceXRanges",I,C),I.split(/\s+/).map(z=>L(z,C)).join(" ")),L=(I,C)=>{I=I.trim();const z=C.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return I.replace(z,(U,q,O,D,B,F)=>{o("xRange",I,U,q,O,D,B,F);const se=y(O),Le=se||y(D),he=Le||y(B),jt=he;return q==="="&&jt&&(q=""),F=C.includePrerelease?"-0":"",se?q===">"||q==="<"?U="<0.0.0-0":U="*":q&&jt?(Le&&(D=0),B=0,q===">"?(q=">=",Le?(O=+O+1,D=0,B=0):(D=+D+1,B=0)):q==="<="&&(q="<",Le?O=+O+1:D=+D+1),q==="<"&&(F="-0"),U=`${q+O}.${D}.${B}${F}`):Le?U=`>=${O}.0.0${F} <${+O+1}.0.0-0`:he&&(U=`>=${O}.${D}.0${F} <${O}.${+D+1}.0-0`),o("xRange return",U),U})},P=(I,C)=>(o("replaceStars",I,C),I.trim().replace(c[d.STAR],"")),W=(I,C)=>(o("replaceGTE0",I,C),I.trim().replace(c[C.includePrerelease?d.GTE0PRE:d.GTE0],"")),j=I=>(C,z,U,q,O,D,B,F,se,Le,he,jt)=>(y(U)?z="":y(q)?z=`>=${U}.0.0${I?"-0":""}`:y(O)?z=`>=${U}.${q}.0${I?"-0":""}`:D?z=`>=${z}`:z=`>=${z}${I?"-0":""}`,y(se)?F="":y(Le)?F=`<${+se+1}.0.0-0`:y(he)?F=`<${se}.${+Le+1}.0-0`:jt?F=`<=${se}.${Le}.${he}-${jt}`:I?F=`<${se}.${Le}.${+he+1}-0`:F=`<=${F}`,`${z} ${F}`.trim()),V=(I,C,z)=>{for(let U=0;U<I.length;U++)if(!I[U].test(C))return!1;if(C.prerelease.length&&!z.includePrerelease){for(let U=0;U<I.length;U++)if(o(I[U].semver),I[U].semver!==i.ANY&&I[U].semver.prerelease.length>0){const q=I[U].semver;if(q.major===C.major&&q.minor===C.minor&&q.patch===C.patch)return!0}return!1}return!0};return lc}var hc,ff;function la(){if(ff)return hc;ff=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(u,l){if(l=r(l),u instanceof t){if(u.loose===!!l.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),o("comparator",u,l),this.options=l,this.loose=!!l.loose,this.parse(u),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(u){const l=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],h=u.match(l);if(!h)throw new TypeError(`Invalid comparator: ${u}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new a(h[2],this.options.loose):this.semver=e}toString(){return this.value}test(u){if(o("Comparator.test",u,this.options.loose),this.semver===e||u===e)return!0;if(typeof u=="string")try{u=new a(u,this.options)}catch{return!1}return i(u,this.operator,this.semver,this.options)}intersects(u,l){if(!(u instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(u.value,l).test(this.value):u.operator===""?u.value===""?!0:new c(this.value,l).test(u.semver):(l=r(l),l.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!l.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||i(this.semver,"<",u.semver,l)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||i(this.semver,">",u.semver,l)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}hc=t;const r=dd(),{safeRe:n,t:s}=Ai(),i=Rw(),o=ua(),a=ft(),c=sr();return hc}var fc,pf;function ha(){if(pf)return fc;pf=1;const e=sr();return fc=(r,n,s)=>{try{n=new e(n,s)}catch{return!1}return n.test(r)},fc}var pc,mf;function jR(){if(mf)return pc;mf=1;const e=sr();return pc=(r,n)=>new e(r,n).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),pc}var mc,wf;function WR(){if(wf)return mc;wf=1;const e=ft(),t=sr();return mc=(n,s,i)=>{let o=null,a=null,c=null;try{c=new t(s,i)}catch{return null}return n.forEach(d=>{c.test(d)&&(!o||a.compare(d)===-1)&&(o=d,a=new e(o,i))}),o},mc}var wc,yf;function MR(){if(yf)return wc;yf=1;const e=ft(),t=sr();return wc=(n,s,i)=>{let o=null,a=null,c=null;try{c=new t(s,i)}catch{return null}return n.forEach(d=>{c.test(d)&&(!o||a.compare(d)===1)&&(o=d,a=new e(o,i))}),o},wc}var yc,gf;function VR(){if(gf)return yc;gf=1;const e=ft(),t=sr(),r=da();return yc=(s,i)=>{s=new t(s,i);let o=new e("0.0.0");if(s.test(o)||(o=new e("0.0.0-0"),s.test(o)))return o;o=null;for(let a=0;a<s.set.length;++a){const c=s.set[a];let d=null;c.forEach(u=>{const l=new e(u.semver.version);switch(u.operator){case">":l.prerelease.length===0?l.patch++:l.prerelease.push(0),l.raw=l.format();case"":case">=":(!d||r(l,d))&&(d=l);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),d&&(!o||r(o,d))&&(o=d)}return o&&s.test(o)?o:null},yc}var gc,bf;function FR(){if(bf)return gc;bf=1;const e=sr();return gc=(r,n)=>{try{return new e(r,n).range||"*"}catch{return null}},gc}var bc,vf;function md(){if(vf)return bc;vf=1;const e=ft(),t=la(),{ANY:r}=t,n=sr(),s=ha(),i=da(),o=hd(),a=pd(),c=fd();return bc=(u,l,h,m)=>{u=new e(u,m),l=new n(l,m);let p,w,g,b,v;switch(h){case">":p=i,w=a,g=o,b=">",v=">=";break;case"<":p=o,w=c,g=i,b="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(u,l,m))return!1;for(let y=0;y<l.set.length;++y){const E=l.set[y];let k=null,A=null;if(E.forEach(R=>{R.semver===r&&(R=new t(">=0.0.0")),k=k||R,A=A||R,p(R.semver,k.semver,m)?k=R:g(R.semver,A.semver,m)&&(A=R)}),k.operator===b||k.operator===v||(!A.operator||A.operator===b)&&w(u,A.semver))return!1;if(A.operator===v&&g(u,A.semver))return!1}return!0},bc}var vc,Ef;function ZR(){if(Ef)return vc;Ef=1;const e=md();return vc=(r,n,s)=>e(r,n,">",s),vc}var Ec,_f;function BR(){if(_f)return Ec;_f=1;const e=md();return Ec=(r,n,s)=>e(r,n,"<",s),Ec}var _c,Nf;function HR(){if(Nf)return _c;Nf=1;const e=sr();return _c=(r,n,s)=>(r=new e(r,s),n=new e(n,s),r.intersects(n,s)),_c}var Nc,Af;function KR(){if(Af)return Nc;Af=1;const e=ha(),t=nr();return Nc=(r,n,s)=>{const i=[];let o=null,a=null;const c=r.sort((h,m)=>t(h,m,s));for(const h of c)e(h,n,s)?(a=h,o||(o=h)):(a&&i.push([o,a]),a=null,o=null);o&&i.push([o,null]);const d=[];for(const[h,m]of i)h===m?d.push(h):!m&&h===c[0]?d.push("*"):m?h===c[0]?d.push(`<=${m}`):d.push(`${h} - ${m}`):d.push(`>=${h}`);const u=d.join(" || "),l=typeof n.raw=="string"?n.raw:String(n);return u.length<l.length?u:n},Nc}var Ac,kf;function JR(){if(kf)return Ac;kf=1;const e=sr(),t=la(),{ANY:r}=t,n=ha(),s=nr(),i=(l,h,m={})=>{if(l===h)return!0;l=new e(l,m),h=new e(h,m);let p=!1;e:for(const w of l.set){for(const g of h.set){const b=c(w,g,m);if(p=p||b!==null,b)continue e}if(p)return!1}return!0},o=[new t(">=0.0.0-0")],a=[new t(">=0.0.0")],c=(l,h,m)=>{if(l===h)return!0;if(l.length===1&&l[0].semver===r){if(h.length===1&&h[0].semver===r)return!0;m.includePrerelease?l=o:l=a}if(h.length===1&&h[0].semver===r){if(m.includePrerelease)return!0;h=a}const p=new Set;let w,g;for(const T of l)T.operator===">"||T.operator===">="?w=d(w,T,m):T.operator==="<"||T.operator==="<="?g=u(g,T,m):p.add(T.semver);if(p.size>1)return null;let b;if(w&&g){if(b=s(w.semver,g.semver,m),b>0)return null;if(b===0&&(w.operator!==">="||g.operator!=="<="))return null}for(const T of p){if(w&&!n(T,String(w),m)||g&&!n(T,String(g),m))return null;for(const L of h)if(!n(T,String(L),m))return!1;return!0}let v,y,E,k,A=g&&!m.includePrerelease&&g.semver.prerelease.length?g.semver:!1,R=w&&!m.includePrerelease&&w.semver.prerelease.length?w.semver:!1;A&&A.prerelease.length===1&&g.operator==="<"&&A.prerelease[0]===0&&(A=!1);for(const T of h){if(k=k||T.operator===">"||T.operator===">=",E=E||T.operator==="<"||T.operator==="<=",w){if(R&&T.semver.prerelease&&T.semver.prerelease.length&&T.semver.major===R.major&&T.semver.minor===R.minor&&T.semver.patch===R.patch&&(R=!1),T.operator===">"||T.operator===">="){if(v=d(w,T,m),v===T&&v!==w)return!1}else if(w.operator===">="&&!n(w.semver,String(T),m))return!1}if(g){if(A&&T.semver.prerelease&&T.semver.prerelease.length&&T.semver.major===A.major&&T.semver.minor===A.minor&&T.semver.patch===A.patch&&(A=!1),T.operator==="<"||T.operator==="<="){if(y=u(g,T,m),y===T&&y!==g)return!1}else if(g.operator==="<="&&!n(g.semver,String(T),m))return!1}if(!T.operator&&(g||w)&&b!==0)return!1}return!(w&&E&&!g&&b!==0||g&&k&&!w&&b!==0||R||A)},d=(l,h,m)=>{if(!l)return h;const p=s(l.semver,h.semver,m);return p>0?l:p<0||h.operator===">"&&l.operator===">="?h:l},u=(l,h,m)=>{if(!l)return h;const p=s(l.semver,h.semver,m);return p<0?l:p>0||h.operator==="<"&&l.operator==="<="?h:l};return Ac=i,Ac}var kc,Tf;function GR(){if(Tf)return kc;Tf=1;const e=Ai(),t=ca(),r=ft(),n=kw(),s=$s(),i=TR(),o=SR(),a=RR(),c=IR(),d=OR(),u=$R(),l=CR(),h=xR(),m=nr(),p=UR(),w=PR(),g=ld(),b=DR(),v=LR(),y=da(),E=hd(),k=Tw(),A=Sw(),R=fd(),T=pd(),L=Rw(),P=zR(),W=la(),j=sr(),V=ha(),I=jR(),C=WR(),z=MR(),U=VR(),q=FR(),O=md(),D=ZR(),B=BR(),F=HR(),se=KR(),Le=JR();return kc={parse:s,valid:i,clean:o,inc:a,diff:c,major:d,minor:u,patch:l,prerelease:h,compare:m,rcompare:p,compareLoose:w,compareBuild:g,sort:b,rsort:v,gt:y,lt:E,eq:k,neq:A,gte:R,lte:T,cmp:L,coerce:P,Comparator:W,Range:j,satisfies:V,toComparators:I,maxSatisfying:C,minSatisfying:z,minVersion:U,validRange:q,outside:O,gtr:D,ltr:B,intersects:F,simplifyRange:se,subset:Le,SemVer:r,re:e.re,src:e.src,tokens:e.t,SEMVER_SPEC_VERSION:t.SEMVER_SPEC_VERSION,RELEASE_TYPES:t.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers},kc}var QR=GR();const YR=Ag(QR);function x(e,t,r){function n(a,c){var d;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(d=a._zod).traits??(d.traits=new Set),a._zod.traits.add(e),t(a,c);for(const u in o.prototype)u in a||Object.defineProperty(a,u,{value:o.prototype[u].bind(a)});a._zod.constr=o,a._zod.def=c}const s=r?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:e});function o(a){var c;const d=r?.Parent?new i:this;n(d,a),(c=d._zod).deferred??(c.deferred=[]);for(const u of d._zod.deferred)u();return d}return Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}class gs extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Iw extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Ow={};function In(e){return Ow}function XR(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function hu(e,t){return typeof t=="bigint"?t.toString():t}function wd(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function yd(e){return e==null}function gd(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}const Sf=Symbol("evaluating");function ye(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==Sf)return n===void 0&&(n=Sf,n=r()),n},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function Mn(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Vn(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function Rf(e){return JSON.stringify(e)}const $w="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function So(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const eI=wd(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function mi(e){if(So(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(So(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function Cw(e){return mi(e)?{...e}:Array.isArray(e)?[...e]:e}const tI=new Set(["string","number","symbol"]);function fa(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function un(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function Y(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function rI(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}function nI(e,t){const r=e._zod.def,n=Vn(e._zod.def,{get shape(){const s={};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(s[i]=r.shape[i])}return Mn(this,"shape",s),s},checks:[]});return un(e,n)}function sI(e,t){const r=e._zod.def,n=Vn(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete s[i]}return Mn(this,"shape",s),s},checks:[]});return un(e,n)}function iI(e,t){if(!mi(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const s=Vn(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return Mn(this,"shape",i),i},checks:[]});return un(e,s)}function oI(e,t){if(!mi(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Mn(this,"shape",n),n},checks:e._zod.def.checks};return un(e,r)}function aI(e,t){const r=Vn(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Mn(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return un(e,r)}function cI(e,t,r){const n=Vn(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(r)for(const o in r){if(!(o in s))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(i[o]=e?new e({type:"optional",innerType:s[o]}):s[o])}else for(const o in s)i[o]=e?new e({type:"optional",innerType:s[o]}):s[o];return Mn(this,"shape",i),i},checks:[]});return un(t,n)}function uI(e,t,r){const n=Vn(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(r)for(const o in r){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(i[o]=new e({type:"nonoptional",innerType:s[o]}))}else for(const o in s)i[o]=new e({type:"nonoptional",innerType:s[o]});return Mn(this,"shape",i),i},checks:[]});return un(t,n)}function ds(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function xw(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Mi(e){return typeof e=="string"?e:e?.message}function On(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=Mi(e.inst?._zod.def?.error?.(e))??Mi(t?.error?.(e))??Mi(r.customError?.(e))??Mi(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function bd(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function wi(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const Uw=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,hu,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Pw=x("$ZodError",Uw),Dw=x("$ZodError",Uw,{Parent:Error});function dI(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function lI(e,t=r=>r.message){const r={_errors:[]},n=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>n({issues:o}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(t(i));else{let o=r,a=0;for(;a<i.path.length;){const c=i.path[a];a===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(i))):o[c]=o[c]||{_errors:[]},o=o[c],a++}}};return n(e),r}const vd=e=>(t,r,n,s)=>{const i=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new gs;if(o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>On(c,i,In())));throw $w(a,s?.callee),a}return o.value},Ed=e=>async(t,r,n,s)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){const a=new(s?.Err??e)(o.issues.map(c=>On(c,i,In())));throw $w(a,s?.callee),a}return o.value},pa=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new gs;return i.issues.length?{success:!1,error:new(e??Pw)(i.issues.map(o=>On(o,s,In())))}:{success:!0,data:i.value}},hI=pa(Dw),ma=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(o=>On(o,s,In())))}:{success:!0,data:i.value}},fI=ma(Dw),pI=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return vd(e)(t,r,s)},mI=e=>(t,r,n)=>vd(e)(t,r,n),wI=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Ed(e)(t,r,s)},yI=e=>async(t,r,n)=>Ed(e)(t,r,n),gI=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return pa(e)(t,r,s)},bI=e=>(t,r,n)=>pa(e)(t,r,n),vI=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return ma(e)(t,r,s)},EI=e=>async(t,r,n)=>ma(e)(t,r,n),_I=/^[cC][^\s-]{8,}$/,NI=/^[0-9a-z]+$/,AI=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,kI=/^[0-9a-vA-V]{20}$/,TI=/^[A-Za-z0-9]{27}$/,SI=/^[a-zA-Z0-9_-]{21}$/,RI=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,II=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,If=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,OI=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,$I="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function CI(){return new RegExp($I,"u")}const xI=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,UI=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,PI=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,DI=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,LI=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Lw=/^[A-Za-z0-9_-]*$/,zI=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,qI=/^\+(?:[0-9]){6,14}[0-9]$/,zw="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",jI=new RegExp(`^${zw}$`);function qw(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function WI(e){return new RegExp(`^${qw(e)}$`)}function MI(e){const t=qw({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${zw}T(?:${n})$`)}const VI=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},FI=/^(?:true|false)$/i,ZI=/^[^A-Z]*$/,BI=/^[^a-z]*$/,Jt=x("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),jw={number:"number",bigint:"bigint",object:"date"},HI=x("$ZodCheckLessThan",(e,t)=>{Jt.init(e,t);const r=jw[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),KI=x("$ZodCheckGreaterThan",(e,t)=>{Jt.init(e,t);const r=jw[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),JI=x("$ZodCheckMaxLength",(e,t)=>{var r;Jt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!yd(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const o=bd(s);n.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),GI=x("$ZodCheckMinLength",(e,t)=>{var r;Jt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!yd(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const o=bd(s);n.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),QI=x("$ZodCheckLengthEquals",(e,t)=>{var r;Jt.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!yd(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,i=s.length;if(i===t.length)return;const o=bd(s),a=i>t.length;n.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),wa=x("$ZodCheckStringFormat",(e,t)=>{var r,n;Jt.init(e,t),e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),YI=x("$ZodCheckRegex",(e,t)=>{wa.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),XI=x("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=ZI),wa.init(e,t)}),eO=x("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=BI),wa.init(e,t)}),tO=x("$ZodCheckIncludes",(e,t)=>{Jt.init(e,t);const r=fa(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),rO=x("$ZodCheckStartsWith",(e,t)=>{Jt.init(e,t);const r=new RegExp(`^${fa(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),nO=x("$ZodCheckEndsWith",(e,t)=>{Jt.init(e,t);const r=new RegExp(`.*${fa(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),sO=x("$ZodCheckOverwrite",(e,t)=>{Jt.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class iO{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(o=>o),s=Math.min(...n.map(o=>o.length-o.trimStart().length)),i=n.map(o=>o.slice(s)).map(o=>" ".repeat(this.indent*2)+o);for(const o of i)this.content.push(o)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(i=>`  ${i}`)];return new t(...r,s.join(`
`))}}const oO={major:4,minor:1,patch:12},Ve=x("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=oO;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const i of s._zod.onattach)i(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(o,a,c)=>{let d=ds(o),u;for(const l of a){if(l._zod.def.when){if(!l._zod.def.when(o))continue}else if(d)continue;const h=o.issues.length,m=l._zod.check(o);if(m instanceof Promise&&c?.async===!1)throw new gs;if(u||m instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await m,o.issues.length!==h&&(d||(d=ds(o,h)))});else{if(o.issues.length===h)continue;d||(d=ds(o,h))}}return u?u.then(()=>o):o},i=(o,a,c)=>{if(ds(o))return o.aborted=!0,o;const d=s(a,n,c);if(d instanceof Promise){if(c.async===!1)throw new gs;return d.then(u=>e._zod.parse(u,c))}return e._zod.parse(d,c)};e._zod.run=(o,a)=>{if(a.skipChecks)return e._zod.parse(o,a);if(a.direction==="backward"){const d=e._zod.parse({value:o.value,issues:[]},{...a,skipChecks:!0});return d instanceof Promise?d.then(u=>i(u,o,a)):i(d,o,a)}const c=e._zod.parse(o,a);if(c instanceof Promise){if(a.async===!1)throw new gs;return c.then(d=>s(d,n,a))}return s(c,n,a)}}e["~standard"]={validate:s=>{try{const i=hI(e,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return fI(e,s).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),_d=x("$ZodString",(e,t)=>{Ve.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??VI(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),Ue=x("$ZodStringFormat",(e,t)=>{wa.init(e,t),_d.init(e,t)}),aO=x("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=II),Ue.init(e,t)}),cO=x("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=If(n))}else t.pattern??(t.pattern=If());Ue.init(e,t)}),uO=x("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=OI),Ue.init(e,t)}),dO=x("$ZodURL",(e,t)=>{Ue.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),s=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:zI.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=s.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),lO=x("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=CI()),Ue.init(e,t)}),hO=x("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=SI),Ue.init(e,t)}),fO=x("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=_I),Ue.init(e,t)}),pO=x("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=NI),Ue.init(e,t)}),mO=x("$ZodULID",(e,t)=>{t.pattern??(t.pattern=AI),Ue.init(e,t)}),wO=x("$ZodXID",(e,t)=>{t.pattern??(t.pattern=kI),Ue.init(e,t)}),yO=x("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=TI),Ue.init(e,t)}),gO=x("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=MI(t)),Ue.init(e,t)}),bO=x("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=jI),Ue.init(e,t)}),vO=x("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=WI(t)),Ue.init(e,t)}),EO=x("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=RI),Ue.init(e,t)}),_O=x("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=xI),Ue.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),NO=x("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=UI),Ue.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),AO=x("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=PI),Ue.init(e,t)}),kO=x("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=DI),Ue.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[s,i]=n;if(!i)throw new Error;const o=Number(i);if(`${o}`!==i)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Ww(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const TO=x("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=LI),Ue.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Ww(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function SO(e){if(!Lw.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Ww(r)}const RO=x("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Lw),Ue.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{SO(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),IO=x("$ZodE164",(e,t)=>{t.pattern??(t.pattern=qI),Ue.init(e,t)});function OO(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const $O=x("$ZodJWT",(e,t)=>{Ue.init(e,t),e._zod.check=r=>{OO(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),CO=x("$ZodBoolean",(e,t)=>{Ve.init(e,t),e._zod.pattern=FI,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),r}}),xO=x("$ZodUnknown",(e,t)=>{Ve.init(e,t),e._zod.parse=r=>r}),UO=x("$ZodNever",(e,t)=>{Ve.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),PO=x("$ZodDate",(e,t)=>{Ve.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const s=r.value,i=s instanceof Date;return i&&!Number.isNaN(s.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:s,...i?{received:"Invalid Date"}:{},inst:e}),r}});function Of(e,t,r){e.issues.length&&t.issues.push(...xw(r,e.issues)),t.value[r]=e.value}const DO=x("$ZodArray",(e,t)=>{Ve.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const i=[];for(let o=0;o<s.length;o++){const a=s[o],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?i.push(c.then(d=>Of(d,r,o))):Of(c,r,o)}return i.length?Promise.all(i).then(()=>r):r}});function Ro(e,t,r,n){e.issues.length&&t.issues.push(...xw(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function Mw(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=rI(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function Vw(e,t,r,n,s,i){const o=[],a=s.keySet,c=s.catchall._zod,d=c.def.type;for(const u of Object.keys(t)){if(a.has(u))continue;if(d==="never"){o.push(u);continue}const l=c.run({value:t[u],issues:[]},n);l instanceof Promise?e.push(l.then(h=>Ro(h,r,u,t))):Ro(l,r,u,t)}return o.length&&r.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:i}),e.length?Promise.all(e).then(()=>r):r}const LO=x("$ZodObject",(e,t)=>{if(Ve.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=wd(()=>Mw(t));ye(e._zod,"propValues",()=>{const a=t.shape,c={};for(const d in a){const u=a[d]._zod;if(u.values){c[d]??(c[d]=new Set);for(const l of u.values)c[d].add(l)}}return c});const s=So,i=t.catchall;let o;e._zod.parse=(a,c)=>{o??(o=n.value);const d=a.value;if(!s(d))return a.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),a;a.value={};const u=[],l=o.shape;for(const h of o.keys){const p=l[h]._zod.run({value:d[h],issues:[]},c);p instanceof Promise?u.push(p.then(w=>Ro(w,a,h,d))):Ro(p,a,h,d)}return i?Vw(u,d,a,c,n.value,e):u.length?Promise.all(u).then(()=>a):a}}),zO=x("$ZodObjectJIT",(e,t)=>{LO.init(e,t);const r=e._zod.parse,n=wd(()=>Mw(t)),s=h=>{const m=new iO(["shape","payload","ctx"]),p=n.value,w=y=>{const E=Rf(y);return`shape[${E}]._zod.run({ value: input[${E}], issues: [] }, ctx)`};m.write("const input = payload.value;");const g=Object.create(null);let b=0;for(const y of p.keys)g[y]=`key_${b++}`;m.write("const newResult = {};");for(const y of p.keys){const E=g[y],k=Rf(y);m.write(`const ${E} = ${w(y)};`),m.write(`
        if (${E}.issues.length) {
          payload.issues = payload.issues.concat(${E}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${k}, ...iss.path] : [${k}]
          })));
        }
        
        
        if (${E}.value === undefined) {
          if (${k} in input) {
            newResult[${k}] = undefined;
          }
        } else {
          newResult[${k}] = ${E}.value;
        }
        
      `)}m.write("payload.value = newResult;"),m.write("return payload;");const v=m.compile();return(y,E)=>v(h,y,E)};let i;const o=So,a=!Ow.jitless,d=a&&eI.value,u=t.catchall;let l;e._zod.parse=(h,m)=>{l??(l=n.value);const p=h.value;return o(p)?a&&d&&m?.async===!1&&m.jitless!==!0?(i||(i=s(t.shape)),h=i(h,m),u?Vw([],p,h,m,l,e):h):r(h,m):(h.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),h)}});function $f(e,t,r,n){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const s=e.filter(i=>!ds(i));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(i=>i.issues.map(o=>On(o,n,In())))}),t)}const qO=x("$ZodUnion",(e,t)=>{Ve.init(e,t),ye(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),ye(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),ye(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),ye(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${s.map(i=>gd(i.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(s,i)=>{if(r)return n(s,i);let o=!1;const a=[];for(const c of t.options){const d=c._zod.run({value:s.value,issues:[]},i);if(d instanceof Promise)a.push(d),o=!0;else{if(d.issues.length===0)return d;a.push(d)}}return o?Promise.all(a).then(c=>$f(c,s,e,i)):$f(a,s,e,i)}}),jO=x("$ZodIntersection",(e,t)=>{Ve.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,i=t.left._zod.run({value:s,issues:[]},n),o=t.right._zod.run({value:s,issues:[]},n);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([c,d])=>Cf(r,c,d)):Cf(r,i,o)}});function fu(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(mi(e)&&mi(t)){const r=Object.keys(t),n=Object.keys(e).filter(i=>r.indexOf(i)!==-1),s={...e,...t};for(const i of n){const o=fu(e[i],t[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};s[i]=o.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],i=t[n],o=fu(s,i);if(!o.valid)return{valid:!1,mergeErrorPath:[n,...o.mergeErrorPath]};r.push(o.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function Cf(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),ds(e))return e;const n=fu(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const WO=x("$ZodEnum",(e,t)=>{Ve.init(e,t);const r=XR(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(s=>tI.has(typeof s)).map(s=>typeof s=="string"?fa(s):s.toString()).join("|")})$`),e._zod.parse=(s,i)=>{const o=s.value;return n.has(o)||s.issues.push({code:"invalid_value",values:r,input:o,inst:e}),s}}),MO=x("$ZodTransform",(e,t)=>{Ve.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Iw(e.constructor.name);const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(o=>(r.value=o,r));if(s instanceof Promise)throw new gs;return r.value=s,r}});function xf(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const VO=x("$ZodOptional",(e,t)=>{Ve.init(e,t),e._zod.optin="optional",e._zod.optout="optional",ye(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),ye(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${gd(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>xf(i,r.value)):xf(s,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),FO=x("$ZodNullable",(e,t)=>{Ve.init(e,t),ye(e._zod,"optin",()=>t.innerType._zod.optin),ye(e._zod,"optout",()=>t.innerType._zod.optout),ye(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${gd(r.source)}|null)$`):void 0}),ye(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),ZO=x("$ZodDefault",(e,t)=>{Ve.init(e,t),e._zod.optin="optional",ye(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>Uf(i,t)):Uf(s,t)}});function Uf(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const BO=x("$ZodPrefault",(e,t)=>{Ve.init(e,t),e._zod.optin="optional",ye(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),HO=x("$ZodNonOptional",(e,t)=>{Ve.init(e,t),ye(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>Pf(i,e)):Pf(s,e)}});function Pf(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const KO=x("$ZodCatch",(e,t)=>{Ve.init(e,t),ye(e._zod,"optin",()=>t.innerType._zod.optin),ye(e._zod,"optout",()=>t.innerType._zod.optout),ye(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>(r.value=i.value,i.issues.length&&(r.value=t.catchValue({...r,error:{issues:i.issues.map(o=>On(o,n,In()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>On(i,n,In()))},input:r.value}),r.issues=[]),r)}}),JO=x("$ZodPipe",(e,t)=>{Ve.init(e,t),ye(e._zod,"values",()=>t.in._zod.values),ye(e._zod,"optin",()=>t.in._zod.optin),ye(e._zod,"optout",()=>t.out._zod.optout),ye(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const i=t.out._zod.run(r,n);return i instanceof Promise?i.then(o=>Vi(o,t.in,n)):Vi(i,t.in,n)}const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(i=>Vi(i,t.out,n)):Vi(s,t.out,n)}});function Vi(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const GO=x("$ZodReadonly",(e,t)=>{Ve.init(e,t),ye(e._zod,"propValues",()=>t.innerType._zod.propValues),ye(e._zod,"values",()=>t.innerType._zod.values),ye(e._zod,"optin",()=>t.innerType._zod.optin),ye(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(Df):Df(s)}});function Df(e){return e.value=Object.freeze(e.value),e}const QO=x("$ZodCustom",(e,t)=>{Jt.init(e,t),Ve.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(i=>Lf(i,r,n,e));Lf(s,r,n,e)}});function Lf(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(wi(s))}}class YO{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const s={...n,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function XO(){return new YO}const Fi=XO();function e$(e,t){return new e({type:"string",...Y(t)})}function t$(e,t){return new e({type:"string",coerce:!0,...Y(t)})}function r$(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...Y(t)})}function zf(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...Y(t)})}function n$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...Y(t)})}function s$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Y(t)})}function i$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Y(t)})}function o$(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Y(t)})}function a$(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...Y(t)})}function c$(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...Y(t)})}function u$(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...Y(t)})}function d$(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...Y(t)})}function l$(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...Y(t)})}function h$(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...Y(t)})}function f$(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...Y(t)})}function p$(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...Y(t)})}function m$(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...Y(t)})}function w$(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...Y(t)})}function y$(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Y(t)})}function g$(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Y(t)})}function b$(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...Y(t)})}function v$(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...Y(t)})}function E$(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...Y(t)})}function _$(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...Y(t)})}function N$(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Y(t)})}function A$(e,t){return new e({type:"string",format:"date",check:"string_format",...Y(t)})}function k$(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...Y(t)})}function T$(e,t){return new e({type:"string",format:"duration",check:"string_format",...Y(t)})}function S$(e,t){return new e({type:"boolean",...Y(t)})}function R$(e){return new e({type:"unknown"})}function I$(e,t){return new e({type:"never",...Y(t)})}function O$(e,t){return new e({type:"date",...Y(t)})}function $$(e,t){return new HI({check:"less_than",...Y(t),value:e,inclusive:!0})}function C$(e,t){return new KI({check:"greater_than",...Y(t),value:e,inclusive:!0})}function Fw(e,t){return new JI({check:"max_length",...Y(t),maximum:e})}function Io(e,t){return new GI({check:"min_length",...Y(t),minimum:e})}function Zw(e,t){return new QI({check:"length_equals",...Y(t),length:e})}function x$(e,t){return new YI({check:"string_format",format:"regex",...Y(t),pattern:e})}function U$(e){return new XI({check:"string_format",format:"lowercase",...Y(e)})}function P$(e){return new eO({check:"string_format",format:"uppercase",...Y(e)})}function D$(e,t){return new tO({check:"string_format",format:"includes",...Y(t),includes:e})}function L$(e,t){return new rO({check:"string_format",format:"starts_with",...Y(t),prefix:e})}function z$(e,t){return new nO({check:"string_format",format:"ends_with",...Y(t),suffix:e})}function ki(e){return new sO({check:"overwrite",tx:e})}function q$(e){return ki(t=>t.normalize(e))}function j$(){return ki(e=>e.trim())}function W$(){return ki(e=>e.toLowerCase())}function M$(){return ki(e=>e.toUpperCase())}function V$(e,t,r){return new e({type:"array",element:t,...Y(r)})}function F$(e,t,r){return new e({type:"custom",check:"custom",fn:t,...Y(r)})}function Z$(e){const t=B$(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(wi(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(wi(s))}},e(r.value,r)));return t}function B$(e,t){const r=new Jt({check:"custom",...Y(t)});return r._zod.check=e,r}const H$=x("ZodISODateTime",(e,t)=>{gO.init(e,t),De.init(e,t)});function K$(e){return N$(H$,e)}const J$=x("ZodISODate",(e,t)=>{bO.init(e,t),De.init(e,t)});function G$(e){return A$(J$,e)}const Q$=x("ZodISOTime",(e,t)=>{vO.init(e,t),De.init(e,t)});function Y$(e){return k$(Q$,e)}const X$=x("ZodISODuration",(e,t)=>{EO.init(e,t),De.init(e,t)});function e0(e){return T$(X$,e)}const t0=(e,t)=>{Pw.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>lI(e,r)},flatten:{value:r=>dI(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,hu,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,hu,2)}},isEmpty:{get(){return e.issues.length===0}}})},Gt=x("ZodError",t0,{Parent:Error}),r0=vd(Gt),n0=Ed(Gt),s0=pa(Gt),i0=ma(Gt),o0=pI(Gt),a0=mI(Gt),c0=wI(Gt),u0=yI(Gt),d0=gI(Gt),l0=bI(Gt),h0=vI(Gt),f0=EI(Gt),He=x("ZodType",(e,t)=>(Ve.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(Vn(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>un(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>r0(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>s0(e,r,n),e.parseAsync=async(r,n)=>n0(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>i0(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>o0(e,r,n),e.decode=(r,n)=>a0(e,r,n),e.encodeAsync=async(r,n)=>c0(e,r,n),e.decodeAsync=async(r,n)=>u0(e,r,n),e.safeEncode=(r,n)=>d0(e,r,n),e.safeDecode=(r,n)=>l0(e,r,n),e.safeEncodeAsync=async(r,n)=>h0(e,r,n),e.safeDecodeAsync=async(r,n)=>f0(e,r,n),e.refine=(r,n)=>e.check(oC(r,n)),e.superRefine=r=>e.check(aC(r)),e.overwrite=r=>e.check(ki(r)),e.optional=()=>Wf(e),e.nullable=()=>Mf(e),e.nullish=()=>Wf(Mf(e)),e.nonoptional=r=>X0(e,r),e.array=()=>z0(e),e.or=r=>M0([e,r]),e.and=r=>F0(e,r),e.transform=r=>Vf(e,H0(r)),e.default=r=>G0(e,r),e.prefault=r=>Y0(e,r),e.catch=r=>tC(e,r),e.pipe=r=>Vf(e,r),e.readonly=()=>sC(e),e.describe=r=>{const n=e.clone();return Fi.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Fi.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Fi.get(e);const n=e.clone();return Fi.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Bw=x("_ZodString",(e,t)=>{_d.init(e,t),He.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(x$(...n)),e.includes=(...n)=>e.check(D$(...n)),e.startsWith=(...n)=>e.check(L$(...n)),e.endsWith=(...n)=>e.check(z$(...n)),e.min=(...n)=>e.check(Io(...n)),e.max=(...n)=>e.check(Fw(...n)),e.length=(...n)=>e.check(Zw(...n)),e.nonempty=(...n)=>e.check(Io(1,...n)),e.lowercase=n=>e.check(U$(n)),e.uppercase=n=>e.check(P$(n)),e.trim=()=>e.check(j$()),e.normalize=(...n)=>e.check(q$(...n)),e.toLowerCase=()=>e.check(W$()),e.toUpperCase=()=>e.check(M$())}),Hw=x("ZodString",(e,t)=>{_d.init(e,t),Bw.init(e,t),e.email=r=>e.check(r$(p0,r)),e.url=r=>e.check(a$(m0,r)),e.jwt=r=>e.check(_$(O0,r)),e.emoji=r=>e.check(c$(w0,r)),e.guid=r=>e.check(zf(qf,r)),e.uuid=r=>e.check(n$(Zi,r)),e.uuidv4=r=>e.check(s$(Zi,r)),e.uuidv6=r=>e.check(i$(Zi,r)),e.uuidv7=r=>e.check(o$(Zi,r)),e.nanoid=r=>e.check(u$(y0,r)),e.guid=r=>e.check(zf(qf,r)),e.cuid=r=>e.check(d$(g0,r)),e.cuid2=r=>e.check(l$(b0,r)),e.ulid=r=>e.check(h$(v0,r)),e.base64=r=>e.check(b$(S0,r)),e.base64url=r=>e.check(v$(R0,r)),e.xid=r=>e.check(f$(E0,r)),e.ksuid=r=>e.check(p$(_0,r)),e.ipv4=r=>e.check(m$(N0,r)),e.ipv6=r=>e.check(w$(A0,r)),e.cidrv4=r=>e.check(y$(k0,r)),e.cidrv6=r=>e.check(g$(T0,r)),e.e164=r=>e.check(E$(I0,r)),e.datetime=r=>e.check(K$(r)),e.date=r=>e.check(G$(r)),e.time=r=>e.check(Y$(r)),e.duration=r=>e.check(e0(r))});function ct(e){return e$(Hw,e)}const De=x("ZodStringFormat",(e,t)=>{Ue.init(e,t),Bw.init(e,t)}),p0=x("ZodEmail",(e,t)=>{uO.init(e,t),De.init(e,t)}),qf=x("ZodGUID",(e,t)=>{aO.init(e,t),De.init(e,t)}),Zi=x("ZodUUID",(e,t)=>{cO.init(e,t),De.init(e,t)}),m0=x("ZodURL",(e,t)=>{dO.init(e,t),De.init(e,t)}),w0=x("ZodEmoji",(e,t)=>{lO.init(e,t),De.init(e,t)}),y0=x("ZodNanoID",(e,t)=>{hO.init(e,t),De.init(e,t)}),g0=x("ZodCUID",(e,t)=>{fO.init(e,t),De.init(e,t)}),b0=x("ZodCUID2",(e,t)=>{pO.init(e,t),De.init(e,t)}),v0=x("ZodULID",(e,t)=>{mO.init(e,t),De.init(e,t)}),E0=x("ZodXID",(e,t)=>{wO.init(e,t),De.init(e,t)}),_0=x("ZodKSUID",(e,t)=>{yO.init(e,t),De.init(e,t)}),N0=x("ZodIPv4",(e,t)=>{_O.init(e,t),De.init(e,t)}),A0=x("ZodIPv6",(e,t)=>{NO.init(e,t),De.init(e,t)}),k0=x("ZodCIDRv4",(e,t)=>{AO.init(e,t),De.init(e,t)}),T0=x("ZodCIDRv6",(e,t)=>{kO.init(e,t),De.init(e,t)}),S0=x("ZodBase64",(e,t)=>{TO.init(e,t),De.init(e,t)}),R0=x("ZodBase64URL",(e,t)=>{RO.init(e,t),De.init(e,t)}),I0=x("ZodE164",(e,t)=>{IO.init(e,t),De.init(e,t)}),O0=x("ZodJWT",(e,t)=>{$O.init(e,t),De.init(e,t)}),$0=x("ZodBoolean",(e,t)=>{CO.init(e,t),He.init(e,t)});function C0(e){return S$($0,e)}const x0=x("ZodUnknown",(e,t)=>{xO.init(e,t),He.init(e,t)});function jf(){return R$(x0)}const U0=x("ZodNever",(e,t)=>{UO.init(e,t),He.init(e,t)});function P0(e){return I$(U0,e)}const D0=x("ZodDate",(e,t)=>{PO.init(e,t),He.init(e,t),e.min=(n,s)=>e.check(C$(n,s)),e.max=(n,s)=>e.check($$(n,s));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function As(e){return O$(D0,e)}const L0=x("ZodArray",(e,t)=>{DO.init(e,t),He.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(Io(r,n)),e.nonempty=r=>e.check(Io(1,r)),e.max=(r,n)=>e.check(Fw(r,n)),e.length=(r,n)=>e.check(Zw(r,n)),e.unwrap=()=>e.element});function z0(e,t){return V$(L0,e,t)}const q0=x("ZodObject",(e,t)=>{zO.init(e,t),He.init(e,t),ye(e,"shape",()=>t.shape),e.keyof=()=>Z0(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:jf()}),e.loose=()=>e.clone({...e._zod.def,catchall:jf()}),e.strict=()=>e.clone({...e._zod.def,catchall:P0()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>iI(e,r),e.safeExtend=r=>oI(e,r),e.merge=r=>aI(e,r),e.pick=r=>nI(e,r),e.omit=r=>sI(e,r),e.partial=(...r)=>cI(Kw,e,r[0]),e.required=(...r)=>uI(Jw,e,r[0])});function j0(e,t){const r={type:"object",shape:e??{},...Y(t)};return new q0(r)}const W0=x("ZodUnion",(e,t)=>{qO.init(e,t),He.init(e,t),e.options=t.options});function M0(e,t){return new W0({type:"union",options:e,...Y(t)})}const V0=x("ZodIntersection",(e,t)=>{jO.init(e,t),He.init(e,t)});function F0(e,t){return new V0({type:"intersection",left:e,right:t})}const pu=x("ZodEnum",(e,t)=>{WO.init(e,t),He.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const i={};for(const o of n)if(r.has(o))i[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new pu({...t,checks:[],...Y(s),entries:i})},e.exclude=(n,s)=>{const i={...t.entries};for(const o of n)if(r.has(o))delete i[o];else throw new Error(`Key ${o} not found in enum`);return new pu({...t,checks:[],...Y(s),entries:i})}});function Z0(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new pu({type:"enum",entries:r,...Y(t)})}const B0=x("ZodTransform",(e,t)=>{MO.init(e,t),He.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new Iw(e.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(wi(i,r.value,t));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),r.issues.push(wi(o))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(i=>(r.value=i,r)):(r.value=s,r)}});function H0(e){return new B0({type:"transform",transform:e})}const Kw=x("ZodOptional",(e,t)=>{VO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Wf(e){return new Kw({type:"optional",innerType:e})}const K0=x("ZodNullable",(e,t)=>{FO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Mf(e){return new K0({type:"nullable",innerType:e})}const J0=x("ZodDefault",(e,t)=>{ZO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function G0(e,t){return new J0({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Cw(t)}})}const Q0=x("ZodPrefault",(e,t)=>{BO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Y0(e,t){return new Q0({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Cw(t)}})}const Jw=x("ZodNonOptional",(e,t)=>{HO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType});function X0(e,t){return new Jw({type:"nonoptional",innerType:e,...Y(t)})}const eC=x("ZodCatch",(e,t)=>{KO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function tC(e,t){return new eC({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const rC=x("ZodPipe",(e,t)=>{JO.init(e,t),He.init(e,t),e.in=t.in,e.out=t.out});function Vf(e,t){return new rC({type:"pipe",in:e,out:t})}const nC=x("ZodReadonly",(e,t)=>{GO.init(e,t),He.init(e,t),e.unwrap=()=>e._zod.def.innerType});function sC(e){return new nC({type:"readonly",innerType:e})}const iC=x("ZodCustom",(e,t)=>{QO.init(e,t),He.init(e,t)});function oC(e,t={}){return F$(iC,e,t)}function aC(e){return Z$(e)}function Gw(e){return t$(Hw,e)}const ya=j0({id:ct(),createdAt:As().default(()=>new Date),updatedAt:As().default(()=>new Date)});ya.extend({email:ct().transform(e=>e.toLowerCase()),emailVerified:C0().default(!1),name:ct(),image:ct().nullish()});ya.extend({providerId:ct(),accountId:ct(),userId:Gw(),accessToken:ct().nullish(),refreshToken:ct().nullish(),idToken:ct().nullish(),accessTokenExpiresAt:As().nullish(),refreshTokenExpiresAt:As().nullish(),scope:ct().nullish(),password:ct().nullish()});ya.extend({userId:Gw(),expiresAt:As(),token:ct(),ipAddress:ct().nullish(),userAgent:ct().nullish()});ya.extend({value:ct(),expiresAt:As(),identifier:ct()});const pr=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e)),Bi=new WeakMap;function Qw(e,t){const r=t.fields,n={};for(const s in e){const i=r[s];if(!i){n[s]=e[s];continue}i.returned!==!1&&(n[s]=e[s])}return n}function Nd(e,t){Bi.has(e)||Bi.set(e,new Map);const r=Bi.get(e);if(r.has(t))return r.get(t);let n={...t==="user"?e.user?.additionalFields:{},...t==="session"?e.session?.additionalFields:{}};for(const s of e.plugins||[])s.schema&&s.schema[t]&&(n={...n,...s.schema[t].fields});return Bi.get(e).set(t,n),n}function mu(e,t){const r=Nd(e,"user");return Qw(t,{fields:r})}function Tc(e,t){const r=Nd(e,"session");return Qw(t,{fields:r})}function cC(e,t){const r=t.action,n=t.fields,s=Object.assign(Object.create(null),null);for(const i in n){if(i in e){if(n[i].input===!1){if(n[i].defaultValue){s[i]=n[i].defaultValue;continue}if(s[i])throw new _("BAD_REQUEST",{message:`${i} is not allowed to be set`});continue}if(n[i].validator?.input&&e[i]!==void 0){s[i]=n[i].validator.input.parse(e[i]);continue}if(n[i].transform?.input&&e[i]!==void 0){s[i]=n[i].transform?.input(e[i]);continue}s[i]=e[i];continue}if(n[i].defaultValue&&r==="create"){s[i]=n[i].defaultValue;continue}if(n[i].required&&r==="create")throw new _("BAD_REQUEST",{message:`${i} is required`})}return s}function uC(e,t={},r){const n=Nd(e,"user");return cC(t,{fields:n,action:r})}function Ad(e,t){if(!t)return e;for(const r in t){const n=t[r]?.modelName;n&&(e[r].modelName=n);for(const s in e[r].fields){const i=t[r]?.fields?.[s];i&&(e[r].fields[s].fieldName=i)}}return e}function Yw(e,t){if(t.advanced?.ipAddress?.disableIpTracking)return null;if(Su()||Ru)return"127.0.0.1";const r="headers"in e?e.headers:e,n=["x-forwarded-for"],s=t.advanced?.ipAddress?.ipAddressHeaders||n;for(const i of s){const o="get"in r?r.get(i):r[i];if(typeof o=="string"){const a=o.split(",")[0].trim();if(dC(a))return a}}return null}function dC(e){return!!(PN().safeParse(e).success||DN().safeParse(e).success)}function Or(e){return typeof e>"u"||e===void 0}function st(e){return typeof e=="string"}function ks(e){return typeof e=="number"}function yi(e){return typeof e=="boolean"}function ga(e){return e===null}function Xw(e){return e instanceof Date}function ba(e){return typeof e=="bigint"}function lC(e){return typeof Buffer<"u"&&Buffer.isBuffer(e)}function lt(e){return typeof e=="function"}function Pt(e){return typeof e=="object"&&e!==null}function f(e){return Object.freeze(e)}function Hi(e){return Cr(e)?e:[e]}function Cr(e){return Array.isArray(e)}function xt(e){return e}const oe=f({is(e){return e.kind==="AlterTableNode"},create(e){return f({kind:"AlterTableNode",table:e})},cloneWithTableProps(e,t){return f({...e,...t})},cloneWithColumnAlteration(e,t){return f({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}}),ae=f({is(e){return e.kind==="IdentifierNode"},create(e){return f({kind:"IdentifierNode",name:e})}}),br=f({is(e){return e.kind==="CreateIndexNode"},create(e){return f({kind:"CreateIndexNode",name:ae.create(e)})},cloneWith(e,t){return f({...e,...t})},cloneWithColumns(e,t){return f({...e,columns:[...e.columns||[],...t]})}}),ey=f({is(e){return e.kind==="CreateSchemaNode"},create(e,t){return f({kind:"CreateSchemaNode",schema:ae.create(e),...t})},cloneWith(e,t){return f({...e,...t})}}),hC=["preserve rows","delete rows","drop"],Rt=f({is(e){return e.kind==="CreateTableNode"},create(e){return f({kind:"CreateTableNode",table:e,columns:f([])})},cloneWithColumn(e,t){return f({...e,columns:f([...e.columns,t])})},cloneWithConstraint(e,t){return f({...e,constraints:e.constraints?f([...e.constraints,t]):f([t])})},cloneWithFrontModifier(e,t){return f({...e,frontModifiers:e.frontModifiers?f([...e.frontModifiers,t]):f([t])})},cloneWithEndModifier(e,t){return f({...e,endModifiers:e.endModifiers?f([...e.endModifiers,t]):f([t])})},cloneWith(e,t){return f({...e,...t})}}),xr=f({is(e){return e.kind==="SchemableIdentifierNode"},create(e){return f({kind:"SchemableIdentifierNode",identifier:ae.create(e)})},createWithSchema(e,t){return f({kind:"SchemableIdentifierNode",schema:ae.create(e),identifier:ae.create(t)})}}),Gs=f({is(e){return e.kind==="DropIndexNode"},create(e,t){return f({kind:"DropIndexNode",name:xr.create(e),...t})},cloneWith(e,t){return f({...e,...t})}}),wu=f({is(e){return e.kind==="DropSchemaNode"},create(e,t){return f({kind:"DropSchemaNode",schema:ae.create(e),...t})},cloneWith(e,t){return f({...e,...t})}}),yu=f({is(e){return e.kind==="DropTableNode"},create(e,t){return f({kind:"DropTableNode",table:e,...t})},cloneWith(e,t){return f({...e,...t})}}),Pr=f({is(e){return e.kind==="AliasNode"},create(e,t){return f({kind:"AliasNode",node:e,alias:t})}}),Sr=f({is(e){return e.kind==="TableNode"},create(e){return f({kind:"TableNode",table:xr.create(e)})},createWithSchema(e,t){return f({kind:"TableNode",table:xr.createWithSchema(e,t)})}});function pt(e){return Pt(e)&&lt(e.toOperationNode)}function ty(e){return Pt(e)&&"expressionType"in e&&pt(e)}function fC(e){return Pt(e)&&"expression"in e&&st(e.alias)&&pt(e)}const gr=f({is(e){return e.kind==="SelectModifierNode"},create(e,t){return f({kind:"SelectModifierNode",modifier:e,of:t})},createWithExpression(e){return f({kind:"SelectModifierNode",rawModifier:e})}}),rn=f({is(e){return e.kind==="AndNode"},create(e,t){return f({kind:"AndNode",left:e,right:t})}}),Cs=f({is(e){return e.kind==="OrNode"},create(e,t){return f({kind:"OrNode",left:e,right:t})}}),Sc=f({is(e){return e.kind==="OnNode"},create(e){return f({kind:"OnNode",on:e})},cloneWithOperation(e,t,r){return f({...e,on:t==="And"?rn.create(e.on,r):Cs.create(e.on,r)})}}),Tn=f({is(e){return e.kind==="JoinNode"},create(e,t){return f({kind:"JoinNode",joinType:e,table:t,on:void 0})},createWithOn(e,t,r){return f({kind:"JoinNode",joinType:e,table:t,on:Sc.create(r)})},cloneWithOn(e,t){return f({...e,on:e.on?Sc.cloneWithOperation(e.on,"And",t):Sc.create(t)})}}),Ts=f({is(e){return e.kind==="BinaryOperationNode"},create(e,t,r){return f({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}}),pC=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],mC=["+","-","*","/","%","^","&","|","#","<<",">>"],ry=["->","->>"],wC=[...pC,...mC,"&&","||"],yC=["exists","not exists"],gC=["not","-",...yC],bC=[...wC,...ry,...gC,"between","between symmetric"],nn=f({is(e){return e.kind==="OperatorNode"},create(e){return f({kind:"OperatorNode",operator:e})}});function Ff(e){return st(e)&&ry.includes(e)}const Me=f({is(e){return e.kind==="ColumnNode"},create(e){return f({kind:"ColumnNode",column:ae.create(e)})}}),kd=f({is(e){return e.kind==="SelectAllNode"},create(){return f({kind:"SelectAllNode"})}}),va=f({is(e){return e.kind==="ReferenceNode"},create(e,t){return f({kind:"ReferenceNode",table:t,column:e})},createSelectAll(e){return f({kind:"ReferenceNode",table:e,column:kd.create()})}});class vC{#e;get dynamicReference(){return this.#e}get refType(){}constructor(t){this.#e=t}toOperationNode(){return ay(this.#e)}}function ny(e){return Pt(e)&&pt(e)&&st(e.dynamicReference)}const kr=f({is(e){return e.kind==="OrderByItemNode"},create(e,t){return f({kind:"OrderByItemNode",orderBy:e,direction:t})},cloneWith(e,t){return f({...e,...t})}}),Re=f({is(e){return e.kind==="RawNode"},create(e,t){return f({kind:"RawNode",sqlFragments:f(e),parameters:f(t)})},createWithSql(e){return Re.create([e],[])},createWithChild(e){return Re.create(["",""],[e])},createWithChildren(e){return Re.create(new Array(e.length+1).fill(""),e)}}),EC={is(e){return e.kind==="CollateNode"},create(e){return f({kind:"CollateNode",collation:ae.create(e)})}};class wn{#e;constructor(t){this.#e=f(t)}desc(){return new wn({node:kr.cloneWith(this.#e.node,{direction:Re.createWithSql("desc")})})}asc(){return new wn({node:kr.cloneWith(this.#e.node,{direction:Re.createWithSql("asc")})})}nullsLast(){return new wn({node:kr.cloneWith(this.#e.node,{nulls:"last"})})}nullsFirst(){return new wn({node:kr.cloneWith(this.#e.node,{nulls:"first"})})}collate(t){return new wn({node:kr.cloneWith(this.#e.node,{collation:EC.create(t)})})}toOperationNode(){return this.#e.node}}const Zf=new Set;function xs(e){Zf.has(e)||(Zf.add(e),console.log(e))}function sy(e){return e==="asc"||e==="desc"}function $n(e){if(e.length===2)return[Rc(e[0],e[1])];if(e.length===1){const[t]=e;return Array.isArray(t)?(xs("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map(r=>Rc(r))):[Rc(t)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function Rc(e,t){const r=_C(e);if(kr.is(r)){if(t)throw new Error("Cannot specify direction twice!");return r}return iy(r,t)}function _C(e){if(Ri(e))return Fn(e);if(ny(e))return e.toOperationNode();const[t,r]=e.split(" ");return r?(xs("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),iy(Ur(t),r)):Ur(e)}function iy(e,t){if(typeof t=="string"){if(!sy(t))throw new Error(`Invalid order by direction: ${t}`);return kr.create(e,Re.createWithSql(t))}if(ty(t))return xs("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),kr.create(e,t.toOperationNode());const r=kr.create(e);return t?t(new wn({node:r})).toOperationNode():r}const Oo=f({is(e){return e.kind==="JSONReferenceNode"},create(e,t){return f({kind:"JSONReferenceNode",reference:e,traversal:t})},cloneWithTraversal(e,t){return f({...e,traversal:t})}}),oy=f({is(e){return e.kind==="JSONOperatorChainNode"},create(e){return f({kind:"JSONOperatorChainNode",operator:e,values:f([])})},cloneWithValue(e,t){return f({...e,values:f([...e.values,t])})}}),Qs=f({is(e){return e.kind==="JSONPathNode"},create(e){return f({kind:"JSONPathNode",inOperator:e,pathLegs:f([])})},cloneWithLeg(e,t){return f({...e,pathLegs:f([...e.pathLegs,t])})}});function ay(e){return st(e)?Ur(e):e.toOperationNode()}function gi(e){return Cr(e)?e.map(t=>Dt(t)):[Dt(e)]}function Dt(e){return Ri(e)?Fn(e):ay(e)}function NC(e,t){const r=Ur(e);if(Ff(t))return Oo.create(r,oy.create(nn.create(t)));const n=t.slice(0,-1);if(Ff(n))return Oo.create(r,Qs.create(nn.create(n)));throw new Error(`Invalid JSON operator: ${t}`)}function Ur(e){if(!e.includes("."))return va.create(Me.create(e));const r=e.split(".").map(Td);if(r.length===3)return kC(r);if(r.length===2)return TC(r);throw new Error(`invalid column reference ${e}`)}function AC(e){const t=" as ";if(e.includes(t)){const[r,n]=e.split(t).map(Td);return Pr.create(Ur(r),ae.create(n))}else return Ur(e)}function cy(e){return Me.create(e)}function $o(e){if(e.includes(" ")){const[r,n]=e.split(" ").map(Td);if(!sy(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return $n([r,n])[0]}else return cy(e)}function kC(e){const[t,r,n]=e;return va.create(Me.create(n),Sr.createWithSchema(t,r))}function TC(e){const[t,r]=e;return va.create(Me.create(r),Sr.create(t))}function Td(e){return e.trim()}const uy=f({is(e){return e.kind==="PrimitiveValueListNode"},create(e){return f({kind:"PrimitiveValueListNode",values:f([...e])})}}),Ea=f({is(e){return e.kind==="ValueListNode"},create(e){return f({kind:"ValueListNode",values:f(e)})}}),Zt=f({is(e){return e.kind==="ValueNode"},create(e){return f({kind:"ValueNode",value:e})},createImmediate(e){return f({kind:"ValueNode",value:e,immediate:!0})}});function SC(e){return Cr(e)?RC(e):Be(e)}function Be(e){return Ri(e)?Fn(e):Zt.create(e)}function Sd(e){return ks(e)||yi(e)||ga(e)}function Rd(e){if(!Sd(e))throw new Error(`unsafe immediate value ${JSON.stringify(e)}`);return Zt.createImmediate(e)}function RC(e){return e.some(Ri)?Ea.create(e.map(t=>Be(t))):uy.create(e)}const Rr=f({is(e){return e.kind==="ParensNode"},create(e){return f({kind:"ParensNode",node:e})}});function it(e){if(e.length===3)return Id(e[0],e[1],e[2]);if(e.length===1)return Be(e[0]);throw new Error(`invalid arguments: ${JSON.stringify(e)}`)}function Id(e,t,r){return IC(t)&&dy(r)?Ts.create(Dt(e),gu(t),Zt.createImmediate(r)):Ts.create(Dt(e),gu(t),SC(r))}function mr(e,t,r){return Ts.create(Dt(e),gu(t),Dt(r))}function Bf(e,t){return Co(Object.entries(e).filter(([,r])=>!Or(r)).map(([r,n])=>Id(r,dy(n)?"is":"=",n)),t)}function Co(e,t,r=!0){const n=t==="and"?rn.create:Cs.create;if(e.length===0)return Ts.create(Zt.createImmediate(1),nn.create("="),Zt.createImmediate(t==="and"?1:0));let s=Hf(e[0]);for(let i=1;i<e.length;++i)s=n(s,Hf(e[i]));return e.length>1&&r?Rr.create(s):s}function IC(e){return e==="is"||e==="is not"}function dy(e){return ga(e)||yi(e)}function gu(e){if(st(e)&&bC.includes(e))return nn.create(e);if(pt(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function Hf(e){return pt(e)?e.toOperationNode():e}const Ss=f({is(e){return e.kind==="OrderByNode"},create(e){return f({kind:"OrderByNode",items:f([...e])})},cloneWithItems(e,t){return f({...e,items:f([...e.items,...t])})}}),Kf=f({is(e){return e.kind==="PartitionByNode"},create(e){return f({kind:"PartitionByNode",items:f(e)})},cloneWithItems(e,t){return f({...e,items:f([...e.items,...t])})}}),bu=f({is(e){return e.kind==="OverNode"},create(){return f({kind:"OverNode"})},cloneWithOrderByItems(e,t){return f({...e,orderBy:e.orderBy?Ss.cloneWithItems(e.orderBy,t):Ss.create(t)})},cloneWithPartitionByItems(e,t){return f({...e,partitionBy:e.partitionBy?Kf.cloneWithItems(e.partitionBy,t):Kf.create(t)})}}),xo=f({is(e){return e.kind==="FromNode"},create(e){return f({kind:"FromNode",froms:f(e)})},cloneWithFroms(e,t){return f({...e,froms:f([...e.froms,...t])})}}),Jf=f({is(e){return e.kind==="GroupByNode"},create(e){return f({kind:"GroupByNode",items:f(e)})},cloneWithItems(e,t){return f({...e,items:f([...e.items,...t])})}}),Gf=f({is(e){return e.kind==="HavingNode"},create(e){return f({kind:"HavingNode",having:e})},cloneWithOperation(e,t,r){return f({...e,having:t==="And"?rn.create(e.having,r):Cs.create(e.having,r)})}}),Xe=f({is(e){return e.kind==="InsertQueryNode"},create(e,t,r){return f({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r})},createWithoutInto(){return f({kind:"InsertQueryNode"})},cloneWith(e,t){return f({...e,...t})}}),ly=f({is(e){return e.kind==="ListNode"},create(e){return f({kind:"ListNode",items:f(e)})}}),bs=f({is(e){return e.kind==="UpdateQueryNode"},create(e,t){return f({kind:"UpdateQueryNode",table:e.length===1?e[0]:ly.create(e),...t&&{with:t}})},createWithoutTable(){return f({kind:"UpdateQueryNode"})},cloneWithFromItems(e,t){return f({...e,from:e.from?xo.cloneWithFroms(e.from,t):xo.create(t)})},cloneWithUpdates(e,t){return f({...e,updates:e.updates?f([...e.updates,...t]):t})},cloneWithLimit(e,t){return f({...e,limit:t})}}),Qf=f({is(e){return e.kind==="UsingNode"},create(e){return f({kind:"UsingNode",tables:f(e)})},cloneWithTables(e,t){return f({...e,tables:f([...e.tables,...t])})}}),Ys=f({is(e){return e.kind==="DeleteQueryNode"},create(e,t){return f({kind:"DeleteQueryNode",from:xo.create(e),...t&&{with:t}})},cloneWithOrderByItems:(e,t)=>Z.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>Z.cloneWithoutOrderBy(e),cloneWithLimit(e,t){return f({...e,limit:t})},cloneWithoutLimit(e){return f({...e,limit:void 0})},cloneWithUsing(e,t){return f({...e,using:e.using!==void 0?Qf.cloneWithTables(e.using,t):Qf.create(t)})}}),wt=f({is(e){return e.kind==="WhereNode"},create(e){return f({kind:"WhereNode",where:e})},cloneWithOperation(e,t,r){return f({...e,where:t==="And"?rn.create(e.where,r):Cs.create(e.where,r)})}}),Yf=f({is(e){return e.kind==="ReturningNode"},create(e){return f({kind:"ReturningNode",selections:f(e)})},cloneWithSelections(e,t){return f({...e,selections:e.selections?f([...e.selections,...t]):f(t)})}}),OC=f({is(e){return e.kind==="ExplainNode"},create(e,t){return f({kind:"ExplainNode",format:e,options:t})}}),Cn=f({is(e){return e.kind==="WhenNode"},create(e){return f({kind:"WhenNode",condition:e})},cloneWithResult(e,t){return f({...e,result:t})}}),hr=f({is(e){return e.kind==="MergeQueryNode"},create(e,t){return f({kind:"MergeQueryNode",into:e,...t&&{with:t}})},cloneWithUsing(e,t){return f({...e,using:t})},cloneWithWhen(e,t){return f({...e,whens:e.whens?f([...e.whens,t]):f([t])})},cloneWithThen(e,t){return f({...e,whens:e.whens?f([...e.whens.slice(0,-1),Cn.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}}),Xf=f({is(e){return e.kind==="OutputNode"},create(e){return f({kind:"OutputNode",selections:f(e)})},cloneWithSelections(e,t){return f({...e,selections:e.selections?f([...e.selections,...t]):f(t)})}}),Z=f({is(e){return pe.is(e)||Xe.is(e)||bs.is(e)||Ys.is(e)||hr.is(e)},cloneWithEndModifier(e,t){return f({...e,endModifiers:e.endModifiers?f([...e.endModifiers,t]):f([t])})},cloneWithWhere(e,t){return f({...e,where:e.where?wt.cloneWithOperation(e.where,"And",t):wt.create(t)})},cloneWithJoin(e,t){return f({...e,joins:e.joins?f([...e.joins,t]):f([t])})},cloneWithReturning(e,t){return f({...e,returning:e.returning?Yf.cloneWithSelections(e.returning,t):Yf.create(t)})},cloneWithoutReturning(e){return f({...e,returning:void 0})},cloneWithoutWhere(e){return f({...e,where:void 0})},cloneWithExplain(e,t,r){return f({...e,explain:OC.create(t,r?.toOperationNode())})},cloneWithTop(e,t){return f({...e,top:t})},cloneWithOutput(e,t){return f({...e,output:e.output?Xf.cloneWithSelections(e.output,t):Xf.create(t)})},cloneWithOrderByItems(e,t){return f({...e,orderBy:e.orderBy?Ss.cloneWithItems(e.orderBy,t):Ss.create(t)})},cloneWithoutOrderBy(e){return f({...e,orderBy:void 0})}}),pe=f({is(e){return e.kind==="SelectQueryNode"},create(e){return f({kind:"SelectQueryNode",...e&&{with:e}})},createFrom(e,t){return f({kind:"SelectQueryNode",from:xo.create(e),...t&&{with:t}})},cloneWithSelections(e,t){return f({...e,selections:e.selections?f([...e.selections,...t]):f(t)})},cloneWithDistinctOn(e,t){return f({...e,distinctOn:e.distinctOn?f([...e.distinctOn,...t]):f(t)})},cloneWithFrontModifier(e,t){return f({...e,frontModifiers:e.frontModifiers?f([...e.frontModifiers,t]):f([t])})},cloneWithOrderByItems:(e,t)=>Z.cloneWithOrderByItems(e,t),cloneWithGroupByItems(e,t){return f({...e,groupBy:e.groupBy?Jf.cloneWithItems(e.groupBy,t):Jf.create(t)})},cloneWithLimit(e,t){return f({...e,limit:t})},cloneWithOffset(e,t){return f({...e,offset:t})},cloneWithFetch(e,t){return f({...e,fetch:t})},cloneWithHaving(e,t){return f({...e,having:e.having?Gf.cloneWithOperation(e.having,"And",t):Gf.create(t)})},cloneWithSetOperations(e,t){return f({...e,setOperations:e.setOperations?f([...e.setOperations,...t]):f([...t])})},cloneWithoutSelections(e){return f({...e,selections:[]})},cloneWithoutLimit(e){return f({...e,limit:void 0})},cloneWithoutOffset(e){return f({...e,offset:void 0})},cloneWithoutOrderBy:e=>Z.cloneWithoutOrderBy(e),cloneWithoutGroupBy(e){return f({...e,groupBy:void 0})}});class Xs{#e;constructor(t){this.#e=f(t)}on(...t){return new Xs({...this.#e,joinNode:Tn.cloneWithOn(this.#e.joinNode,it(t))})}onRef(t,r,n){return new Xs({...this.#e,joinNode:Tn.cloneWithOn(this.#e.joinNode,mr(t,r,n))})}onTrue(){return new Xs({...this.#e,joinNode:Tn.cloneWithOn(this.#e.joinNode,Re.createWithSql("true"))})}$call(t){return t(this)}toOperationNode(){return this.#e.joinNode}}const $C=f({is(e){return e.kind==="PartitionByItemNode"},create(e){return f({kind:"PartitionByItemNode",partitionBy:e})}});function CC(e){return gi(e).map($C.create)}class ei{#e;constructor(t){this.#e=f(t)}orderBy(...t){return new ei({overNode:bu.cloneWithOrderByItems(this.#e.overNode,$n(t))})}clearOrderBy(){return new ei({overNode:Z.cloneWithoutOrderBy(this.#e.overNode)})}partitionBy(t){return new ei({overNode:bu.cloneWithPartitionByItems(this.#e.overNode,CC(t))})}$call(t){return t(this)}toOperationNode(){return this.#e.overNode}}const ti=f({is(e){return e.kind==="SelectionNode"},create(e){return f({kind:"SelectionNode",selection:e})},createSelectAll(){return f({kind:"SelectionNode",selection:kd.create()})},createSelectAllFromTable(e){return f({kind:"SelectionNode",selection:va.createSelectAll(e)})}});function zt(e){return lt(e)?zt(e(Ds())):Cr(e)?e.map(t=>ep(t)):[ep(e)]}function ep(e){return st(e)?ti.create(AC(e)):ny(e)?ti.create(e.toOperationNode()):ti.create(Ny(e))}function Bt(e){return e?Array.isArray(e)?e.map(tp):[tp(e)]:[ti.createSelectAll()]}function tp(e){if(st(e))return ti.createSelectAllFromTable(je(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const xC=f({is(e){return e.kind==="ValuesNode"},create(e){return f({kind:"ValuesNode",values:f(e)})}}),UC=f({is(e){return e.kind==="DefaultInsertValueNode"},create(){return f({kind:"DefaultInsertValueNode"})}});function hy(e){const t=lt(e)?e(Ds()):e,r=Cr(t)?t:f([t]);return PC(r)}function PC(e){const t=DC(e);return[f([...t.keys()].map(Me.create)),xC.create(e.map(r=>LC(r,t)))]}function DC(e){const t=new Map;for(const r of e){const n=Object.keys(r);for(const s of n)!t.has(s)&&r[s]!==void 0&&t.set(s,t.size)}return t}function LC(e,t){const r=Object.keys(e),n=Array.from({length:t.size});let s=!1,i=r.length;for(const a of r){const c=t.get(a);if(Or(c)){i--;continue}const d=e[a];(Or(d)||Ri(d))&&(s=!0),n[c]=d}if(i<t.size||s){const a=UC.create();return Ea.create(n.map(c=>Or(c)?a:Be(c)))}return uy.create(n)}const fy=f({is(e){return e.kind==="ColumnUpdateNode"},create(e,t){return f({kind:"ColumnUpdateNode",column:e,value:t})}});function zC(...e){return e.length===2?[fy.create(Dt(e[0]),Be(e[1]))]:Od(e[0])}function Od(e){const t=lt(e)?e(Ds()):e;return Object.entries(t).filter(([r,n])=>n!==void 0).map(([r,n])=>fy.create(Me.create(r),Be(n)))}const qC=f({is(e){return e.kind==="OnDuplicateKeyNode"},create(e){return f({kind:"OnDuplicateKeyNode",updates:e})}});class jC{insertId;numInsertedOrUpdatedRows;constructor(t,r){this.insertId=t,this.numInsertedOrUpdatedRows=r}}class Ti extends Error{node;constructor(t){super("no result"),this.node=t}}function Si(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}const Ot=f({is(e){return e.kind==="OnConflictNode"},create(){return f({kind:"OnConflictNode"})},cloneWith(e,t){return f({...e,...t})},cloneWithIndexWhere(e,t){return f({...e,indexWhere:e.indexWhere?wt.cloneWithOperation(e.indexWhere,"And",t):wt.create(t)})},cloneWithIndexOrWhere(e,t){return f({...e,indexWhere:e.indexWhere?wt.cloneWithOperation(e.indexWhere,"Or",t):wt.create(t)})},cloneWithUpdateWhere(e,t){return f({...e,updateWhere:e.updateWhere?wt.cloneWithOperation(e.updateWhere,"And",t):wt.create(t)})},cloneWithUpdateOrWhere(e,t){return f({...e,updateWhere:e.updateWhere?wt.cloneWithOperation(e.updateWhere,"Or",t):wt.create(t)})},cloneWithoutIndexWhere(e){return f({...e,indexWhere:void 0})},cloneWithoutUpdateWhere(e){return f({...e,updateWhere:void 0})}});class Er{#e;constructor(t){this.#e=f(t)}column(t){const r=Me.create(t);return new Er({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?f([...this.#e.onConflictNode.columns,r]):f([r])})})}columns(t){const r=t.map(Me.create);return new Er({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?f([...this.#e.onConflictNode.columns,...r]):f(r)})})}constraint(t){return new Er({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{constraint:ae.create(t)})})}expression(t){return new Er({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{indexExpression:t.toOperationNode()})})}where(...t){return new Er({...this.#e,onConflictNode:Ot.cloneWithIndexWhere(this.#e.onConflictNode,it(t))})}whereRef(t,r,n){return new Er({...this.#e,onConflictNode:Ot.cloneWithIndexWhere(this.#e.onConflictNode,mr(t,r,n))})}clearWhere(){return new Er({...this.#e,onConflictNode:Ot.cloneWithoutIndexWhere(this.#e.onConflictNode)})}doNothing(){return new WC({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{doNothing:!0})})}doUpdateSet(t){return new ri({...this.#e,onConflictNode:Ot.cloneWith(this.#e.onConflictNode,{updates:Od(t)})})}$call(t){return t(this)}}class WC{#e;constructor(t){this.#e=f(t)}toOperationNode(){return this.#e.onConflictNode}}class ri{#e;constructor(t){this.#e=f(t)}where(...t){return new ri({...this.#e,onConflictNode:Ot.cloneWithUpdateWhere(this.#e.onConflictNode,it(t))})}whereRef(t,r,n){return new ri({...this.#e,onConflictNode:Ot.cloneWithUpdateWhere(this.#e.onConflictNode,mr(t,r,n))})}clearWhere(){return new ri({...this.#e,onConflictNode:Ot.cloneWithoutUpdateWhere(this.#e.onConflictNode)})}$call(t){return t(this)}toOperationNode(){return this.#e.onConflictNode}}const MC=f({is(e){return e.kind==="TopNode"},create(e,t){return f({kind:"TopNode",expression:e,modifiers:t})}});function Us(e,t){if(!ks(e)&&!ba(e))throw new Error(`Invalid top expression: ${e}`);if(!Or(t)&&!VC(t))throw new Error(`Invalid top modifiers: ${t}`);return MC.create(e,t)}function VC(e){return e==="percent"||e==="with ties"||e==="percent with ties"}const Xn=f({is(e){return e.kind==="OrActionNode"},create(e){return f({kind:"OrActionNode",action:e})}});class ce{#e;constructor(t){this.#e=f(t)}values(t){const[r,n]=hy(t);return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{columns:r,values:n})})}columns(t){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{columns:f(t.map(Me.create))})})}expression(t){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{values:Fn(t)})})}defaultValues(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{defaultValues:!0})})}modifyEnd(t){return new ce({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,t.toOperationNode())})}ignore(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("ignore")})})}orIgnore(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("ignore")})})}orAbort(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("abort")})})}orFail(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("fail")})})}orReplace(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("replace")})})}orRollback(){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{orAction:Xn.create("rollback")})})}top(t,r){return new ce({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}onConflict(t){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{onConflict:t(new Er({onConflictNode:Ot.create()})).toOperationNode()})})}onDuplicateKeyUpdate(t){return new ce({...this.#e,queryNode:Xe.cloneWith(this.#e.queryNode,{onDuplicateKey:qC.create(Od(t))})})}returning(t){return new ce({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,zt(t))})}returningAll(){return new ce({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,Bt())})}output(t){return new ce({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,zt(t))})}outputAll(t){return new ce({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,Bt(t))})}clearReturning(){return new ce({...this.#e,queryNode:Z.cloneWithoutReturning(this.#e.queryNode)})}$call(t){return t(this)}$if(t,r){return t?r(this):new ce({...this.#e})}$castTo(){return new ce(this.#e)}$narrowType(){return new ce(this.#e)}$assertType(){return new ce(this.#e)}withPlugin(t){return new ce({...this.#e,executor:this.#e.executor.withPlugin(t)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const t=this.compile(),r=await this.#e.executor.executeQuery(t),{adapter:n}=this.#e.executor,s=t.query;return s.returning&&n.supportsReturning||s.output&&n.supportsOutput?r.rows:[new jC(r.insertId,r.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[t]=await this.execute();return t}async executeTakeFirstOrThrow(t=Ti){const r=await this.executeTakeFirst();if(r===void 0)throw Si(t)?new t(this.toOperationNode()):t(this.toOperationNode());return r}async*stream(t=100){const r=this.compile(),n=this.#e.executor.stream(r,t);for await(const s of n)yield*s.rows}async explain(t,r){return await new ce({...this.#e,queryNode:Z.cloneWithExplain(this.#e.queryNode,t,r)}).execute()}}class FC{numDeletedRows;constructor(t){this.numDeletedRows=t}}const $d=f({is(e){return e.kind==="LimitNode"},create(e){return f({kind:"LimitNode",limit:e})}});class Te{#e;constructor(t){this.#e=f(t)}where(...t){return new Te({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,it(t))})}whereRef(t,r,n){return new Te({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,mr(t,r,n))})}clearWhere(){return new Te({...this.#e,queryNode:Z.cloneWithoutWhere(this.#e.queryNode)})}top(t,r){return new Te({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}using(t){return new Te({...this.#e,queryNode:Ys.cloneWithUsing(this.#e.queryNode,vs(t))})}innerJoin(...t){return this.#t("InnerJoin",t)}leftJoin(...t){return this.#t("LeftJoin",t)}rightJoin(...t){return this.#t("RightJoin",t)}fullJoin(...t){return this.#t("FullJoin",t)}#t(t,r){return new Te({...this.#e,queryNode:Z.cloneWithJoin(this.#e.queryNode,Na(t,r))})}returning(t){return new Te({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,zt(t))})}returningAll(t){return new Te({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,Bt(t))})}output(t){return new Te({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,zt(t))})}outputAll(t){return new Te({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,Bt(t))})}clearReturning(){return new Te({...this.#e,queryNode:Z.cloneWithoutReturning(this.#e.queryNode)})}clearLimit(){return new Te({...this.#e,queryNode:Ys.cloneWithoutLimit(this.#e.queryNode)})}orderBy(...t){return new Te({...this.#e,queryNode:Z.cloneWithOrderByItems(this.#e.queryNode,$n(t))})}clearOrderBy(){return new Te({...this.#e,queryNode:Z.cloneWithoutOrderBy(this.#e.queryNode)})}limit(t){return new Te({...this.#e,queryNode:Ys.cloneWithLimit(this.#e.queryNode,$d.create(Be(t)))})}modifyEnd(t){return new Te({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,t.toOperationNode())})}$call(t){return t(this)}$if(t,r){return t?r(this):new Te({...this.#e})}$castTo(){return new Te(this.#e)}$narrowType(){return new Te(this.#e)}$assertType(){return new Te(this.#e)}withPlugin(t){return new Te({...this.#e,executor:this.#e.executor.withPlugin(t)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const t=this.compile(),r=await this.#e.executor.executeQuery(t),{adapter:n}=this.#e.executor,s=t.query;return s.returning&&n.supportsReturning||s.output&&n.supportsOutput?r.rows:[new FC(r.numAffectedRows??BigInt(0))]}async executeTakeFirst(){const[t]=await this.execute();return t}async executeTakeFirstOrThrow(t=Ti){const r=await this.executeTakeFirst();if(r===void 0)throw Si(t)?new t(this.toOperationNode()):t(this.toOperationNode());return r}async*stream(t=100){const r=this.compile(),n=this.#e.executor.stream(r,t);for await(const s of n)yield*s.rows}async explain(t,r){return await new Te({...this.#e,queryNode:Z.cloneWithExplain(this.#e.queryNode,t,r)}).execute()}}class ZC{numUpdatedRows;numChangedRows;constructor(t,r){this.numUpdatedRows=t,this.numChangedRows=r}}class ge{#e;constructor(t){this.#e=f(t)}where(...t){return new ge({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,it(t))})}whereRef(t,r,n){return new ge({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,mr(t,r,n))})}clearWhere(){return new ge({...this.#e,queryNode:Z.cloneWithoutWhere(this.#e.queryNode)})}top(t,r){return new ge({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}from(t){return new ge({...this.#e,queryNode:bs.cloneWithFromItems(this.#e.queryNode,vs(t))})}innerJoin(...t){return this.#t("InnerJoin",t)}leftJoin(...t){return this.#t("LeftJoin",t)}rightJoin(...t){return this.#t("RightJoin",t)}fullJoin(...t){return this.#t("FullJoin",t)}#t(t,r){return new ge({...this.#e,queryNode:Z.cloneWithJoin(this.#e.queryNode,Na(t,r))})}orderBy(...t){return new ge({...this.#e,queryNode:Z.cloneWithOrderByItems(this.#e.queryNode,$n(t))})}clearOrderBy(){return new ge({...this.#e,queryNode:Z.cloneWithoutOrderBy(this.#e.queryNode)})}limit(t){return new ge({...this.#e,queryNode:bs.cloneWithLimit(this.#e.queryNode,$d.create(Be(t)))})}set(...t){return new ge({...this.#e,queryNode:bs.cloneWithUpdates(this.#e.queryNode,zC(...t))})}returning(t){return new ge({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,zt(t))})}returningAll(t){return new ge({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,Bt(t))})}output(t){return new ge({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,zt(t))})}outputAll(t){return new ge({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,Bt(t))})}modifyEnd(t){return new ge({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,t.toOperationNode())})}clearReturning(){return new ge({...this.#e,queryNode:Z.cloneWithoutReturning(this.#e.queryNode)})}$call(t){return t(this)}$if(t,r){return t?r(this):new ge({...this.#e})}$castTo(){return new ge(this.#e)}$narrowType(){return new ge(this.#e)}$assertType(){return new ge(this.#e)}withPlugin(t){return new ge({...this.#e,executor:this.#e.executor.withPlugin(t)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const t=this.compile(),r=await this.#e.executor.executeQuery(t),{adapter:n}=this.#e.executor,s=t.query;return s.returning&&n.supportsReturning||s.output&&n.supportsOutput?r.rows:[new ZC(r.numAffectedRows??BigInt(0),r.numChangedRows)]}async executeTakeFirst(){const[t]=await this.execute();return t}async executeTakeFirstOrThrow(t=Ti){const r=await this.executeTakeFirst();if(r===void 0)throw Si(t)?new t(this.toOperationNode()):t(this.toOperationNode());return r}async*stream(t=100){const r=this.compile(),n=this.#e.executor.stream(r,t);for await(const s of n)yield*s.rows}async explain(t,r){return await new ge({...this.#e,queryNode:Z.cloneWithExplain(this.#e.queryNode,t,r)}).execute()}}const rp=f({is(e){return e.kind==="CommonTableExpressionNameNode"},create(e,t){return f({kind:"CommonTableExpressionNameNode",table:Sr.create(e),columns:t?f(t.map(Me.create)):void 0})}}),Uo=f({is(e){return e.kind==="CommonTableExpressionNode"},create(e,t){return f({kind:"CommonTableExpressionNode",name:e,expression:t})},cloneWith(e,t){return f({...e,...t})}});class Po{#e;constructor(t){this.#e=f(t)}materialized(){return new Po({...this.#e,node:Uo.cloneWith(this.#e.node,{materialized:!0})})}notMaterialized(){return new Po({...this.#e,node:Uo.cloneWith(this.#e.node,{materialized:!1})})}toOperationNode(){return this.#e.node}}function np(e,t){const r=t(rx()).toOperationNode();return lt(e)?e(BC(r)).toOperationNode():Uo.create(py(e),r)}function BC(e){return t=>new Po({node:Uo.create(py(t),e)})}function py(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],n=t[1].split(",").map(s=>s.trim());return rp.create(r,n)}else return rp.create(e)}const Ki=f({is(e){return e.kind==="WithNode"},create(e,t){return f({kind:"WithNode",expressions:f([e]),...t})},cloneWithExpression(e,t){return f({...e,expressions:f([...e.expressions,t])})}}),sp=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function my(e){let t="";for(let r=0;r<e;++r)t+=HC();return t}function HC(){return sp[~~(Math.random()*sp.length)]}function re(){return new KC}class KC{#e;get queryId(){return this.#e===void 0&&(this.#e=my(8)),this.#e}}class wy{nodeStack=[];#e=f({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(t,r){if(!t)return t;this.nodeStack.push(t);const n=this.transformNodeImpl(t,r);return this.nodeStack.pop(),f(n)}transformNodeImpl(t,r){return this.#e[t.kind](t,r)}transformNodeList(t,r){return t&&f(t.map(n=>this.transformNode(n,r)))}transformSelectQuery(t,r){return{kind:"SelectQueryNode",from:this.transformNode(t.from,r),selections:this.transformNodeList(t.selections,r),distinctOn:this.transformNodeList(t.distinctOn,r),joins:this.transformNodeList(t.joins,r),groupBy:this.transformNode(t.groupBy,r),orderBy:this.transformNode(t.orderBy,r),where:this.transformNode(t.where,r),frontModifiers:this.transformNodeList(t.frontModifiers,r),endModifiers:this.transformNodeList(t.endModifiers,r),limit:this.transformNode(t.limit,r),offset:this.transformNode(t.offset,r),with:this.transformNode(t.with,r),having:this.transformNode(t.having,r),explain:this.transformNode(t.explain,r),setOperations:this.transformNodeList(t.setOperations,r),fetch:this.transformNode(t.fetch,r),top:this.transformNode(t.top,r)}}transformSelection(t,r){return{kind:"SelectionNode",selection:this.transformNode(t.selection,r)}}transformColumn(t,r){return{kind:"ColumnNode",column:this.transformNode(t.column,r)}}transformAlias(t,r){return{kind:"AliasNode",node:this.transformNode(t.node,r),alias:this.transformNode(t.alias,r)}}transformTable(t,r){return{kind:"TableNode",table:this.transformNode(t.table,r)}}transformFrom(t,r){return{kind:"FromNode",froms:this.transformNodeList(t.froms,r)}}transformReference(t,r){return{kind:"ReferenceNode",column:this.transformNode(t.column,r),table:this.transformNode(t.table,r)}}transformAnd(t,r){return{kind:"AndNode",left:this.transformNode(t.left,r),right:this.transformNode(t.right,r)}}transformOr(t,r){return{kind:"OrNode",left:this.transformNode(t.left,r),right:this.transformNode(t.right,r)}}transformValueList(t,r){return{kind:"ValueListNode",values:this.transformNodeList(t.values,r)}}transformParens(t,r){return{kind:"ParensNode",node:this.transformNode(t.node,r)}}transformJoin(t,r){return{kind:"JoinNode",joinType:t.joinType,table:this.transformNode(t.table,r),on:this.transformNode(t.on,r)}}transformRaw(t,r){return{kind:"RawNode",sqlFragments:f([...t.sqlFragments]),parameters:this.transformNodeList(t.parameters,r)}}transformWhere(t,r){return{kind:"WhereNode",where:this.transformNode(t.where,r)}}transformInsertQuery(t,r){return{kind:"InsertQueryNode",into:this.transformNode(t.into,r),columns:this.transformNodeList(t.columns,r),values:this.transformNode(t.values,r),returning:this.transformNode(t.returning,r),onConflict:this.transformNode(t.onConflict,r),onDuplicateKey:this.transformNode(t.onDuplicateKey,r),endModifiers:this.transformNodeList(t.endModifiers,r),with:this.transformNode(t.with,r),ignore:t.ignore,orAction:this.transformNode(t.orAction,r),replace:t.replace,explain:this.transformNode(t.explain,r),defaultValues:t.defaultValues,top:this.transformNode(t.top,r),output:this.transformNode(t.output,r)}}transformValues(t,r){return{kind:"ValuesNode",values:this.transformNodeList(t.values,r)}}transformDeleteQuery(t,r){return{kind:"DeleteQueryNode",from:this.transformNode(t.from,r),using:this.transformNode(t.using,r),joins:this.transformNodeList(t.joins,r),where:this.transformNode(t.where,r),returning:this.transformNode(t.returning,r),endModifiers:this.transformNodeList(t.endModifiers,r),with:this.transformNode(t.with,r),orderBy:this.transformNode(t.orderBy,r),limit:this.transformNode(t.limit,r),explain:this.transformNode(t.explain,r),top:this.transformNode(t.top,r),output:this.transformNode(t.output,r)}}transformReturning(t,r){return{kind:"ReturningNode",selections:this.transformNodeList(t.selections,r)}}transformCreateTable(t,r){return{kind:"CreateTableNode",table:this.transformNode(t.table,r),columns:this.transformNodeList(t.columns,r),constraints:this.transformNodeList(t.constraints,r),temporary:t.temporary,ifNotExists:t.ifNotExists,onCommit:t.onCommit,frontModifiers:this.transformNodeList(t.frontModifiers,r),endModifiers:this.transformNodeList(t.endModifiers,r),selectQuery:this.transformNode(t.selectQuery,r)}}transformColumnDefinition(t,r){return{kind:"ColumnDefinitionNode",column:this.transformNode(t.column,r),dataType:this.transformNode(t.dataType,r),references:this.transformNode(t.references,r),primaryKey:t.primaryKey,autoIncrement:t.autoIncrement,unique:t.unique,notNull:t.notNull,unsigned:t.unsigned,defaultTo:this.transformNode(t.defaultTo,r),check:this.transformNode(t.check,r),generated:this.transformNode(t.generated,r),frontModifiers:this.transformNodeList(t.frontModifiers,r),endModifiers:this.transformNodeList(t.endModifiers,r),nullsNotDistinct:t.nullsNotDistinct,identity:t.identity,ifNotExists:t.ifNotExists}}transformAddColumn(t,r){return{kind:"AddColumnNode",column:this.transformNode(t.column,r)}}transformDropTable(t,r){return{kind:"DropTableNode",table:this.transformNode(t.table,r),ifExists:t.ifExists,cascade:t.cascade}}transformOrderBy(t,r){return{kind:"OrderByNode",items:this.transformNodeList(t.items,r)}}transformOrderByItem(t,r){return{kind:"OrderByItemNode",orderBy:this.transformNode(t.orderBy,r),direction:this.transformNode(t.direction,r),collation:this.transformNode(t.collation,r),nulls:t.nulls}}transformGroupBy(t,r){return{kind:"GroupByNode",items:this.transformNodeList(t.items,r)}}transformGroupByItem(t,r){return{kind:"GroupByItemNode",groupBy:this.transformNode(t.groupBy,r)}}transformUpdateQuery(t,r){return{kind:"UpdateQueryNode",table:this.transformNode(t.table,r),from:this.transformNode(t.from,r),joins:this.transformNodeList(t.joins,r),where:this.transformNode(t.where,r),updates:this.transformNodeList(t.updates,r),returning:this.transformNode(t.returning,r),endModifiers:this.transformNodeList(t.endModifiers,r),with:this.transformNode(t.with,r),explain:this.transformNode(t.explain,r),limit:this.transformNode(t.limit,r),top:this.transformNode(t.top,r),output:this.transformNode(t.output,r),orderBy:this.transformNode(t.orderBy,r)}}transformColumnUpdate(t,r){return{kind:"ColumnUpdateNode",column:this.transformNode(t.column,r),value:this.transformNode(t.value,r)}}transformLimit(t,r){return{kind:"LimitNode",limit:this.transformNode(t.limit,r)}}transformOffset(t,r){return{kind:"OffsetNode",offset:this.transformNode(t.offset,r)}}transformOnConflict(t,r){return{kind:"OnConflictNode",columns:this.transformNodeList(t.columns,r),constraint:this.transformNode(t.constraint,r),indexExpression:this.transformNode(t.indexExpression,r),indexWhere:this.transformNode(t.indexWhere,r),updates:this.transformNodeList(t.updates,r),updateWhere:this.transformNode(t.updateWhere,r),doNothing:t.doNothing}}transformOnDuplicateKey(t,r){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(t.updates,r)}}transformCreateIndex(t,r){return{kind:"CreateIndexNode",name:this.transformNode(t.name,r),table:this.transformNode(t.table,r),columns:this.transformNodeList(t.columns,r),unique:t.unique,using:this.transformNode(t.using,r),ifNotExists:t.ifNotExists,where:this.transformNode(t.where,r),nullsNotDistinct:t.nullsNotDistinct}}transformList(t,r){return{kind:"ListNode",items:this.transformNodeList(t.items,r)}}transformDropIndex(t,r){return{kind:"DropIndexNode",name:this.transformNode(t.name,r),table:this.transformNode(t.table,r),ifExists:t.ifExists,cascade:t.cascade}}transformPrimaryKeyConstraint(t,r){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(t.columns,r),name:this.transformNode(t.name,r),deferrable:t.deferrable,initiallyDeferred:t.initiallyDeferred}}transformUniqueConstraint(t,r){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(t.columns,r),name:this.transformNode(t.name,r),nullsNotDistinct:t.nullsNotDistinct,deferrable:t.deferrable,initiallyDeferred:t.initiallyDeferred}}transformForeignKeyConstraint(t,r){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(t.columns,r),references:this.transformNode(t.references,r),name:this.transformNode(t.name,r),onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable,initiallyDeferred:t.initiallyDeferred}}transformSetOperation(t,r){return{kind:"SetOperationNode",operator:t.operator,expression:this.transformNode(t.expression,r),all:t.all}}transformReferences(t,r){return{kind:"ReferencesNode",table:this.transformNode(t.table,r),columns:this.transformNodeList(t.columns,r),onDelete:t.onDelete,onUpdate:t.onUpdate}}transformCheckConstraint(t,r){return{kind:"CheckConstraintNode",expression:this.transformNode(t.expression,r),name:this.transformNode(t.name,r)}}transformWith(t,r){return{kind:"WithNode",expressions:this.transformNodeList(t.expressions,r),recursive:t.recursive}}transformCommonTableExpression(t,r){return{kind:"CommonTableExpressionNode",name:this.transformNode(t.name,r),materialized:t.materialized,expression:this.transformNode(t.expression,r)}}transformCommonTableExpressionName(t,r){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(t.table,r),columns:this.transformNodeList(t.columns,r)}}transformHaving(t,r){return{kind:"HavingNode",having:this.transformNode(t.having,r)}}transformCreateSchema(t,r){return{kind:"CreateSchemaNode",schema:this.transformNode(t.schema,r),ifNotExists:t.ifNotExists}}transformDropSchema(t,r){return{kind:"DropSchemaNode",schema:this.transformNode(t.schema,r),ifExists:t.ifExists,cascade:t.cascade}}transformAlterTable(t,r){return{kind:"AlterTableNode",table:this.transformNode(t.table,r),renameTo:this.transformNode(t.renameTo,r),setSchema:this.transformNode(t.setSchema,r),columnAlterations:this.transformNodeList(t.columnAlterations,r),addConstraint:this.transformNode(t.addConstraint,r),dropConstraint:this.transformNode(t.dropConstraint,r),renameConstraint:this.transformNode(t.renameConstraint,r),addIndex:this.transformNode(t.addIndex,r),dropIndex:this.transformNode(t.dropIndex,r)}}transformDropColumn(t,r){return{kind:"DropColumnNode",column:this.transformNode(t.column,r)}}transformRenameColumn(t,r){return{kind:"RenameColumnNode",column:this.transformNode(t.column,r),renameTo:this.transformNode(t.renameTo,r)}}transformAlterColumn(t,r){return{kind:"AlterColumnNode",column:this.transformNode(t.column,r),dataType:this.transformNode(t.dataType,r),dataTypeExpression:this.transformNode(t.dataTypeExpression,r),setDefault:this.transformNode(t.setDefault,r),dropDefault:t.dropDefault,setNotNull:t.setNotNull,dropNotNull:t.dropNotNull}}transformModifyColumn(t,r){return{kind:"ModifyColumnNode",column:this.transformNode(t.column,r)}}transformAddConstraint(t,r){return{kind:"AddConstraintNode",constraint:this.transformNode(t.constraint,r)}}transformDropConstraint(t,r){return{kind:"DropConstraintNode",constraintName:this.transformNode(t.constraintName,r),ifExists:t.ifExists,modifier:t.modifier}}transformRenameConstraint(t,r){return{kind:"RenameConstraintNode",oldName:this.transformNode(t.oldName,r),newName:this.transformNode(t.newName,r)}}transformCreateView(t,r){return{kind:"CreateViewNode",name:this.transformNode(t.name,r),temporary:t.temporary,orReplace:t.orReplace,ifNotExists:t.ifNotExists,materialized:t.materialized,columns:this.transformNodeList(t.columns,r),as:this.transformNode(t.as,r)}}transformRefreshMaterializedView(t,r){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(t.name,r),concurrently:t.concurrently,withNoData:t.withNoData}}transformDropView(t,r){return{kind:"DropViewNode",name:this.transformNode(t.name,r),ifExists:t.ifExists,materialized:t.materialized,cascade:t.cascade}}transformGenerated(t,r){return{kind:"GeneratedNode",byDefault:t.byDefault,always:t.always,identity:t.identity,stored:t.stored,expression:this.transformNode(t.expression,r)}}transformDefaultValue(t,r){return{kind:"DefaultValueNode",defaultValue:this.transformNode(t.defaultValue,r)}}transformOn(t,r){return{kind:"OnNode",on:this.transformNode(t.on,r)}}transformSelectModifier(t,r){return{kind:"SelectModifierNode",modifier:t.modifier,rawModifier:this.transformNode(t.rawModifier,r),of:this.transformNodeList(t.of,r)}}transformCreateType(t,r){return{kind:"CreateTypeNode",name:this.transformNode(t.name,r),enum:this.transformNode(t.enum,r)}}transformDropType(t,r){return{kind:"DropTypeNode",name:this.transformNode(t.name,r),ifExists:t.ifExists}}transformExplain(t,r){return{kind:"ExplainNode",format:t.format,options:this.transformNode(t.options,r)}}transformSchemableIdentifier(t,r){return{kind:"SchemableIdentifierNode",schema:this.transformNode(t.schema,r),identifier:this.transformNode(t.identifier,r)}}transformAggregateFunction(t,r){return{kind:"AggregateFunctionNode",func:t.func,aggregated:this.transformNodeList(t.aggregated,r),distinct:t.distinct,orderBy:this.transformNode(t.orderBy,r),withinGroup:this.transformNode(t.withinGroup,r),filter:this.transformNode(t.filter,r),over:this.transformNode(t.over,r)}}transformOver(t,r){return{kind:"OverNode",orderBy:this.transformNode(t.orderBy,r),partitionBy:this.transformNode(t.partitionBy,r)}}transformPartitionBy(t,r){return{kind:"PartitionByNode",items:this.transformNodeList(t.items,r)}}transformPartitionByItem(t,r){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(t.partitionBy,r)}}transformBinaryOperation(t,r){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(t.leftOperand,r),operator:this.transformNode(t.operator,r),rightOperand:this.transformNode(t.rightOperand,r)}}transformUnaryOperation(t,r){return{kind:"UnaryOperationNode",operator:this.transformNode(t.operator,r),operand:this.transformNode(t.operand,r)}}transformUsing(t,r){return{kind:"UsingNode",tables:this.transformNodeList(t.tables,r)}}transformFunction(t,r){return{kind:"FunctionNode",func:t.func,arguments:this.transformNodeList(t.arguments,r)}}transformCase(t,r){return{kind:"CaseNode",value:this.transformNode(t.value,r),when:this.transformNodeList(t.when,r),else:this.transformNode(t.else,r),isStatement:t.isStatement}}transformWhen(t,r){return{kind:"WhenNode",condition:this.transformNode(t.condition,r),result:this.transformNode(t.result,r)}}transformJSONReference(t,r){return{kind:"JSONReferenceNode",reference:this.transformNode(t.reference,r),traversal:this.transformNode(t.traversal,r)}}transformJSONPath(t,r){return{kind:"JSONPathNode",inOperator:this.transformNode(t.inOperator,r),pathLegs:this.transformNodeList(t.pathLegs,r)}}transformJSONPathLeg(t,r){return{kind:"JSONPathLegNode",type:t.type,value:t.value}}transformJSONOperatorChain(t,r){return{kind:"JSONOperatorChainNode",operator:this.transformNode(t.operator,r),values:this.transformNodeList(t.values,r)}}transformTuple(t,r){return{kind:"TupleNode",values:this.transformNodeList(t.values,r)}}transformMergeQuery(t,r){return{kind:"MergeQueryNode",into:this.transformNode(t.into,r),using:this.transformNode(t.using,r),whens:this.transformNodeList(t.whens,r),with:this.transformNode(t.with,r),top:this.transformNode(t.top,r),endModifiers:this.transformNodeList(t.endModifiers,r),output:this.transformNode(t.output,r),returning:this.transformNode(t.returning,r)}}transformMatched(t,r){return{kind:"MatchedNode",not:t.not,bySource:t.bySource}}transformAddIndex(t,r){return{kind:"AddIndexNode",name:this.transformNode(t.name,r),columns:this.transformNodeList(t.columns,r),unique:t.unique,using:this.transformNode(t.using,r),ifNotExists:t.ifNotExists}}transformCast(t,r){return{kind:"CastNode",expression:this.transformNode(t.expression,r),dataType:this.transformNode(t.dataType,r)}}transformFetch(t,r){return{kind:"FetchNode",rowCount:this.transformNode(t.rowCount,r),modifier:t.modifier}}transformTop(t,r){return{kind:"TopNode",expression:t.expression,modifiers:t.modifiers}}transformOutput(t,r){return{kind:"OutputNode",selections:this.transformNodeList(t.selections,r)}}transformDataType(t,r){return t}transformSelectAll(t,r){return t}transformIdentifier(t,r){return t}transformValue(t,r){return t}transformPrimitiveValueList(t,r){return t}transformOperator(t,r){return t}transformDefaultInsertValue(t,r){return t}transformOrAction(t,r){return t}transformCollate(t,r){return t}}const JC=f({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),GC={json_agg:!0,to_json:!0};class QC extends wy{#e;#t=new Set;#r=new Set;constructor(t){super(),this.#e=t}transformNodeImpl(t,r){if(!this.#s(t))return super.transformNodeImpl(t,r);const n=this.#c(t);for(const o of n)this.#r.add(o);const s=this.#i(t);for(const o of s)this.#t.add(o);const i=super.transformNodeImpl(t,r);for(const o of s)this.#t.delete(o);for(const o of n)this.#r.delete(o);return i}transformSchemableIdentifier(t,r){const n=super.transformSchemableIdentifier(t,r);return n.schema||!this.#t.has(t.identifier.name)?n:{...n,schema:ae.create(this.#e)}}transformReferences(t,r){const n=super.transformReferences(t,r);return n.table.table.schema?n:{...n,table:Sr.createWithSchema(this.#e,n.table.table.identifier.name)}}transformAggregateFunction(t,r){return{...super.transformAggregateFunction({...t,aggregated:[]},r),aggregated:this.#n(t,r,"aggregated")}}transformFunction(t,r){return{...super.transformFunction({...t,arguments:[]},r),arguments:this.#n(t,r,"arguments")}}#n(t,r,n){return GC[t.func]?t[n].map(s=>!Sr.is(s)||s.table.schema?this.transformNode(s,r):{...s,table:this.transformIdentifier(s.table.identifier,r)}):this.transformNodeList(t[n],r)}#s(t){return t.kind in JC}#i(t){const r=new Set;if("name"in t&&t.name&&xr.is(t.name)&&this.#o(t.name,r),"from"in t&&t.from)for(const n of t.from.froms)this.#a(n,r);if("into"in t&&t.into&&this.#a(t.into,r),"table"in t&&t.table&&this.#a(t.table,r),"joins"in t&&t.joins)for(const n of t.joins)this.#a(n.table,r);return"using"in t&&t.using&&(Tn.is(t.using)?this.#a(t.using.table,r):this.#a(t.using,r)),r}#c(t){const r=new Set;return"with"in t&&t.with&&this.#u(t.with,r),r}#a(t,r){if(Sr.is(t))this.#o(t.table,r);else if(Pr.is(t)&&Sr.is(t.node))this.#o(t.node.table,r);else if(ly.is(t))for(const n of t.items)this.#a(n,r)}#o(t,r){const n=t.identifier.name;!this.#t.has(n)&&!this.#r.has(n)&&r.add(n)}#u(t,r){for(const n of t.expressions){const s=n.name.table.table.identifier.name;this.#r.has(s)||r.add(s)}}}class Ps{#e;constructor(t){this.#e=new QC(t)}transformQuery(t){return this.#e.transformNode(t.node,t.queryId)}async transformResult(t){return t.result}}const YC=f({is(e){return e.kind==="MatchedNode"},create(e,t=!1){return f({kind:"MatchedNode",not:e,bySource:t})}});function ip(e,t,r){return Cn.create(Co([YC.create(!e.isMatched,e.bySource),...t&&t.length>0?[t.length===3&&r?mr(t[0],t[1],t[2]):it(t)]:[]],"and",!1))}function ni(e){return st(e)?Re.create([e],[]):pt(e)?e.toOperationNode():e}class si{#e;#t;#r;constructor(){this.#e=new Promise((t,r)=>{this.#r=r,this.#t=t})}get promise(){return this.#e}resolve=t=>{this.#t&&this.#t(t)};reject=t=>{this.#r&&this.#r(t)}}async function yy(e){const t=new si,r=new si;return e.provideConnection(async n=>(t.resolve(n),await r.promise)).catch(n=>t.reject(n)),f({connection:await t.promise,release:r.resolve})}const XC=f([]);class gy{#e;constructor(t=XC){this.#e=t}get plugins(){return this.#e}transformQuery(t,r){for(const n of this.#e){const s=n.transformQuery({node:t,queryId:r});if(s.kind===t.kind)t=s;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${t.kind}`,`but it returned a ${s.kind}`].join(" "))}return t}async executeQuery(t){return await this.provideConnection(async r=>{const n=await r.executeQuery(t);return"numUpdatedOrDeletedRows"in n&&xs("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#t(n,t.queryId)})}async*stream(t,r){const{connection:n,release:s}=await yy(this);try{for await(const i of n.streamQuery(t,r))yield await this.#t(i,t.queryId)}finally{s()}}async#t(t,r){for(const n of this.#e)t=await n.transformResult({result:t,queryId:r});return t}}class ls extends gy{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(t){return new ls([...this.plugins,t])}withPlugins(t){return new ls([...this.plugins,...t])}withPluginAtFront(t){return new ls([t,...this.plugins])}withoutPlugins(){return new ls([])}}const _a=new ls;class ex{numChangedRows;constructor(t){this.numChangedRows=t}}class jr{#e;constructor(t){this.#e=f(t)}modifyEnd(t){return new jr({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,t.toOperationNode())})}top(t,r){return new jr({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}using(...t){return new bt({...this.#e,queryNode:hr.cloneWithUsing(this.#e.queryNode,Na("Using",t))})}returning(t){return new jr({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,zt(t))})}returningAll(t){return new jr({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,Bt(t))})}output(t){return new jr({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,zt(t))})}outputAll(t){return new jr({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,Bt(t))})}}class bt{#e;constructor(t){this.#e=f(t)}modifyEnd(t){return new bt({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,t.toOperationNode())})}top(t,r){return new bt({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}whenMatched(){return this.#t([])}whenMatchedAnd(...t){return this.#t(t)}whenMatchedAndRef(t,r,n){return this.#t([t,r,n],!0)}#t(t,r){return new op({...this.#e,queryNode:hr.cloneWithWhen(this.#e.queryNode,ip({isMatched:!0},t,r))})}whenNotMatched(){return this.#r([])}whenNotMatchedAnd(...t){return this.#r(t)}whenNotMatchedAndRef(t,r,n){return this.#r([t,r,n],!0)}whenNotMatchedBySource(){return this.#r([],!1,!0)}whenNotMatchedBySourceAnd(...t){return this.#r(t,!1,!0)}whenNotMatchedBySourceAndRef(t,r,n){return this.#r([t,r,n],!0,!0)}returning(t){return new bt({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,zt(t))})}returningAll(t){return new bt({...this.#e,queryNode:Z.cloneWithReturning(this.#e.queryNode,Bt(t))})}output(t){return new bt({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,zt(t))})}outputAll(t){return new bt({...this.#e,queryNode:Z.cloneWithOutput(this.#e.queryNode,Bt(t))})}#r(t,r=!1,n=!1){const s={...this.#e,queryNode:hr.cloneWithWhen(this.#e.queryNode,ip({isMatched:!1,bySource:n},t,r))},i=n?op:tx;return new i(s)}$call(t){return t(this)}$if(t,r){return t?r(this):new bt({...this.#e})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const t=this.compile(),r=await this.#e.executor.executeQuery(t),{adapter:n}=this.#e.executor,s=t.query;return s.returning&&n.supportsReturning||s.output&&n.supportsOutput?r.rows:[new ex(r.numAffectedRows)]}async executeTakeFirst(){const[t]=await this.execute();return t}async executeTakeFirstOrThrow(t=Ti){const r=await this.executeTakeFirst();if(r===void 0)throw Si(t)?new t(this.toOperationNode()):t(this.toOperationNode());return r}}class op{#e;constructor(t){this.#e=f(t)}thenDelete(){return new bt({...this.#e,queryNode:hr.cloneWithThen(this.#e.queryNode,ni("delete"))})}thenDoNothing(){return new bt({...this.#e,queryNode:hr.cloneWithThen(this.#e.queryNode,ni("do nothing"))})}thenUpdate(t){return new bt({...this.#e,queryNode:hr.cloneWithThen(this.#e.queryNode,ni(t(new ge({queryId:this.#e.queryId,executor:_a,queryNode:bs.createWithoutTable()}))))})}thenUpdateSet(...t){return this.thenUpdate(r=>r.set(...t))}}class tx{#e;constructor(t){this.#e=f(t)}thenDoNothing(){return new bt({...this.#e,queryNode:hr.cloneWithThen(this.#e.queryNode,ni("do nothing"))})}thenInsertValues(t){const[r,n]=hy(t);return new bt({...this.#e,queryNode:hr.cloneWithThen(this.#e.queryNode,ni(Xe.cloneWith(Xe.createWithoutInto(),{columns:r,values:n})))})}}class Hr{#e;constructor(t){this.#e=f(t)}selectFrom(t){return vu({queryId:re(),executor:this.#e.executor,queryNode:pe.createFrom(vs(t),this.#e.withNode)})}selectNoFrom(t){return vu({queryId:re(),executor:this.#e.executor,queryNode:pe.cloneWithSelections(pe.create(this.#e.withNode),zt(t))})}insertInto(t){return new ce({queryId:re(),executor:this.#e.executor,queryNode:Xe.create(je(t),this.#e.withNode)})}replaceInto(t){return new ce({queryId:re(),executor:this.#e.executor,queryNode:Xe.create(je(t),this.#e.withNode,!0)})}deleteFrom(t){return new Te({queryId:re(),executor:this.#e.executor,queryNode:Ys.create(vs(t),this.#e.withNode)})}updateTable(t){return new ge({queryId:re(),executor:this.#e.executor,queryNode:bs.create(vs(t),this.#e.withNode)})}mergeInto(t){return new jr({queryId:re(),executor:this.#e.executor,queryNode:hr.create(Ay(t),this.#e.withNode)})}with(t,r){const n=np(t,r);return new Hr({...this.#e,withNode:this.#e.withNode?Ki.cloneWithExpression(this.#e.withNode,n):Ki.create(n)})}withRecursive(t,r){const n=np(t,r);return new Hr({...this.#e,withNode:this.#e.withNode?Ki.cloneWithExpression(this.#e.withNode,n):Ki.create(n,{recursive:!0})})}withPlugin(t){return new Hr({...this.#e,executor:this.#e.executor.withPlugin(t)})}withoutPlugins(){return new Hr({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(t){return new Hr({...this.#e,executor:this.#e.executor.withPluginAtFront(new Ps(t))})}}function rx(){return new Hr({executor:_a})}function nx(e,t){return new Xs({joinNode:Tn.create(e,vi(t))})}function sx(){return new ei({overNode:bu.create()})}function Na(e,t){if(t.length===3)return ox(e,t[0],t[1],t[2]);if(t.length===2)return ix(e,t[0],t[1]);if(t.length===1)return ax(e,t[0]);throw new Error("not implemented")}function ix(e,t,r){return r(nx(e,t)).toOperationNode()}function ox(e,t,r,n){return Tn.createWithOn(e,vi(t),mr(r,"=",n))}function ax(e,t){return Tn.create(e,vi(t))}const cx=f({is(e){return e.kind==="OffsetNode"},create(e){return f({kind:"OffsetNode",offset:e})}}),ux=f({is(e){return e.kind==="GroupByItemNode"},create(e){return f({kind:"GroupByItemNode",groupBy:e})}});function dx(e){return e=lt(e)?e(Ds()):e,gi(e).map(ux.create)}const by=f({is(e){return e.kind==="SetOperationNode"},create(e,t,r){return f({kind:"SetOperationNode",operator:e,expression:t,all:r})}});function es(e,t,r){return lt(t)&&(t=t(xd())),Cr(t)||(t=[t]),t.map(n=>by.create(e,Fn(n),r))}class ue{#e;constructor(t){this.#e=t}get expressionType(){}as(t){return new Cd(this,t)}or(...t){return new Do(Cs.create(this.#e,it(t)))}and(...t){return new Lo(rn.create(this.#e,it(t)))}$castTo(){return new ue(this.#e)}$notNull(){return new ue(this.#e)}toOperationNode(){return this.#e}}class Cd{#e;#t;constructor(t,r){this.#e=t,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return Pr.create(this.#e.toOperationNode(),pt(this.#t)?this.#t.toOperationNode():ae.create(this.#t))}}class Do{#e;constructor(t){this.#e=t}get expressionType(){}as(t){return new Cd(this,t)}or(...t){return new Do(Cs.create(this.#e,it(t)))}$castTo(){return new Do(this.#e)}toOperationNode(){return Rr.create(this.#e)}}class Lo{#e;constructor(t){this.#e=t}get expressionType(){}as(t){return new Cd(this,t)}and(...t){return new Lo(rn.create(this.#e,it(t)))}$castTo(){return new Lo(this.#e)}toOperationNode(){return Rr.create(this.#e)}}const lx={is(e){return e.kind==="FetchNode"},create(e,t){return{kind:"FetchNode",rowCount:Zt.create(e),modifier:t}}};function hx(e,t){if(!ks(e)&&!ba(e))throw new Error(`Invalid fetch row count: ${e}`);if(!fx(t))throw new Error(`Invalid fetch modifier: ${t}`);return lx.create(e,t)}function fx(e){return e==="only"||e==="with ties"}class ee{#e;constructor(t){this.#e=f(t)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...t){return new ee({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,it(t))})}whereRef(t,r,n){return new ee({...this.#e,queryNode:Z.cloneWithWhere(this.#e.queryNode,mr(t,r,n))})}having(...t){return new ee({...this.#e,queryNode:pe.cloneWithHaving(this.#e.queryNode,it(t))})}havingRef(t,r,n){return new ee({...this.#e,queryNode:pe.cloneWithHaving(this.#e.queryNode,mr(t,r,n))})}select(t){return new ee({...this.#e,queryNode:pe.cloneWithSelections(this.#e.queryNode,zt(t))})}distinctOn(t){return new ee({...this.#e,queryNode:pe.cloneWithDistinctOn(this.#e.queryNode,gi(t))})}modifyFront(t){return new ee({...this.#e,queryNode:pe.cloneWithFrontModifier(this.#e.queryNode,gr.createWithExpression(t.toOperationNode()))})}modifyEnd(t){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.createWithExpression(t.toOperationNode()))})}distinct(){return new ee({...this.#e,queryNode:pe.cloneWithFrontModifier(this.#e.queryNode,gr.create("Distinct"))})}forUpdate(t){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("ForUpdate",t?Hi(t).map(je):void 0))})}forShare(t){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("ForShare",t?Hi(t).map(je):void 0))})}forKeyShare(t){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("ForKeyShare",t?Hi(t).map(je):void 0))})}forNoKeyUpdate(t){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("ForNoKeyUpdate",t?Hi(t).map(je):void 0))})}skipLocked(){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("SkipLocked"))})}noWait(){return new ee({...this.#e,queryNode:Z.cloneWithEndModifier(this.#e.queryNode,gr.create("NoWait"))})}selectAll(t){return new ee({...this.#e,queryNode:pe.cloneWithSelections(this.#e.queryNode,Bt(t))})}innerJoin(...t){return this.#t("InnerJoin",t)}leftJoin(...t){return this.#t("LeftJoin",t)}rightJoin(...t){return this.#t("RightJoin",t)}fullJoin(...t){return this.#t("FullJoin",t)}crossJoin(...t){return this.#t("CrossJoin",t)}innerJoinLateral(...t){return this.#t("LateralInnerJoin",t)}leftJoinLateral(...t){return this.#t("LateralLeftJoin",t)}crossJoinLateral(...t){return this.#t("LateralCrossJoin",t)}crossApply(...t){return this.#t("CrossApply",t)}outerApply(...t){return this.#t("OuterApply",t)}#t(t,r){return new ee({...this.#e,queryNode:Z.cloneWithJoin(this.#e.queryNode,Na(t,r))})}orderBy(...t){return new ee({...this.#e,queryNode:Z.cloneWithOrderByItems(this.#e.queryNode,$n(t))})}groupBy(t){return new ee({...this.#e,queryNode:pe.cloneWithGroupByItems(this.#e.queryNode,dx(t))})}limit(t){return new ee({...this.#e,queryNode:pe.cloneWithLimit(this.#e.queryNode,$d.create(Be(t)))})}offset(t){return new ee({...this.#e,queryNode:pe.cloneWithOffset(this.#e.queryNode,cx.create(Be(t)))})}fetch(t,r="only"){return new ee({...this.#e,queryNode:pe.cloneWithFetch(this.#e.queryNode,hx(t,r))})}top(t,r){return new ee({...this.#e,queryNode:Z.cloneWithTop(this.#e.queryNode,Us(t,r))})}union(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("union",t,!1))})}unionAll(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("union",t,!0))})}intersect(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("intersect",t,!1))})}intersectAll(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("intersect",t,!0))})}except(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("except",t,!1))})}exceptAll(t){return new ee({...this.#e,queryNode:pe.cloneWithSetOperations(this.#e.queryNode,es("except",t,!0))})}as(t){return new px(this,t)}clearSelect(){return new ee({...this.#e,queryNode:pe.cloneWithoutSelections(this.#e.queryNode)})}clearWhere(){return new ee({...this.#e,queryNode:Z.cloneWithoutWhere(this.#e.queryNode)})}clearLimit(){return new ee({...this.#e,queryNode:pe.cloneWithoutLimit(this.#e.queryNode)})}clearOffset(){return new ee({...this.#e,queryNode:pe.cloneWithoutOffset(this.#e.queryNode)})}clearOrderBy(){return new ee({...this.#e,queryNode:Z.cloneWithoutOrderBy(this.#e.queryNode)})}clearGroupBy(){return new ee({...this.#e,queryNode:pe.cloneWithoutGroupBy(this.#e.queryNode)})}$call(t){return t(this)}$if(t,r){return t?r(this):new ee({...this.#e})}$castTo(){return new ee(this.#e)}$narrowType(){return new ee(this.#e)}$assertType(){return new ee(this.#e)}$asTuple(){return new ue(this.toOperationNode())}$asScalar(){return new ue(this.toOperationNode())}withPlugin(t){return new ee({...this.#e,executor:this.#e.executor.withPlugin(t)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const t=this.compile();return(await this.#e.executor.executeQuery(t)).rows}async executeTakeFirst(){const[t]=await this.execute();return t}async executeTakeFirstOrThrow(t=Ti){const r=await this.executeTakeFirst();if(r===void 0)throw Si(t)?new t(this.toOperationNode()):t(this.toOperationNode());return r}async*stream(t=100){const r=this.compile(),n=this.#e.executor.stream(r,t);for await(const s of n)yield*s.rows}async explain(t,r){return await new ee({...this.#e,queryNode:Z.cloneWithExplain(this.#e.queryNode,t,r)}).execute()}}function vu(e){return new ee(e)}class px{#e;#t;constructor(t,r){this.#e=t,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Pr.create(this.#e.toOperationNode(),ae.create(this.#t))}}const Kr=f({is(e){return e.kind==="AggregateFunctionNode"},create(e,t=[]){return f({kind:"AggregateFunctionNode",func:e,aggregated:t})},cloneWithDistinct(e){return f({...e,distinct:!0})},cloneWithOrderBy(e,t,r=!1){const n=r?"withinGroup":"orderBy";return f({...e,[n]:e[n]?Ss.cloneWithItems(e[n],t):Ss.create(t)})},cloneWithFilter(e,t){return f({...e,filter:e.filter?wt.cloneWithOperation(e.filter,"And",t):wt.create(t)})},cloneWithOrFilter(e,t){return f({...e,filter:e.filter?wt.cloneWithOperation(e.filter,"Or",t):wt.create(t)})},cloneWithOver(e,t){return f({...e,over:t})}}),ap=f({is(e){return e.kind==="FunctionNode"},create(e,t){return f({kind:"FunctionNode",func:e,arguments:t})}});class $t{#e;constructor(t){this.#e=f(t)}get expressionType(){}as(t){return new mx(this,t)}distinct(){return new $t({...this.#e,aggregateFunctionNode:Kr.cloneWithDistinct(this.#e.aggregateFunctionNode)})}orderBy(...t){return new $t({...this.#e,aggregateFunctionNode:Z.cloneWithOrderByItems(this.#e.aggregateFunctionNode,$n(t))})}clearOrderBy(){return new $t({...this.#e,aggregateFunctionNode:Z.cloneWithoutOrderBy(this.#e.aggregateFunctionNode)})}withinGroupOrderBy(...t){return new $t({...this.#e,aggregateFunctionNode:Kr.cloneWithOrderBy(this.#e.aggregateFunctionNode,$n(t),!0)})}filterWhere(...t){return new $t({...this.#e,aggregateFunctionNode:Kr.cloneWithFilter(this.#e.aggregateFunctionNode,it(t))})}filterWhereRef(t,r,n){return new $t({...this.#e,aggregateFunctionNode:Kr.cloneWithFilter(this.#e.aggregateFunctionNode,mr(t,r,n))})}over(t){const r=sx();return new $t({...this.#e,aggregateFunctionNode:Kr.cloneWithOver(this.#e.aggregateFunctionNode,(t?t(r):r).toOperationNode())})}$call(t){return t(this)}$castTo(){return new $t(this.#e)}$notNull(){return new $t(this.#e)}toOperationNode(){return this.#e.aggregateFunctionNode}}class mx{#e;#t;constructor(t,r){this.#e=t,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return Pr.create(this.#e.toOperationNode(),ae.create(this.#t))}}function vy(){const e=(r,n)=>new ue(ap.create(r,gi(n??[]))),t=(r,n)=>new $t({aggregateFunctionNode:Kr.create(r,n?gi(n):void 0)});return Object.assign(e,{agg:t,avg(r){return t("avg",[r])},coalesce(...r){return e("coalesce",r)},count(r){return t("count",[r])},countAll(r){return new $t({aggregateFunctionNode:Kr.create("count",Bt(r))})},max(r){return t("max",[r])},min(r){return t("min",[r])},sum(r){return t("sum",[r])},any(r){return e("any",[r])},jsonAgg(r){return new $t({aggregateFunctionNode:Kr.create("json_agg",[st(r)?je(r):r.toOperationNode()])})},toJson(r){return new ue(ap.create("to_json",[st(r)?je(r):r.toOperationNode()]))}})}const wx=f({is(e){return e.kind==="UnaryOperationNode"},create(e,t){return f({kind:"UnaryOperationNode",operator:e,operand:t})}});function yx(e,t){return wx.create(nn.create(e),Dt(t))}const lr=f({is(e){return e.kind==="CaseNode"},create(e){return f({kind:"CaseNode",value:e})},cloneWithWhen(e,t){return f({...e,when:f(e.when?[...e.when,t]:[t])})},cloneWithThen(e,t){return f({...e,when:e.when?f([...e.when.slice(0,-1),Cn.cloneWithResult(e.when[e.when.length-1],t)]):void 0})},cloneWith(e,t){return f({...e,...t})}});class Ey{#e;constructor(t){this.#e=f(t)}when(...t){return new _y({...this.#e,node:lr.cloneWithWhen(this.#e.node,Cn.create(it(t)))})}}class _y{#e;constructor(t){this.#e=f(t)}then(t){return new gx({...this.#e,node:lr.cloneWithThen(this.#e.node,Sd(t)?Rd(t):Be(t))})}}class gx{#e;constructor(t){this.#e=f(t)}when(...t){return new _y({...this.#e,node:lr.cloneWithWhen(this.#e.node,Cn.create(it(t)))})}else(t){return new bx({...this.#e,node:lr.cloneWith(this.#e.node,{else:Sd(t)?Rd(t):Be(t)})})}end(){return new ue(lr.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new ue(lr.cloneWith(this.#e.node,{isStatement:!0}))}}class bx{#e;constructor(t){this.#e=f(t)}end(){return new ue(lr.cloneWith(this.#e.node,{isStatement:!1}))}endCase(){return new ue(lr.cloneWith(this.#e.node,{isStatement:!0}))}}const cp=f({is(e){return e.kind==="JSONPathLegNode"},create(e,t){return f({kind:"JSONPathLegNode",type:e,value:t})}});class Eu{#e;constructor(t){this.#e=t}at(t){return this.#t("ArrayLocation",t)}key(t){return this.#t("Member",t)}#t(t,r){return Oo.is(this.#e)?new bi(Oo.cloneWithTraversal(this.#e,Qs.is(this.#e.traversal)?Qs.cloneWithLeg(this.#e.traversal,cp.create(t,r)):oy.cloneWithValue(this.#e.traversal,Zt.createImmediate(r)))):new bi(Qs.cloneWithLeg(this.#e,cp.create(t,r)))}}class bi extends Eu{#e;constructor(t){super(t),this.#e=t}get expressionType(){}as(t){return new vx(this,t)}$castTo(){return new bi(this.#e)}$notNull(){return new bi(this.#e)}toOperationNode(){return this.#e}}class vx{#e;#t;constructor(t,r){this.#e=t,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}toOperationNode(){return Pr.create(this.#e.toOperationNode(),pt(this.#t)?this.#t.toOperationNode():ae.create(this.#t))}}const up=f({is(e){return e.kind==="TupleNode"},create(e){return f({kind:"TupleNode",values:f(e)})}}),Ex=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],_x=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],Nx=f({is(e){return e.kind==="DataTypeNode"},create(e){return f({kind:"DataTypeNode",dataType:e})}});function Ax(e){return!!(Ex.includes(e)||_x.some(t=>t.test(e)))}function xn(e){if(pt(e))return e.toOperationNode();if(Ax(e))return Nx.create(e);throw new Error(`invalid column data type ${JSON.stringify(e)}`)}const kx=f({is(e){return e.kind==="CastNode"},create(e,t){return f({kind:"CastNode",expression:e,dataType:t})}});function xd(e=_a){function t(s,i,o){return new ue(Id(s,i,o))}function r(s,i){return new ue(yx(s,i))}const n=Object.assign(t,{fn:void 0,eb:void 0,selectFrom(s){return vu({queryId:re(),executor:e,queryNode:pe.createFrom(vs(s))})},case(s){return new Ey({node:lr.create(Or(s)?void 0:Dt(s))})},ref(s,i){return Or(i)?new ue(Ur(s)):new Eu(NC(s,i))},jsonPath(){return new Eu(Qs.create())},table(s){return new ue(je(s))},val(s){return new ue(Be(s))},refTuple(...s){return new ue(up.create(s.map(Dt)))},tuple(...s){return new ue(up.create(s.map(Be)))},lit(s){return new ue(Rd(s))},unary:r,not(s){return r("not",s)},exists(s){return r("exists",s)},neg(s){return r("-",s)},between(s,i,o){return new ue(Ts.create(Dt(s),nn.create("between"),rn.create(Be(i),Be(o))))},betweenSymmetric(s,i,o){return new ue(Ts.create(Dt(s),nn.create("between symmetric"),rn.create(Be(i),Be(o))))},and(s){return Cr(s)?new ue(Co(s,"and")):new ue(Bf(s,"and"))},or(s){return Cr(s)?new ue(Co(s,"or")):new ue(Bf(s,"or"))},parens(...s){const i=it(s);return Rr.is(i)?new ue(i):new ue(Rr.create(i))},cast(s,i){return new ue(kx.create(Dt(s),xn(i)))},withSchema(s){return xd(e.withPluginAtFront(new Ps(s)))}});return n.fn=vy(),n.eb=n,n}function Ds(e){return xd()}function Fn(e){if(pt(e))return e.toOperationNode();if(lt(e))return e(Ds()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function Ny(e){if(pt(e))return e.toOperationNode();if(lt(e))return e(Ds()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function Ri(e){return ty(e)||fC(e)||lt(e)}class Tx{#e;get table(){return this.#e}constructor(t){this.#e=t}as(t){return new Sx(this.#e,t)}}class Sx{#e;#t;get table(){return this.#e}get alias(){return this.#t}constructor(t,r){this.#e=t,this.#t=r}toOperationNode(){return Pr.create(je(this.#e),ae.create(this.#t))}}function Rx(e){return Pt(e)&&pt(e)&&st(e.table)&&st(e.alias)}function vs(e){return Cr(e)?e.map(t=>vi(t)):[vi(e)]}function vi(e){return st(e)?Ay(e):Rx(e)?e.toOperationNode():Ny(e)}function Ay(e){const t=" as ";if(e.includes(t)){const[r,n]=e.split(t).map(ky);return Pr.create(je(r),ae.create(n))}else return je(e)}function je(e){if(e.includes(".")){const[r,n]=e.split(".").map(ky);return Sr.createWithSchema(r,n)}else return Sr.create(e)}function ky(e){return e.trim()}const Ty=f({is(e){return e.kind==="AddColumnNode"},create(e){return f({kind:"AddColumnNode",column:e})}}),Se=f({is(e){return e.kind==="ColumnDefinitionNode"},create(e,t){return f({kind:"ColumnDefinitionNode",column:Me.create(e),dataType:t})},cloneWithFrontModifier(e,t){return f({...e,frontModifiers:e.frontModifiers?f([...e.frontModifiers,t]):[t]})},cloneWithEndModifier(e,t){return f({...e,endModifiers:e.endModifiers?f([...e.endModifiers,t]):[t]})},cloneWith(e,t){return f({...e,...t})}}),Sy=f({is(e){return e.kind==="DropColumnNode"},create(e){return f({kind:"DropColumnNode",column:Me.create(e)})}}),Ry=f({is(e){return e.kind==="RenameColumnNode"},create(e,t){return f({kind:"RenameColumnNode",column:Me.create(e),renameTo:Me.create(t)})}}),Ud=f({is(e){return e.kind==="CheckConstraintNode"},create(e,t){return f({kind:"CheckConstraintNode",expression:e,name:t?ae.create(t):void 0})}}),Ix=["no action","restrict","cascade","set null","set default"],so=f({is(e){return e.kind==="ReferencesNode"},create(e,t){return f({kind:"ReferencesNode",table:e,columns:f([...t])})},cloneWithOnDelete(e,t){return f({...e,onDelete:t})},cloneWithOnUpdate(e,t){return f({...e,onUpdate:t})}});function Iy(e){return pt(e)?e.toOperationNode():Zt.createImmediate(e)}const Ji=f({is(e){return e.kind==="GeneratedNode"},create(e){return f({kind:"GeneratedNode",...e})},createWithExpression(e){return f({kind:"GeneratedNode",always:!0,expression:e})},cloneWith(e,t){return f({...e,...t})}}),Ox=f({is(e){return e.kind==="DefaultValueNode"},create(e){return f({kind:"DefaultValueNode",defaultValue:e})}});function zo(e){if(Ix.includes(e))return e;throw new Error(`invalid OnModifyForeignAction ${e}`)}class be{#e;constructor(t){this.#e=t}autoIncrement(){return new be(Se.cloneWith(this.#e,{autoIncrement:!0}))}identity(){return new be(Se.cloneWith(this.#e,{identity:!0}))}primaryKey(){return new be(Se.cloneWith(this.#e,{primaryKey:!0}))}references(t){const r=Ur(t);if(!r.table||kd.is(r.column))throw new Error(`invalid call references('${t}'). The reference must have format table.column or schema.table.column`);return new be(Se.cloneWith(this.#e,{references:so.create(r.table,[r.column])}))}onDelete(t){if(!this.#e.references)throw new Error("on delete constraint can only be added for foreign keys");return new be(Se.cloneWith(this.#e,{references:so.cloneWithOnDelete(this.#e.references,zo(t))}))}onUpdate(t){if(!this.#e.references)throw new Error("on update constraint can only be added for foreign keys");return new be(Se.cloneWith(this.#e,{references:so.cloneWithOnUpdate(this.#e.references,zo(t))}))}unique(){return new be(Se.cloneWith(this.#e,{unique:!0}))}notNull(){return new be(Se.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new be(Se.cloneWith(this.#e,{unsigned:!0}))}defaultTo(t){return new be(Se.cloneWith(this.#e,{defaultTo:Ox.create(Iy(t))}))}check(t){return new be(Se.cloneWith(this.#e,{check:Ud.create(t.toOperationNode())}))}generatedAlwaysAs(t){return new be(Se.cloneWith(this.#e,{generated:Ji.createWithExpression(t.toOperationNode())}))}generatedAlwaysAsIdentity(){return new be(Se.cloneWith(this.#e,{generated:Ji.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new be(Se.cloneWith(this.#e,{generated:Ji.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new be(Se.cloneWith(this.#e,{generated:Ji.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(t){return new be(Se.cloneWithFrontModifier(this.#e,t.toOperationNode()))}nullsNotDistinct(){return new be(Se.cloneWith(this.#e,{nullsNotDistinct:!0}))}ifNotExists(){return new be(Se.cloneWith(this.#e,{ifNotExists:!0}))}modifyEnd(t){return new be(Se.cloneWithEndModifier(this.#e,t.toOperationNode()))}$call(t){return t(this)}toOperationNode(){return this.#e}}const Oy=f({is(e){return e.kind==="ModifyColumnNode"},create(e){return f({kind:"ModifyColumnNode",column:e})}}),Wr=f({is(e){return e.kind==="ForeignKeyConstraintNode"},create(e,t,r,n){return f({kind:"ForeignKeyConstraintNode",columns:e,references:so.create(t,r),name:n?ae.create(n):void 0})},cloneWith(e,t){return f({...e,...t})}});class Ar{#e;constructor(t){this.#e=t}onDelete(t){return new Ar(Wr.cloneWith(this.#e,{onDelete:zo(t)}))}onUpdate(t){return new Ar(Wr.cloneWith(this.#e,{onUpdate:zo(t)}))}deferrable(){return new Ar(Wr.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new Ar(Wr.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new Ar(Wr.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new Ar(Wr.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(t){return t(this)}toOperationNode(){return this.#e}}const io=f({is(e){return e.kind==="AddConstraintNode"},create(e){return f({kind:"AddConstraintNode",constraint:e})}}),yn=f({is(e){return e.kind==="UniqueConstraintNode"},create(e,t,r){return f({kind:"UniqueConstraintNode",columns:f(e.map(Me.create)),name:t?ae.create(t):void 0,nullsNotDistinct:r})},cloneWith(e,t){return f({...e,...t})}}),oo=f({is(e){return e.kind==="DropConstraintNode"},create(e){return f({kind:"DropConstraintNode",constraintName:ae.create(e)})},cloneWith(e,t){return f({...e,...t})}}),js=f({is(e){return e.kind==="AlterColumnNode"},create(e,t,r){return f({kind:"AlterColumnNode",column:Me.create(e),[t]:r})}});class $y{#e;constructor(t){this.#e=t}setDataType(t){return new Ws(js.create(this.#e,"dataType",xn(t)))}setDefault(t){return new Ws(js.create(this.#e,"setDefault",Iy(t)))}dropDefault(){return new Ws(js.create(this.#e,"dropDefault",!0))}setNotNull(){return new Ws(js.create(this.#e,"setNotNull",!0))}dropNotNull(){return new Ws(js.create(this.#e,"dropNotNull",!0))}$call(t){return t(this)}}class Ws{#e;constructor(t){this.#e=t}toOperationNode(){return this.#e}}class ts{#e;constructor(t){this.#e=f(t)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class Mr{#e;constructor(t){this.#e=f(t)}onDelete(t){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.onDelete(t)})}onUpdate(t){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.onUpdate(t)})}deferrable(){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.deferrable()})}notDeferrable(){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new Mr({...this.#e,constraintBuilder:this.#e.constraintBuilder.initiallyImmediate()})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(oe.cloneWithTableProps(this.#e.node,{addConstraint:io.create(this.#e.constraintBuilder.toOperationNode())}),this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class Es{#e;constructor(t){this.#e=f(t)}ifExists(){return new Es({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{dropConstraint:oo.cloneWith(this.#e.node.dropConstraint,{ifExists:!0})})})}cascade(){return new Es({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{dropConstraint:oo.cloneWith(this.#e.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Es({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{dropConstraint:oo.cloneWith(this.#e.node.dropConstraint,{modifier:"restrict"})})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}const hs=f({is(e){return e.kind==="PrimaryKeyConstraintNode"},create(e,t){return f({kind:"PrimaryKeyConstraintNode",columns:f(e.map(Me.create)),name:t?ae.create(t):void 0})},cloneWith(e,t){return f({...e,...t})}}),as=f({is(e){return e.kind==="AddIndexNode"},create(e){return f({kind:"AddIndexNode",name:ae.create(e)})},cloneWith(e,t){return f({...e,...t})},cloneWithColumns(e,t){return f({...e,columns:[...e.columns||[],...t]})}});class gn{#e;constructor(t){this.#e=f(t)}unique(){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.cloneWith(this.#e.node.addIndex,{unique:!0})})})}column(t){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.cloneWithColumns(this.#e.node.addIndex,[$o(t)])})})}columns(t){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.cloneWithColumns(this.#e.node.addIndex,t.map($o))})})}expression(t){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.cloneWithColumns(this.#e.node.addIndex,[t.toOperationNode()])})})}using(t){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.cloneWith(this.#e.node.addIndex,{using:Re.createWithSql(t)})})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class Jr{#e;constructor(t){this.#e=t}nullsNotDistinct(){return new Jr(yn.cloneWith(this.#e,{nullsNotDistinct:!0}))}deferrable(){return new Jr(yn.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new Jr(yn.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new Jr(yn.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new Jr(yn.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(t){return t(this)}toOperationNode(){return this.#e}}class En{#e;constructor(t){this.#e=t}deferrable(){return new En(hs.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new En(hs.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new En(hs.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new En(hs.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(t){return t(this)}toOperationNode(){return this.#e}}class Cy{#e;constructor(t){this.#e=t}$call(t){return t(this)}toOperationNode(){return this.#e}}const $x=f({is(e){return e.kind==="RenameConstraintNode"},create(e,t){return f({kind:"RenameConstraintNode",oldName:ae.create(e),newName:ae.create(t)})}});class Cx{#e;constructor(t){this.#e=f(t)}renameTo(t){return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{renameTo:je(t)})})}setSchema(t){return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{setSchema:ae.create(t)})})}alterColumn(t,r){const n=r(new $y(t));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(t){return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Sy.create(t))})}renameColumn(t,r){return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Ry.create(t,r))})}addColumn(t,r,n=xt){const s=n(new be(Se.create(t,xn(r))));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Ty.create(s.toOperationNode()))})}modifyColumn(t,r,n=xt){const s=n(new be(Se.create(t,xn(r))));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Oy.create(s.toOperationNode()))})}addUniqueConstraint(t,r,n=xt){const s=n(new Jr(yn.create(r,t)));return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addConstraint:io.create(s.toOperationNode())})})}addCheckConstraint(t,r,n=xt){const s=n(new Cy(Ud.create(r.toOperationNode(),t)));return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addConstraint:io.create(s.toOperationNode())})})}addForeignKeyConstraint(t,r,n,s,i=xt){const o=i(new Ar(Wr.create(r.map(Me.create),je(n),s.map(Me.create),t)));return new Mr({...this.#e,constraintBuilder:o})}addPrimaryKeyConstraint(t,r,n=xt){const s=n(new En(hs.create(r,t)));return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addConstraint:io.create(s.toOperationNode())})})}dropConstraint(t){return new Es({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{dropConstraint:oo.create(t)})})}renameConstraint(t,r){return new Es({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{renameConstraint:$x.create(t,r)})})}addIndex(t){return new gn({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{addIndex:as.create(t)})})}dropIndex(t){return new ts({...this.#e,node:oe.cloneWithTableProps(this.#e.node,{dropIndex:Gs.create(t)})})}$call(t){return t(this)}}class Yt{#e;constructor(t){this.#e=f(t)}alterColumn(t,r){const n=r(new $y(t));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,n.toOperationNode())})}dropColumn(t){return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Sy.create(t))})}renameColumn(t,r){return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Ry.create(t,r))})}addColumn(t,r,n=xt){const s=n(new be(Se.create(t,xn(r))));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Ty.create(s.toOperationNode()))})}modifyColumn(t,r,n=xt){const s=n(new be(Se.create(t,xn(r))));return new Yt({...this.#e,node:oe.cloneWithColumnAlteration(this.#e.node,Oy.create(s.toOperationNode()))})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class xy extends wy{transformPrimitiveValueList(t){return Ea.create(t.values.map(Zt.createImmediate))}transformValue(t){return Zt.createImmediate(t.value)}}class Qt{#e;constructor(t){this.#e=f(t)}ifNotExists(){return new Qt({...this.#e,node:br.cloneWith(this.#e.node,{ifNotExists:!0})})}unique(){return new Qt({...this.#e,node:br.cloneWith(this.#e.node,{unique:!0})})}nullsNotDistinct(){return new Qt({...this.#e,node:br.cloneWith(this.#e.node,{nullsNotDistinct:!0})})}on(t){return new Qt({...this.#e,node:br.cloneWith(this.#e.node,{table:je(t)})})}column(t){return new Qt({...this.#e,node:br.cloneWithColumns(this.#e.node,[$o(t)])})}columns(t){return new Qt({...this.#e,node:br.cloneWithColumns(this.#e.node,t.map($o))})}expression(t){return new Qt({...this.#e,node:br.cloneWithColumns(this.#e.node,[t.toOperationNode()])})}using(t){return new Qt({...this.#e,node:br.cloneWith(this.#e.node,{using:Re.createWithSql(t)})})}where(...t){const r=new xy;return new Qt({...this.#e,node:Z.cloneWithWhere(this.#e.node,r.transformNode(it(t),this.#e.queryId))})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class Pd{#e;constructor(t){this.#e=f(t)}ifNotExists(){return new Pd({...this.#e,node:ey.cloneWith(this.#e.node,{ifNotExists:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}function xx(e){if(hC.includes(e))return e;throw new Error(`invalid OnCommitAction ${e}`)}class It{#e;constructor(t){this.#e=f(t)}temporary(){return new It({...this.#e,node:Rt.cloneWith(this.#e.node,{temporary:!0})})}onCommit(t){return new It({...this.#e,node:Rt.cloneWith(this.#e.node,{onCommit:xx(t)})})}ifNotExists(){return new It({...this.#e,node:Rt.cloneWith(this.#e.node,{ifNotExists:!0})})}addColumn(t,r,n=xt){const s=n(new be(Se.create(t,xn(r))));return new It({...this.#e,node:Rt.cloneWithColumn(this.#e.node,s.toOperationNode())})}addPrimaryKeyConstraint(t,r,n=xt){const s=n(new En(hs.create(r,t)));return new It({...this.#e,node:Rt.cloneWithConstraint(this.#e.node,s.toOperationNode())})}addUniqueConstraint(t,r,n=xt){const s=n(new Jr(yn.create(r,t)));return new It({...this.#e,node:Rt.cloneWithConstraint(this.#e.node,s.toOperationNode())})}addCheckConstraint(t,r,n=xt){const s=n(new Cy(Ud.create(r.toOperationNode(),t)));return new It({...this.#e,node:Rt.cloneWithConstraint(this.#e.node,s.toOperationNode())})}addForeignKeyConstraint(t,r,n,s,i=xt){const o=i(new Ar(Wr.create(r.map(Me.create),je(n),s.map(Me.create),t)));return new It({...this.#e,node:Rt.cloneWithConstraint(this.#e.node,o.toOperationNode())})}modifyFront(t){return new It({...this.#e,node:Rt.cloneWithFrontModifier(this.#e.node,t.toOperationNode())})}modifyEnd(t){return new It({...this.#e,node:Rt.cloneWithEndModifier(this.#e.node,t.toOperationNode())})}as(t){return new It({...this.#e,node:Rt.cloneWith(this.#e.node,{selectQuery:Fn(t)})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class ii{#e;constructor(t){this.#e=f(t)}on(t){return new ii({...this.#e,node:Gs.cloneWith(this.#e.node,{table:je(t)})})}ifExists(){return new ii({...this.#e,node:Gs.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new ii({...this.#e,node:Gs.cloneWith(this.#e.node,{cascade:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class qo{#e;constructor(t){this.#e=f(t)}ifExists(){return new qo({...this.#e,node:wu.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new qo({...this.#e,node:wu.cloneWith(this.#e.node,{cascade:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class jo{#e;constructor(t){this.#e=f(t)}ifExists(){return new jo({...this.#e,node:yu.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new jo({...this.#e,node:yu.cloneWith(this.#e.node,{cascade:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}const Vr=f({is(e){return e.kind==="CreateViewNode"},create(e){return f({kind:"CreateViewNode",name:xr.create(e)})},cloneWith(e,t){return f({...e,...t})}});class Ux{#e=new xy;transformQuery(t){return this.#e.transformNode(t.node,t.queryId)}transformResult(t){return Promise.resolve(t.result)}}class Fr{#e;constructor(t){this.#e=f(t)}temporary(){return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{temporary:!0})})}materialized(){return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{materialized:!0})})}ifNotExists(){return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{ifNotExists:!0})})}orReplace(){return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{orReplace:!0})})}columns(t){return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{columns:t.map(cy)})})}as(t){const r=t.withPlugin(new Ux).toOperationNode();return new Fr({...this.#e,node:Vr.cloneWith(this.#e.node,{as:r})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}const ao=f({is(e){return e.kind==="DropViewNode"},create(e){return f({kind:"DropViewNode",name:xr.create(e)})},cloneWith(e,t){return f({...e,...t})}});class oi{#e;constructor(t){this.#e=f(t)}materialized(){return new oi({...this.#e,node:ao.cloneWith(this.#e.node,{materialized:!0})})}ifExists(){return new oi({...this.#e,node:ao.cloneWith(this.#e.node,{ifExists:!0})})}cascade(){return new oi({...this.#e,node:ao.cloneWith(this.#e.node,{cascade:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}const Uy=f({is(e){return e.kind==="CreateTypeNode"},create(e){return f({kind:"CreateTypeNode",name:e})},cloneWithEnum(e,t){return f({...e,enum:Ea.create(t.map(Zt.createImmediate))})}});class Dd{#e;constructor(t){this.#e=f(t)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}asEnum(t){return new Dd({...this.#e,node:Uy.cloneWithEnum(this.#e.node,t)})}$call(t){return t(this)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}const Py=f({is(e){return e.kind==="DropTypeNode"},create(e){return f({kind:"DropTypeNode",name:e})},cloneWith(e,t){return f({...e,...t})}});class Ld{#e;constructor(t){this.#e=f(t)}ifExists(){return new Ld({...this.#e,node:Py.cloneWith(this.#e.node,{ifExists:!0})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}function dp(e){if(e.includes(".")){const r=e.split(".").map(Px);if(r.length===2)return xr.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${e}`)}else return xr.create(e)}function Px(e){return e.trim()}const co=f({is(e){return e.kind==="RefreshMaterializedViewNode"},create(e){return f({kind:"RefreshMaterializedViewNode",name:xr.create(e)})},cloneWith(e,t){return f({...e,...t})}});class ai{#e;constructor(t){this.#e=f(t)}concurrently(){return new ai({...this.#e,node:co.cloneWith(this.#e.node,{concurrently:!0,withNoData:!1})})}withData(){return new ai({...this.#e,node:co.cloneWith(this.#e.node,{withNoData:!1})})}withNoData(){return new ai({...this.#e,node:co.cloneWith(this.#e.node,{withNoData:!0,concurrently:!1})})}$call(t){return t(this)}toOperationNode(){return this.#e.executor.transformQuery(this.#e.node,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){await this.#e.executor.executeQuery(this.compile())}}class ci{#e;constructor(t){this.#e=t}createTable(t){return new It({queryId:re(),executor:this.#e,node:Rt.create(je(t))})}dropTable(t){return new jo({queryId:re(),executor:this.#e,node:yu.create(je(t))})}createIndex(t){return new Qt({queryId:re(),executor:this.#e,node:br.create(t)})}dropIndex(t){return new ii({queryId:re(),executor:this.#e,node:Gs.create(t)})}createSchema(t){return new Pd({queryId:re(),executor:this.#e,node:ey.create(t)})}dropSchema(t){return new qo({queryId:re(),executor:this.#e,node:wu.create(t)})}alterTable(t){return new Cx({queryId:re(),executor:this.#e,node:oe.create(je(t))})}createView(t){return new Fr({queryId:re(),executor:this.#e,node:Vr.create(t)})}refreshMaterializedView(t){return new ai({queryId:re(),executor:this.#e,node:co.create(t)})}dropView(t){return new oi({queryId:re(),executor:this.#e,node:ao.create(t)})}createType(t){return new Dd({queryId:re(),executor:this.#e,node:Uy.create(dp(t))})}dropType(t){return new Ld({queryId:re(),executor:this.#e,node:Py.create(dp(t))})}withPlugin(t){return new ci(this.#e.withPlugin(t))}withoutPlugins(){return new ci(this.#e.withoutPlugins())}withSchema(t){return new ci(this.#e.withPluginAtFront(new Ps(t)))}}class Dx{ref(t){return new vC(t)}table(t){return new Tx(t)}}class Lx{#e;constructor(t){this.#e=t}async provideConnection(t){const r=await this.#e.acquireConnection();try{return await t(r)}finally{await this.#e.releaseConnection(r)}}}class bn extends gy{#e;#t;#r;constructor(t,r,n,s=[]){super(s),this.#e=t,this.#t=r,this.#r=n}get adapter(){return this.#t}compileQuery(t,r){return this.#e.compileQuery(t,r)}provideConnection(t){return this.#r.provideConnection(t)}withPlugins(t){return new bn(this.#e,this.#t,this.#r,[...this.plugins,...t])}withPlugin(t){return new bn(this.#e,this.#t,this.#r,[...this.plugins,t])}withPluginAtFront(t){return new bn(this.#e,this.#t,this.#r,[t,...this.plugins])}withConnectionProvider(t){return new bn(this.#e,this.#t,t,[...this.plugins])}withoutPlugins(){return new bn(this.#e,this.#t,this.#r,[])}}function Ic(){return typeof performance<"u"&&lt(performance.now)?performance.now():Date.now()}class zx{#e;#t;#r;#n;#s;#i=new WeakSet;constructor(t,r){this.#n=!1,this.#e=t,this.#t=r}async init(){if(this.#s)throw new Error("driver has already been destroyed");this.#r||(this.#r=this.#e.init().then(()=>{this.#n=!0}).catch(t=>(this.#r=void 0,Promise.reject(t)))),await this.#r}async acquireConnection(){if(this.#s)throw new Error("driver has already been destroyed");this.#n||await this.init();const t=await this.#e.acquireConnection();return this.#i.has(t)||(this.#c()&&this.#a(t),this.#i.add(t)),t}async releaseConnection(t){await this.#e.releaseConnection(t)}beginTransaction(t,r){return this.#e.beginTransaction(t,r)}commitTransaction(t){return this.#e.commitTransaction(t)}rollbackTransaction(t){return this.#e.rollbackTransaction(t)}savepoint(t,r,n){if(this.#e.savepoint)return this.#e.savepoint(t,r,n);throw new Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(t,r,n){if(this.#e.rollbackToSavepoint)return this.#e.rollbackToSavepoint(t,r,n);throw new Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(t,r,n){if(this.#e.releaseSavepoint)return this.#e.releaseSavepoint(t,r,n);throw new Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#r&&(await this.#r,this.#s||(this.#s=this.#e.destroy().catch(t=>(this.#s=void 0,Promise.reject(t)))),await this.#s)}#c(){return this.#t.isLevelEnabled("query")||this.#t.isLevelEnabled("error")}#a(t){const r=t.executeQuery,n=t.streamQuery,s=this;t.executeQuery=async i=>{let o;const a=Ic();try{return await r.call(t,i)}catch(c){throw o=c,await s.#o(c,i,a),c}finally{o||await s.#u(i,a)}},t.streamQuery=async function*(i,o){let a;const c=Ic();try{for await(const d of n.call(t,i,o))yield d}catch(d){throw a=d,await s.#o(d,i,c),d}finally{a||await s.#u(i,c,!0)}}}async#o(t,r,n){await this.#t.error(()=>({level:"error",error:t,query:r,queryDurationMillis:this.#d(n)}))}async#u(t,r,n=!1){await this.#t.query(()=>({level:"query",isStream:n,query:t,queryDurationMillis:this.#d(r)}))}#d(t){return Ic()-t}}const qx=()=>{};class zd{#e;#t;constructor(t){this.#e=t}async provideConnection(t){for(;this.#t;)await this.#t.catch(qx);return this.#t=this.#r(t).finally(()=>{this.#t=void 0}),this.#t}async#r(t){return await t(this.#e)}}const jx=["read only","read write"],Wx=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function Dy(e){if(e.accessMode&&!jx.includes(e.accessMode))throw new Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!Wx.includes(e.isolationLevel))throw new Error(`invalid transaction isolation level ${e.isolationLevel}`)}f(["query","error"]);class Mx{#e;#t;constructor(t){lt(t)?(this.#t=t,this.#e=f({query:!0,error:!0})):(this.#t=Vx,this.#e=f({query:t.includes("query"),error:t.includes("error")}))}isLevelEnabled(t){return this.#e[t]}async query(t){this.#e.query&&await this.#t(t())}async error(t){this.#e.error&&await this.#t(t())}}function Vx(e){if(e.level==="query"){const t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else e.level==="error"&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}function Fx(e){return Pt(e)&&lt(e.compile)}Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class Ir extends Hr{#e;constructor(t){let r,n;if(Zx(t))r={executor:t.executor},n={...t};else{const s=t.dialect,i=s.createDriver(),o=s.createQueryCompiler(),a=s.createAdapter(),c=new Mx(t.log??[]),d=new zx(i,c),u=new Lx(d),l=new bn(o,a,u,t.plugins??[]);r={executor:l},n={config:t,executor:l,dialect:s,driver:d}}super(r),this.#e=f(n)}get schema(){return new ci(this.#e.executor)}get dynamic(){return new Dx}get introspection(){return this.#e.dialect.createIntrospector(this.withoutPlugins())}case(t){return new Ey({node:lr.create(Or(t)?void 0:Fn(t))})}get fn(){return vy()}transaction(){return new Wo({...this.#e})}startTransaction(){return new Mo({...this.#e})}connection(){return new Bx({...this.#e})}withPlugin(t){return new Ir({...this.#e,executor:this.#e.executor.withPlugin(t)})}withoutPlugins(){return new Ir({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(t){return new Ir({...this.#e,executor:this.#e.executor.withPluginAtFront(new Ps(t))})}withTables(){return new Ir({...this.#e})}async destroy(){await this.#e.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#e.executor}executeQuery(t,r){r!==void 0&&xs("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");const n=Fx(t)?t.compile():t;return this.getExecutor().executeQuery(n)}async[Symbol.asyncDispose](){await this.destroy()}}class _n extends Ir{#e;constructor(t){super(t),this.#e=t}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(t){return new _n({...this.#e,executor:this.#e.executor.withPlugin(t)})}withoutPlugins(){return new _n({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(t){return new _n({...this.#e,executor:this.#e.executor.withPluginAtFront(new Ps(t))})}withTables(){return new _n({...this.#e})}}function Zx(e){return Pt(e)&&Pt(e.config)&&Pt(e.driver)&&Pt(e.executor)&&Pt(e.dialect)}class Bx{#e;constructor(t){this.#e=f(t)}async execute(t){return this.#e.executor.provideConnection(async r=>{const n=this.#e.executor.withConnectionProvider(new zd(r)),s=new Ir({...this.#e,executor:n});return await t(s)})}}class Wo{#e;constructor(t){this.#e=f(t)}setAccessMode(t){return new Wo({...this.#e,accessMode:t})}setIsolationLevel(t){return new Wo({...this.#e,isolationLevel:t})}async execute(t){const{isolationLevel:r,accessMode:n,...s}=this.#e,i={isolationLevel:r,accessMode:n};return Dy(i),this.#e.executor.provideConnection(async o=>{const a=this.#e.executor.withConnectionProvider(new zd(o)),c=new _n({...s,executor:a});let d=!1;try{await this.#e.driver.beginTransaction(o,i),d=!0;const u=await t(c);return await this.#e.driver.commitTransaction(o),u}catch(u){throw d&&await this.#e.driver.rollbackTransaction(o),u}})}}class Mo{#e;constructor(t){this.#e=f(t)}setAccessMode(t){return new Mo({...this.#e,accessMode:t})}setIsolationLevel(t){return new Mo({...this.#e,isolationLevel:t})}async execute(){const{isolationLevel:t,accessMode:r,...n}=this.#e,s={isolationLevel:t,accessMode:r};Dy(s);const i=await yy(this.#e.executor);return await this.#e.driver.beginTransaction(i.connection,s),new _r({...n,connection:i,executor:this.#e.executor.withConnectionProvider(new zd(i.connection))})}}class _r extends _n{#e;#t;#r;constructor(t){const r={isCommitted:!1,isRolledBack:!1};t={...t,executor:new Zr(t.executor,r)};const{connection:n,...s}=t;super(s),this.#e=f(t),this.#r=r;const i=re();this.#t=o=>t.executor.compileQuery(o,i)}get isCommitted(){return this.#r.isCommitted}get isRolledBack(){return this.#r.isRolledBack}commit(){return vn(this.#r),new Ms(async()=>{await this.#e.driver.commitTransaction(this.#e.connection.connection),this.#r.isCommitted=!0,this.#e.connection.release()})}rollback(){return vn(this.#r),new Ms(async()=>{await this.#e.driver.rollbackTransaction(this.#e.connection.connection),this.#r.isRolledBack=!0,this.#e.connection.release()})}savepoint(t){return vn(this.#r),new Ms(async()=>(await this.#e.driver.savepoint?.(this.#e.connection.connection,t,this.#t),new _r({...this.#e})))}rollbackToSavepoint(t){return vn(this.#r),new Ms(async()=>(await this.#e.driver.rollbackToSavepoint?.(this.#e.connection.connection,t,this.#t),new _r({...this.#e})))}releaseSavepoint(t){return vn(this.#r),new Ms(async()=>(await this.#e.driver.releaseSavepoint?.(this.#e.connection.connection,t,this.#t),new _r({...this.#e})))}withPlugin(t){return new _r({...this.#e,executor:this.#e.executor.withPlugin(t)})}withoutPlugins(){return new _r({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(t){return new _r({...this.#e,executor:this.#e.executor.withPluginAtFront(new Ps(t))})}withTables(){return new _r({...this.#e})}}class Ms{#e;constructor(t){this.#e=t}async execute(){return await this.#e()}}function vn(e){if(e.isCommitted)throw new Error("Transaction is already committed");if(e.isRolledBack)throw new Error("Transaction is already rolled back")}class Zr{#e;#t;constructor(t,r){t instanceof Zr?this.#e=t.#e:this.#e=t,this.#t=r}get adapter(){return this.#e.adapter}get plugins(){return this.#e.plugins}transformQuery(t,r){return this.#e.transformQuery(t,r)}compileQuery(t,r){return this.#e.compileQuery(t,r)}provideConnection(t){return this.#e.provideConnection(t)}executeQuery(t){return vn(this.#t),this.#e.executeQuery(t)}stream(t,r){return vn(this.#t),this.#e.stream(t,r)}withConnectionProvider(t){return new Zr(this.#e.withConnectionProvider(t),this.#t)}withPlugin(t){return new Zr(this.#e.withPlugin(t),this.#t)}withPlugins(t){return new Zr(this.#e.withPlugins(t),this.#t)}withPluginAtFront(t){return new Zr(this.#e.withPluginAtFront(t),this.#t)}withoutPlugins(){return new Zr(this.#e.withoutPlugins(),this.#t)}}class ui{#e;constructor(t){this.#e=f(t)}get expressionType(){}get isRawBuilder(){return!0}as(t){return new Hx(this,t)}$castTo(){return new ui({...this.#e})}$notNull(){return new ui(this.#e)}withPlugin(t){return new ui({...this.#e,plugins:this.#e.plugins!==void 0?f([...this.#e.plugins,t]):f([t])})}toOperationNode(){return this.#r(this.#t())}compile(t){return this.#n(this.#t(t))}async execute(t){const r=this.#t(t);return r.executeQuery(this.#n(r))}#t(t){const r=t!==void 0?t.getExecutor():_a;return this.#e.plugins!==void 0?r.withPlugins(this.#e.plugins):r}#r(t){return t.transformQuery(this.#e.rawNode,this.#e.queryId)}#n(t){return t.compileQuery(this.#r(t),this.#e.queryId)}}function Dr(e){return new ui(e)}class Hx{#e;#t;constructor(t,r){this.#e=t,this.#t=r}get expression(){return this.#e}get alias(){return this.#t}get rawBuilder(){return this.#e}toOperationNode(){return Pr.create(this.#e.toOperationNode(),pt(this.#t)?this.#t.toOperationNode():ae.create(this.#t))}}const qe=Object.assign((e,...t)=>Dr({queryId:re(),rawNode:Re.create(e,t?.map(lp)??[])}),{ref(e){return Dr({queryId:re(),rawNode:Re.createWithChild(Ur(e))})},val(e){return Dr({queryId:re(),rawNode:Re.createWithChild(Be(e))})},value(e){return this.val(e)},table(e){return Dr({queryId:re(),rawNode:Re.createWithChild(je(e))})},id(...e){const t=new Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",Dr({queryId:re(),rawNode:Re.create(t,e.map(ae.create))})},lit(e){return Dr({queryId:re(),rawNode:Re.createWithChild(Zt.createImmediate(e))})},literal(e){return this.lit(e)},raw(e){return Dr({queryId:re(),rawNode:Re.createWithSql(e)})},join(e,t=qe`, `){const r=new Array(Math.max(2*e.length-1,0)),n=t.toOperationNode();for(let s=0;s<e.length;++s)r[2*s]=lp(e[s]),s!==e.length-1&&(r[2*s+1]=n);return Dr({queryId:re(),rawNode:Re.createWithChildren(r)})}});function lp(e){return pt(e)?e.toOperationNode():Be(e)}class Kx{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#e=f({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=t=>{this.nodeStack.push(t),this.#e[t.kind](t),this.nodeStack.pop()}}const Jx=/'/g;class Aa extends Kx{#e="";#t=[];get numParameters(){return this.#t.length}compileQuery(t,r){return this.#e="",this.#t=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(t),f({query:t,queryId:r,sql:this.getSql(),parameters:[...this.#t]})}getSql(){return this.#e}visitSelectQuery(t){const r=this.parentNode!==void 0&&!Rr.is(this.parentNode)&&!Xe.is(this.parentNode)&&!Rt.is(this.parentNode)&&!Vr.is(this.parentNode)&&!by.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),r&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("select"),t.distinctOn&&(this.append(" "),this.compileDistinctOn(t.distinctOn)),t.frontModifiers?.length&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.top&&(this.append(" "),this.visitNode(t.top)),t.selections&&(this.append(" "),this.compileList(t.selections)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.groupBy&&(this.append(" "),this.visitNode(t.groupBy)),t.having&&(this.append(" "),this.visitNode(t.having)),t.setOperations&&(this.append(" "),this.compileList(t.setOperations," ")),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.offset&&(this.append(" "),this.visitNode(t.offset)),t.fetch&&(this.append(" "),this.visitNode(t.fetch)),t.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...t.endModifiers])," ")),r&&this.append(")")}visitFrom(t){this.append("from "),this.compileList(t.froms)}visitSelection(t){this.visitNode(t.selection)}visitColumn(t){this.visitNode(t.column)}compileDistinctOn(t){this.append("distinct on ("),this.compileList(t),this.append(")")}compileList(t,r=", "){const n=t.length-1;for(let s=0;s<=n;s++)this.visitNode(t[s]),s<n&&this.append(r)}visitWhere(t){this.append("where "),this.visitNode(t.where)}visitHaving(t){this.append("having "),this.visitNode(t.having)}visitInsertQuery(t){const r=this.parentNode!==void 0&&!Rr.is(this.parentNode)&&!Re.is(this.parentNode)&&!Cn.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),r&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append(t.replace?"replace":"insert"),t.ignore&&(xs("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),t.orAction&&(this.append(" "),this.visitNode(t.orAction)),t.top&&(this.append(" "),this.visitNode(t.top)),t.into&&(this.append(" into "),this.visitNode(t.into)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.output&&(this.append(" "),this.visitNode(t.output)),t.values&&(this.append(" "),this.visitNode(t.values)),t.defaultValues&&(this.append(" "),this.append("default values")),t.onConflict&&(this.append(" "),this.visitNode(t.onConflict)),t.onDuplicateKey&&(this.append(" "),this.visitNode(t.onDuplicateKey)),t.returning&&(this.append(" "),this.visitNode(t.returning)),r&&this.append(")"),t.endModifiers?.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitValues(t){this.append("values "),this.compileList(t.values)}visitDeleteQuery(t){const r=this.parentNode!==void 0&&!Rr.is(this.parentNode)&&!Re.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),r&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("delete "),t.top&&(this.visitNode(t.top),this.append(" ")),this.visitNode(t.from),t.output&&(this.append(" "),this.visitNode(t.output)),t.using&&(this.append(" "),this.visitNode(t.using)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),r&&this.append(")"),t.endModifiers?.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitReturning(t){this.append("returning "),this.compileList(t.selections)}visitAlias(t){this.visitNode(t.node),this.append(" as "),this.visitNode(t.alias)}visitReference(t){t.table&&(this.visitNode(t.table),this.append(".")),this.visitNode(t.column)}visitSelectAll(t){this.append("*")}visitIdentifier(t){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(t),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(t){if(!st(t.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(t.name))}visitAnd(t){this.visitNode(t.left),this.append(" and "),this.visitNode(t.right)}visitOr(t){this.visitNode(t.left),this.append(" or "),this.visitNode(t.right)}visitValue(t){t.immediate?this.appendImmediateValue(t.value):this.appendValue(t.value)}visitValueList(t){this.append("("),this.compileList(t.values),this.append(")")}visitTuple(t){this.append("("),this.compileList(t.values),this.append(")")}visitPrimitiveValueList(t){this.append("(");const{values:r}=t;for(let n=0;n<r.length;++n)this.appendValue(r[n]),n!==r.length-1&&this.append(", ");this.append(")")}visitParens(t){this.append("("),this.visitNode(t.node),this.append(")")}visitJoin(t){this.append(Qx[t.joinType]),this.append(" "),this.visitNode(t.table),t.on&&(this.append(" "),this.visitNode(t.on))}visitOn(t){this.append("on "),this.visitNode(t.on)}visitRaw(t){const{sqlFragments:r,parameters:n}=t;for(let s=0;s<r.length;++s)this.append(r[s]),n.length>s&&this.visitNode(n[s])}visitOperator(t){this.append(t.operator)}visitTable(t){this.visitNode(t.table)}visitSchemableIdentifier(t){t.schema&&(this.visitNode(t.schema),this.append(".")),this.visitNode(t.identifier)}visitCreateTable(t){this.append("create "),t.frontModifiers&&t.frontModifiers.length>0&&(this.compileList(t.frontModifiers," "),this.append(" ")),t.temporary&&this.append("temporary "),this.append("table "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.table),t.selectQuery?(this.append(" as "),this.visitNode(t.selectQuery)):(this.append(" ("),this.compileList([...t.columns,...t.constraints??[]]),this.append(")"),t.onCommit&&(this.append(" on commit "),this.append(t.onCommit)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," ")))}visitColumnDefinition(t){t.ifNotExists&&this.append("if not exists "),this.visitNode(t.column),this.append(" "),this.visitNode(t.dataType),t.unsigned&&this.append(" unsigned"),t.frontModifiers&&t.frontModifiers.length>0&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.generated&&(this.append(" "),this.visitNode(t.generated)),t.identity&&this.append(" identity"),t.defaultTo&&(this.append(" "),this.visitNode(t.defaultTo)),t.notNull&&this.append(" not null"),t.unique&&this.append(" unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.primaryKey&&this.append(" primary key"),t.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),t.references&&(this.append(" "),this.visitNode(t.references)),t.check&&(this.append(" "),this.visitNode(t.check)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(t){this.append("references "),this.visitNode(t.table),this.append(" ("),this.compileList(t.columns),this.append(")"),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitDropTable(t){this.append("drop table "),t.ifExists&&this.append("if exists "),this.visitNode(t.table),t.cascade&&this.append(" cascade")}visitDataType(t){this.append(t.dataType)}visitOrderBy(t){this.append("order by "),this.compileList(t.items)}visitOrderByItem(t){this.visitNode(t.orderBy),t.collation&&(this.append(" "),this.visitNode(t.collation)),t.direction&&(this.append(" "),this.visitNode(t.direction)),t.nulls&&(this.append(" nulls "),this.append(t.nulls))}visitGroupBy(t){this.append("group by "),this.compileList(t.items)}visitGroupByItem(t){this.visitNode(t.groupBy)}visitUpdateQuery(t){const r=this.parentNode!==void 0&&!Rr.is(this.parentNode)&&!Re.is(this.parentNode)&&!Cn.is(this.parentNode);if(this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),r&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("update "),t.top&&(this.visitNode(t.top),this.append(" ")),t.table&&(this.visitNode(t.table),this.append(" ")),this.append("set "),t.updates&&this.compileList(t.updates),t.output&&(this.append(" "),this.visitNode(t.output)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins){if(!t.from)throw new Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(t.joins," ")}t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),r&&this.append(")"),t.endModifiers?.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitColumnUpdate(t){this.visitNode(t.column),this.append(" = "),this.visitNode(t.value)}visitLimit(t){this.append("limit "),this.visitNode(t.limit)}visitOffset(t){this.append("offset "),this.visitNode(t.offset)}visitOnConflict(t){this.append("on conflict"),t.columns?(this.append(" ("),this.compileList(t.columns),this.append(")")):t.constraint?(this.append(" on constraint "),this.visitNode(t.constraint)):t.indexExpression&&(this.append(" ("),this.visitNode(t.indexExpression),this.append(")")),t.indexWhere&&(this.append(" "),this.visitNode(t.indexWhere)),t.doNothing===!0?this.append(" do nothing"):t.updates&&(this.append(" do update set "),this.compileList(t.updates),t.updateWhere&&(this.append(" "),this.visitNode(t.updateWhere)))}visitOnDuplicateKey(t){this.append("on duplicate key update "),this.compileList(t.updates)}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.using&&(this.append(" using "),this.visitNode(t.using)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.where&&(this.append(" "),this.visitNode(t.where))}visitDropIndex(t){this.append("drop index "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.cascade&&this.append(" cascade")}visitCreateSchema(t){this.append("create schema "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.schema)}visitDropSchema(t){this.append("drop schema "),t.ifExists&&this.append("if exists "),this.visitNode(t.schema),t.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("primary key ("),this.compileList(t.columns),this.append(")"),this.buildDeferrable(t)}buildDeferrable(t){t.deferrable!==void 0&&(t.deferrable?this.append(" deferrable"):this.append(" not deferrable")),t.initiallyDeferred!==void 0&&(t.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(t.columns),this.append(")"),this.buildDeferrable(t)}visitCheckConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("check ("),this.visitNode(t.expression),this.append(")")}visitForeignKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("foreign key ("),this.compileList(t.columns),this.append(") "),this.visitNode(t.references),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate)),this.buildDeferrable(t)}visitList(t){this.compileList(t.items)}visitWith(t){this.append("with "),t.recursive&&this.append("recursive "),this.compileList(t.expressions)}visitCommonTableExpression(t){this.visitNode(t.name),this.append(" as "),yi(t.materialized)&&(t.materialized||this.append("not "),this.append("materialized ")),this.visitNode(t.expression)}visitCommonTableExpressionName(t){this.visitNode(t.table),t.columns&&(this.append("("),this.compileList(t.columns),this.append(")"))}visitAlterTable(t){this.append("alter table "),this.visitNode(t.table),this.append(" "),t.renameTo&&(this.append("rename to "),this.visitNode(t.renameTo)),t.setSchema&&(this.append("set schema "),this.visitNode(t.setSchema)),t.addConstraint&&this.visitNode(t.addConstraint),t.dropConstraint&&this.visitNode(t.dropConstraint),t.renameConstraint&&this.visitNode(t.renameConstraint),t.columnAlterations&&this.compileColumnAlterations(t.columnAlterations),t.addIndex&&this.visitNode(t.addIndex),t.dropIndex&&this.visitNode(t.dropIndex)}visitAddColumn(t){this.append("add column "),this.visitNode(t.column)}visitRenameColumn(t){this.append("rename column "),this.visitNode(t.column),this.append(" to "),this.visitNode(t.renameTo)}visitDropColumn(t){this.append("drop column "),this.visitNode(t.column)}visitAlterColumn(t){this.append("alter column "),this.visitNode(t.column),this.append(" "),t.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(t.dataType),t.dataTypeExpression&&(this.append("using "),this.visitNode(t.dataTypeExpression))),t.setDefault&&(this.append("set default "),this.visitNode(t.setDefault)),t.dropDefault&&this.append("drop default"),t.setNotNull&&this.append("set not null"),t.dropNotNull&&this.append("drop not null")}visitModifyColumn(t){this.append("modify column "),this.visitNode(t.column)}visitAddConstraint(t){this.append("add "),this.visitNode(t.constraint)}visitDropConstraint(t){this.append("drop constraint "),t.ifExists&&this.append("if exists "),this.visitNode(t.constraintName),t.modifier==="cascade"?this.append(" cascade"):t.modifier==="restrict"&&this.append(" restrict")}visitRenameConstraint(t){this.append("rename constraint "),this.visitNode(t.oldName),this.append(" to "),this.visitNode(t.newName)}visitSetOperation(t){this.append(t.operator),this.append(" "),t.all&&this.append("all "),this.visitNode(t.expression)}visitCreateView(t){this.append("create "),t.orReplace&&this.append("or replace "),t.materialized&&this.append("materialized "),t.temporary&&this.append("temporary "),this.append("view "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),this.append(" "),t.columns&&(this.append("("),this.compileList(t.columns),this.append(") ")),t.as&&(this.append("as "),this.visitNode(t.as))}visitRefreshMaterializedView(t){this.append("refresh materialized view "),t.concurrently&&this.append("concurrently "),this.visitNode(t.name),t.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(t){this.append("drop "),t.materialized&&this.append("materialized "),this.append("view "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.cascade&&this.append(" cascade")}visitGenerated(t){this.append("generated "),t.always&&this.append("always "),t.byDefault&&this.append("by default "),this.append("as "),t.identity&&this.append("identity"),t.expression&&(this.append("("),this.visitNode(t.expression),this.append(")")),t.stored&&this.append(" stored")}visitDefaultValue(t){this.append("default "),this.visitNode(t.defaultValue)}visitSelectModifier(t){t.rawModifier?this.visitNode(t.rawModifier):this.append(Gx[t.modifier]),t.of&&(this.append(" of "),this.compileList(t.of,", "))}visitCreateType(t){this.append("create type "),this.visitNode(t.name),t.enum&&(this.append(" as enum "),this.visitNode(t.enum))}visitDropType(t){this.append("drop type "),t.ifExists&&this.append("if exists "),this.visitNode(t.name)}visitExplain(t){this.append("explain"),(t.options||t.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),t.options&&(this.visitNode(t.options),t.format&&this.append(this.getExplainOptionsDelimiter())),t.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(t.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(t){this.append("default")}visitAggregateFunction(t){this.append(t.func),this.append("("),t.distinct&&this.append("distinct "),this.compileList(t.aggregated),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),this.append(")"),t.withinGroup&&(this.append(" within group ("),this.visitNode(t.withinGroup),this.append(")")),t.filter&&(this.append(" filter("),this.visitNode(t.filter),this.append(")")),t.over&&(this.append(" "),this.visitNode(t.over))}visitOver(t){this.append("over("),t.partitionBy&&(this.visitNode(t.partitionBy),t.orderBy&&this.append(" ")),t.orderBy&&this.visitNode(t.orderBy),this.append(")")}visitPartitionBy(t){this.append("partition by "),this.compileList(t.items)}visitPartitionByItem(t){this.visitNode(t.partitionBy)}visitBinaryOperation(t){this.visitNode(t.leftOperand),this.append(" "),this.visitNode(t.operator),this.append(" "),this.visitNode(t.rightOperand)}visitUnaryOperation(t){this.visitNode(t.operator),this.isMinusOperator(t.operator)||this.append(" "),this.visitNode(t.operand)}isMinusOperator(t){return nn.is(t)&&t.operator==="-"}visitUsing(t){this.append("using "),this.compileList(t.tables)}visitFunction(t){this.append(t.func),this.append("("),this.compileList(t.arguments),this.append(")")}visitCase(t){this.append("case"),t.value&&(this.append(" "),this.visitNode(t.value)),t.when&&(this.append(" "),this.compileList(t.when," ")),t.else&&(this.append(" else "),this.visitNode(t.else)),this.append(" end"),t.isStatement&&this.append(" case")}visitWhen(t){this.append("when "),this.visitNode(t.condition),t.result&&(this.append(" then "),this.visitNode(t.result))}visitJSONReference(t){this.visitNode(t.reference),this.visitNode(t.traversal)}visitJSONPath(t){t.inOperator&&this.visitNode(t.inOperator),this.append("'$");for(const r of t.pathLegs)this.visitNode(r);this.append("'")}visitJSONPathLeg(t){const r=t.type==="ArrayLocation";this.append(r?"[":"."),this.append(String(t.value)),r&&this.append("]")}visitJSONOperatorChain(t){for(let r=0,n=t.values.length;r<n;r++)r===n-1?this.visitNode(t.operator):this.append("->"),this.visitNode(t.values[r])}visitMergeQuery(t){t.with&&(this.visitNode(t.with),this.append(" ")),this.append("merge "),t.top&&(this.visitNode(t.top),this.append(" ")),this.append("into "),this.visitNode(t.into),t.using&&(this.append(" "),this.visitNode(t.using)),t.whens&&(this.append(" "),this.compileList(t.whens," ")),t.returning&&(this.append(" "),this.visitNode(t.returning)),t.output&&(this.append(" "),this.visitNode(t.output)),t.endModifiers?.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitMatched(t){t.not&&this.append("not "),this.append("matched"),t.bySource&&this.append(" by source")}visitAddIndex(t){this.append("add "),t.unique&&this.append("unique "),this.append("index "),this.visitNode(t.name),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.using&&(this.append(" using "),this.visitNode(t.using))}visitCast(t){this.append("cast("),this.visitNode(t.expression),this.append(" as "),this.visitNode(t.dataType),this.append(")")}visitFetch(t){this.append("fetch next "),this.visitNode(t.rowCount),this.append(` rows ${t.modifier}`)}visitOutput(t){this.append("output "),this.compileList(t.selections)}visitTop(t){this.append(`top(${t.expression})`),t.modifiers&&this.append(` ${t.modifiers}`)}visitOrAction(t){this.append(t.action)}visitCollate(t){this.append("collate "),this.visitNode(t.collation)}append(t){this.#e+=t}appendValue(t){this.addParameter(t),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(t){const r=this.getLeftIdentifierWrapper(),n=this.getRightIdentifierWrapper();let s="";for(const i of t)s+=i,i===r?s+=r:i===n&&(s+=n);return s}sanitizeStringLiteral(t){return t.replace(Jx,"''")}addParameter(t){this.#t.push(t)}appendImmediateValue(t){if(st(t))this.appendStringLiteral(t);else if(ks(t)||yi(t)||ba(t))this.append(t.toString());else if(ga(t))this.append("null");else if(Xw(t))this.appendImmediateValue(t.toISOString());else throw new Error(`invalid immediate value ${t}`)}appendStringLiteral(t){this.append("'"),this.append(this.sanitizeStringLiteral(t)),this.append("'")}sortSelectModifiers(t){return t.sort((r,n)=>r.modifier&&n.modifier?hp[r.modifier]-hp[n.modifier]:1),f(t)}compileColumnAlterations(t){this.compileList(t)}announcesNewColumnDataType(){return!0}}const Gx=f({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),hp=f({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Qx=f({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"}),Vt=f({raw(e,t=[]){return f({sql:e,query:Re.createWithSql(e),parameters:f(t),queryId:re()})}});class ka{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}function $r(e,t){return Re.createWithChildren([Re.createWithSql(`${e} `),ae.create(t)])}class Yx{#e;#t=new eU;#r;#n;constructor(t){this.#e=f({...t})}async init(){this.#r=lt(this.#e.database)?await this.#e.database():this.#e.database,this.#n=new Xx(this.#r),this.#e.onCreateConnection&&await this.#e.onCreateConnection(this.#n)}async acquireConnection(){return await this.#t.lock(),this.#n}async beginTransaction(t){await t.executeQuery(Vt.raw("begin"))}async commitTransaction(t){await t.executeQuery(Vt.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Vt.raw("rollback"))}async savepoint(t,r,n){await t.executeQuery(n($r("savepoint",r),re()))}async rollbackToSavepoint(t,r,n){await t.executeQuery(n($r("rollback to",r),re()))}async releaseSavepoint(t,r,n){await t.executeQuery(n($r("release",r),re()))}async releaseConnection(){this.#t.unlock()}async destroy(){this.#r?.close()}}class Xx{#e;constructor(t){this.#e=t}executeQuery(t){const{sql:r,parameters:n}=t,s=this.#e.prepare(r);if(s.reader)return Promise.resolve({rows:s.all(n)});const{changes:i,lastInsertRowid:o}=s.run(n);return Promise.resolve({numAffectedRows:i!=null?BigInt(i):void 0,insertId:o!=null?BigInt(o):void 0,rows:[]})}async*streamQuery(t,r){const{sql:n,parameters:s,query:i}=t,o=this.#e.prepare(n);if(pe.is(i)){const a=o.iterate(s);for(const c of a)yield{rows:[c]}}else throw new Error("Sqlite driver only supports streaming of select queries")}}class eU{#e;#t;async lock(){for(;this.#e;)await this.#e;this.#e=new Promise(t=>{this.#t=t})}unlock(){const t=this.#t;this.#e=void 0,this.#t=void 0,t?.()}}const tU=/"/g;class rU extends Aa{visitOrAction(t){this.append("or "),this.append(t.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(t){return t.replace(tU,'""')}visitDefaultInsertValue(t){this.append("null")}}const Ii="kysely_migration",Ta="kysely_migration_lock";f({__noMigrations__:!0});class nU{#e;constructor(t){this.#e=t}async getSchemas(){return[]}async getTables(t={withInternalKyselyTables:!1}){return await this.#r(t)}async getMetadata(t){return{tables:await this.getTables(t)}}#t(t,r){let n=t.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return r.withInternalKyselyTables||(n=n.where("name","!=",Ii).where("name","!=",Ta)),n}async#r(t){const r=await this.#t(this.#e,t).execute(),n=await this.#e.with("table_list",i=>this.#t(i,t)).selectFrom(["table_list as tl",qe`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),s={};for(const i of n)s[i.table]??=[],s[i.table].push(i);return r.map(({name:i,sql:o,type:a})=>{let c=o?.split(/[\(\),]/)?.find(u=>u.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,"");const d=s[i]??[];if(!c){const u=d.filter(l=>l.pk>0);u.length===1&&u[0].type.toLowerCase()==="integer"&&(c=u[0].name)}return{name:i,isView:a==="view",columns:d.map(u=>({name:u.name,dataType:u.type,isNullable:!u.notnull,isAutoIncrementing:u.name===c,hasDefaultValue:u.dflt_value!=null,comment:void 0}))}})}}class sU extends ka{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(t,r){}async releaseMigrationLock(t,r){}}class Ly{#e;constructor(t){this.#e=f({...t})}createDriver(){return new Yx(this.#e)}createQueryCompiler(){return new rU}createAdapter(){return new sU}createIntrospector(t){return new nU(t)}}const iU=/"/g;class oU extends Aa{sanitizeIdentifier(t){return t.replace(iU,'""')}}class aU{#e;constructor(t){this.#e=t}async getSchemas(){return(await this.#e.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(r=>({name:r.nspname}))}async getTables(t={withInternalKyselyTables:!1}){let r=this.#e.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",qe`col_description(a.attrelid, a.attnum)`.as("column_description"),qe`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where(qe`has_schema_privilege(ns.nspname, 'USAGE')`).where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();t.withInternalKyselyTables||(r=r.where("c.relname","!=",Ii).where("c.relname","!=",Ta));const n=await r.execute();return this.#t(n)}async getMetadata(t){return{tables:await this.getTables(t)}}#t(t){return t.reduce((r,n)=>{let s=r.find(i=>i.name===n.table&&i.schema===n.schema);return s||(s=f({name:n.table,isView:n.table_type==="v",schema:n.schema,columns:[]}),r.push(s)),s.columns.push(f({name:n.column,dataType:n.type,dataTypeSchema:n.type_schema,isNullable:!n.not_null,isAutoIncrementing:n.auto_incrementing!==null,hasDefaultValue:n.has_default,comment:n.column_description??void 0})),r},[])}}const cU=BigInt("3853314791062309107");class uU extends ka{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(t,r){await qe`select pg_advisory_xact_lock(${qe.lit(cU)})`.execute(t)}async releaseMigrationLock(t,r){}}function qd(e,t){if(dU(e)&&t.stack){const r=t.stack.split(`
`).slice(1).join(`
`);return e.stack+=`
${r}`,e}return e}function dU(e){return Pt(e)&&st(e.stack)}const zy=Symbol();class lU{#e;#t=new WeakMap;#r;constructor(t){this.#e=f({...t})}async init(){this.#r=lt(this.#e.pool)?await this.#e.pool():this.#e.pool}async acquireConnection(){const t=await this.#n();let r=this.#t.get(t);return r||(r=new fU(t),this.#t.set(t,r),this.#e?.onCreateConnection&&await this.#e.onCreateConnection(r)),this.#e?.onReserveConnection&&await this.#e.onReserveConnection(r),r}async#n(){return new Promise((t,r)=>{this.#r.getConnection(async(n,s)=>{n?r(n):t(s)})})}async beginTransaction(t,r){if(r.isolationLevel||r.accessMode){const n=[];r.isolationLevel&&n.push(`isolation level ${r.isolationLevel}`),r.accessMode&&n.push(r.accessMode);const s=`set transaction ${n.join(", ")}`;await t.executeQuery(Vt.raw(s))}await t.executeQuery(Vt.raw("begin"))}async commitTransaction(t){await t.executeQuery(Vt.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Vt.raw("rollback"))}async savepoint(t,r,n){await t.executeQuery(n($r("savepoint",r),re()))}async rollbackToSavepoint(t,r,n){await t.executeQuery(n($r("rollback to",r),re()))}async releaseSavepoint(t,r,n){await t.executeQuery(n($r("release savepoint",r),re()))}async releaseConnection(t){t[zy]()}async destroy(){return new Promise((t,r)=>{this.#r.end(n=>{n?r(n):t()})})}}function hU(e){return Pt(e)&&"insertId"in e&&"affectedRows"in e}class fU{#e;constructor(t){this.#e=t}async executeQuery(t){try{const r=await this.#t(t);if(hU(r)){const{insertId:n,affectedRows:s,changedRows:i}=r;return{insertId:n!=null&&n.toString()!=="0"?BigInt(n):void 0,numAffectedRows:s!=null?BigInt(s):void 0,numChangedRows:i!=null?BigInt(i):void 0,rows:[]}}else if(Array.isArray(r))return{rows:r};return{rows:[]}}catch(r){throw qd(r,new Error)}}#t(t){return new Promise((r,n)=>{this.#e.query(t.sql,t.parameters,(s,i)=>{s?n(s):r(i)})})}async*streamQuery(t,r){const n=this.#e.query(t.sql,t.parameters).stream({objectMode:!0});try{for await(const s of n)yield{rows:[s]}}catch(s){if(s&&typeof s=="object"&&"code"in s&&s.code==="ERR_STREAM_PREMATURE_CLOSE")return;throw s}}[zy](){this.#e.release()}}const pU=/`/g;class mU extends Aa{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(t){return t.replace(pU,"``")}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.using&&(this.append(" using "),this.visitNode(t.using)),t.table&&(this.append(" on "),this.visitNode(t.table)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.where&&(this.append(" "),this.visitNode(t.where))}}class wU{#e;constructor(t){this.#e=t}async getSchemas(){return(await this.#e.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(r=>({name:r.SCHEMA_NAME}))}async getTables(t={withInternalKyselyTables:!1}){let r=this.#e.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",s=>s.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",qe`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();t.withInternalKyselyTables||(r=r.where("columns.TABLE_NAME","!=",Ii).where("columns.TABLE_NAME","!=",Ta));const n=await r.execute();return this.#t(n)}async getMetadata(t){return{tables:await this.getTables(t)}}#t(t){return t.reduce((r,n)=>{let s=r.find(i=>i.name===n.TABLE_NAME);return s||(s=f({name:n.TABLE_NAME,isView:n.TABLE_TYPE==="VIEW",schema:n.TABLE_SCHEMA,columns:[]}),r.push(s)),s.columns.push(f({name:n.COLUMN_NAME,dataType:n.DATA_TYPE,isNullable:n.IS_NULLABLE==="YES",isAutoIncrementing:n.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:n.COLUMN_DEFAULT!==null,comment:n.COLUMN_COMMENT===""?void 0:n.COLUMN_COMMENT})),r},[])}}const fp="ea586330-2c93-47c8-908d-981d9d270f9d",yU=3600;class gU extends ka{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(t,r){await qe`select get_lock(${qe.lit(fp)}, ${qe.lit(yU)})`.execute(t)}async releaseMigrationLock(t,r){await qe`select release_lock(${qe.lit(fp)})`.execute(t)}}class qy{#e;constructor(t){this.#e=t}createDriver(){return new lU(this.#e)}createQueryCompiler(){return new mU}createAdapter(){return new gU}createIntrospector(t){return new wU(t)}}const jy=Symbol();class bU{#e;#t=new WeakMap;#r;constructor(t){this.#e=f({...t})}async init(){this.#r=lt(this.#e.pool)?await this.#e.pool():this.#e.pool}async acquireConnection(){const t=await this.#r.connect();let r=this.#t.get(t);return r||(r=new vU(t,{cursor:this.#e.cursor??null}),this.#t.set(t,r),this.#e.onCreateConnection&&await this.#e.onCreateConnection(r)),this.#e.onReserveConnection&&await this.#e.onReserveConnection(r),r}async beginTransaction(t,r){if(r.isolationLevel||r.accessMode){let n="start transaction";r.isolationLevel&&(n+=` isolation level ${r.isolationLevel}`),r.accessMode&&(n+=` ${r.accessMode}`),await t.executeQuery(Vt.raw(n))}else await t.executeQuery(Vt.raw("begin"))}async commitTransaction(t){await t.executeQuery(Vt.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Vt.raw("rollback"))}async savepoint(t,r,n){await t.executeQuery(n($r("savepoint",r),re()))}async rollbackToSavepoint(t,r,n){await t.executeQuery(n($r("rollback to",r),re()))}async releaseSavepoint(t,r,n){await t.executeQuery(n($r("release",r),re()))}async releaseConnection(t){t[jy]()}async destroy(){if(this.#r){const t=this.#r;this.#r=void 0,await t.end()}}}class vU{#e;#t;constructor(t,r){this.#e=t,this.#t=r}async executeQuery(t){try{const{command:r,rowCount:n,rows:s}=await this.#e.query(t.sql,[...t.parameters]);return{numAffectedRows:r==="INSERT"||r==="UPDATE"||r==="DELETE"||r==="MERGE"?BigInt(n):void 0,rows:s??[]}}catch(r){throw qd(r,new Error)}}async*streamQuery(t,r){if(!this.#t.cursor)throw new Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(r)||r<=0)throw new Error("chunkSize must be a positive integer");const n=this.#e.query(new this.#t.cursor(t.sql,t.parameters.slice()));try{for(;;){const s=await n.read(r);if(s.length===0)break;yield{rows:s}}}finally{await n.close()}}[jy](){this.#e.release()}}class Wy{#e;constructor(t){this.#e=t}createDriver(){return new bU(this.#e)}createQueryCompiler(){return new oU}createAdapter(){return new uU}createIntrospector(t){return new aU(t)}}class EU extends ka{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(t){await qe`exec sp_getapplock @DbPrincipal = ${qe.lit("dbo")}, @Resource = ${qe.lit(Ii)}, @LockMode = ${qe.lit("Exclusive")}`.execute(t)}async releaseMigrationLock(){}}const My=Symbol(),Vy=Symbol(),Fy=Symbol();class _U{#e;#t;constructor(t){this.#e=f({...t});const{tarn:r,tedious:n,validateConnections:s}=this.#e,{validateConnections:i,...o}=r.options;this.#t=new r.Pool({...o,create:async()=>{const a=await n.connectionFactory();return await new NU(a,n).connect()},destroy:async a=>{await a[Vy]()},validate:s===!1||i===!1?void 0:a=>a[Fy]()})}async init(){}async acquireConnection(){return await this.#t.acquire().promise}async beginTransaction(t,r){await t.beginTransaction(r)}async commitTransaction(t){await t.commitTransaction()}async rollbackTransaction(t){await t.rollbackTransaction()}async savepoint(t,r){await t.savepoint(r)}async rollbackToSavepoint(t,r){await t.rollbackTransaction(r)}async releaseConnection(t){(this.#e.resetConnectionsOnRelease||this.#e.tedious.resetConnectionOnRelease)&&await t[My](),this.#t.release(t)}async destroy(){await this.#t.destroy()}}class NU{#e;#t;#r;constructor(t,r){this.#e=t,this.#t=!1,this.#r=r}async beginTransaction(t){const{isolationLevel:r}=t;await new Promise((n,s)=>this.#e.beginTransaction(i=>{i?s(i):n(void 0)},r?my(8):void 0,r?this.#n(r):void 0))}async commitTransaction(){await new Promise((t,r)=>this.#e.commitTransaction(n=>{n?r(n):t(void 0)}))}async connect(){const{promise:t,reject:r,resolve:n}=new si;this.#e.connect(i=>{if(i)return r(i);n()}),this.#e.on("error",i=>{i instanceof Error&&"code"in i&&i.code==="ESOCKET"&&(this.#t=!0),console.error(i),r(i)});function s(){r(new Error("The connection ended without ever completing the connection"))}return this.#e.once("end",s),await t,this.#e.off("end",s),this}async executeQuery(t){try{const r=new si,n=new Oc({compiledQuery:t,tedious:this.#r,onDone:r});this.#e.execSql(n.request);const{rowCount:s,rows:i}=await r.promise;return{numAffectedRows:s!==void 0?BigInt(s):void 0,rows:i}}catch(r){throw qd(r,new Error)}}async rollbackTransaction(t){await new Promise((r,n)=>this.#e.rollbackTransaction(s=>{s?n(s):r(void 0)},t))}async savepoint(t){await new Promise((r,n)=>this.#e.saveTransaction(s=>{s?n(s):r(void 0)},t))}async*streamQuery(t,r){if(!Number.isInteger(r)||r<=0)throw new Error("chunkSize must be a positive integer");const n=new Oc({compiledQuery:t,streamChunkSize:r,tedious:this.#r});this.#e.execSql(n.request);try{for(;;){const s=await n.readChunk();if(s.length===0||(yield{rows:s},s.length<r))break}}finally{await this.#s(n)}}#n(t){const{ISOLATION_LEVEL:r}=this.#r,s={"read committed":r.READ_COMMITTED,"read uncommitted":r.READ_UNCOMMITTED,"repeatable read":r.REPEATABLE_READ,serializable:r.SERIALIZABLE,snapshot:r.SNAPSHOT}[t];if(s===void 0)throw new Error(`Unknown isolation level: ${t}`);return s}#s(t){return new Promise(r=>{t.request.once("requestCompleted",r),this.#e.cancel()||(t.request.off("requestCompleted",r),r())})}[Vy](){return"closed"in this.#e&&this.#e.closed?Promise.resolve():new Promise(t=>{this.#e.once("end",t),this.#e.close()})}async[My](){await new Promise((t,r)=>{this.#e.reset(n=>{if(n)return r(n);t()})})}async[Fy](){if(this.#t||this.#i())return!1;try{const t=new si,r=new Oc({compiledQuery:Vt.raw("select 1"),onDone:t,tedious:this.#r});return this.#e.execSql(r.request),await t.promise,!0}catch{return!1}}#i(){return"closed"in this.#e&&!!this.#e.closed}}class Oc{#e;#t;#r;#n;#s;#i;constructor(t){const{compiledQuery:r,onDone:n,streamChunkSize:s,tedious:i}=t;if(this.#t=[],this.#r=s,this.#n={},this.#s=i,n){const o="onDone";this.#n[o]=(a,c)=>{if(a!=="chunkReady"){if(delete this.#n[o],a==="error")return n.reject(c);n.resolve({rowCount:this.#i,rows:this.#t})}}}this.#e=new this.#s.Request(r.sql,(o,a)=>{if(o)return Object.values(this.#n).forEach(c=>c("error",o instanceof AggregateError?o.errors:o));this.#i=a}),this.#c(r.parameters),this.#a()}get request(){return this.#e}readChunk(){const t=this.readChunk.name;return new Promise((r,n)=>{this.#n[t]=(s,i)=>{if(delete this.#n[t],s==="error")return n(i);r(this.#t.splice(0,this.#r))},this.#e.resume()})}#c(t){for(let r=0;r<t.length;r++){const n=t[r];this.#e.addParameter(String(r+1),this.#o(n),n)}}#a(){const t=this.#r?()=>{this.#r<=this.#t.length&&(this.#e.pause(),Object.values(this.#n).forEach(n=>n("chunkReady")))}:()=>{},r=n=>{const s={};for(const i of n)s[i.metadata.colName]=i.value;this.#t.push(s),t()};this.#e.on("row",r),this.#e.once("requestCompleted",()=>{Object.values(this.#n).forEach(n=>n("completed")),this.#e.off("row",r)})}#o(t){return ga(t)||Or(t)||st(t)?this.#s.TYPES.NVarChar:ba(t)||ks(t)&&t%1===0?t<-2147483648||t>2147483647?this.#s.TYPES.BigInt:this.#s.TYPES.Int:ks(t)?this.#s.TYPES.Float:yi(t)?this.#s.TYPES.Bit:Xw(t)?this.#s.TYPES.DateTime:lC(t)?this.#s.TYPES.VarBinary:this.#s.TYPES.NVarChar}}class AU{#e;constructor(t){this.#e=t}async getSchemas(){return await this.#e.selectFrom("sys.schemas").select("name").execute()}async getTables(t={withInternalKyselyTables:!1}){const r=await this.#e.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",s=>s.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!t.withInternalKyselyTables,s=>s.where("tables.name","!=",Ii).where("tables.name","!=",Ta)).select(["tables.name as table_name",s=>s.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#e.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",s=>s.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),n={};for(const s of r){const i=`${s.table_schema_name}.${s.table_name}`;(n[i]=n[i]||f({columns:[],isView:s.table_type==="V ",name:s.table_name,schema:s.table_schema_name??void 0})).columns.push(f({dataType:s.type_name,dataTypeSchema:s.type_schema_name??void 0,hasDefaultValue:s.column_default_object_id>0||s.column_generated_always_type!=="NOT_APPLICABLE"||s.column_is_identity||s.column_is_computed||s.column_is_rowguidcol,isAutoIncrementing:s.column_is_identity,isNullable:s.column_is_nullable&&s.type_is_nullable,name:s.column_name,comment:s.column_comment??void 0}))}return Object.values(n)}async getMetadata(t){return{tables:await this.getTables(t)}}}const kU=/^[a-z0-9_]$/i;class TU extends Aa{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(t){super.visitOffset(t),this.append(" rows")}compileColumnAlterations(t){const r={};for(const s of t)r[s.kind]||(r[s.kind]=[]),r[s.kind].push(s);let n=!0;r.AddColumnNode&&(this.append("add "),this.compileList(r.AddColumnNode),n=!1),r.AlterColumnNode&&(n||this.append(", "),this.compileList(r.AlterColumnNode)),r.DropColumnNode&&(n||this.append(", "),this.append("drop column "),this.compileList(r.DropColumnNode)),r.ModifyColumnNode&&(n||this.append(", "),this.compileList(r.ModifyColumnNode)),r.RenameColumnNode&&(n||this.append(", "),this.compileList(r.RenameColumnNode))}visitAddColumn(t){this.visitNode(t.column)}visitDropColumn(t){this.visitNode(t.column)}visitMergeQuery(t){super.visitMergeQuery(t),this.append(";")}visitCollate(t){this.append("collate ");const{name:r}=t.collation;for(const n of r)if(!kU.test(n))throw new Error(`Invalid collation: ${r}`);this.append(r)}announcesNewColumnDataType(){return!1}}class SU{#e;constructor(t){this.#e=t}createDriver(){return new _U(this.#e)}createQueryCompiler(){return new TU}createAdapter(){return new EU}createIntrospector(t){return new AU(t)}}function jd(e){if(!e)return null;if("dialect"in e)return jd(e.dialect);if("createDriver"in e){if(e instanceof Ly)return"sqlite";if(e instanceof qy)return"mysql";if(e instanceof Wy)return"postgres";if(e instanceof SU)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":"fileControl"in e||"open"in e&&"close"in e&&"prepare"in e?"sqlite":null}const Zy=async e=>{const t=e.database;if(!t)return{kysely:null,databaseType:null,transaction:void 0};if("db"in t)return{kysely:t.db,databaseType:t.type,transaction:t.transaction};if("dialect"in t)return{kysely:new Ir({dialect:t.dialect}),databaseType:t.type,transaction:t.transaction};let r;const n=jd(t);if("createDriver"in t&&(r=t),"aggregate"in t&&!("createSession"in t)&&(r=new Ly({database:t})),"getConnection"in t&&(r=new qy(t)),"connect"in t&&(r=new Wy({pool:t})),"fileControl"in t){const{BunSqliteDialect:s}=await Gc(async()=>{const{BunSqliteDialect:i}=await import("./bun-sqlite-dialect-CUyp5lZ1.js");return{BunSqliteDialect:i}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]));r=new s({database:t})}if("createSession"in t&&typeof window>"u"){let s;try{({DatabaseSync:s}=await import("node:sqlite"))}catch(i){if(i!==null&&typeof i=="object"&&"code"in i&&i.code!=="ERR_UNKNOWN_BUILTIN_MODULE")throw i}if(s&&t instanceof s){const{NodeSqliteDialect:i}=await Gc(async()=>{const{NodeSqliteDialect:o}=await import("./node-sqlite-dialect-CMtbNv9Z.js");return{NodeSqliteDialect:o}},__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]));r=new i({database:t})}}return{kysely:r?new Ir({dialect:r}):null,databaseType:n,transaction:void 0}},RU=(e,t)=>{let r=null;const n=o=>({getFieldName:a,schema:c,getDefaultModelName:d})=>{const u=async(p,w,g,b)=>{let v;if(t?.type==="mysql"){await w.execute();const y=p.id?"id":b.length>0&&b[0]?.field?b[0].field:"id";if(!p.id&&b.length===0)return v=await o.selectFrom(g).selectAll().orderBy(a({model:g,field:y}),"desc").limit(1).executeTakeFirst(),v;const E=p[y]||b[0]?.value;return v=await o.selectFrom(g).selectAll().orderBy(a({model:g,field:y}),"desc").where(a({model:g,field:y}),"=",E).limit(1).executeTakeFirst(),v}return t?.type==="mssql"?(v=await w.outputAll("inserted").executeTakeFirst(),v):(v=await w.returningAll().executeTakeFirst(),v)};function l(p,w,g){if(g==="id")return p;const{type:b="sqlite"}=t||{};let v=c[w]?.fields[g];return v||(v=Object.values(c).find(y=>y.modelName===w)),v.type==="boolean"&&(b==="sqlite"||b==="mssql")&&p!==null&&p!==void 0?p?1:0:v.type==="date"&&p&&p instanceof Date&&b==="sqlite"?p.toISOString():p}function h(p){function w(g){for(const b in g){if(!Object.prototype.hasOwnProperty.call(g,b))continue;const v=g[b];v instanceof Date&&t?.type==="mysql"||typeof v=="object"&&v!==null&&w(v)}}if(Array.isArray(p))for(let g=0;g<p.length;g++){const b=p[g];typeof b=="object"&&b!==null&&w(b)}else typeof p=="object"&&p!==null&&w(p);return p}function m(p,w){if(!w)return{and:null,or:null};const g={and:[],or:[]};return w.forEach(b=>{let{field:v,value:y,operator:E="=",connector:k="AND"}=b;const A=a({model:p,field:v});y=l(y,p,v);const R=T=>E.toLowerCase()==="in"?T(A,"in",Array.isArray(y)?y:[y]):E.toLowerCase()==="not_in"?T(A,"not in",Array.isArray(y)?y:[y]):E==="contains"?T(A,"like",`%${y}%`):E==="starts_with"?T(A,"like",`${y}%`):E==="ends_with"?T(A,"like",`%${y}`):E==="eq"?T(A,"=",y):E==="ne"?T(A,"<>",y):E==="gt"?T(A,">",y):E==="gte"?T(A,">=",y):E==="lt"?T(A,"<",y):E==="lte"?T(A,"<=",y):T(A,E,y);k==="OR"?g.or.push(R):g.and.push(R)}),{and:g.and.length?g.and:null,or:g.or.length?g.or:null}}return{async create({data:p,model:w}){const g=o.insertInto(w).values(p),b=await u(p,g,w,[]);return h(b)},async findOne({model:p,where:w,select:g}){const{and:b,or:v}=m(p,w);let y=o.selectFrom(p).selectAll();b&&(y=y.where(k=>k.and(b.map(A=>A(k))))),v&&(y=y.where(k=>k.or(v.map(A=>A(k)))));const E=await y.executeTakeFirst();return E?h(E):null},async findMany({model:p,where:w,limit:g,offset:b,sortBy:v}){const{and:y,or:E}=m(p,w);let k=o.selectFrom(p);y&&(k=k.where(R=>R.and(y.map(T=>T(R))))),E&&(k=k.where(R=>R.or(E.map(T=>T(R))))),t?.type==="mssql"?b||(k=k.top(g||100)):k=k.limit(g||100),v&&(k=k.orderBy(a({model:p,field:v.field}),v.direction)),b&&(t?.type==="mssql"?(v||(k=k.orderBy(a({model:p,field:"id"}))),k=k.offset(b).fetch(g||100)):k=k.offset(b));const A=await k.selectAll().execute();return A?h(A):[]},async update({model:p,where:w,update:g}){const{and:b,or:v}=m(p,w);let y=o.updateTable(p).set(g);return b&&(y=y.where(E=>E.and(b.map(k=>k(E))))),v&&(y=y.where(E=>E.or(v.map(k=>k(E))))),h(await u(g,y,p,w))},async updateMany({model:p,where:w,update:g}){const{and:b,or:v}=m(p,w);let y=o.updateTable(p).set(g);return b&&(y=y.where(k=>k.and(b.map(A=>A(k))))),v&&(y=y.where(k=>k.or(v.map(A=>A(k))))),(await y.execute()).length},async count({model:p,where:w}){const{and:g,or:b}=m(p,w);let v=o.selectFrom(p).select(o.fn.count("id").as("count"));g&&(v=v.where(E=>E.and(g.map(k=>k(E))))),b&&(v=v.where(E=>E.or(b.map(k=>k(E)))));const y=await v.execute();return typeof y[0].count=="number"?y[0].count:typeof y[0].count=="bigint"?Number(y[0].count):parseInt(y[0].count)},async delete({model:p,where:w}){const{and:g,or:b}=m(p,w);let v=o.deleteFrom(p);g&&(v=v.where(y=>y.and(g.map(E=>E(y))))),b&&(v=v.where(y=>y.or(b.map(E=>E(y))))),await v.execute()},async deleteMany({model:p,where:w}){const{and:g,or:b}=m(p,w);let v=o.deleteFrom(p);return g&&(v=v.where(y=>y.and(g.map(E=>E(y))))),b&&(v=v.where(y=>y.or(b.map(E=>E(y))))),(await v.execute()).length},options:t}};let s=null;s={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:!(t?.type==="sqlite"||t?.type==="mssql"||t?.type==="mysql"||!t?.type),supportsDates:!(t?.type==="sqlite"||t?.type==="mssql"||!t?.type),supportsJSON:!1,transaction:t?.transaction??!1?o=>e.transaction().execute(a=>{const c=To({config:s.config,adapter:n(a)})(r);return o(c)}):!1},adapter:n(e)};const i=To(s);return o=>(r=o,i(o))},IU=(e,t)=>{let r=null,n=To({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:!1,customTransformInput(s){return s.options.advanced?.database?.useNumberId&&s.field==="id"&&s.action==="create"?e[s.model].length+1:s.data},transaction:async s=>{let i=structuredClone(e);try{return await s(n(r))}catch(o){throw Object.keys(e).forEach(a=>{e[a]=i[a]}),o}}},adapter:({getFieldName:s,options:i,debugLog:o})=>{function a(c,d){const u=e[d];if(!u)throw te.error(`[MemoryAdapter] Model ${d} not found in the DB`,Object.keys(e)),new Error(`Model ${d} not found`);const l=(h,m)=>{const{field:p,value:w,operator:g}=m;switch(g){case"in":if(!Array.isArray(w))throw new Error("Value must be an array");return w.includes(h[p]);case"not_in":if(!Array.isArray(w))throw new Error("Value must be an array");return!w.includes(h[p]);case"contains":return h[p].includes(w);case"starts_with":return h[p].startsWith(w);case"ends_with":return h[p].endsWith(w);case"ne":return h[p]!==w;case"gt":return w!=null&&h[p]>w;case"gte":return w!=null&&h[p]>=w;case"lt":return w!=null&&h[p]<w;case"lte":return w!=null&&h[p]<=w;default:return h[p]===w}};return u.filter(h=>{if(!c.length||c.length===0)return!0;let m=l(h,c[0]);for(const p of c){const w=l(h,p);p.connector==="OR"?m=m||w:m=m&&w}return m})}return{create:async({model:c,data:d})=>(i.advanced?.database?.useNumberId&&(d.id=e[c].length+1),e[c]||(e[c]=[]),e[c].push(d),d),findOne:async({model:c,where:d})=>a(d,c)[0]||null,findMany:async({model:c,where:d,sortBy:u,limit:l,offset:h})=>{let m=e[c];return d&&(m=a(d,c)),u&&(m=m.sort((p,w)=>{const g=s({model:c,field:u.field}),b=p[g],v=w[g];let y=0;return b==null&&v==null?y=0:b==null?y=-1:v==null?y=1:typeof b=="string"&&typeof v=="string"?y=b.localeCompare(v):b instanceof Date&&v instanceof Date?y=b.getTime()-v.getTime():typeof b=="number"&&typeof v=="number"?y=b-v:typeof b=="boolean"&&typeof v=="boolean"?y=b===v?0:b?1:-1:y=String(b).localeCompare(String(v)),u.direction==="asc"?y:-y})),h!==void 0&&(m=m.slice(h)),l!==void 0&&(m=m.slice(0,l)),m||[]},count:async({model:c,where:d})=>d?a(d,c).length:e[c].length,update:async({model:c,where:d,update:u})=>{const l=a(d,c);return l.forEach(h=>{Object.assign(h,u)}),l[0]||null},delete:async({model:c,where:d})=>{const u=e[c],l=a(d,c);e[c]=u.filter(h=>!l.includes(h))},deleteMany:async({model:c,where:d})=>{const u=e[c],l=a(d,c);let h=0;return e[c]=u.filter(m=>l.includes(m)?(h++,!1):!l.includes(m)),h},updateMany({model:c,where:d,update:u}){const l=a(d,c);return l.forEach(h=>{Object.assign(h,u)}),l[0]||null}}}});return s=>(r=s,n(s))};function OU(e,t){const r=t.hooks;async function n(o,a,c,d,u){let l=o;for(const p of r||[]){const w=p[a]?.create?.before;if(w){const g=await w(l,d);if(g===!1)return null;typeof g=="object"&&"data"in g&&(l={...l,...g.data})}}const h=c?await c.fn(l):null,m=!c||c.executeMainFn?await(u||e).create({model:a,data:l,forceAllowId:!0}):h;for(const p of r||[]){const w=p[a]?.create?.after;w&&await w(m,d)}return m}async function s(o,a,c,d,u,l){let h=o;for(const w of r||[]){const g=w[c]?.update?.before;if(g){const b=await g(o,u);if(b===!1)return null;h=typeof b=="object"?b.data:b}}const m=d?await d.fn(h):null,p=!d||d.executeMainFn?await(l||e).update({model:c,update:h,where:a}):m;for(const w of r||[]){const g=w[c]?.update?.after;g&&await g(p,u)}return p}async function i(o,a,c,d,u,l){let h=o;for(const w of r||[]){const g=w[c]?.update?.before;if(g){const b=await g(o,u);if(b===!1)return null;h=typeof b=="object"?b.data:b}}const m=d?await d.fn(h):null,p=!d||d.executeMainFn?await(l||e).updateMany({model:c,update:h,where:a}):m;for(const w of r||[]){const g=w[c]?.update?.after;g&&await g(p,u)}return p}return{createWithHooks:n,updateWithHooks:s,updateManyWithHooks:i}}const By=(e,t)=>{const r=t.logger,n=t.options,s=n.secondaryStorage,i=n.session?.expiresIn||3600*24*7,{createWithHooks:o,updateWithHooks:a,updateManyWithHooks:c}=OU(e,t);async function d(u){if(!s)return;const l=await s.get(`active-sessions-${u.id}`);if(!l)return;const h=Date.now(),p=(ht(l)||[]).filter(w=>w.expiresAt>h);await Promise.all(p.map(async({token:w})=>{const g=await s.get(w);if(!g)return;const b=ht(g);if(!b)return;const v=Math.max(Math.floor(new Date(b.session.expiresAt).getTime()-h)/1e3,0);await s.set(w,JSON.stringify({session:b.session,user:u}),Math.floor(v))}))}return{createOAuthUser:async(u,l,h)=>e.transaction(async m=>{const p=await o({createdAt:new Date,updatedAt:new Date,...u},"user",void 0,h,m),w=await o({...l,userId:p.id,createdAt:new Date,updatedAt:new Date},"account",void 0,h,m);return{user:p,account:w}}),createUser:async(u,l,h)=>await o({createdAt:new Date,updatedAt:new Date,...u,email:u.email?.toLowerCase()},"user",void 0,l,h),createAccount:async(u,l,h)=>await o({createdAt:new Date,updatedAt:new Date,...u},"account",void 0,l,h),listSessions:async(u,l)=>{if(s){const m=await s.get(`active-sessions-${u}`);if(!m)return[];const p=ht(m)||[],w=Date.now(),g=p.filter(v=>v.expiresAt>w),b=[];for(const v of g){const y=await s.get(v.token);if(y){const E=ht(y);if(!E)return[];const k=Tc(t.options,{...E.session,expiresAt:new Date(E.session.expiresAt)});b.push(k)}}return b}return await(l||e).findMany({model:"session",where:[{field:"userId",value:u}]})},listUsers:async(u,l,h,m,p)=>await(p||e).findMany({model:"user",limit:u,offset:l,sortBy:h,where:m}),countTotalUsers:async(u,l)=>{const h=await(l||e).count({model:"user",where:u});return typeof h=="string"?parseInt(h):h},deleteUser:async(u,l)=>{s&&await s.delete(`active-sessions-${u}`),(!s||n.session?.storeSessionInDatabase)&&await(l||e).deleteMany({model:"session",where:[{field:"userId",value:u}]}),await(l||e).deleteMany({model:"account",where:[{field:"userId",value:u}]}),await(l||e).delete({model:"user",where:[{field:"id",value:u}]})},createSession:async(u,l,h,m,p,w)=>{const g=l.headers||l.request?.headers,{id:b,...v}=m||{},y={ipAddress:(l.request||l.headers)&&Yw(l.request||l.headers,l.context.options)||"",userAgent:g?.get("user-agent")||"",...v,expiresAt:pr(h?3600*24:i,"sec"),userId:u,token:Ht(32),createdAt:new Date,updatedAt:new Date,...p?v:{}};return await o(y,"session",s?{fn:async k=>{const A=await s.get(`active-sessions-${u}`);let R=[];const T=Date.now();A&&(R=ht(A)||[],R=R.filter(I=>I.expiresAt>T));const L=R.sort((I,C)=>I.expiresAt-C.expiresAt);let P=L.at(-1)?.expiresAt;L.push({token:y.token,expiresAt:y.expiresAt.getTime()}),(!P||P<y.expiresAt.getTime())&&(P=y.expiresAt.getTime());const W=Math.max(Math.floor((P-T)/1e3),0);W>0&&await s.set(`active-sessions-${u}`,JSON.stringify(L),W);const j=await e.findOne({model:"user",where:[{field:"id",value:u}]}),V=Math.max(Math.floor((y.expiresAt.getTime()-T)/1e3),0);return V>0&&await s.set(y.token,JSON.stringify({session:k,user:j}),V),k},executeMainFn:n.session?.storeSessionInDatabase}:void 0,l,w)},findSession:async(u,l)=>{if(s){const g=await s.get(u);if(!g&&!n.session?.storeSessionInDatabase)return null;if(g){const b=ht(g);if(!b)return null;const v=Tc(t.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),y=mu(t.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return{session:v,user:y}}}const h=await(l||e).findOne({model:"session",where:[{value:u,field:"token"}]});if(!h)return null;const m=await(l||e).findOne({model:"user",where:[{value:h.userId,field:"id"}]});if(!m)return null;const p=Tc(t.options,h),w=mu(t.options,m);return{session:p,user:w}},findSessions:async(u,l)=>{if(s){const w=[];for(const g of u){const b=await s.get(g);if(b){const v=ht(b);if(!v)return[];const y={session:{...v.session,expiresAt:new Date(v.session.expiresAt)},user:{...v.user,createdAt:new Date(v.user.createdAt),updatedAt:new Date(v.user.updatedAt)}};w.push(y)}}return w}const h=await(l||e).findMany({model:"session",where:[{field:"token",value:u,operator:"in"}]}),m=h.map(w=>w.userId);if(!m.length)return[];const p=await(l||e).findMany({model:"user",where:[{field:"id",value:m,operator:"in"}]});return h.map(w=>{const g=p.find(b=>b.id===w.userId);return g?{session:w,user:g}:null})},updateSession:async(u,l,h,m)=>await a(l,[{field:"token",value:u}],"session",s?{async fn(w){const g=await s.get(u);let b=null;if(g){const v=ht(g);return v?(b={...v.session,...w},b):null}else return null},executeMainFn:n.session?.storeSessionInDatabase}:void 0,h,m),deleteSession:async(u,l)=>{if(s){const h=await s.get(u);if(h){const{session:m}=ht(h)??{};if(!m){r.error("Session not found in secondary storage");return}const p=m.userId,w=await s.get(`active-sessions-${p}`);if(w){let g=ht(w)||[];const b=Date.now(),v=g.filter(k=>k.expiresAt>b&&k.token!==u),E=v.sort((k,A)=>k.expiresAt-A.expiresAt).at(-1)?.expiresAt;v.length>0&&E&&E>Date.now()?await s.set(`active-sessions-${p}`,JSON.stringify(v),Math.floor((E-b)/1e3)):await s.delete(`active-sessions-${p}`)}else r.error("Active sessions list not found in secondary storage")}if(await s.delete(u),!n.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await(l||e).delete({model:"session",where:[{field:"token",value:u}]})},deleteAccounts:async(u,l)=>{await(l||e).deleteMany({model:"account",where:[{field:"userId",value:u}]})},deleteAccount:async(u,l)=>{await(l||e).delete({model:"account",where:[{field:"id",value:u}]})},deleteSessions:async(u,l)=>{if(s){if(typeof u=="string"){const h=await s.get(`active-sessions-${u}`),m=h?ht(h):[];if(!m)return;for(const p of m)await s.delete(p.token)}else for(const h of u)await s.get(h)&&await s.delete(h);if(!n.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await(l||e).deleteMany({model:"session",where:[{field:Array.isArray(u)?"token":"userId",value:u,operator:Array.isArray(u)?"in":void 0}]})},findOAuthUser:async(u,l,h,m)=>{const p=await(m||e).findMany({model:"account",where:[{value:l,field:"accountId"}]}).then(w=>w.find(g=>g.providerId===h));if(p){const w=await(m||e).findOne({model:"user",where:[{value:p.userId,field:"id"}]});if(w)return{user:w,accounts:[p]};{const g=await(m||e).findOne({model:"user",where:[{value:u.toLowerCase(),field:"email"}]});return g?{user:g,accounts:[p]}:null}}else{const w=await(m||e).findOne({model:"user",where:[{value:u.toLowerCase(),field:"email"}]});if(w){const g=await(m||e).findMany({model:"account",where:[{value:w.id,field:"userId"}]});return{user:w,accounts:g||[]}}else return null}},findUserByEmail:async(u,l,h)=>{const m=await(h||e).findOne({model:"user",where:[{value:u.toLowerCase(),field:"email"}]});if(!m)return null;if(l?.includeAccounts){const p=await(h||e).findMany({model:"account",where:[{value:m.id,field:"userId"}]});return{user:m,accounts:p}}return{user:m,accounts:[]}},findUserById:async(u,l)=>await(l||e).findOne({model:"user",where:[{field:"id",value:u}]}),linkAccount:async(u,l,h)=>await o({createdAt:new Date,updatedAt:new Date,...u},"account",void 0,l,h),updateUser:async(u,l,h,m)=>{const p=await a(l,[{field:"id",value:u}],"user",void 0,h,m);return await d(p),await d(p),p},updateUserByEmail:async(u,l,h,m)=>{const p=await a(l,[{field:"email",value:u.toLowerCase()}],"user",void 0,h,m);return await d(p),await d(p),p},updatePassword:async(u,l,h,m)=>{await c({password:l},[{field:"userId",value:u},{field:"providerId",value:"credential"}],"account",void 0,h,m)},findAccounts:async(u,l)=>await(l||e).findMany({model:"account",where:[{field:"userId",value:u}]}),findAccount:async(u,l)=>await(l||e).findOne({model:"account",where:[{field:"accountId",value:u}]}),findAccountByProviderId:async(u,l,h)=>await(h||e).findOne({model:"account",where:[{field:"accountId",value:u},{field:"providerId",value:l}]}),findAccountByUserId:async(u,l)=>await(l||e).findMany({model:"account",where:[{field:"userId",value:u}]}),updateAccount:async(u,l,h,m)=>await a(l,[{field:"id",value:u}],"account",void 0,h,m),createVerificationValue:async(u,l,h)=>await o({createdAt:new Date,updatedAt:new Date,...u},"verification",void 0,l,h),findVerificationValue:async(u,l)=>{const h=await(l||e).findMany({model:"verification",where:[{field:"identifier",value:u}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return n.verification?.disableCleanup||await(l||e).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),h[0]},deleteVerificationValue:async(u,l)=>{await(l||e).delete({model:"verification",where:[{field:"id",value:u}]})},deleteVerificationByIdentifier:async(u,l)=>{await(l||e).delete({model:"verification",where:[{field:"identifier",value:u}]})},updateVerificationValue:async(u,l,h,m)=>await a(l,[{field:"id",value:u}],"verification",void 0,h,m)}};async function $U(e){if(!e.database){const s=li(e),i=Object.keys(s).reduce((o,a)=>(o[a]=[],o),{});return te.warn("No database configuration provided. Using memory adapter in development"),IU(i)(e)}if(typeof e.database=="function")return e.database(e);const{kysely:t,databaseType:r,transaction:n}=await Zy(e);if(!t)throw new ve("Failed to initialize database adapter");return RU(t,{type:r||"sqlite",debugLogs:"debugLogs"in e.database?e.database.debugLogs:!1,transaction:n})(e)}function CU(e){const t=li(e);let r={};for(const n in t){const s=t[n],i=s.fields;let o={};if(Object.entries(i).forEach(([a,c])=>{if(o[c.fieldName||a]=c,c.references){const d=t[c.references.model];d&&(o[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),r[s.modelName]){r[s.modelName].fields={...r[s.modelName].fields,...o};continue}r[s.modelName]={fields:o,order:s.order||1/0}}return r}const xU={string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},UU={string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},PU={string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},DU={string:["varchar","nvarchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]},LU={postgres:xU,mysql:UU,sqlite:PU,mssql:DU};function zU(e,t,r){function n(o){return o.toLowerCase().split("(")[0].trim()}if(t==="string[]"||t==="number[]")return e.toLowerCase().includes("json");const s=LU[r];return(Array.isArray(t)?s.string.map(o=>o.toLowerCase()):s[t].map(o=>o.toLowerCase())).includes(n(e))}async function qU(e){const t=CU(e),r=Bu(e.logger);let{kysely:n,databaseType:s}=await Zy(e);s||(r.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),s="sqlite"),n||(r.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));const i=await n.introspection.getTables(),o=[],a=[];for(const[h,m]of Object.entries(t)){const p=i.find(g=>g.name===h);if(!p){const g=o.findIndex(y=>y.table===h),b={table:h,fields:m.fields,order:m.order||1/0},v=o.findIndex(y=>(y.order||1/0)>b.order);v===-1?g===-1?o.push(b):o[g].fields={...o[g].fields,...m.fields}:o.splice(v,0,b);continue}let w={};for(const[g,b]of Object.entries(m.fields)){const v=p.columns.find(y=>y.name===g);if(!v){w[g]=b;continue}zU(v.dataType,b.type,s)||r.warn(`Field ${g} in table ${h} has a different type in the database. Expected ${b.type} but got ${v.dataType}.`)}Object.keys(w).length>0&&a.push({table:h,fields:w,order:m.order||1/0})}const c=[];function d(h,m){const p=h.type,w={string:{sqlite:"text",postgres:"text",mysql:h.unique?"varchar(255)":h.references?"varchar(36)":"text",mssql:h.unique||h.sortable?"varchar(255)":h.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:h.bigint?"bigint":"integer",postgres:h.bigint?"bigint":"integer",mysql:h.bigint?"bigint":"integer",mssql:h.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:qe`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:e.advanced?.database?.useNumberId?"serial":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"},foreignKeyId:{postgres:e.advanced?.database?.useNumberId?"integer":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"}};return m==="id"||h.references?.field==="id"?m==="id"?w.id[s]:w.foreignKeyId[s]:s==="sqlite"&&(p==="string[]"||p==="number[]")?"text":p==="string[]"||p==="number[]"?"jsonb":Array.isArray(p)?"text":w[p][s||"sqlite"]}if(a.length)for(const h of a)for(const[m,p]of Object.entries(h.fields)){const w=d(p,m),g=n.schema.alterTable(h.table).addColumn(m,w,b=>(b=p.required!==!1?b.notNull():b,p.references&&(b=b.references(`${p.references.model}.${p.references.field}`).onDelete(p.references.onDelete||"cascade")),p.unique&&(b=b.unique()),p.type==="date"&&typeof p.defaultValue=="function"&&(s==="postgres"||s==="mysql"||s==="mssql")&&(s==="mysql"?b=b.defaultTo(qe`CURRENT_TIMESTAMP(3)`):b=b.defaultTo(qe`CURRENT_TIMESTAMP`)),b));c.push(g)}if(o.length)for(const h of o){let m=n.schema.createTable(h.table).addColumn("id",e.advanced?.database?.useNumberId?s==="postgres"?"serial":"integer":s==="mysql"||s==="mssql"?"varchar(36)":"text",p=>e.advanced?.database?.useNumberId?s==="postgres"||s==="sqlite"?p.primaryKey().notNull():s==="mssql"?p.identity().primaryKey().notNull():p.autoIncrement().primaryKey().notNull():p.primaryKey().notNull());for(const[p,w]of Object.entries(h.fields)){const g=d(w,p);m=m.addColumn(p,g,b=>(b=w.required!==!1?b.notNull():b,w.references&&(b=b.references(`${w.references.model}.${w.references.field}`).onDelete(w.references.onDelete||"cascade")),w.unique&&(b=b.unique()),w.type==="date"&&typeof w.defaultValue=="function"&&(s==="postgres"||s==="mysql"||s==="mssql")&&(s==="mysql"?b=b.defaultTo(qe`CURRENT_TIMESTAMP(3)`):b=b.defaultTo(qe`CURRENT_TIMESTAMP`)),b))}c.push(m)}async function u(){for(const h of c)await h.execute()}async function l(){return c.map(m=>m.compile().sql).join(`;

`)+";"}return{toBeCreated:o,toBeAdded:a,runMigrations:u,compileMigrations:l}}var jU={};const Hy=e=>e({},{optionsOnly:!0});if(YR.lt(At,"1.25.0"))throw new Error("Convex version must be at least 1.25.0");const WU=(e,t)=>{const r=async s=>{const i=await s.auth.getUserIdentity();if(!i)return;const o=await s.runQuery(e.adapter.findOne,{model:"user",where:[{field:"_id",value:i.subject}]});if(o)return o},n=async s=>{const i=await s.auth.getUserIdentity();if(!i)return new Headers;const o=await s.runQuery(e.adapter.findOne,{model:"session",where:[{field:"_id",value:i.sessionId}]});return new Headers({...o?.token?{authorization:`Bearer ${o.token}`}:{},...o?.ipAddress?{"x-forwarded-for":o.ipAddress}:{}})};return{component:e,adapter:s=>hR(s,e,{...t,debugLogs:t?.verbose}),getAuth:async(s,i)=>({auth:s(i),headers:await n(i)}),getHeaders:n,safeGetAuthUser:r,getAuthUser:async s=>{const i=await r(s);if(!i)throw new Error("Unauthenticated");return i},getAnyUserById:async(s,i)=>await s.runQuery(e.adapter.findOne,{model:"user",where:[{field:"_id",value:i}]}),setUserId:async(s,i,o)=>{await s.runMutation(e.adapter.updateOne,{input:{model:"user",where:[{field:"_id",value:i}],update:{userId:o}}})},migrationGetUser:async(s,i)=>await s.runQuery(e.adapter.findOne,{model:"user",where:[{field:"userId",value:i}]}),migrationRemoveUserId:async(s,i)=>{if(!e.adapter.migrationRemoveUserId)throw new Error("migrationRemoveUserId not found");await s.runMutation(e.adapter.migrationRemoveUserId,{userId:i})},triggersApi:()=>({onCreate:Oa({args:{doc:N.any(),model:N.string()},handler:async(s,i)=>{await t?.triggers?.[i.model]?.onCreate?.(s,i.doc)}}),onUpdate:Oa({args:{oldDoc:N.any(),newDoc:N.any(),model:N.string()},handler:async(s,i)=>{await t?.triggers?.[i.model]?.onUpdate?.(s,i.newDoc,i.oldDoc)}}),onDelete:Oa({args:{doc:N.any(),model:N.string()},handler:async(s,i)=>{await t?.triggers?.[i.model]?.onDelete?.(s,i.doc)}})}),registerRoutes:(s,i,o={})=>{const a=Hy(i),c=a.options.basePath??"/api/auth",d=Kc(async(p,w)=>{t?.verbose&&(console.log("options.baseURL",a.options.baseURL),console.log("request headers",w.headers));const b=await i(p).handler(w);return t?.verbose&&console.log("response headers",b.headers),b});if(s.lookup("/.well-known/openid-configuration","GET")||s.route({path:"/.well-known/openid-configuration",method:"GET",handler:Kc(async()=>{const p=`${jU.CONVEX_SITE_URL}${c}/convex/.well-known/openid-configuration`;return Response.redirect(p)})}),!o.cors){s.route({pathPrefix:`${c}/`,method:"GET",handler:d}),s.route({pathPrefix:`${c}/`,method:"POST",handler:d});return}const l=typeof o.cors=="boolean"?{allowedOrigins:[],allowedHeaders:[],exposedHeaders:[]}:o.cors;let h;const m=_R(s,{allowedOrigins:async p=>(h=h??(await a.$context).options.trustedOrigins??[],(Array.isArray(h)?h:await h(p)).map(g=>g.endsWith("*")&&g.length>1?g.slice(0,-1):g).concat(l.allowedOrigins??[])),allowCredentials:!0,allowedHeaders:["Content-Type","Better-Auth-Cookie","Authorization"].concat(l.allowedHeaders??[]),exposedHeaders:["Set-Better-Auth-Cookie"].concat(l.exposedHeaders??[]),debug:t?.verbose,enforceAllowOrigins:!1});m.route({pathPrefix:`${c}/`,method:"GET",handler:d}),m.route({pathPrefix:`${c}/`,method:"POST",handler:d})}}},Wd=(e="SHA-256",t="none")=>{const r={importKey:async(n,s)=>Nn().importKey("raw",typeof n=="string"?new TextEncoder().encode(n):n,{name:"HMAC",hash:{name:e}},!1,[s]),sign:async(n,s)=>{typeof n=="string"&&(n=await r.importKey(n,"sign"));const i=await Nn().sign("HMAC",n,typeof s=="string"?new TextEncoder().encode(s):s);return t==="hex"?ko.encode(i):t==="base64"||t==="base64url"||t==="base64urlnopad"?jn.encode(i,{padding:t!=="base64urlnopad"}):i},verify:async(n,s,i)=>(typeof n=="string"&&(n=await r.importKey(n,"verify")),t==="hex"&&(i=ko.decode(i)),(t==="base64"||t==="base64url"||t==="base64urlnopad")&&(i=await er.decode(i)),Nn().verify("HMAC",n,typeof i=="string"?new TextEncoder().encode(i):i,typeof s=="string"?new TextEncoder().encode(s):s))};return r},$c=new Map,MU=new TextEncoder,VU={decode:(e,t="utf-8")=>($c.has(t)||$c.set(t,new TextDecoder(t)),$c.get(t).decode(e)),encode:MU.encode},Vo=1e3,Fo=Vo*60,Zo=Fo*60,Ei=Zo*24,_u=Ei*7,Bo=Ei*365.25,Nu=Bo/12;function Ky(e,t){if(typeof e=="string")return FU(e);if(typeof e=="number")return BU(e);throw new Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(e)}`)}function FU(e){if(typeof e!="string"||e.length===0||e.length>100)throw new Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(e)}`);const t=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(e);if(!t?.groups)return NaN;const{value:r,unit:n="ms"}=t.groups,s=parseFloat(r),i=n.toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return s*Bo;case"months":case"month":case"mo":return s*Nu;case"weeks":case"week":case"w":return s*_u;case"days":case"day":case"d":return s*Ei;case"hours":case"hour":case"hrs":case"hr":case"h":return s*Zo;case"minutes":case"minute":case"mins":case"min":case"m":return s*Fo;case"seconds":case"second":case"secs":case"sec":case"s":return s*Vo;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:throw new Error(`Unknown unit "${i}" provided to ms.parse(). value=${JSON.stringify(e)}`)}}function ZU(e){const t=Math.abs(e);return t>=Bo?`${Math.round(e/Bo)}y`:t>=Nu?`${Math.round(e/Nu)}mo`:t>=_u?`${Math.round(e/_u)}w`:t>=Ei?`${Math.round(e/Ei)}d`:t>=Zo?`${Math.round(e/Zo)}h`:t>=Fo?`${Math.round(e/Fo)}m`:t>=Vo?`${Math.round(e/Vo)}s`:`${e}ms`}function BU(e,t){if(typeof e!="number"||!Number.isFinite(e))throw new Error("Value provided to ms.format() must be of type number.");return ZU(e)}function Jy(e){const t=new Map;return e.split(", ").forEach(n=>{const s=n.split(";").map(l=>l.trim()),[i,...o]=s,[a,...c]=(i||"").split("="),d=c.join("=");if(!a||d===void 0)return;const u={value:d};o.forEach(l=>{const[h,...m]=l.split("="),p=m.join("="),w=h.trim().toLowerCase();switch(w){case"max-age":u["max-age"]=p?parseInt(p.trim(),10):void 0;break;case"expires":u.expires=p?new Date(p.trim()):void 0;break;case"domain":u.domain=p?p.trim():void 0;break;case"path":u.path=p?p.trim():void 0;break;case"secure":u.secure=!0;break;case"httponly":u.httponly=!0;break;case"samesite":u.samesite=p?p.trim().toLowerCase():void 0;break;default:u[w]=p?p.trim():!0;break}}),t.set(a,u)}),t}function Gy(e){const r=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?!!e.baseURL.startsWith("https://"):jc)?"__Secure-":"",n=!!e.advanced?.crossSubDomainCookies?.enabled,s=n?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(n&&!s)throw new ve("baseURL is required when crossSubdomainCookies are enabled");function i(o,a={}){const c=e.advanced?.cookiePrefix||"better-auth",d=e.advanced?.cookies?.[o]?.name||`${c}.${o}`,u=e.advanced?.cookies?.[o]?.attributes;return{name:`${r}${d}`,attributes:{secure:!!r,sameSite:"lax",path:"/",httpOnly:!0,...n?{domain:s}:{},...e.advanced?.defaultCookieAttributes,...a,...u}}}return i}function HU(e){const t=Gy(e),r=e.session?.expiresIn||Ky("7d")/1e3,n=t("session_token",{maxAge:r}),s=t("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),i=t("dont_remember");return{sessionToken:{name:n.name,options:n.attributes},sessionData:{name:s.name,options:s.attributes},dontRememberToken:{name:i.name,options:i.attributes}}}async function Qy(e,t,r){if(e.context.options.session?.cookieCache?.enabled){const i={session:Object.entries(t.session).reduce((d,[u,l])=>{const h=e.context.options.session?.additionalFields?.[u];return(!h||h.returned!==!1)&&(d[u]=l),d},{}),user:t.user},o={...e.context.authCookies.sessionData.options,maxAge:r?void 0:e.context.authCookies.sessionData.options.maxAge},a=pr(o.maxAge||60,"sec").getTime(),c=jn.encode(JSON.stringify({session:i,expiresAt:a,signature:await Wd("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...i,expiresAt:a}))}),{padding:!1});if(c.length>4093){e.context?.logger?.error(`Session data exceeds cookie size limit (${c.length} bytes > 4093 bytes). Consider reducing session data size or disabling cookie cache. Session will not be cached in cookie.`);return}e.setCookie(e.context.authCookies.sessionData.name,c,o)}}async function Nt(e,t,r,n){const s=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=r!==void 0?r:!!s;const i=e.context.authCookies.sessionToken.options,o=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...i,maxAge:o,...n}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await Qy(e,t,r),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function Un(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}const Yy=ps(async()=>({})),et=ps.create({use:[Yy,ps(async()=>({}))]}),K=go.create({use:[Yy]}),Q={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."},KU=fi(G({disableCookieCache:Gl().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:Gl().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),Xy=()=>K("/get-session",{method:"GET",query:KU,requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{try{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;const r=e.getCookie(e.context.authCookies.sessionData.name),n=r?ht(VU.decode(jn.decode(r))):null;if(n&&!await Wd("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...n.session,expiresAt:n.expiresAt}),n.signature)){const l=e.context.authCookies.sessionData.name;return e.setCookie(l,"",{maxAge:0}),e.json(null)}const s=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(n?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){const u=n.session;if(n.expiresAt<Date.now()||u.session.expiresAt<new Date){const h=e.context.authCookies.sessionData.name;e.setCookie(h,"",{maxAge:0})}else return e.context.session=u,e.json(u)}const i=await e.context.internalAdapter.findSession(t);if(e.context.session=i,!i||i.session.expiresAt<new Date)return Un(e),i&&await e.context.internalAdapter.deleteSession(i.session.token),e.json(null);if(s||e.query?.disableRefresh)return e.json(i);const o=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge;if(i.session.expiresAt.valueOf()-o*1e3+a*1e3<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){const u=await e.context.internalAdapter.updateSession(i.session.token,{expiresAt:pr(e.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!u)return Un(e),e.json(null,{status:401});const l=(u.expiresAt.valueOf()-Date.now())/1e3;return await Nt(e,{session:u,user:i.user},!1,{maxAge:l}),e.json({session:u,user:i.user})}return await Qy(e,i,!!s),e.json(i)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new _("INTERNAL_SERVER_ERROR",{message:Q.FAILED_TO_GET_SESSION})}}),ut=async(e,t)=>{if(e.context.session)return e.context.session;const r=await Xy()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(n=>null);return e.context.session=r,r},rr=et(async e=>{const t=await ut(e);if(!t?.session)throw new _("UNAUTHORIZED");return{session:t}}),Zn=et(async e=>{const t=await ut(e,{disableCookieCache:!0});if(!t?.session)throw new _("UNAUTHORIZED");return{session:t}});et(async e=>{const t=await ut(e);if(!t?.session&&(e.request||e.headers))throw new _("UNAUTHORIZED");return{session:t}});const JU=et(async e=>{const t=await ut(e);if(!t?.session)throw new _("UNAUTHORIZED");if(e.context.sessionConfig.freshAge===0)return{session:t};const r=e.context.sessionConfig.freshAge,n=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-n<r*1e3))throw new _("FORBIDDEN",{message:"Session is not fresh"});return{session:t}}),GU=()=>K("/list-sessions",{method:"GET",use:[rr],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async e=>{try{const r=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter(n=>n.expiresAt>new Date);return e.json(r)}catch(t){throw e.context.logger.error(t),e.error("INTERNAL_SERVER_ERROR")}}),QU=K("/revoke-session",{method:"POST",body:G({token:S().meta({description:"The token to revoke"})}),use:[Zn],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new _("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new _("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(n){throw e.context.logger.error(n&&typeof n=="object"&&"name"in n?n.name:"",n),new _("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),YU=K("/revoke-sessions",{method:"POST",use:[Zn],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&typeof t=="object"&&"name"in t?t.name:"",t),new _("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),XU=K("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[Zn],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.context.session;if(!t.user)throw new _("UNAUTHORIZED");const s=(await e.context.internalAdapter.listSessions(t.user.id)).filter(i=>i.expiresAt>new Date).filter(i=>i.token!==e.context.session.session.token);return await Promise.all(s.map(i=>e.context.internalAdapter.deleteSession(i.token))),e.json({status:!0})});async function eP(e,t,r=3600){return await new ud(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}function tP(e,t){const r=new Uint8Array(e),n=new Uint8Array(t);let s=r.length^n.length;const i=Math.max(r.length,n.length);for(let o=0;o<i;o++)s|=(o<r.length?r[o]:0)^(o<n.length?n[o]:0);return s===0}async function pp(e){const t=await Wn("SHA-256").digest(e);return er.encode(t)}const rs={N:16384,r:16,p:1,dkLen:64};async function eg(e,t){return await YS(e.normalize("NFKC"),t,{N:rs.N,p:rs.p,r:rs.r,dkLen:rs.dkLen,maxmem:128*rs.N*rs.r*2})}const rP=async e=>{const t=ko.encode(crypto.getRandomValues(new Uint8Array(16))),r=await eg(e,t);return`${t}:${ko.encode(r)}`},nP=async({hash:e,password:t})=>{const[r,n]=e.split(":");if(!r||!n)throw new ve("Invalid password hash");const s=await eg(t,r);return tP(s,Mg(n))},Md=async({key:e,data:t})=>{const r=await Wn("SHA-256").digest(e),n=DT(t),s=Jm(Ym)(new Uint8Array(r));return UT(s.encrypt(n))},Vd=async({key:e,data:t})=>{const r=await Wn("SHA-256").digest(e),n=PT(t),s=Jm(Ym)(new Uint8Array(r));return new TextDecoder().decode(s.decrypt(n))};function Cc(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function Au(e,t,r=".",n){if(!Cc(t))return Au(e,{},r,n);const s=Object.assign({},t);for(const i in e){if(i==="__proto__"||i==="constructor")continue;const o=e[i];o!=null&&(n&&n(s,i,o,r)||(Array.isArray(o)&&Array.isArray(s[i])?s[i]=[...o,...s[i]]:Cc(o)&&Cc(s[i])?s[i]=Au(o,s[i],(r?`${r}.`:"")+i.toString(),n):s[i]=o))}return s}function tg(e){return(...t)=>t.reduce((r,n)=>Au(r,n,"",e),{})}const sP=tg();function ku(e){return e==="-"||e==="^"||e==="$"||e==="+"||e==="."||e==="("||e===")"||e==="|"||e==="["||e==="]"||e==="{"||e==="}"||e==="*"||e==="?"||e==="\\"?`\\${e}`:e}function iP(e){let t="";for(let r=0;r<e.length;r++)t+=ku(e[r]);return t}function rg(e,t=!0){if(Array.isArray(e))return`(?:${e.map(u=>`^${rg(u,t)}$`).join("|")})`;let r="",n="",s=".";t===!0?(r="/",n="[/\\\\]",s="[^/\\\\]"):t&&(r=t,n=iP(r),n.length>1?(n=`(?:${n})`,s=`((?!${n}).)`):s=`[^${n}]`);let i=t?`${n}+?`:"",o=t?`${n}*?`:"",a=t?e.split(r):[e],c="";for(let d=0;d<a.length;d++){let u=a[d],l=a[d+1],h="";if(!(!u&&d>0)){if(t&&(d===a.length-1?h=o:l!=="**"?h=i:h=""),t&&u==="**"){h&&(c+=d===0?"":h,c+=`(?:${s}*?${h})*?`);continue}for(let m=0;m<u.length;m++){let p=u[m];p==="\\"?m<u.length-1&&(c+=ku(u[m+1]),m++):p==="?"?c+=s:p==="*"?c+=`${s}*?`:c+=ku(p)}c+=h}}return c}function oP(e,t){if(typeof t!="string")throw new TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function _i(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if((typeof t=="string"||typeof t=="boolean")&&(t={separator:t}),arguments.length===2&&!(typeof t>"u"||typeof t=="object"&&t!==null&&!Array.isArray(t)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if(t=t||{},t.separator==="\\")throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=rg(e,t.separator),n=new RegExp(`^${r}$`,t.flags),s=oP.bind(null,n);return s.options=t,s.pattern=e,s.regexp=n,s}const aP=et(async e=>{if(e.request?.method!=="POST"||!e.request)return;const{body:t,query:r,context:n}=e,s=e.headers?.get("origin")||e.headers?.get("referer")||"",i=t?.callbackURL||r?.callbackURL,o=t?.redirectTo,a=t?.errorCallbackURL,c=t?.newUserCallbackURL,d=Array.isArray(n.options.trustedOrigins)?n.trustedOrigins:[...n.trustedOrigins,...await n.options.trustedOrigins?.(e.request)||[]],u=e.headers?.has("cookie"),l=(m,p)=>{if(m.startsWith("/"))return!1;if(p.includes("*"))return p.includes("://")?_i(p)(di(m)||m):_i(p)(Tp(m));const w=Sp(m);return w==="http:"||w==="https:"||!w?p===di(m):m.startsWith(p)},h=(m,p)=>{if(!m)return;if(!d.some(g=>l(m,g)||m?.startsWith("/")&&p!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(m)))throw e.context.logger.error(`Invalid ${p}: ${m}`),e.context.logger.info(`If it's a valid URL, please add ${m} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${d}`),new _("FORBIDDEN",{message:`Invalid ${p}`})};u&&!e.context.options.advanced?.disableCSRFCheck&&h(s,"origin"),i&&h(i,"callbackURL"),o&&h(o,"redirectURL"),a&&h(a,"errorCallbackURL"),c&&h(c,"newUserCallbackURL")}),Fd=e=>et(async t=>{if(!t.request)return;const{context:r}=t,n=e(t),s=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(t.request)||[]],i=(c,d)=>{if(c.startsWith("/"))return!1;if(d.includes("*"))return d.includes("://")?_i(d)(di(c)||c):_i(d)(Tp(c));const u=Sp(c);return u==="http:"||u==="https:"||!u?d===di(c):c.startsWith(d)},o=(c,d)=>{if(!c)return;if(!s.some(l=>i(c,l)||c?.startsWith("/")&&d!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(c)))throw t.context.logger.error(`Invalid ${d}: ${c}`),t.context.logger.info(`If it's a valid URL, please add ${c} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${s}`),new _("FORBIDDEN",{message:`Invalid ${d}`})},a=Array.isArray(n)?n:[n];for(const c of a)o(c,"callbackURL")});async function Pn(e,t,r,n=3600){return await eP({email:t.toLowerCase(),updateTo:r},e,n)}async function mp(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new _("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await Pn(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:n,token:r},e.request)}const cP=K("/send-verification-email",{method:"POST",body:G({email:ea().meta({description:"The email to send the verification email to"}),callbackURL:S().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new _("BAD_REQUEST",{message:"Verification email isn't enabled"});const{email:t}=e.body,r=await ut(e);if(!r){const n=await e.context.internalAdapter.findUserByEmail(t);return n?(await mp(e,n.user),e.json({status:!0})):e.json({status:!0})}if(r?.user.emailVerified)throw new _("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(r?.user.email!==t)throw new _("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await mp(e,r.user),e.json({status:!0})}),uP=K("/verify-email",{method:"GET",query:G({token:S().meta({description:"The token to verify the email"}),callbackURL:S().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[Fd(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{function t(c){throw e.query.callbackURL?e.query.callbackURL.includes("?")?e.redirect(`${e.query.callbackURL}&error=${c}`):e.redirect(`${e.query.callbackURL}?error=${c}`):new _("UNAUTHORIZED",{message:c})}const{token:r}=e.query;let n;try{n=await aa(r,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(c){return c instanceof cu?t("token_expired"):t("invalid_token")}const i=G({email:S().email(),updateTo:S().optional()}).parse(n.payload),o=await e.context.internalAdapter.findUserByEmail(i.email);if(!o)return t("user_not_found");if(i.updateTo){const c=await ut(e);if(!c){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}if(c.user.email!==i.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return t("unauthorized")}const d=await e.context.internalAdapter.updateUserByEmail(i.email,{email:i.updateTo,emailVerified:!1},e),u=await Pn(e.context.secret,i.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${e.context.baseURL}/verify-email?token=${u}&callbackURL=${e.query.callbackURL||"/"}`,token:u},e.request),await Nt(e,{session:c.session,user:{...c.user,email:i.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}e.context.options.emailVerification?.onEmailVerification&&await e.context.options.emailVerification.onEmailVerification(o.user,e.request);const a=await e.context.internalAdapter.updateUserByEmail(i.email,{emailVerified:!0},e);if(e.context.options.emailVerification?.afterEmailVerification&&await e.context.options.emailVerification.afterEmailVerification(a,e.request),e.context.options.emailVerification?.autoSignInAfterVerification){const c=await ut(e);if(!c||c.user.email!==i.email){const d=await e.context.internalAdapter.createSession(o.user.id,e);if(!d)throw new _("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await Nt(e,{session:d,user:{...o.user,emailVerified:!0}})}else await Nt(e,{session:c.session,user:{...c.user,emailVerified:!0}})}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})}),Zd={isAction:!1};async function ng(e,t){const r=e.body?.callbackURL||e.context.options.baseURL;if(!r)throw new _("BAD_REQUEST",{message:"callbackURL is required"});const n=Ct(128),s=Ct(32),i=e.context.createAuthCookie("state",{maxAge:300*1e3});await e.setSignedCookie(i.name,s,e.context.secret,i.attributes);const o=JSON.stringify({callbackURL:r,codeVerifier:n,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+600*1e3,requestSignUp:e.body?.requestSignUp}),a=new Date;a.setMinutes(a.getMinutes()+10);const c=await e.context.internalAdapter.createVerificationValue({value:o,identifier:s,expiresAt:a},e);if(!c)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new _("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:c.identifier,codeVerifier:n}}async function dP(e){const t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r){e.context.logger.error("State Mismatch. Verification not found",{state:t});const a=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${a}?error=please_restart_the_process`)}const n=G({callbackURL:S(),codeVerifier:S(),errorURL:S().optional(),newUserURL:S().optional(),expiresAt:Tr(),link:G({email:S(),userId:Wt()}).optional(),requestSignUp:Xt().optional()}).parse(JSON.parse(r.value));n.errorURL||(n.errorURL=`${e.context.baseURL}/error`);const s=e.context.createAuthCookie("state"),i=await e.getSignedCookie(s.name,e.context.secret);if(!e.context.oauthConfig?.skipStateCookieCheck&&(!i||i!==t)){const a=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${a}?error=state_mismatch`)}if(e.setCookie(s.name,"",{maxAge:0}),n.expiresAt<Date.now()){await e.context.internalAdapter.deleteVerificationValue(r.id);const a=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${a}?error=please_restart_the_process`)}return await e.context.internalAdapter.deleteVerificationValue(r.id),n}async function sg(e){const t=await Wn("SHA-256").digest(e);return jn.encode(new Uint8Array(t),{padding:!1})}function ig(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?pr(e.expires_in,"sec"):void 0,refreshTokenExpiresAt:e.refresh_token_expires_in?pr(e.refresh_token_expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}function lP(e,t){return e&&(t.options.account?.encryptOAuthTokens?Vd({key:t.secret,data:e}):e)}function vt(e,t){return t.options.account?.encryptOAuthTokens&&e?Md({key:t.secret,data:e}):e}async function og(e,{userInfo:t,account:r,callbackURL:n,disableSignUp:s,overrideUserInfo:i}){const o=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(u=>{te.error(`Better auth was unable to query your database.
Error: `,u);const l=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${l}?error=internal_server_error`)});let a=o?.user,c=!a;if(o){const u=o.accounts.find(l=>l.providerId===r.providerId&&l.accountId===r.accountId);if(u){if(e.context.options.account?.updateAccountOnSignIn!==!1){const l=Object.fromEntries(Object.entries({idToken:r.idToken,accessToken:await vt(r.accessToken,e.context),refreshToken:await vt(r.refreshToken,e.context),accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([h,m])=>m!==void 0));Object.keys(l).length>0&&await e.context.internalAdapter.updateAccount(u.id,l,e)}t.emailVerified&&!o.user.emailVerified&&t.email.toLowerCase()===o.user.email&&await e.context.internalAdapter.updateUser(o.user.id,{emailVerified:!0})}else{if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return Ru&&te.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:o.user.id,accessToken:await vt(r.accessToken,e.context),refreshToken:await vt(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(m){return te.error("Unable to link account",m),{error:"unable to link account",data:null}}t.emailVerified&&!o.user.emailVerified&&t.email.toLowerCase()===o.user.email&&await e.context.internalAdapter.updateUser(o.user.id,{emailVerified:!0})}if(i){const{id:l,...h}=t;await e.context.internalAdapter.updateUser(o.user.id,{...h,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===o.user.email&&o.user.emailVerified||t.emailVerified})}}else{if(s)return{error:"signup disabled",data:null,isRegister:!1};try{const{id:u,...l}=t;if(a=await e.context.internalAdapter.createOAuthUser({...l,email:t.email.toLowerCase()},{accessToken:await vt(r.accessToken,e.context),refreshToken:await vt(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then(h=>h?.user),!t.emailVerified&&a&&e.context.options.emailVerification?.sendOnSignUp){const h=await Pn(e.context.secret,a.email,void 0,e.context.options.emailVerification?.expiresIn),m=`${e.context.baseURL}/verify-email?token=${h}&callbackURL=${n}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:a,url:m,token:h},e.request)}}catch(u){return te.error(u),u instanceof _?{error:u.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}}if(!a)return{error:"unable to create user",data:null,isRegister:!1};const d=await e.context.internalAdapter.createSession(a.id,e);return d?{data:{session:d,user:a},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}async function _e({id:e,options:t,authorizationEndpoint:r,state:n,codeVerifier:s,scopes:i,claims:o,redirectURI:a,duration:c,prompt:d,accessType:u,responseType:l,display:h,loginHint:m,hd:p,responseMode:w,additionalParams:g,scopeJoiner:b}){const v=new URL(r);v.searchParams.set("response_type",l||"code");const y=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;if(v.searchParams.set("client_id",y),v.searchParams.set("state",n),v.searchParams.set("scope",i.join(b||" ")),v.searchParams.set("redirect_uri",t.redirectURI||a),c&&v.searchParams.set("duration",c),h&&v.searchParams.set("display",h),m&&v.searchParams.set("login_hint",m),d&&v.searchParams.set("prompt",d),p&&v.searchParams.set("hd",p),u&&v.searchParams.set("access_type",u),w&&v.searchParams.set("response_mode",w),s){const E=await sg(s);v.searchParams.set("code_challenge_method","S256"),v.searchParams.set("code_challenge",E)}if(o){const E=o.reduce((k,A)=>(k[A]=null,k),{});v.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...E}}))}return g&&Object.entries(g).forEach(([E,k])=>{v.searchParams.set(E,k)}),v}function hP({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:s,deviceId:i,headers:o,additionalParams:a={},resource:c}){const d=new URLSearchParams,u={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...o};if(d.set("grant_type","authorization_code"),d.set("code",e),t&&d.set("code_verifier",t),n.clientKey&&d.set("client_key",n.clientKey),i&&d.set("device_id",i),d.set("redirect_uri",n.redirectURI||r),c)if(typeof c=="string")d.append("resource",c);else for(const l of c)d.append("resource",l);if(s==="basic"){const l=Array.isArray(n.clientId)?n.clientId[0]:n.clientId,h=er.encode(`${l}:${n.clientSecret??""}`);u.authorization=`Basic ${h}`}else{const l=Array.isArray(n.clientId)?n.clientId[0]:n.clientId;d.set("client_id",l),n.clientSecret&&d.set("client_secret",n.clientSecret)}for(const[l,h]of Object.entries(a))d.has(l)||d.append(l,h);return{body:d,headers:u}}async function le({code:e,codeVerifier:t,redirectURI:r,options:n,tokenEndpoint:s,authentication:i,deviceId:o,headers:a,additionalParams:c={},resource:d}){const{body:u,headers:l}=hP({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:i,deviceId:o,headers:a,additionalParams:c,resource:d}),{data:h,error:m}=await ne(s,{method:"POST",body:u,headers:l});if(m)throw m;return ig(h)}function fP({refreshToken:e,options:t,authentication:r,extraParams:n,resource:s}){const i=new URLSearchParams,o={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(i.set("grant_type","refresh_token"),i.set("refresh_token",e),r==="basic"){const a=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;a?o.authorization="Basic "+er.encode(`${a}:${t.clientSecret??""}`):o.authorization="Basic "+er.encode(`:${t.clientSecret??""}`)}else{const a=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;i.set("client_id",a),t.clientSecret&&i.set("client_secret",t.clientSecret)}if(s)if(typeof s=="string")i.append("resource",s);else for(const a of s)i.append("resource",a);if(n)for(const[a,c]of Object.entries(n))i.set(a,c);return{body:i,headers:o}}async function me({refreshToken:e,options:t,tokenEndpoint:r,authentication:n,extraParams:s}){const{body:i,headers:o}=fP({refreshToken:e,options:t,authentication:n,extraParams:s}),{data:a,error:c}=await ne(r,{method:"POST",body:i,headers:o});if(c)throw c;const d={accessToken:a.access_token,refreshToken:a.refresh_token,tokenType:a.token_type,scopes:a.scope?.split(" "),idToken:a.id_token};if(a.expires_in){const u=new Date;d.accessTokenExpiresAt=new Date(u.getTime()+a.expires_in*1e3)}return d}const pP=e=>{const t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",async createAuthorizationURL({state:r,scopes:n,redirectURI:s}){const i=e.disableDefaultScope?[]:["email","name"];return e.scope&&i.push(...e.scope),n&&i.push(...n),await _e({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:i,state:r,redirectURI:s,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:s})=>le({code:r,codeVerifier:n,redirectURI:s,options:e,tokenEndpoint:t}),async verifyIdToken(r,n){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,n);const s=mw(r),{kid:i,alg:o}=s;if(!i||!o)return!1;const a=await mP(i),{payload:c}=await aa(r,a,{algorithms:[o],issuer:"https://appleid.apple.com",audience:e.audience&&e.audience.length?e.audience:e.appBundleIdentifier?e.appBundleIdentifier:e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(d=>{c[d]!==void 0&&(c[d]=!!c[d])}),n&&c.nonce!==n?!1:!!c},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>me({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;const n=an(r.idToken);if(!n)return null;const s=r.user?`${r.user.name?.firstName} ${r.user.name?.lastName}`:n.name||n.email,i=typeof n.email_verified=="boolean"?n.email_verified:n.email_verified==="true",o={...n,name:s},a=await e.mapProfileToUser?.(o);return{user:{id:n.sub,name:o.name,emailVerified:i,email:n.email,...a},data:o}},options:e}},mP=async e=>{const t="https://appleid.apple.com",r="/auth/keys",{data:n}=await ne(`${t}${r}`);if(!n?.keys)throw new _("BAD_REQUEST",{message:"Keys not found"});const s=n.keys.find(i=>i.kid===e);if(!s)throw new Error(`JWK with kid ${e} not found`);return await oa(s,s.alg)},wP=e=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s}){if(!e.clientId||!e.clientSecret)throw te.error("Client Id and Secret are required for Atlassian"),new ve("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new ve("codeVerifier is required for Atlassian");const i=e.disableDefaultScope?[]:["read:jira-user","offline_access"];return e.scope&&i.push(...e.scope),r&&i.push(...r),_e({id:"atlassian",options:e,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:i,state:t,codeVerifier:n,redirectURI:s,additionalParams:{audience:"api.atlassian.com"},prompt:e.prompt})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;try{const{data:r}=await ne("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.account_id,name:r.name,email:r.email,image:r.picture,emailVerified:!1,...n},data:r}}catch(r){return te.error("Failed to fetch user info from Figma:",r),null}},options:e}),yP=e=>{if(!e.domain||!e.region||!e.userPoolId)throw te.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new ve("DOMAIN_AND_REGION_REQUIRED");const t=e.domain.replace(/^https?:\/\//,""),r=`https://${t}/oauth2/authorize`,n=`https://${t}/oauth2/token`,s=`https://${t}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:i,scopes:o,codeVerifier:a,redirectURI:c}){if(!e.clientId)throw te.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new ve("CLIENT_ID_AND_SECRET_REQUIRED");if(e.requireClientSecret&&!e.clientSecret)throw te.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new ve("CLIENT_SECRET_REQUIRED");const d=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&d.push(...e.scope),o&&d.push(...o),await _e({id:"cognito",options:{...e},authorizationEndpoint:r,scopes:d,state:i,codeVerifier:a,redirectURI:c,prompt:e.prompt})},validateAuthorizationCode:async({code:i,codeVerifier:o,redirectURI:a})=>le({code:i,codeVerifier:o,redirectURI:a,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>me({refreshToken:i,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:n}),async verifyIdToken(i,o){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(i,o);try{const a=mw(i),{kid:c,alg:d}=a;if(!c||!d)return!1;const u=await gP(c,e.region,e.userPoolId),l=`https://cognito-idp.${e.region}.amazonaws.com/${e.userPoolId}`,{payload:h}=await aa(i,u,{algorithms:[d],issuer:l,audience:e.clientId,maxTokenAge:"1h"});return!(o&&h.nonce!==o)}catch(a){return te.error("Failed to verify ID token:",a),!1}},async getUserInfo(i){if(e.getUserInfo)return e.getUserInfo(i);if(i.idToken)try{const o=an(i.idToken);if(!o)return null;const a=o.name||o.given_name||o.username||o.email,c={...o,name:a},d=await e.mapProfileToUser?.(c);return{user:{id:o.sub,name:c.name,email:o.email,image:o.picture,emailVerified:o.email_verified,...d},data:c}}catch(o){te.error("Failed to decode ID token:",o)}if(i.accessToken)try{const{data:o}=await ne(s,{headers:{Authorization:`Bearer ${i.accessToken}`}});if(o){const a=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name||o.given_name||o.username,email:o.email,image:o.picture,emailVerified:o.email_verified,...a},data:o}}}catch(o){te.error("Failed to fetch user info from Cognito:",o)}return null},options:e}},gP=async(e,t,r)=>{const n=`https://cognito-idp.${t}.amazonaws.com/${r}/.well-known/jwks.json`;try{const{data:s}=await ne(n);if(!s?.keys)throw new _("BAD_REQUEST",{message:"Keys not found"});const i=s.keys.find(o=>o.kid===e);if(!i)throw new Error(`JWK with kid ${e} not found`);return await oa(i,i.alg)}catch(s){throw te.error("Failed to fetch Cognito public key:",s),s}},bP=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["identify","email"];r&&s.push(...r),e.scope&&s.push(...e.scope);const o=s.includes("bot")&&e.permissions!==void 0?`&permissions=${e.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${s.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"none"}${o}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;if(r.avatar===null){const i=r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${i}.png`}else{const i=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${i}`}const s=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...s},data:r}},options:e}),vP=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:n,loginHint:s}){const i=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await _e({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:i,state:t,redirectURI:n,loginHint:s,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(t.split(".").length===3)try{const{payload:n}=await aa(t,BS(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});return r&&n.nonce!==r?!1:!!n}catch{return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken&&t.idToken.split(".").length===3){const o=an(t.idToken),a={id:o.sub,name:o.name,email:o.email,picture:{data:{url:o.picture,height:100,width:100,is_silhouette:!1}}},c=await e.mapProfileToUser?.({...a,email_verified:!0});return{user:{...a,emailVerified:!0,...c},data:o}}const r=["id","name","email","picture",...e?.fields||[]],{data:n,error:s}=await ne("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(s)return null;const i=await e.mapProfileToUser?.(n);return{user:{id:n.id,name:n.name,email:n.email,image:n.picture.data.url,emailVerified:n.email_verified,...i},data:n}},options:e}),EP=e=>({id:"figma",name:"Figma",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s}){if(!e.clientId||!e.clientSecret)throw te.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new ve("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new ve("codeVerifier is required for Figma");const i=e.disableDefaultScope?[]:["file_read"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await _e({id:"figma",options:e,authorizationEndpoint:"https://www.figma.com/oauth",scopes:i,state:t,codeVerifier:n,redirectURI:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);try{const{data:r}=await ne("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return te.error("Failed to fetch user from Figma"),null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.handle,email:r.email,image:r.img_url,emailVerified:!!r.email,...n},data:r}}catch(r){return te.error("Failed to fetch user info from Figma:",r),null}},options:e}),_P=e=>{const t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:n,loginHint:s,redirectURI:i}){const o=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&o.push(...e.scope),n&&o.push(...n),_e({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:o,state:r,redirectURI:i,loginHint:s,prompt:e.prompt})},validateAuthorizationCode:async({code:r,redirectURI:n})=>le({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>me({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:s}=await ne("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(s)return null;const{data:i}=await ne("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});!n.email&&i&&(n.email=(i.find(c=>c.primary)??i[0])?.email);const o=i?.find(c=>c.email===n.email)?.verified??!1,a=await e.mapProfileToUser?.(n);return{user:{id:n.id,name:n.name||n.login,email:n.email,image:n.avatar_url,emailVerified:o,...a},data:n}},options:e}},NP=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s,loginHint:i,display:o}){if(!e.clientId||!e.clientSecret)throw te.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new ve("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new ve("codeVerifier is required for Google");const a=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&a.push(...e.scope),r&&a.push(...r),await _e({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:n,redirectURI:s,prompt:e.prompt,accessType:e.accessType,display:o||e.display,loginHint:i,hd:e.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const n=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:s}=await ne(n);return s?s.aud===e.clientId&&(s.iss==="https://accounts.google.com"||s.iss==="accounts.google.com"):!1},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=an(t.idToken),n=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...n},data:r}},options:e}),AP=e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:n,codeVerifier:s}){const i=e.disableDefaultScope?[]:["user:read"];return e.scope&&i.push(...e.scope),r&&i.push(...r),_e({id:"kick",redirectURI:n,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:i,codeVerifier:s,state:t})},async validateAuthorizationCode({code:t,redirectURI:r,codeVerifier:n}){return le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:n})},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const s=r.data[0],i=await e.mapProfileToUser?.(s);return{user:{id:s.user_id,name:s.name,email:s.email,image:s.profile_picture,emailVerified:!0,...i},data:s}},options:e}),kP=e=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s}){const i=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&i.push(...e.scope),r&&i.push(...r),_e({id:"huggingface",options:e,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:i,state:t,codeVerifier:n,redirectURI:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const s=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name||r.preferred_username,email:r.email,image:r.picture,emailVerified:r.email_verified??!1,...s},data:r}},options:e}),TP=e=>{const t=e.tenantId||"common",r=e.authority||"https://login.microsoftonline.com",n=`${r}/${t}/oauth2/v2.0/authorize`,s=`${r}/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(i){const o=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&o.push(...e.scope),i.scopes&&o.push(...i.scopes),_e({id:"microsoft",options:e,authorizationEndpoint:n,state:i.state,codeVerifier:i.codeVerifier,scopes:o,redirectURI:i.redirectURI,prompt:e.prompt,loginHint:i.loginHint})},validateAuthorizationCode({code:i,codeVerifier:o,redirectURI:a}){return le({code:i,codeVerifier:o,redirectURI:a,options:e,tokenEndpoint:s})},async getUserInfo(i){if(e.getUserInfo)return e.getUserInfo(i);if(!i.idToken)return null;const o=an(i.idToken),a=e.profilePhotoSize||48;await ne(`https://graph.microsoft.com/v1.0/me/photos/${a}x${a}/$value`,{headers:{Authorization:`Bearer ${i.accessToken}`},async onResponse(d){if(!(e.disableProfilePhoto||!d.response.ok))try{const l=await d.response.clone().arrayBuffer(),h=er.encode(l);o.picture=`data:image/jpeg;base64, ${h}`}catch(u){te.error(u&&typeof u=="object"&&"name"in u?u.name:"",u)}}});const c=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,image:o.picture,emailVerified:!0,...c},data:o}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>{const o=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&o.push(...e.scope),me({refreshToken:i,options:{clientId:e.clientId,clientSecret:e.clientSecret},extraParams:{scope:o.join(" ")},tokenEndpoint:s})},options:e}},SP=e=>({id:"slack",name:"Slack",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["openid","profile","email"];r&&s.push(...r),e.scope&&s.push(...e.scope);const i=new URL("https://slack.com/openid/connect/authorize");return i.searchParams.set("scope",s.join(" ")),i.searchParams.set("response_type","code"),i.searchParams.set("client_id",e.clientId),i.searchParams.set("redirect_uri",e.redirectURI||n),i.searchParams.set("state",t),i},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const s=await e.mapProfileToUser?.(r);return{user:{id:r["https://slack.com/user_id"],name:r.name||"",email:r.email,emailVerified:r.email_verified,image:r.picture||r["https://slack.com/user_image_512"],...s},data:r}},options:e}),RP=e=>{const t="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:r,scopes:n,loginHint:s,redirectURI:i}){const o=e.disableDefaultScope?[]:[];return e.scope&&o.push(...e.scope),n&&o.push(...n),_e({id:"notion",options:e,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:o,state:r,redirectURI:i,loginHint:s,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:r,redirectURI:n})=>le({code:r,redirectURI:n,options:e,tokenEndpoint:t,authentication:"basic"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>me({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:s}=await ne("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${r.accessToken}`,"Notion-Version":"2022-06-28"}});if(s||!n)return null;const i=n.bot?.owner?.user;if(!i)return null;const o=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.name||"Notion User",email:i.person?.email||null,image:i.avatar_url,emailVerified:!!i.person?.email,...o},data:i}},options:e}},IP=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s}){const i=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&i.push(...e.scope),r&&i.push(...r),_e({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:i,state:t,codeVerifier:n,redirectURI:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const s=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...s},data:r}},options:e}),OP=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&s.push(...e.scope),r&&s.push(...r),_e({id:"twitch",redirectURI:n,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:s,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=t.idToken;if(!r)return te.error("No idToken found in token"),null;const n=an(r),s=await e.mapProfileToUser?.(n);return{user:{id:n.sub,name:n.preferred_username,email:n.email,image:n.picture,emailVerified:n.email_verified,...s},data:n}},options:e}),$P=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){const r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),_e({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>le({code:t,codeVerifier:r,authentication:"basic",redirectURI:n,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const{data:s,error:i}=await ne("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});let o=!1;!i&&s?.data?.confirmed_email&&(r.data.email=s.data.confirmed_email,o=!0);const a=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.email||r.data.username||null,image:r.data.profile_image_url,emailVerified:o,...a},data:r}},options:e}),CP=e=>{const t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:n,codeVerifier:s,redirectURI:i})=>{const o=e.disableDefaultScope?[]:["account_info.read"];e.scope&&o.push(...e.scope),n&&o.push(...n);const a={};return e.accessType&&(a.token_access_type=e.accessType),await _e({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:o,state:r,redirectURI:i,codeVerifier:s,additionalParams:a})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:s})=>await le({code:r,codeVerifier:n,redirectURI:s,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>me({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:s}=await ne("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(s)return null;const i=await e.mapProfileToUser?.(n);return{user:{id:n.account_id,name:n.name?.display_name,email:n.email,emailVerified:n.email_verified||!1,image:n.profile_photo_url,...i},data:n}},options:e}},xP=e=>{const t="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:r,scopes:n,loginHint:s,redirectURI:i}){const o=e.disableDefaultScope?[]:["read"];return e.scope&&o.push(...e.scope),n&&o.push(...n),_e({id:"linear",options:e,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:o,state:r,redirectURI:i,loginHint:s})},validateAuthorizationCode:async({code:r,redirectURI:n})=>le({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>me({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:s}=await ne("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(s||!n?.data?.viewer)return null;const i=n.data.viewer,o=await e.mapProfileToUser?.(i);return{user:{id:n.data.viewer.id,name:n.data.viewer.name,email:n.data.viewer.email,image:n.data.viewer.avatarUrl,emailVerified:!0,...o},data:i}},options:e}},UP=e=>{const t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:n,scopes:s,redirectURI:i,loginHint:o})=>{const a=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&a.push(...e.scope),s&&a.push(...s),await _e({id:"linkedin",options:e,authorizationEndpoint:t,scopes:a,state:n,loginHint:o,redirectURI:i})},validateAuthorizationCode:async({code:n,redirectURI:s})=>await le({code:n,redirectURI:s,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async n=>me({refreshToken:n,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:r}),async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);const{data:s,error:i}=await ne("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${n.accessToken}`}});if(i)return null;const o=await e.mapProfileToUser?.(s);return{user:{id:s.sub,name:s.name,email:s.email,emailVerified:s.email_verified||!1,image:s.picture,...o},data:s}},options:e}},xc=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),PP=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:xc(`${t}/oauth/authorize`),tokenEndpoint:xc(`${t}/oauth/token`),userinfoEndpoint:xc(`${t}/api/v4/user`)}},DP=e=>{const{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:n}=PP(e.issuer),s="gitlab";return{id:s,name:"Gitlab",createAuthorizationURL:async({state:o,scopes:a,codeVerifier:c,loginHint:d,redirectURI:u})=>{const l=e.disableDefaultScope?[]:["read_user"];return e.scope&&l.push(...e.scope),a&&l.push(...a),await _e({id:s,options:e,authorizationEndpoint:t,scopes:l,state:o,redirectURI:u,codeVerifier:c,loginHint:d})},validateAuthorizationCode:async({code:o,redirectURI:a,codeVerifier:c})=>le({code:o,redirectURI:a,options:e,codeVerifier:c,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async o=>me({refreshToken:o,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);const{data:a,error:c}=await ne(n,{headers:{authorization:`Bearer ${o.accessToken}`}});if(c||a.state!=="active"||a.locked)return null;const d=await e.mapProfileToUser?.(a);return{user:{id:a.id,name:a.name??a.username,email:a.email,image:a.avatar_url,emailVerified:!0,...d},data:a}},options:e}},LP=e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&s.push(...e.scope),r&&s.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${s.join(",")}&response_type=code&client_key=${e.clientKey}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:e.redirectURI||r,options:{clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:e.clientKey}}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=["open_id","avatar_large_url","display_name","username"],{data:n,error:s}=await ne(`https://open.tiktokapis.com/v2/user/info/?fields=${r.join(",")}`,{headers:{authorization:`Bearer ${t.accessToken}`}});return s?null:{user:{email:n.data.user.email||n.data.user.username,id:n.data.user.open_id,name:n.data.user.display_name||n.data.user.username,image:n.data.user.avatar_large_url,emailVerified:!!n.data.user.email},data:n}},options:e}),zP=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["identity"];return e.scope&&s.push(...e.scope),r&&s.push(...r),_e({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:s,state:t,redirectURI:n,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{const n=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),s={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${er.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:i,error:o}=await ne("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:s,body:n.toString()});if(o)throw o;return ig(i)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(n)return null;const s=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...s},data:r}},options:e}),qP=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&s.push(...e.scope),r&&s.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${s.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const s=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!0,...s},data:{...r}}},options:e}),jP=e=>{const r=(e.environment??"production")==="sandbox",n=e.loginUrl?`https://${e.loginUrl}/services/oauth2/authorize`:r?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",s=e.loginUrl?`https://${e.loginUrl}/services/oauth2/token`:r?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",i=e.loginUrl?`https://${e.loginUrl}/services/oauth2/userinfo`:r?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:o,scopes:a,codeVerifier:c,redirectURI:d}){if(!e.clientId||!e.clientSecret)throw te.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new ve("CLIENT_ID_AND_SECRET_REQUIRED");if(!c)throw new ve("codeVerifier is required for Salesforce");const u=e.disableDefaultScope?[]:["openid","email","profile"];return e.scope&&u.push(...e.scope),a&&u.push(...a),_e({id:"salesforce",options:e,authorizationEndpoint:n,scopes:u,state:o,codeVerifier:c,redirectURI:e.redirectURI||d})},validateAuthorizationCode:async({code:o,codeVerifier:a,redirectURI:c})=>le({code:o,codeVerifier:a,redirectURI:e.redirectURI||c,options:e,tokenEndpoint:s}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async o=>me({refreshToken:o,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:s}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);try{const{data:a}=await ne(i,{headers:{Authorization:`Bearer ${o.accessToken}`}});if(!a)return te.error("Failed to fetch user info from Salesforce"),null;const c=await e.mapProfileToUser?.(a);return{user:{id:a.user_id,name:a.name,email:a.email,image:a.photos?.picture||a.photos?.thumbnail,emailVerified:a.email_verified??!1,...c},data:a}}catch(a){return te.error("Failed to fetch user info from Salesforce:",a),null}},options:e}},WP=e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:s}){const i=e.disableDefaultScope?[]:["email","phone"];return e.scope&&i.push(...e.scope),r&&i.push(...r),_e({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:i,state:t,redirectURI:s,codeVerifier:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n,deviceId:s})=>le({code:t,codeVerifier:r,redirectURI:e.redirectURI||n,options:e,deviceId:s,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;const r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:n,error:s}=await ne("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(s||!n.user.email)return null;const i=await e.mapProfileToUser?.(n);return{user:{id:n.user.user_id,first_name:n.user.first_name,last_name:n.user.last_name,email:n.user.email,image:n.user.avatar,emailVerified:!!n.user.email,birthday:n.user.birthday,sex:n.user.sex,name:`${n.user.first_name} ${n.user.last_name}`,...i},data:n}},options:e}),MP=e=>{const t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:r,redirectURI:n,codeVerifier:s})=>{const i=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:n,client_id:t.clientId,state:r});if(t.pkce){const a=await sg(s);i.set("code_challenge_method","S256"),i.set("code_challenge",a)}const o=new URL("https://zoom.us/oauth/authorize");return o.search=i.toString(),o},validateAuthorizationCode:async({code:r,redirectURI:n,codeVerifier:s})=>le({code:r,redirectURI:t.redirectURI||n,codeVerifier:s,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(r){if(t.getUserInfo)return t.getUserInfo(r);const{data:n,error:s}=await ne("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${r.accessToken}`}});if(s)return null;const i=await t.mapProfileToUser?.(n);return{user:{id:n.id,name:n.display_name,image:n.pic_url,email:n.email,emailVerified:!!n.verified,...i},data:{...n}}}}},VP=e=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return e.scope&&s.push(...e.scope),r&&s.push(...r),_e({id:"kakao",options:e,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:s,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r)return null;const s=await e.mapProfileToUser?.(r),i=r.kakao_account||{},o=i.profile||{};return{user:{id:String(r.id),name:o.nickname||i.name||void 0,email:i.email,image:o.profile_image_url||o.thumbnail_image_url,emailVerified:!!i.is_email_valid&&!!i.is_email_verified,...s},data:r}},options:e}),FP=e=>({id:"naver",name:"Naver",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const s=e.disableDefaultScope?[]:["profile","email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),_e({id:"naver",options:e,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:s,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>le({code:t,redirectURI:r,options:e,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>me({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await ne("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r||r.resultcode!=="00")return null;const s=await e.mapProfileToUser?.(r),i=r.response||{};return{user:{id:i.id,name:i.name||i.nickname,email:i.email,image:i.profile_image,emailVerified:!1,...s},data:r}},options:e}),ZP=e=>{const t="https://access.line.me/oauth2/v2.1/authorize",r="https://api.line.me/oauth2/v2.1/token",n="https://api.line.me/oauth2/v2.1/userinfo",s="https://api.line.me/oauth2/v2.1/verify";return{id:"line",name:"LINE",async createAuthorizationURL({state:i,scopes:o,codeVerifier:a,redirectURI:c,loginHint:d}){const u=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&u.push(...e.scope),o&&u.push(...o),await _e({id:"line",options:e,authorizationEndpoint:t,scopes:u,state:i,codeVerifier:a,redirectURI:c,loginHint:d})},validateAuthorizationCode:async({code:i,codeVerifier:o,redirectURI:a})=>le({code:i,codeVerifier:o,redirectURI:a,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>me({refreshToken:i,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:r}),async verifyIdToken(i,o){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(i,o);const a=new URLSearchParams;a.set("id_token",i),a.set("client_id",e.clientId),o&&a.set("nonce",o);const{data:c,error:d}=await ne(s,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:a});return!(d||!c||c.aud!==e.clientId||o&&c.nonce&&c.nonce!==o)},async getUserInfo(i){if(e.getUserInfo)return e.getUserInfo(i);let o=null;if(i.idToken)try{o=an(i.idToken)}catch{}if(!o){const{data:h}=await ne(n,{headers:{authorization:`Bearer ${i.accessToken}`}});o=h||null}if(!o)return null;const a=await e.mapProfileToUser?.(o),c=o.sub||o.userId,d=o.name||o.displayName,u=o.picture||o.pictureUrl||void 0,l=o.email;return{user:{id:c,name:d,email:l,image:u,emailVerified:!1,...a},data:o}},options:e}},BP=e=>{const r=(e.environment||"sandbox")==="sandbox",n=r?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",s=r?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",i=r?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:o,codeVerifier:a,redirectURI:c}){if(!e.clientId||!e.clientSecret)throw te.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new ve("CLIENT_ID_AND_SECRET_REQUIRED");return await _e({id:"paypal",options:e,authorizationEndpoint:n,scopes:[],state:o,codeVerifier:a,redirectURI:c,prompt:e.prompt})},validateAuthorizationCode:async({code:o,redirectURI:a})=>{const c=er.encode(`${e.clientId}:${e.clientSecret}`);try{const d=await ne(s,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:o,redirect_uri:a}).toString()});if(!d.data)throw new ve("FAILED_TO_GET_ACCESS_TOKEN");const u=d.data;return{accessToken:u.access_token,refreshToken:u.refresh_token,accessTokenExpiresAt:u.expires_in?new Date(Date.now()+u.expires_in*1e3):void 0,idToken:u.id_token}}catch(d){throw te.error("PayPal token exchange failed:",d),new ve("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async o=>{const a=er.encode(`${e.clientId}:${e.clientSecret}`);try{const c=await ne(s,{method:"POST",headers:{Authorization:`Basic ${a}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:o}).toString()});if(!c.data)throw new ve("FAILED_TO_REFRESH_ACCESS_TOKEN");const d=c.data;return{accessToken:d.access_token,refreshToken:d.refresh_token,accessTokenExpiresAt:d.expires_in?new Date(Date.now()+d.expires_in*1e3):void 0}}catch(c){throw te.error("PayPal token refresh failed:",c),new ve("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(o,a){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(o,a);try{return!!an(o).sub}catch(c){return te.error("Failed to verify PayPal ID token:",c),!1}},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.accessToken)return te.error("Access token is required to fetch PayPal user info"),null;try{const a=await ne(`${i}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${o.accessToken}`,Accept:"application/json"}});if(!a.data)return te.error("Failed to fetch user info from PayPal"),null;const c=a.data,d=await e.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}}catch(a){return te.error("Failed to fetch user info from PayPal:",a),null}},options:e}},ag={apple:pP,atlassian:wP,cognito:yP,discord:bP,facebook:vP,figma:EP,github:_P,microsoft:TP,google:NP,huggingface:kP,slack:SP,spotify:IP,twitch:OP,twitter:$P,dropbox:CP,kick:AP,linear:xP,linkedin:UP,gitlab:DP,tiktok:LP,reddit:zP,roblox:qP,salesforce:jP,vk:WP,zoom:MP,notion:RP,kakao:VP,naver:FP,line:ZP,paypal:BP},HP=Object.keys(ag),cg=Mt(HP).or(S()),KP=K("/sign-in/social",{method:"POST",body:G({callbackURL:S().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:S().optional(),errorCallbackURL:S().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:cg,disableRedirect:Xt().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:fi(G({token:S().meta({description:"ID token from the provider"}),nonce:S().meta({description:"Nonce used to generate the token"}).optional(),accessToken:S().meta({description:"Access token from the provider"}).optional(),refreshToken:S().meta({description:"Refresh token from the provider"}).optional(),expiresAt:Tr().meta({description:"Expiry date of the token"}).optional()})),scopes:Et(S()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:Xt().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:S().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async e=>{const t=e.context.socialProviders.find(i=>i.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new _("NOT_FOUND",{message:Q.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new _("NOT_FOUND",{message:Q.ID_TOKEN_NOT_SUPPORTED});const{token:i,nonce:o}=e.body.idToken;if(!await t.verifyIdToken(i,o))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.INVALID_TOKEN});const c=await t.getUserInfo({idToken:i,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!c||!c?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.FAILED_TO_GET_USER_INFO});if(!c.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.USER_EMAIL_NOT_FOUND});const d=await og(e,{userInfo:{...c.user,email:c.user.email,id:String(c.user.id),name:c.user.name||"",image:c.user.image,emailVerified:c.user.emailVerified||!1},account:{providerId:t.id,accountId:String(c.user.id),accessToken:e.body.idToken.accessToken},callbackURL:e.body.callbackURL,disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(d.error)throw new _("UNAUTHORIZED",{message:d.error});return await Nt(e,d.data),e.json({redirect:!1,token:d.data.session.token,url:void 0,user:{id:d.data.user.id,email:d.data.user.email,name:d.data.user.name,image:d.data.user.image,emailVerified:d.data.user.emailVerified,createdAt:d.data.user.createdAt,updatedAt:d.data.user.updatedAt}})}const{codeVerifier:r,state:n}=await ng(e),s=await t.createAuthorizationURL({state:n,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:s.toString(),redirect:!e.body.disableRedirect})}),JP=K("/sign-in/email",{method:"POST",body:G({email:S().meta({description:"Email of the user"}),password:S().meta({description:"Password of the user"}),callbackURL:S().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:Xt().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new _("BAD_REQUEST",{message:"Email and password is not enabled"});const{email:t,password:r}=e.body;if(!S().email().safeParse(t).success)throw new _("BAD_REQUEST",{message:Q.INVALID_EMAIL});const s=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!s)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new _("UNAUTHORIZED",{message:Q.INVALID_EMAIL_OR_PASSWORD});const i=s.accounts.find(d=>d.providerId==="credential");if(!i)throw e.context.logger.error("Credential account not found",{email:t}),new _("UNAUTHORIZED",{message:Q.INVALID_EMAIL_OR_PASSWORD});const o=i?.password;if(!o)throw e.context.logger.error("Password not found",{email:t}),new _("UNAUTHORIZED",{message:Q.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:o,password:r}))throw e.context.logger.error("Invalid password"),new _("UNAUTHORIZED",{message:Q.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!s.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new _("FORBIDDEN",{message:Q.EMAIL_NOT_VERIFIED});if(e.context.options?.emailVerification?.sendOnSignIn){const d=await Pn(e.context.secret,s.user.email,void 0,e.context.options.emailVerification?.expiresIn),u=`${e.context.baseURL}/verify-email?token=${d}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:s.user,url:u,token:d},e.request)}throw new _("FORBIDDEN",{message:Q.EMAIL_NOT_VERIFIED})}const c=await e.context.internalAdapter.createSession(s.user.id,e,e.body.rememberMe===!1);if(!c)throw e.context.logger.error("Failed to create session"),new _("UNAUTHORIZED",{message:Q.FAILED_TO_CREATE_SESSION});return await Nt(e,{session:c,user:s.user},e.body.rememberMe===!1),e.json({redirect:!!e.body.callbackURL,token:c.token,url:e.body.callbackURL,user:{id:s.user.id,email:s.user.email,name:s.user.name,image:s.user.image,emailVerified:s.user.emailVerified,createdAt:s.user.createdAt,updatedAt:s.user.updatedAt}})}),Gi=G({code:S().optional(),error:S().optional(),device_id:S().optional(),error_description:S().optional(),state:S().optional(),user:S().optional()}),GP=K("/callback/:id",{method:["GET","POST"],body:Gi.optional(),query:Gi.optional(),metadata:Zd},async e=>{let t;const r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if(e.method==="GET")t=Gi.parse(e.query);else if(e.method==="POST")t=Gi.parse(e.body);else throw new Error("Unsupported method")}catch(A){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",A),e.redirect(`${r}?error=invalid_callback_request`)}const{code:n,error:s,state:i,error_description:o,device_id:a}=t;if(!i){e.context.logger.error("State not found",s);const A=r.includes("?")?"&":"?",R=`${r}${A}state=state_not_found`;throw e.redirect(R)}const{codeVerifier:c,callbackURL:d,link:u,errorURL:l,newUserURL:h,requestSignUp:m}=await dP(e);function p(A,R){const T=l??r,L=new URLSearchParams({error:A});R&&L.set("error_description",R);const P=T.includes("?")?"&":"?",W=`${T}${P}${L.toString()}`;throw e.redirect(W)}if(s&&p(s,o),!n)throw e.context.logger.error("Code not found"),p("no_code");const w=e.context.socialProviders.find(A=>A.id===e.params.id);if(!w)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),p("oauth_provider_not_found");let g;try{g=await w.validateAuthorizationCode({code:n,codeVerifier:c,deviceId:a,redirectURI:`${e.context.baseURL}/callback/${w.id}`})}catch(A){throw e.context.logger.error("",A),p("invalid_code")}const b=await w.getUserInfo({...g,user:e.body?.user?ht(e.body.user):void 0}).then(A=>A?.user);if(!b)return e.context.logger.error("Unable to get user info"),p("unable_to_get_user_info");if(!d)throw e.context.logger.error("No callback URL found"),p("no_callback_url");if(u){if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(w.id)&&!b.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return e.context.logger.error("Unable to link account - untrusted provider"),p("unable_to_link_account");if(b.email!==u.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return p("email_doesn't_match");const T=await e.context.internalAdapter.findAccount(String(b.id));if(T){if(T.userId.toString()!==u.userId.toString())return p("account_already_linked_to_different_user");const P=Object.fromEntries(Object.entries({accessToken:await vt(g.accessToken,e.context),refreshToken:await vt(g.refreshToken,e.context),idToken:g.idToken,accessTokenExpiresAt:g.accessTokenExpiresAt,refreshTokenExpiresAt:g.refreshTokenExpiresAt,scope:g.scopes?.join(",")}).filter(([W,j])=>j!==void 0));await e.context.internalAdapter.updateAccount(T.id,P)}else if(!await e.context.internalAdapter.createAccount({userId:u.userId,providerId:w.id,accountId:String(b.id),...g,accessToken:await vt(g.accessToken,e.context),refreshToken:await vt(g.refreshToken,e.context),scope:g.scopes?.join(",")},e))return p("unable_to_link_account");let L;try{L=d.toString()}catch{L=d}throw e.redirect(L)}if(!b.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),p("email_not_found");const v=await og(e,{userInfo:{...b,id:String(b.id),email:b.email,name:b.name||b.email},account:{providerId:w.id,accountId:String(b.id),...g,scope:g.scopes?.join(",")},callbackURL:d,disableSignUp:w.disableImplicitSignUp&&!m||w.options?.disableSignUp,overrideUserInfo:w.options?.overrideUserInfoOnSignIn});if(v.error)return e.context.logger.error(v.error.split(" ").join("_")),p(v.error.split(" ").join("_"));const{session:y,user:E}=v.data;await Nt(e,{session:y,user:E});let k;try{k=(v.isRegister&&h||d).toString()}catch{k=v.isRegister&&h||d}throw e.redirect(k)}),QP=K("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw Un(e),new _("BAD_REQUEST",{message:Q.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),Un(e),e.json({success:!0})});function wp(e,t,r){const n=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([s,i])=>n.searchParams.set(s,i)),n.href}function YP(e,t,r){const n=new URL(t,e.baseURL);return r&&Object.entries(r).forEach(([s,i])=>n.searchParams.set(s,i)),n.href}const XP=K("/request-password-reset",{method:"POST",body:G({email:ea().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:S().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new _("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});const s=3600*1,i=pr(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||s,"sec"),o=Ht(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${o}`,expiresAt:i},e);const a=r?encodeURIComponent(r):"",c=`${e.context.baseURL}/reset-password/${o}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:c,token:o},e.request),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),eD=K("/forget-password",{method:"POST",body:G({email:S().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:S().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new _("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});const s=3600*1,i=pr(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||s,"sec"),o=Ht(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${o}`,expiresAt:i},e);const a=r?encodeURIComponent(r):"",c=`${e.context.baseURL}/reset-password/${o}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:c,token:o},e.request),e.json({status:!0})}),ug=K("/reset-password/:token",{method:"GET",query:G({callbackURL:S().meta({description:"The URL to redirect the user to reset their password"})}),use:[Fd(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{const{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(wp(e.context,r,{error:"INVALID_TOKEN"}));const n=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);throw!n||n.expiresAt<new Date?e.redirect(wp(e.context,r,{error:"INVALID_TOKEN"})):e.redirect(YP(e.context,r,{token:t}))}),tD=ug,rD=K("/reset-password",{method:"POST",query:G({token:S().optional()}).optional(),body:G({newPassword:S().meta({description:"The new password to set"}),token:S().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const t=e.body.token||e.query?.token;if(!t)throw new _("BAD_REQUEST",{message:Q.INVALID_TOKEN});const{newPassword:r}=e.body,n=e.context.password?.config.minPasswordLength,s=e.context.password?.config.maxPasswordLength;if(r.length<n)throw new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_SHORT});if(r.length>s)throw new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_LONG});const i=`reset-password:${t}`,o=await e.context.internalAdapter.findVerificationValue(i);if(!o||o.expiresAt<new Date)throw new _("BAD_REQUEST",{message:Q.INVALID_TOKEN});const a=o.value,c=await e.context.password.hash(r);if((await e.context.internalAdapter.findAccounts(a)).find(l=>l.providerId==="credential")?await e.context.internalAdapter.updatePassword(a,c,e):await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:c,accountId:a},e),await e.context.internalAdapter.deleteVerificationValue(o.id),e.context.options.emailAndPassword?.onPasswordReset){const l=await e.context.internalAdapter.findUserById(a);l&&await e.context.options.emailAndPassword.onPasswordReset({user:l},e.request)}return e.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(a),e.json({status:!0})}),nD=()=>K("/update-user",{method:"POST",body:_t(S().meta({description:"Field name must be a string"}),gt()),use:[rr],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async e=>{const t=e.body;if(t.email)throw new _("BAD_REQUEST",{message:Q.EMAIL_CAN_NOT_BE_UPDATED});const{name:r,image:n,...s}=t,i=e.context.session;if(n===void 0&&r===void 0&&Object.keys(s).length===0)return e.json({status:!0});const o=await e.context.internalAdapter.updateUser(i.user.id,{name:r,image:n,...s},e);return await Nt(e,{session:i.session,user:o}),e.json({status:!0})}),sD=K("/change-password",{method:"POST",body:G({newPassword:S().meta({description:"The new password to set"}),currentPassword:S().meta({description:"The current password is required"}),revokeOtherSessions:Xt().meta({description:"Must be a boolean value"}).optional()}),use:[Zn],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{const{newPassword:t,currentPassword:r,revokeOtherSessions:n}=e.body,s=e.context.session,i=e.context.password.config.minPasswordLength;if(t.length<i)throw e.context.logger.error("Password is too short"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_SHORT});const o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_LONG});const c=(await e.context.internalAdapter.findAccounts(s.user.id)).find(h=>h.providerId==="credential"&&h.password);if(!c||!c.password)throw new _("BAD_REQUEST",{message:Q.CREDENTIAL_ACCOUNT_NOT_FOUND});const d=await e.context.password.hash(t);if(!await e.context.password.verify({hash:c.password,password:r}))throw new _("BAD_REQUEST",{message:Q.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(c.id,{password:d});let l=null;if(n){await e.context.internalAdapter.deleteSessions(s.user.id);const h=await e.context.internalAdapter.createSession(s.user.id,e);if(!h)throw new _("INTERNAL_SERVER_ERROR",{message:Q.FAILED_TO_GET_SESSION});await Nt(e,{session:h,user:s.user}),l=h.token}return e.json({token:l,user:{id:s.user.id,email:s.user.email,name:s.user.name,image:s.user.image,emailVerified:s.user.emailVerified,createdAt:s.user.createdAt,updatedAt:s.user.updatedAt}})}),iD=K("/set-password",{method:"POST",body:G({newPassword:S().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[Zn]},async e=>{const{newPassword:t}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(t.length<n)throw e.context.logger.error("Password is too short"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_SHORT});const s=e.context.password.config.maxPasswordLength;if(t.length>s)throw e.context.logger.error("Password is too long"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_LONG});const o=(await e.context.internalAdapter.findAccounts(r.user.id)).find(c=>c.providerId==="credential"&&c.password),a=await e.context.password.hash(t);if(!o)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:a},e),e.json({status:!0});throw new _("BAD_REQUEST",{message:"user already has a password"})}),oD=K("/delete-user",{method:"POST",use:[Zn],body:G({callbackURL:S().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:S().meta({description:"The password of the user is required to delete the user"}).optional(),token:S().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new _("NOT_FOUND");const t=e.context.session;if(e.body.password){const i=(await e.context.internalAdapter.findAccounts(t.user.id)).find(a=>a.providerId==="credential"&&a.password);if(!i||!i.password)throw new _("BAD_REQUEST",{message:Q.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:i.password,password:e.body.password}))throw new _("BAD_REQUEST",{message:Q.INVALID_PASSWORD})}if(e.body.token)return await dg({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){const s=Ct(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${s}`,expiresAt:new Date(Date.now()+(e.context.options.user.deleteUser?.deleteTokenExpiresIn||3600*24)*1e3)},e);const i=`${e.context.baseURL}/delete-user/callback?token=${s}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:i,token:s},e.request),e.json({success:!0,message:"Verification email sent"})}if(!e.body.password&&e.context.sessionConfig.freshAge!==0){const s=new Date(t.session.createdAt).getTime(),i=e.context.sessionConfig.freshAge*1e3;if(Date.now()-s>i*1e3)throw new _("BAD_REQUEST",{message:Q.SESSION_EXPIRED})}const r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),Un(e);const n=e.context.options.user.deleteUser?.afterDelete;return n&&await n(t.user,e.request),e.json({success:!0,message:"User deleted"})}),dg=K("/delete-user/callback",{method:"GET",query:G({token:S().meta({description:"The token to verify the deletion request"}),callbackURL:S().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[Fd(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new _("NOT_FOUND");const t=await ut(e);if(!t)throw new _("NOT_FOUND",{message:Q.FAILED_TO_GET_USER_INFO});const r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date)throw new _("NOT_FOUND",{message:Q.INVALID_TOKEN});if(r.value!==t.user.id)throw new _("NOT_FOUND",{message:Q.INVALID_TOKEN});const n=e.context.options.user.deleteUser?.beforeDelete;n&&await n(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),Un(e);const s=e.context.options.user.deleteUser?.afterDelete;if(s&&await s(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})}),aD=K("/change-email",{method:"POST",body:G({newEmail:ea().meta({description:"The new email address to set must be a valid email address"}),callbackURL:S().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[Zn],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new _("BAD_REQUEST",{message:"Change email is disabled"});const t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new _("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new _("BAD_REQUEST",{message:"Couldn't update your email"});if(e.context.session.user.emailVerified!==!0){if(await e.context.internalAdapter.findUserByEmail(t))throw new _("UNPROCESSABLE_ENTITY",{message:Q.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await Nt(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){const o=await Pn(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),a=`${e.context.baseURL}/verify-email?token=${o}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:a,token:o},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new _("BAD_REQUEST",{message:"Verification email isn't enabled"});const n=await Pn(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${n}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:s,token:n},e.request),e.json({status:!0})});function cD(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const uD=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon"></div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${cD(e)}</span></div>
    </div>
</body>
</html>`,dD=K("/error",{method:"GET",metadata:{...Zd,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>{const t=new URL(e.request?.url||"").searchParams.get("error")||"Unknown";return new Response(uD(t),{headers:{"Content-Type":"text/html"}})}),lD=K("/ok",{method:"GET",metadata:{...Zd,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0})),hD=K("/list-accounts",{method:"GET",use:[rr],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","scopes"]}}}}}}}}},async e=>{const t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(n=>({id:n.id,providerId:n.providerId,createdAt:n.createdAt,updatedAt:n.updatedAt,accountId:n.accountId,scopes:n.scope?.split(",")||[]})))}),fD=K("/link-social",{method:"POST",requireHeaders:!0,body:G({callbackURL:S().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:cg,idToken:G({token:S(),nonce:S().optional(),accessToken:S().optional(),refreshToken:S().optional(),scopes:Et(S()).optional()}).optional(),requestSignUp:Xt().optional(),scopes:Et(S()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:S().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:Xt().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional()}),use:[rr],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{const t=e.context.session,r=e.context.socialProviders.find(i=>i.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new _("NOT_FOUND",{message:Q.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!r.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new _("NOT_FOUND",{message:Q.ID_TOKEN_NOT_SUPPORTED});const{token:i,nonce:o}=e.body.idToken;if(!await r.verifyIdToken(i,o))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.INVALID_TOKEN});const c=await r.getUserInfo({idToken:i,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!c||!c?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.FAILED_TO_GET_USER_INFO});const d=String(c.user.id);if(!c.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new _("UNAUTHORIZED",{message:Q.USER_EMAIL_NOT_FOUND});if((await e.context.internalAdapter.findAccounts(t.user.id)).find(p=>p.providerId===r.id&&p.accountId===d))return e.json({url:"",status:!0,redirect:!1});if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.id)&&!c.user.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)throw new _("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(c.user.email!==t.user.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new _("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await e.context.internalAdapter.createAccount({userId:t.user.id,providerId:r.id,accountId:d,accessToken:e.body.idToken.accessToken,idToken:i,refreshToken:e.body.idToken.refreshToken,scope:e.body.idToken.scopes?.join(",")},e)}catch{throw new _("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(e.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await e.context.internalAdapter.updateUser(t.user.id,{name:c.user?.name,image:c.user?.image})}catch(p){console.warn("Could not update user - "+p.toString())}return e.json({url:"",status:!0,redirect:!1})}const n=await ng(e,{userId:t.user.id,email:t.user.email}),s=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:s.toString(),redirect:!e.body.disableRedirect})}),pD=K("/unlink-account",{method:"POST",body:G({providerId:S(),accountId:S().optional()}),use:[JU],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const{providerId:t,accountId:r}=e.body,n=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(n.length===1&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new _("BAD_REQUEST",{message:Q.FAILED_TO_UNLINK_LAST_ACCOUNT});const s=n.find(i=>r?i.accountId===r&&i.providerId===t:i.providerId===t);if(!s)throw new _("BAD_REQUEST",{message:Q.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(s.id),e.json({status:!0})}),lg=K("/get-access-token",{method:"POST",body:G({providerId:S().meta({description:"The provider ID for the OAuth provider"}),accountId:S().meta({description:"The account ID associated with the refresh token"}).optional(),userId:S().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{const{providerId:t,accountId:r,userId:n}=e.body,s=e.request,i=await ut(e);if(s&&!i)throw e.error("UNAUTHORIZED");let o=i?.user?.id||n;if(!o)throw new _("BAD_REQUEST",{message:"Either userId or session is required"});if(!e.context.socialProviders.find(u=>u.id===t))throw new _("BAD_REQUEST",{message:`Provider ${t} is not supported.`});const c=(await e.context.internalAdapter.findAccounts(o)).find(u=>r?u.id===r&&u.providerId===t:u.providerId===t);if(!c)throw new _("BAD_REQUEST",{message:"Account not found"});const d=e.context.socialProviders.find(u=>u.id===t);if(!d)throw new _("BAD_REQUEST",{message:`Provider ${t} not found.`});try{let u=null;const l=c.accessTokenExpiresAt&&new Date(c.accessTokenExpiresAt).getTime()-Date.now()<5e3;c.refreshToken&&l&&d.refreshAccessToken&&(u=await d.refreshAccessToken(c.refreshToken),await e.context.internalAdapter.updateAccount(c.id,{accessToken:await vt(u.accessToken,e.context),accessTokenExpiresAt:u.accessTokenExpiresAt,refreshToken:await vt(u.refreshToken,e.context),refreshTokenExpiresAt:u.refreshTokenExpiresAt}));const h={accessToken:await lP(u?.accessToken??c.accessToken??"",e.context),accessTokenExpiresAt:u?.accessTokenExpiresAt??c.accessTokenExpiresAt??void 0,scopes:c.scope?.split(",")??[],idToken:u?.idToken??c.idToken??void 0};return e.json(h)}catch(u){throw new _("BAD_REQUEST",{message:"Failed to get a valid access token",cause:u})}}),mD=K("/refresh-token",{method:"POST",body:G({providerId:S().meta({description:"The provider ID for the OAuth provider"}),accountId:S().meta({description:"The account ID associated with the refresh token"}).optional(),userId:S().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{const{providerId:t,accountId:r,userId:n}=e.body,s=e.request,i=await ut(e);if(s&&!i)throw e.error("UNAUTHORIZED");let o=i?.user?.id||n;if(!o)throw new _("BAD_REQUEST",{message:"Either userId or session is required"});const c=(await e.context.internalAdapter.findAccounts(o)).find(u=>r?u.id===r&&u.providerId===t:u.providerId===t);if(!c)throw new _("BAD_REQUEST",{message:"Account not found"});const d=e.context.socialProviders.find(u=>u.id===t);if(!d)throw new _("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!d.refreshAccessToken)throw new _("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{const u=await d.refreshAccessToken(c.refreshToken);return await e.context.internalAdapter.updateAccount(c.id,{accessToken:await vt(u.accessToken,e.context),refreshToken:await vt(u.refreshToken,e.context),accessTokenExpiresAt:u.accessTokenExpiresAt,refreshTokenExpiresAt:u.refreshTokenExpiresAt}),e.json(u)}catch(u){throw new _("BAD_REQUEST",{message:"Failed to refresh access token",cause:u})}}),wD=K("/account-info",{method:"POST",use:[rr],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:G({accountId:S().meta({description:"The provider given account id for which to get the account info"})})},async e=>{const t=await e.context.internalAdapter.findAccount(e.body.accountId);if(!t||t.userId!==e.context.session.user.id)throw new _("BAD_REQUEST",{message:"Account not found"});const r=e.context.socialProviders.find(i=>i.id===t.providerId);if(!r)throw new _("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${t.providerId} but it is not configured`});const n=await lg({...e,body:{accountId:t.id,providerId:t.providerId},returnHeaders:!1});if(!n.accessToken)throw new _("BAD_REQUEST",{message:"Access token not found"});const s=await r.getUserInfo({...n,accessToken:n.accessToken});return e.json(s)}),hg=tg((e,t,r)=>{if(Array.isArray(e[t])&&Array.isArray(r))return e[t]=r,!0});function yD(e,t){const r={};for(const[n,s]of Object.entries(e))r[n]=async i=>{const o=await t;let a={...i,context:{...o,returned:void 0,responseHeaders:void 0,session:null},path:s.path,headers:i?.headers?new Headers(i?.headers):void 0};const{beforeHooks:c,afterHooks:d}=vD(o),u=await gD(a,c);if("context"in u&&u.context&&typeof u.context=="object"){const{headers:p,...w}=u.context;p&&p.forEach((g,b)=>{a.headers.set(b,g)}),a=hg(w,a)}else if(u)return i?.asResponse?An(u,{headers:i?.headers}):i?.returnHeaders?{headers:i?.headers,response:u}:u;a.asResponse=!1,a.returnHeaders=!0;const l=await s(a).catch(p=>{if(p instanceof _)return{response:p,headers:p.headers?new Headers(p.headers):null};throw p});if(l&&l instanceof Response)return l;a.context.returned=l.response,a.context.responseHeaders=l.headers;const h=await bD(a,d);if(h.response&&(l.response=h.response),l.response instanceof _&&Jo(o.logger.level,"debug")&&(l.response.stack=l.response.errorStack),l.response instanceof _&&!i?.asResponse)throw l.response;return i?.asResponse?An(l.response,{headers:l.headers}):i?.returnHeaders?{headers:l.headers,response:l.response}:l.response},r[n].path=s.path,r[n].options=s.options;return r}async function gD(e,t){let r={};for(const n of t)if(n.matcher(e)){const s=await n.handler({...e,returnHeaders:!1}).catch(i=>{throw i instanceof _&&Jo(e.context.logger.level,"debug")&&(i.stack=i.errorStack),i});if(s&&typeof s=="object"){if("context"in s&&typeof s.context=="object"){const{headers:i,...o}=s.context;i instanceof Headers&&(r.headers?i.forEach((a,c)=>{r.headers?.set(c,a)}):r.headers=i),r=hg(o,r);continue}return s}}return{context:r}}async function bD(e,t){for(const r of t)if(r.matcher(e)){const n=await r.handler(e).catch(s=>{if(s instanceof _)return Jo(e.context.logger.level,"debug")&&(s.stack=s.errorStack),{response:s,headers:s.headers?new Headers(s.headers):null};throw s});n.headers&&n.headers.forEach((s,i)=>{e.context.responseHeaders?i.toLowerCase()==="set-cookie"?e.context.responseHeaders.append(i,s):e.context.responseHeaders.set(i,s):e.context.responseHeaders=new Headers({[i]:s})}),n.response&&(e.context.returned=n.response)}return{response:e.context.returned,headers:e.context.responseHeaders}}function vD(e){const t=e.options.plugins||[],r=[],n=[];e.options.hooks?.before&&r.push({matcher:()=>!0,handler:e.options.hooks.before}),e.options.hooks?.after&&n.push({matcher:()=>!0,handler:e.options.hooks.after});const s=t.map(o=>{if(o.hooks?.before)return o.hooks.before}).filter(o=>o!==void 0).flat(),i=t.map(o=>{if(o.hooks?.after)return o.hooks.after}).filter(o=>o!==void 0).flat();return s.length&&r.push(...s),i.length&&n.push(...i),{beforeHooks:r,afterHooks:n}}const ED=()=>K("/sign-up/email",{method:"POST",body:_t(S(),gt()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.enabled||e.context.options.emailAndPassword?.disableSignUp)throw new _("BAD_REQUEST",{message:"Email and password sign up is not enabled"});const t=e.body,{name:r,email:n,password:s,image:i,callbackURL:o,rememberMe:a,...c}=t;if(!ea().safeParse(n).success)throw new _("BAD_REQUEST",{message:Q.INVALID_EMAIL});const u=e.context.password.config.minPasswordLength;if(s.length<u)throw e.context.logger.error("Password is too short"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_SHORT});const l=e.context.password.config.maxPasswordLength;if(s.length>l)throw e.context.logger.error("Password is too long"),new _("BAD_REQUEST",{message:Q.PASSWORD_TOO_LONG});if((await e.context.internalAdapter.findUserByEmail(n))?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${n}`),new _("UNPROCESSABLE_ENTITY",{message:Q.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});const m=await e.context.password.hash(s);let p;try{const g=uC(e.context.options,c,"create");if(p=await e.context.internalAdapter.createUser({email:n.toLowerCase(),name:r,image:i,...g,emailVerified:!1},e),!p)throw new _("BAD_REQUEST",{message:Q.FAILED_TO_CREATE_USER})}catch(g){throw Ru&&e.context.logger.error("Failed to create user",g),g instanceof _?g:(e.context.logger?.error("Failed to create user",g),new _("UNPROCESSABLE_ENTITY",{message:Q.FAILED_TO_CREATE_USER,details:g}))}if(!p)throw new _("UNPROCESSABLE_ENTITY",{message:Q.FAILED_TO_CREATE_USER});if(await e.context.internalAdapter.linkAccount({userId:p.id,providerId:"credential",accountId:p.id,password:m},e),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){const g=await Pn(e.context.secret,p.email,void 0,e.context.options.emailVerification?.expiresIn),b=`${e.context.baseURL}/verify-email?token=${g}&callbackURL=${t.callbackURL||"/"}`,v=e.request?[{user:p,url:b,token:g},e.request]:[{user:p,url:b,token:g}];await e.context.options.emailVerification?.sendVerificationEmail?.(...v)}if(e.context.options.emailAndPassword.autoSignIn===!1||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null,user:{id:p.id,email:p.email,name:p.name,image:p.image,emailVerified:p.emailVerified,createdAt:p.createdAt,updatedAt:p.updatedAt}});const w=await e.context.internalAdapter.createSession(p.id,e,a===!1);if(!w)throw new _("BAD_REQUEST",{message:Q.FAILED_TO_CREATE_SESSION});return await Nt(e,{session:w,user:p},a===!1),e.json({token:w.token,user:{id:p.id,email:p.email,name:p.name,image:p.image,emailVerified:p.emailVerified,createdAt:p.createdAt,updatedAt:p.updatedAt}})});function _D(e,t,r){const n=Date.now(),s=t*1e3;return n-r.lastRequest<s&&r.count>=e}function ND(e){return new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":e.toString()}})}function AD(e,t){const r=Date.now(),n=t*1e3;return Math.ceil((e+n-r)/1e3)}function kD(e){const t="rateLimit",r=e.adapter;return{get:async n=>{const i=(await r.findMany({model:t,where:[{field:"key",value:n}]}))[0];return typeof i?.lastRequest=="bigint"&&(i.lastRequest=Number(i.lastRequest)),i},set:async(n,s,i)=>{try{i?await r.updateMany({model:t,where:[{field:"key",value:n}],update:{count:s.count,lastRequest:s.lastRequest}}):await r.create({model:t,data:{key:n,count:s.count,lastRequest:s.lastRequest}})}catch(o){e.logger.error("Error setting rate limit",o)}}}}const yp=new Map;function TD(e,t){if(e.options.rateLimit?.customStorage)return e.options.rateLimit.customStorage;const r=e.rateLimit.storage;return r==="secondary-storage"?{get:async n=>{const s=await e.options.secondaryStorage?.get(n);return s?ht(s):void 0},set:async(n,s,i)=>{const o=t?.window??e.options.rateLimit?.window??10;await e.options.secondaryStorage?.set?.(n,JSON.stringify(s),o)}}:r==="memory"?{async get(n){return yp.get(n)},async set(n,s,i){yp.set(n,s)}}:kD(e)}async function SD(e,t){if(!t.rateLimit.enabled)return;const r=new URL(e.url).pathname.replace(t.options.basePath||"/api/auth","");let n=t.rateLimit.window,s=t.rateLimit.max;const i=Yw(e,t.options);if(!i)return;const o=i+r,c=RD().find(h=>h.pathMatcher(r));c&&(n=c.window,s=c.max);for(const h of t.options.plugins||[])if(h.rateLimit){const m=h.rateLimit.find(p=>p.pathMatcher(r));if(m){n=m.window,s=m.max;break}}if(t.rateLimit.customRules){const h=Object.keys(t.rateLimit.customRules).find(m=>m.includes("*")?_i(m)(r):m===r);if(h){const m=t.rateLimit.customRules[h],p=typeof m=="function"?await m(e):m;if(p&&(n=p.window,s=p.max),p===!1)return}}const d=TD(t,{window:n}),u=await d.get(o),l=Date.now();if(!u)await d.set(o,{key:o,count:1,lastRequest:l});else{const h=l-u.lastRequest;if(_D(s,n,u)){const m=AD(u.lastRequest,n);return ND(m)}else h>n*1e3?await d.set(o,{...u,count:1,lastRequest:l},!0):await d.set(o,{...u,count:u.count+1,lastRequest:l},!0)}}function RD(){return[{pathMatcher(t){return t.startsWith("/sign-in")||t.startsWith("/sign-up")||t.startsWith("/change-password")||t.startsWith("/change-email")},window:10,max:3}]}function ID(e,t){const r=new Map;e.plugins?.forEach(s=>{if(s.endpoints){for(const[i,o]of Object.entries(s.endpoints))if(o&&"path"in o){const a=o.path;let c=[];o.options&&"method"in o.options&&(Array.isArray(o.options.method)?c=o.options.method:typeof o.options.method=="string"&&(c=[o.options.method])),c.length===0&&(c=["*"]),r.has(a)||r.set(a,[]),r.get(a).push({pluginId:s.id,endpointKey:i,methods:c})}}});const n=[];for(const[s,i]of r.entries())if(i.length>1){const o=new Map;let a=!1;for(const c of i)for(const d of c.methods)o.has(d)||o.set(d,[]),o.get(d).push(c.pluginId),o.get(d).length>1&&(a=!0),(d==="*"&&i.length>1||d!=="*"&&o.has("*"))&&(a=!0);if(a){const c=[...new Set(i.map(u=>u.pluginId))],d=[];for(const[u,l]of o.entries())(l.length>1||u==="*"&&i.length>1||u!=="*"&&o.has("*"))&&d.push(u);n.push({path:s,plugins:c,conflictingMethods:d})}}if(n.length>0){const s=n.map(i=>`  - "${i.path}" [${i.conflictingMethods.join(", ")}] used by plugins: ${i.plugins.join(", ")}`).join(`
`);t.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${s}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}function fg(e,t){const r=t.plugins?.reduce((a,c)=>({...a,...c.endpoints}),{})??{},n=t.plugins?.map(a=>a.middlewares?.map(c=>{const d=(async u=>{const l=await e;return c.middleware({...u,context:{...l,...u.context}})});return d.options=c.middleware.options,{path:c.path,middleware:d}})).filter(a=>a!==void 0).flat()||[],i={...{signInSocial:KP,callbackOAuth:GP,getSession:Xy(),signOut:QP,signUpEmail:ED(),signInEmail:JP,forgetPassword:eD,resetPassword:rD,verifyEmail:uP,sendVerificationEmail:cP,changeEmail:aD,changePassword:sD,setPassword:iD,updateUser:nD(),deleteUser:oD,forgetPasswordCallback:tD,requestPasswordReset:XP,requestPasswordResetCallback:ug,listSessions:GU(),revokeSession:QU,revokeSessions:YU,revokeOtherSessions:XU,linkSocialAccount:fD,listUserAccounts:hD,deleteUserCallback:dg,unlinkAccount:pD,refreshToken:mD,getAccessToken:lg,accountInfo:wD},...r,ok:lD,error:dD};return{api:yD(i,e),middlewares:n}}const OD=(e,t)=>{const{api:r,middlewares:n}=fg(e,t),s=new URL(e.baseURL).pathname;return RT(r,{routerContext:e,openapi:{disabled:!0},basePath:s,routerMiddleware:[{path:"/**",middleware:aP},...n],async onRequest(i){const o=e.options.disabledPaths||[],a=new URL(i.url).pathname.replace(s,"");if(o.includes(a))return new Response("Not Found",{status:404});for(const c of e.options.plugins||[])if(c.onRequest){const d=await c.onRequest(i,e);if(d&&"response"in d)return d.response}return SD(i,e)},async onResponse(i){for(const o of e.options.plugins||[])if(o.onResponse){const a=await o.onResponse(i,e);if(a)return a.response}return i},onError(i){if(i instanceof _&&i.status==="FOUND")return;if(t.onAPIError?.throw)throw i;if(t.onAPIError?.onError){t.onAPIError.onError(i,e);return}const o=t.logger?.level,a=o==="error"||o==="warn"||o==="debug"?te:void 0;if(t.logger?.disabled!==!0){if(i&&typeof i=="object"&&"message"in i&&typeof i.message=="string"&&(i.message.includes("no column")||i.message.includes("column")||i.message.includes("relation")||i.message.includes("table")||i.message.includes("does not exist"))){e.logger?.error(i.message);return}i instanceof _?(i.status==="INTERNAL_SERVER_ERROR"&&e.logger.error(i.status,i),a?.error(i.message)):e.logger?.error(i&&typeof i=="object"&&"name"in i?i.name:"",i)}}})};et(async()=>({}));et({use:[rr]},async e=>({session:e.context.session}));const pg=S(),$D=Mt(["pending","accepted","rejected","canceled"]).default("pending");G({id:S().default(Ht),name:S(),slug:S(),logo:S().nullish().optional(),metadata:_t(S(),eu()).or(S().transform(e=>JSON.parse(e))).optional(),createdAt:fr()});G({id:S().default(Ht),organizationId:S(),userId:Wt(),role:pg,createdAt:fr().default(()=>new Date)});G({id:S().default(Ht),organizationId:S(),email:S(),role:pg,status:$D,teamId:S().nullish(),inviterId:S(),expiresAt:fr()});G({id:S().default(Ht),name:S().min(1),organizationId:S(),createdAt:fr(),updatedAt:fr().optional()});G({id:S().default(Ht),teamId:S(),userId:S(),createdAt:fr().default(()=>new Date)});G({id:S().default(Ht),organizationId:S(),role:S(),permission:_t(S(),Et(S())),createdAt:fr().default(()=>new Date),updatedAt:fr().optional()});const gp=["admin","member","owner"];Hs([Mt(gp),Et(Mt(gp))]);async function CD(e,t){const n=(await t.context.internalAdapter.findAccounts(e))?.find(o=>o.providerId==="credential"),s=n?.password;if(!n||!s||!t.body.password)throw new _("BAD_REQUEST",{message:"No password credential found"});if(!await t.context.password.verify({hash:s,password:t.body.password}))throw new _("BAD_REQUEST",{message:"Invalid password"});return!0}const xD=e=>({id:"bearer",hooks:{before:[{matcher(t){return!!(t.request?.headers.get("authorization")||t.headers?.get("authorization"))},handler:et(async t=>{const r=t.request?.headers.get("authorization")?.replace("Bearer ","")||t.headers?.get("Authorization")?.replace("Bearer ","");if(!r)return;let n="";r.includes(".")?n=r.replace("=",""):n=(await Rm("",r,t.context.secret)).replace("=","");try{const o=decodeURIComponent(n);if(!await Wd("SHA-256","base64urlnopad").verify(t.context.secret,o.split(".")[0],o.split(".")[1]))return}catch{return}const s=t.request?.headers||t.headers,i=new Headers({...Object.fromEntries(s?.entries())});return i.append("cookie",`${t.context.authCookies.sessionToken.name}=${n}`),{context:{headers:i}}})}],after:[{matcher(t){return!0},handler:et(async t=>{const r=t.context.responseHeaders?.get("set-cookie");if(!r)return;const n=Jy(r),s=t.context.authCookies.sessionToken.name,i=n.get(s);if(!i||!i.value||i["max-age"]===0)return;const o=i.value,a=t.context.responseHeaders?.get("access-control-expose-headers")||"",c=new Set(a.split(",").map(d=>d.trim()).filter(Boolean));c.add("set-auth-token"),t.setHeader("set-auth-token",o),t.setHeader("Access-Control-Expose-Headers",Array.from(c).join(", "))})}]}}),UD=async e=>{const t=e.context.returned;return t?t instanceof Response?t.status!==200?null:await t.clone().json():t instanceof _?null:t:null},Fe={FAILED_TO_CREATE_USER:"Failed to create user",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",YOU_CANNOT_BAN_YOURSELF:"You cannot ban yourself",YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE:"You are not allowed to change users role",YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS:"You are not allowed to create users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS:"You are not allowed to list users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS:"You are not allowed to list users sessions",YOU_ARE_NOT_ALLOWED_TO_BAN_USERS:"You are not allowed to ban users",YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS:"You are not allowed to impersonate users",YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS:"You are not allowed to revoke users sessions",YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS:"You are not allowed to delete users",YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD:"You are not allowed to set users password",BANNED_USER:"You have been banned from this application",YOU_ARE_NOT_ALLOWED_TO_GET_USER:"You are not allowed to get user",NO_DATA_TO_UPDATE:"No data to update",YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS:"You are not allowed to update users",YOU_CANNOT_REMOVE_YOURSELF:"You cannot remove yourself"},PD={user:{fields:{role:{type:"string",required:!1,input:!1},banned:{type:"boolean",defaultValue:!1,required:!1,input:!1},banReason:{type:"string",required:!1,input:!1},banExpires:{type:"date",required:!1,input:!1}}},session:{fields:{impersonatedBy:{type:"string",required:!1}}}};function Uc(e){return Array.isArray(e)?e.join(","):e}const DD=e=>{const t={defaultRole:"user",adminRoles:["admin"],bannedUserMessage:"You have been banned from this application. Please contact support if you believe this is an error.",...e},r=et(async n=>{const s=await ut(n);if(!s)throw new _("UNAUTHORIZED");return{session:s}});return{id:"admin",init(){return{options:{databaseHooks:{user:{create:{async before(n){return{data:{role:e?.defaultRole??"user",...n}}}}},session:{create:{async before(n,s){if(!s)return;const i=await s.context.internalAdapter.findUserById(n.userId);if(i.banned){if(i.banExpires&&new Date(i.banExpires).getTime()<Date.now()){await s.context.internalAdapter.updateUser(n.userId,{banned:!1,banReason:null,banExpires:null});return}if(s&&(s.path.startsWith("/callback")||s.path.startsWith("/oauth2/callback"))){const o=s.context.options.onAPIError?.errorURL||`${s.context.baseURL}/error`;throw s.redirect(`${o}?error=banned&error_description=${t.bannedUserMessage}`)}throw new _("FORBIDDEN",{message:t.bannedUserMessage,code:"BANNED_USER"})}}}}}}}},hooks:{after:[{matcher(n){return n.path==="/list-sessions"},handler:et(async n=>{const s=await UD(n);if(!s)return;const i=s.filter(o=>!o.impersonatedBy);return n.json(i)})}]},endpoints:{setRole:K("/admin/set-role",{method:"POST",body:G({userId:Wt().meta({description:"The user id"}),role:Hs([S().meta({description:"The role to set. `admin` or `user` by default"}),Et(S().meta({description:"The roles to set. `admin` or `user` by default"}))]).meta({description:"The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`"})}),requireHeaders:!0,use:[r],metadata:{openapi:{operationId:"setRole",summary:"Set the role of a user",description:"Set the role of a user",responses:{200:{description:"User role updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async n=>{if(!mt({userId:n.context.session.user.id,role:n.context.session.user.role,options:t,permissions:{user:["set-role"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE});const i=await n.context.internalAdapter.updateUser(n.body.userId,{role:Uc(n.body.role)},n);return n.json({user:i})}),getUser:K("/admin/get-user",{method:"GET",query:G({id:S().meta({description:"The id of the User"})}),use:[r],metadata:{openapi:{operationId:"getUser",summary:"Get an existing user",description:"Get an existing user",responses:{200:{description:"User",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async n=>{const{id:s}=n.query;if(!mt({userId:n.context.session.user.id,role:n.context.session.user.role,options:t,permissions:{user:["get"]}}))throw n.error("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_GET_USER,code:"YOU_ARE_NOT_ALLOWED_TO_GET_USER"});const o=await n.context.internalAdapter.findUserById(s);if(!o)throw new _("NOT_FOUND",{message:Q.USER_NOT_FOUND});return mu(n.context.options,o)}),createUser:K("/admin/create-user",{method:"POST",body:G({email:S().meta({description:"The email of the user"}),password:S().meta({description:"The password of the user"}),name:S().meta({description:"The name of the user"}),role:Hs([S().meta({description:"The role of the user"}),Et(S().meta({description:"The roles of user"}))]).optional().meta({description:'A string or array of strings representing the roles to apply to the new user. Eg: "user"'}),data:_t(S(),gt()).optional().meta({description:"Extra fields for the user. Including custom additional fields."})}),metadata:{openapi:{operationId:"createUser",summary:"Create a new user",description:"Create a new user",responses:{200:{description:"User created",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async n=>{const s=await ut(n);if(!s&&(n.request||n.headers))throw n.error("UNAUTHORIZED");if(s&&!mt({userId:s.user.id,role:s.user.role,options:t,permissions:{user:["create"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS});if(await n.context.internalAdapter.findUserByEmail(n.body.email))throw new _("BAD_REQUEST",{message:Fe.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});const o=await n.context.internalAdapter.createUser({email:n.body.email,name:n.body.name,role:(n.body.role&&Uc(n.body.role))??e?.defaultRole??"user",...n.body.data},n);if(!o)throw new _("INTERNAL_SERVER_ERROR",{message:Fe.FAILED_TO_CREATE_USER});const a=await n.context.password.hash(n.body.password);return await n.context.internalAdapter.linkAccount({accountId:o.id,providerId:"credential",password:a,userId:o.id},n),n.json({user:o})}),adminUpdateUser:K("/admin/update-user",{method:"POST",body:G({userId:Wt().meta({description:"The user id"}),data:_t(gt(),gt()).meta({description:"The user data to update"})}),use:[r],metadata:{openapi:{operationId:"updateUser",summary:"Update a user",description:"Update a user's details",responses:{200:{description:"User updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async n=>{if(!mt({userId:n.context.session.user.id,role:n.context.session.user.role,options:t,permissions:{user:["update"]}}))throw n.error("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,code:"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS"});if(Object.keys(n.body.data).length===0)throw new _("BAD_REQUEST",{message:Fe.NO_DATA_TO_UPDATE});n.body.data?.role&&(n.body.data.role=Uc(n.body.data.role));const i=await n.context.internalAdapter.updateUser(n.body.userId,n.body.data,n);return n.json(i)}),listUsers:K("/admin/list-users",{method:"GET",use:[r],query:G({searchValue:S().optional().meta({description:'The value to search for. Eg: "some name"'}),searchField:Mt(["email","name"]).meta({description:'The field to search in, defaults to email. Can be `email` or `name`. Eg: "name"'}).optional(),searchOperator:Mt(["contains","starts_with","ends_with"]).meta({description:'The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: "contains"'}).optional(),limit:S().meta({description:"The number of users to return"}).or(Tr()).optional(),offset:S().meta({description:"The offset to start from"}).or(Tr()).optional(),sortBy:S().meta({description:"The field to sort by"}).optional(),sortDirection:Mt(["asc","desc"]).meta({description:"The direction to sort by"}).optional(),filterField:S().meta({description:"The field to filter by"}).optional(),filterValue:S().meta({description:"The value to filter by"}).or(Tr()).or(Xt()).optional(),filterOperator:Mt(["eq","ne","lt","lte","gt","gte","contains"]).meta({description:"The operator to use for the filter"}).optional()}),metadata:{openapi:{operationId:"listUsers",summary:"List users",description:"List users",responses:{200:{description:"List of users",content:{"application/json":{schema:{type:"object",properties:{users:{type:"array",items:{$ref:"#/components/schemas/User"}},total:{type:"number"},limit:{type:"number"},offset:{type:"number"}},required:["users","total"]}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{user:["list"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS});const o=[];n.query?.searchValue&&o.push({field:n.query.searchField||"email",operator:n.query.searchOperator||"contains",value:n.query.searchValue}),n.query?.filterValue&&o.push({field:n.query.filterField||"email",operator:n.query.filterOperator||"eq",value:n.query.filterValue});try{const a=await n.context.internalAdapter.listUsers(Number(n.query?.limit)||void 0,Number(n.query?.offset)||void 0,n.query?.sortBy?{field:n.query.sortBy,direction:n.query.sortDirection||"asc"}:void 0,o.length?o:void 0),c=await n.context.internalAdapter.countTotalUsers(o.length?o:void 0);return n.json({users:a,total:c,limit:Number(n.query?.limit)||void 0,offset:Number(n.query?.offset)||void 0})}catch{return n.json({users:[],total:0})}}),listUserSessions:K("/admin/list-user-sessions",{method:"POST",use:[r],body:G({userId:Wt().meta({description:"The user id"})}),metadata:{openapi:{operationId:"listUserSessions",summary:"List user sessions",description:"List user sessions",responses:{200:{description:"List of user sessions",content:{"application/json":{schema:{type:"object",properties:{sessions:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{session:["list"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS});return{sessions:await n.context.internalAdapter.listSessions(n.body.userId)}}),unbanUser:K("/admin/unban-user",{method:"POST",body:G({userId:Wt().meta({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"unbanUser",summary:"Unban a user",description:"Unban a user",responses:{200:{description:"User unbanned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{user:["ban"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});const o=await n.context.internalAdapter.updateUser(n.body.userId,{banned:!1,banExpires:null,banReason:null,updatedAt:new Date});return n.json({user:o})}),banUser:K("/admin/ban-user",{method:"POST",body:G({userId:Wt().meta({description:"The user id"}),banReason:S().meta({description:"The reason for the ban"}).optional(),banExpiresIn:Tr().meta({description:"The number of seconds until the ban expires"}).optional()}),use:[r],metadata:{openapi:{operationId:"banUser",summary:"Ban a user",description:"Ban a user",responses:{200:{description:"User banned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{user:["ban"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});if(!await n.context.internalAdapter.findUserById(n.body.userId))throw new _("NOT_FOUND",{message:Q.USER_NOT_FOUND});if(n.body.userId===n.context.session.user.id)throw new _("BAD_REQUEST",{message:Fe.YOU_CANNOT_BAN_YOURSELF});const a=await n.context.internalAdapter.updateUser(n.body.userId,{banned:!0,banReason:n.body.banReason||e?.defaultBanReason||"No reason",banExpires:n.body.banExpiresIn?pr(n.body.banExpiresIn,"sec"):void 0,updatedAt:new Date},n);return await n.context.internalAdapter.deleteSessions(n.body.userId),n.json({user:a})}),impersonateUser:K("/admin/impersonate-user",{method:"POST",body:G({userId:Wt().meta({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"impersonateUser",summary:"Impersonate a user",description:"Impersonate a user",responses:{200:{description:"Impersonation session created",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async n=>{if(!mt({userId:n.context.session.user.id,role:n.context.session.user.role,options:t,permissions:{user:["impersonate"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS});const i=await n.context.internalAdapter.findUserById(n.body.userId);if(!i)throw new _("NOT_FOUND",{message:"User not found"});const o=await n.context.internalAdapter.createSession(i.id,n,!0,{impersonatedBy:n.context.session.user.id,expiresAt:pr(3600,"sec")},!0);if(!o)throw new _("INTERNAL_SERVER_ERROR",{message:Fe.FAILED_TO_CREATE_USER});const a=n.context.authCookies;Un(n);const c=await n.getSignedCookie(n.context.authCookies.dontRememberToken.name,n.context.secret),d=n.context.createAuthCookie("admin_session");return await n.setSignedCookie(d.name,`${n.context.session.session.token}:${c||""}`,n.context.secret,a.sessionToken.options),await Nt(n,{session:o,user:i},!0),n.json({session:o,user:i})}),stopImpersonating:K("/admin/stop-impersonating",{method:"POST",requireHeaders:!0},async n=>{const s=await ut(n);if(!s)throw new _("UNAUTHORIZED");if(!s.session.impersonatedBy)throw new _("BAD_REQUEST",{message:"You are not impersonating anyone"});const i=await n.context.internalAdapter.findUserById(s.session.impersonatedBy);if(!i)throw new _("INTERNAL_SERVER_ERROR",{message:"Failed to find user"});const o=n.context.createAuthCookie("admin_session").name,a=await n.getSignedCookie(o,n.context.secret);if(!a)throw new _("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});const[c,d]=a?.split(":"),u=await n.context.internalAdapter.findSession(c);if(!u||u.session.userId!==i.id)throw new _("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});return await n.context.internalAdapter.deleteSession(s.session.token),await Nt(n,u,!!d),n.json(u)}),revokeUserSession:K("/admin/revoke-user-session",{method:"POST",body:G({sessionToken:S().meta({description:"The session token"})}),use:[r],metadata:{openapi:{operationId:"revokeUserSession",summary:"Revoke a user session",description:"Revoke a user session",responses:{200:{description:"Session revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{session:["revoke"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await n.context.internalAdapter.deleteSession(n.body.sessionToken),n.json({success:!0})}),revokeUserSessions:K("/admin/revoke-user-sessions",{method:"POST",body:G({userId:Wt().meta({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"revokeUserSessions",summary:"Revoke all user sessions",description:"Revoke all user sessions",responses:{200:{description:"Sessions revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{session:["revoke"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await n.context.internalAdapter.deleteSessions(n.body.userId),n.json({success:!0})}),removeUser:K("/admin/remove-user",{method:"POST",body:G({userId:Wt().meta({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"removeUser",summary:"Remove a user",description:"Delete a user and all their sessions and accounts. Cannot be undone.",responses:{200:{description:"User removed",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async n=>{const s=n.context.session;if(!mt({userId:n.context.session.user.id,role:s.user.role,options:t,permissions:{user:["delete"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS});if(n.body.userId===n.context.session.user.id)throw new _("BAD_REQUEST",{message:Fe.YOU_CANNOT_REMOVE_YOURSELF});if(!await n.context.internalAdapter.findUserById(n.body.userId))throw new _("NOT_FOUND",{message:"User not found"});return await n.context.internalAdapter.deleteUser(n.body.userId),n.json({success:!0})}),setUserPassword:K("/admin/set-user-password",{method:"POST",body:G({newPassword:S().meta({description:"The new password"}),userId:Wt().meta({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"setUserPassword",summary:"Set a user's password",description:"Set a user's password",responses:{200:{description:"Password set",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async n=>{if(!mt({userId:n.context.session.user.id,role:n.context.session.user.role,options:t,permissions:{user:["set-password"]}}))throw new _("FORBIDDEN",{message:Fe.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD});const i=await n.context.password.hash(n.body.newPassword);return await n.context.internalAdapter.updatePassword(n.body.userId,i),n.json({status:!0})}),userHasPermission:K("/admin/has-permission",{method:"POST",body:G({userId:Wt().optional().meta({description:'The user id. Eg: "user-id"'}),role:S().optional().meta({description:'The role to check permission for. Eg: "admin"'})}).and(Hs([G({permission:_t(S(),Et(S())),permissions:Hl()}),G({permission:Hl(),permissions:_t(S(),Et(S()))})])),metadata:{openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check",deprecated:!0},permissions:{type:"object",description:"The permission to check"}},required:["permissions"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}},$Infer:{body:{}}}},async n=>{if(!n.body?.permission&&!n.body?.permissions)throw new _("BAD_REQUEST",{message:"invalid permission check. no permission(s) were passed."});const s=await ut(n);if(!s&&(n.request||n.headers))throw new _("UNAUTHORIZED");if(!s&&!n.body.userId&&!n.body.role)throw new _("BAD_REQUEST",{message:"user id or role is required"});const i=s?.user||(n.body.role?{id:n.body.userId||"",role:n.body.role}:null)||await n.context.internalAdapter.findUserById(n.body.userId);if(!i)throw new _("BAD_REQUEST",{message:"user not found"});const o=mt({userId:i.id,role:i.role,options:e,permissions:n.body.permissions??n.body.permission});return n.json({error:null,success:o})})},$ERROR_CODES:Fe,schema:Ad(PD,t.schema),options:e}},Bd=e=>({getAllKeys:async()=>await e.findMany({model:"jwks"}),getLatestKey:async()=>(await e.findMany({model:"jwks",sortBy:{field:"createdAt",direction:"desc"},limit:1}))[0],createJwk:async t=>await e.create({model:"jwks",data:{...t,createdAt:new Date}})}),mg=60,wg=mg*60,Hd=wg*24,LD=Hd*7,zD=Hd*365.25,qD=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function jD(e){const t=qD.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let s;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(r*mg);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(r*wg);break;case"day":case"days":case"d":s=Math.round(r*Hd);break;case"week":case"weeks":case"w":s=Math.round(r*LD);break;default:s=Math.round(r*zD);break}return t[1]==="-"||t[4]==="ago"?-s:s}function WD(e,t){return typeof e=="number"?e:e instanceof Date?Math.floor(e.getTime()/1e3):t+jD(e)}async function MD(e){const{alg:t,...r}=e?.jwks?.keyPairConfig??{alg:"EdDSA",crv:"Ed25519"},{publicKey:n,privateKey:s}=await HS(t,{...r,extractable:!0}),i=await Ah(n),o=await Ah(s);return{publicWebKey:i,privateWebKey:o,alg:t,cfg:r}}async function yg(e,t){const{publicWebKey:r,privateWebKey:n,alg:s,cfg:i}=await MD(t),o=JSON.stringify(n),a=!t?.jwks?.disablePrivateKeyEncryption;let c={alg:s,...i&&"crv"in i?{crv:i.crv}:{},publicKey:JSON.stringify(r),privateKey:a?JSON.stringify(await Md({key:e.context.secret,data:o})):o,createdAt:new Date};return await Bd(e.context.adapter).createJwk(c)}async function gg(e,t){const{options:r,payload:n}=t,s=Math.floor(Date.now()/1e3),i=n.iat;let o=n.exp;const a=WD(r?.jwt?.expirationTime??"15m",i??s);o=o??a;const c=n.nbf,d=n.iss,u=r?.jwt?.issuer??e.context.options.baseURL,l=n.aud,h=r?.jwt?.audience??e.context.options.baseURL;if(r?.jwt?.sign){const E={...n,iat:i,exp:o,nbf:c,iss:d??u,aud:l??h};return r.jwt.sign(E)}let p=await Bd(e.context.adapter).getLatestKey();const w=!r?.jwks?.disablePrivateKeyEncryption;p===void 0&&(p=await yg(e,r));let g=w?await Vd({key:e.context.secret,data:JSON.parse(p.privateKey)}).catch(()=>{throw new ve("Failed to decrypt private private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either cleanup your jwks or disable private key encryption.")}):p.privateKey;const b=p.alg??r?.jwks?.keyPairConfig?.alg??"EdDSA",v=await oa(JSON.parse(g),b),y=new ud(n).setProtectedHeader({alg:b,kid:p.id}).setExpirationTime(o).setIssuer(d??u).setAudience(l??h);return i&&y.setIssuedAt(i),n.sub&&y.setSubject(n.sub),n.nbf&&y.setNotBefore(n.nbf),n.jti&&y.setJti(n.jti),await y.sign(v)}async function Tu(e,t){const r=t?.jwt?.definePayload?await t?.jwt.definePayload(e.context.session):e.context.session.user;return await gg(e,{options:t,payload:{iat:Math.floor(Date.now()/1e3),...r,sub:await t?.jwt?.getSubject?.(e.context.session)??e.context.session.user.id}})}const VD={jwks:{fields:{publicKey:{type:"string",required:!0},privateKey:{type:"string",required:!0},createdAt:{type:"date",required:!0}}}},FD=e=>{if(e?.jwt?.sign&&!e.jwks?.remoteUrl)throw new ve("jwks_config","jwks.remoteUrl must be set when using jwt.sign");if(e?.jwks?.remoteUrl&&!e.jwks?.keyPairConfig?.alg)throw new ve("jwks_config","must specify alg when using the oidc plugin and jwks.remoteUrl");return{id:"jwt",options:e,endpoints:{getJwks:K("/jwks",{method:"GET",metadata:{openapi:{description:"Get the JSON Web Key Set",responses:{200:{description:"JSON Web Key Set retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{keys:{type:"array",description:"Array of public JSON Web Keys",items:{type:"object",properties:{kid:{type:"string",description:"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk"},kty:{type:"string",description:"Key type (e.g., 'RSA', 'EC', 'OKP')"},alg:{type:"string",description:"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')"},use:{type:"string",description:"Intended use of the public key (e.g., 'sig' for signature)",enum:["sig"],nullable:!0},n:{type:"string",description:"Modulus for RSA keys (base64url-encoded)",nullable:!0},e:{type:"string",description:"Exponent for RSA keys (base64url-encoded)",nullable:!0},crv:{type:"string",description:"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')",nullable:!0},x:{type:"string",description:"X coordinate for elliptic curve keys (base64url-encoded)",nullable:!0},y:{type:"string",description:"Y coordinate for elliptic curve keys (base64url-encoded)",nullable:!0}},required:["kid","kty","alg"]}}},required:["keys"]}}}}}}}},async t=>{if(e?.jwks?.remoteUrl)throw new _("NOT_FOUND");const n=await Bd(t.context.adapter).getAllKeys();if(n.length===0){const o=await yg(t,e);n.push(o)}const s=e?.jwks?.keyPairConfig,i=s&&"crv"in s?s.crv:void 0;return t.json({keys:n.map(o=>({alg:o.alg??e?.jwks?.keyPairConfig?.alg??"EdDSA",crv:o.crv??i,...JSON.parse(o.publicKey),kid:o.id}))})}),getToken:K("/token",{method:"GET",requireHeaders:!0,use:[rr],metadata:{openapi:{description:"Get a JWT token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async t=>{const r=await Tu(t,e);return t.json({token:r})}),signJWT:K("/sign-jwt",{method:"POST",metadata:{SERVER_ONLY:!0,$Infer:{body:{}}},body:G({payload:_t(S(),gt()),overrideOptions:_t(S(),gt()).optional()})},async t=>{const r=await gg(t,{options:{...e,...t.body.overrideOptions},payload:t.body.payload});return t.json({token:r})})},hooks:{after:[{matcher(t){return t.path==="/get-session"},handler:et(async t=>{if(e?.disableSettingJwtHeader)return;const r=t.context.session||t.context.newSession;if(r&&r.session){const n=await Tu(t,e),s=t.context.responseHeaders?.get("access-control-expose-headers")||"",i=new Set(s.split(",").map(o=>o.trim()).filter(Boolean));i.add("set-auth-jwt"),t.setHeader("set-auth-jwt",n),t.setHeader("Access-Control-Expose-Headers",Array.from(i).join(", "))}})}]},schema:Ad(VD,e?.schema)}};fi(G({disableCookieCache:Xt().meta({description:"Disable cookie cache and fetch session from database"}).or(S().transform(e=>e==="true")).optional(),disableRefresh:Xt().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));const ZD={oauthApplication:{modelName:"oauthApplication",fields:{name:{type:"string"},icon:{type:"string",required:!1},metadata:{type:"string",required:!1},clientId:{type:"string",unique:!0},clientSecret:{type:"string",required:!1},redirectURLs:{type:"string"},type:{type:"string"},disabled:{type:"boolean",required:!1,defaultValue:!1},userId:{type:"string",required:!1,references:{model:"user",field:"id",onDelete:"cascade"}},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthAccessToken:{modelName:"oauthAccessToken",fields:{accessToken:{type:"string",unique:!0},refreshToken:{type:"string",unique:!0},accessTokenExpiresAt:{type:"date"},refreshTokenExpiresAt:{type:"date"},clientId:{type:"string",references:{model:"oauthApplication",field:"clientId",onDelete:"cascade"}},userId:{type:"string",required:!1,references:{model:"user",field:"id",onDelete:"cascade"}},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthConsent:{modelName:"oauthConsent",fields:{clientId:{type:"string",references:{model:"oauthApplication",field:"clientId",onDelete:"cascade"}},userId:{type:"string",references:{model:"user",field:"id",onDelete:"cascade"}},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"},consentGiven:{type:"boolean"}}}};function Fs(e,t,r){return`${e.includes("?")?"&":"?"}error=${t}&error_description=${r}`}function ns(e,t,r){const n=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;return Fs(n,t,r)}async function bp(e,t){const r=b=>{if(e.request?.headers.get("sec-fetch-mode")==="cors")return e.json({redirect:!0,url:b});throw e.redirect(b)},n={codeExpiresIn:600,defaultScope:"openid",...t,scopes:["openid","profile","email","offline_access",...t?.scopes||[]]};if(!e.request)throw new _("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});const s=await ut(e);if(!s){await e.setSignedCookie("oidc_login_prompt",JSON.stringify(e.query),e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});const b=e.request.url?.split("?")[1];return r(`${t.loginPage}?${b}`)}const i=e.query;if(!i.client_id){const b=ns(e,"invalid_client","client_id is required");throw e.redirect(b)}if(!i.response_type)throw ns(e,"invalid_request","response_type is required"),e.redirect(ns(e,"invalid_request","response_type is required"));const o=await uo(e.query.client_id,e.context.adapter,t.trustedClients||[]);if(!o){const b=ns(e,"invalid_client","client_id is required");throw e.redirect(b)}const a=o.redirectURLs.find(b=>b===e.query.redirect_uri);if(!a||!i.redirect_uri)throw new _("BAD_REQUEST",{message:"Invalid redirect URI"});if(o.disabled){const b=ns(e,"client_disabled","client is disabled");throw e.redirect(b)}if(i.response_type!=="code"){const b=ns(e,"unsupported_response_type","unsupported response type");throw e.redirect(b)}const c=i.scope?.split(" ").filter(b=>b)||n.defaultScope.split(" "),d=c.filter(b=>!n.scopes.includes(b));if(d.length)return r(Fs(i.redirect_uri,"invalid_scope",`The following scopes are invalid: ${d.join(", ")}`));if((!i.code_challenge||!i.code_challenge_method)&&t.requirePKCE)return r(Fs(i.redirect_uri,"invalid_request","pkce is required"));if(i.code_challenge_method||(i.code_challenge_method="plain"),!["s256",t.allowPlainCodeChallengeMethod?"plain":"s256"].includes(i.code_challenge_method?.toLowerCase()||""))return r(Fs(i.redirect_uri,"invalid_request","invalid code_challenge method"));const u=Ct(32,"a-z","A-Z","0-9"),l=n.codeExpiresIn*1e3,h=new Date(Date.now()+l),m=o.skipConsent,p=await e.context.adapter.findOne({model:"oauthConsent",where:[{field:"clientId",value:o.clientId},{field:"userId",value:s.user.id}]}).then(b=>!!b?.consentGiven),w=!m&&(!p||i.prompt==="consent");try{await e.context.internalAdapter.createVerificationValue({value:JSON.stringify({clientId:o.clientId,redirectURI:i.redirect_uri,scope:c,userId:s.user.id,authTime:new Date(s.session.createdAt).getTime(),requireConsent:w,state:w?i.state:null,codeChallenge:i.code_challenge,codeChallengeMethod:i.code_challenge_method,nonce:i.nonce}),identifier:u,expiresAt:h},e)}catch{return r(Fs(i.redirect_uri,"server_error","An error occurred while processing the request"))}if(!w){const b=new URL(a);return b.searchParams.set("code",u),b.searchParams.set("state",e.query.state),r(b.toString())}if(t?.consentPage){await e.setSignedCookie("oidc_consent_prompt",u,e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});const b=new URLSearchParams;b.set("consent_code",u),b.set("client_id",o.clientId),b.set("scope",c.join(" "));const v=`${t.consentPage}?${b.toString()}`;return r(v)}const g=t?.getConsentHTML;if(!g)throw new _("INTERNAL_SERVER_ERROR",{message:"No consent page provided"});return new Response(g({scopes:c,clientMetadata:o.metadata,clientIcon:o?.icon,clientId:o.clientId,clientName:o.name,code:u}),{headers:{"content-type":"text/html"}})}const vp=async e=>{const t=await Wn("SHA-256").digest(new TextEncoder().encode(e));return jn.encode(new Uint8Array(t),{padding:!1})},bg=e=>e.context.options.plugins?.find(t=>t.id==="jwt");async function uo(e,t,r=[]){const n=r.find(i=>i.clientId===e);return n||await t.findOne({model:"oauthApplication",where:[{field:"clientId",value:e}]}).then(i=>i?{...i,redirectURLs:(i.redirectURLs??"").split(","),metadata:i.metadata?JSON.parse(i.metadata):{}}:null)}const BD=(e,t)=>{const r=bg(e),n=r&&r.options?.jwt&&r.options.jwt.issuer?r.options.jwt.issuer:e.context.options.baseURL,s=e.context.baseURL,i=t?.useJWTPlugin?["RS256","EdDSA","none"]:["HS256","none"];return{issuer:n,authorization_endpoint:`${s}/oauth2/authorize`,token_endpoint:`${s}/oauth2/token`,userinfo_endpoint:`${s}/oauth2/userinfo`,jwks_uri:`${s}/jwks`,registration_endpoint:`${s}/oauth2/register`,scopes_supported:["openid","profile","email","offline_access"],response_types_supported:["code"],response_modes_supported:["query"],grant_types_supported:["authorization_code","refresh_token"],acr_values_supported:["urn:mace:incommon:iap:silver","urn:mace:incommon:iap:bronze"],subject_types_supported:["public"],id_token_signing_alg_values_supported:i,token_endpoint_auth_methods_supported:["client_secret_basic","client_secret_post","none"],code_challenge_methods_supported:["S256"],claims_supported:["sub","iss","aud","exp","nbf","iat","jti","email","email_verified","name"],...t?.metadata}},HD=e=>{const t={oauthClient:"oauthApplication",oauthAccessToken:"oauthAccessToken",oauthConsent:"oauthConsent"},r={codeExpiresIn:600,defaultScope:"openid",accessTokenExpiresIn:3600,refreshTokenExpiresIn:604800,allowPlainCodeChallengeMethod:!0,storeClientSecret:"plain",...e,scopes:["openid","profile","email","offline_access",...e?.scopes||[]]},n=e.trustedClients||[];async function s(o,a){return r.storeClientSecret==="encrypted"?await Md({key:o.context.secret,data:a}):r.storeClientSecret==="hashed"?await vp(a):typeof r.storeClientSecret=="object"&&"hash"in r.storeClientSecret?await r.storeClientSecret.hash(a):typeof r.storeClientSecret=="object"&&"encrypt"in r.storeClientSecret?await r.storeClientSecret.encrypt(a):a}async function i(o,a,c){return r.storeClientSecret==="encrypted"?await Vd({key:o.context.secret,data:a})===c:r.storeClientSecret==="hashed"?await vp(c)===a:typeof r.storeClientSecret=="object"&&"hash"in r.storeClientSecret?await r.storeClientSecret.hash(c)===a:typeof r.storeClientSecret=="object"&&"decrypt"in r.storeClientSecret?await r.storeClientSecret.decrypt(a)===c:c===a}return{id:"oidc",hooks:{after:[{matcher(){return!0},handler:et(async o=>{const a=await o.getSignedCookie("oidc_login_prompt",o.context.secret),c=o.context.authCookies.sessionToken.name,d=Jy(o.context.responseHeaders?.get("set-cookie")||""),u=d.has(c);if(!a||!u)return;o.setCookie("oidc_login_prompt","",{maxAge:0});const h=d.get(c)?.value?.split(".")[0];if(!h)return;const m=await o.context.internalAdapter.findSession(h);return m?(o.query=JSON.parse(a),o.context.session=m,await bp(o,r)):void 0})}]},endpoints:{getOpenIdConfig:K("/.well-known/openid-configuration",{method:"GET",metadata:{isAction:!1}},async o=>{const a=BD(o,e);return o.json(a)}),oAuth2authorize:K("/oauth2/authorize",{method:"GET",query:_t(S(),gt()),metadata:{openapi:{description:"Authorize an OAuth2 request",responses:{200:{description:"Authorization response generated successfully",content:{"application/json":{schema:{type:"object",additionalProperties:!0,description:"Authorization response, contents depend on the authorize function implementation"}}}}}}}},async o=>bp(o,r)),oAuthConsent:K("/oauth2/consent",{method:"POST",body:G({accept:Xt(),consent_code:S().optional().nullish()}),use:[rr],metadata:{openapi:{description:"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).",requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{accept:{type:"boolean",description:"Whether the user accepts or denies the consent request"},consent_code:{type:"string",description:"The consent code from the authorization request. Optional if using cookie-based flow."}},required:["accept"]}}}},responses:{200:{description:"Consent processed successfully",content:{"application/json":{schema:{type:"object",properties:{redirectURI:{type:"string",format:"uri",description:"The URI to redirect to, either with an authorization code or an error"}},required:["redirectURI"]}}}}}}}},async o=>{let a=o.body.consent_code||null;if(a||(a=await o.getSignedCookie("oidc_consent_prompt",o.context.secret)),!a)throw new _("UNAUTHORIZED",{error_description:"consent_code is required (either in body or cookie)",error:"invalid_request"});const c=await o.context.internalAdapter.findVerificationValue(a);if(!c)throw new _("UNAUTHORIZED",{error_description:"Invalid code",error:"invalid_request"});if(c.expiresAt<new Date)throw new _("UNAUTHORIZED",{error_description:"Code expired",error:"invalid_request"});o.setCookie("oidc_consent_prompt","",{maxAge:0});const d=JSON.parse(c.value);if(!d.requireConsent)throw new _("UNAUTHORIZED",{error_description:"Consent not required",error:"invalid_request"});if(!o.body.accept)return await o.context.internalAdapter.deleteVerificationValue(c.id),o.json({redirectURI:`${d.redirectURI}?error=access_denied&error_description=User denied access`});const u=Ct(32,"a-z","A-Z","0-9"),l=r.codeExpiresIn*1e3,h=new Date(Date.now()+l);await o.context.internalAdapter.updateVerificationValue(c.id,{value:JSON.stringify({...d,requireConsent:!1}),identifier:u,expiresAt:h}),await o.context.adapter.create({model:t.oauthConsent,data:{clientId:d.clientId,userId:d.userId,scopes:d.scope.join(" "),consentGiven:!0,createdAt:new Date,updatedAt:new Date}});const m=new URL(d.redirectURI);return m.searchParams.set("code",u),d.state&&m.searchParams.set("state",d.state),o.json({redirectURI:m.toString()})}),oAuth2token:K("/oauth2/token",{method:"POST",body:_t(gt(),gt()),metadata:{isAction:!1}},async o=>{let{body:a}=o;if(!a)throw new _("BAD_REQUEST",{error_description:"request body not found",error:"invalid_request"});if(a instanceof FormData&&(a=Object.fromEntries(a.entries())),!(a instanceof Object))throw new _("BAD_REQUEST",{error_description:"request body is not an object",error:"invalid_request"});let{client_id:c,client_secret:d}=a;const u=o.request?.headers.get("authorization")||null;if(u&&!c&&!d&&u.startsWith("Basic "))try{const D=u.replace("Basic ",""),B=new TextDecoder().decode(er.decode(D));if(!B.includes(":"))throw new _("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});const[F,se]=B.split(":");if(!F||!se)throw new _("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});c=F,d=se}catch{throw new _("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"})}const l=Date.now(),h=Math.floor(l/1e3),m=h+(r.accessTokenExpiresIn??3600),p=new Date(m*1e3),w=new Date((h+(r.refreshTokenExpiresIn??604800))*1e3),{grant_type:g,code:b,redirect_uri:v,refresh_token:y,code_verifier:E}=a;if(g==="refresh_token"){if(!y)throw new _("BAD_REQUEST",{error_description:"refresh_token is required",error:"invalid_request"});const D=await o.context.adapter.findOne({model:t.oauthAccessToken,where:[{field:"refreshToken",value:y.toString()}]});if(!D)throw new _("UNAUTHORIZED",{error_description:"invalid refresh token",error:"invalid_grant"});if(D.clientId!==c?.toString())throw new _("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(D.refreshTokenExpiresAt<new Date)throw new _("UNAUTHORIZED",{error_description:"refresh token expired",error:"invalid_grant"});const B=Ct(32,"a-z","A-Z"),F=Ct(32,"a-z","A-Z");return await o.context.adapter.create({model:t.oauthAccessToken,data:{accessToken:B,refreshToken:F,accessTokenExpiresAt:p,refreshTokenExpiresAt:w,clientId:c.toString(),userId:D.userId,scopes:D.scopes,createdAt:new Date(h*1e3),updatedAt:new Date(h*1e3)}}),o.json({access_token:B,token_type:"bearer",expires_in:r.accessTokenExpiresIn,refresh_token:F,scope:D.scopes})}if(!b)throw new _("BAD_REQUEST",{error_description:"code is required",error:"invalid_request"});if(e.requirePKCE&&!E)throw new _("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});const k=await o.context.internalAdapter.findVerificationValue(b.toString());if(!k)throw new _("UNAUTHORIZED",{error_description:"invalid code",error:"invalid_grant"});if(k.expiresAt<new Date)throw new _("UNAUTHORIZED",{error_description:"code expired",error:"invalid_grant"});if(await o.context.internalAdapter.deleteVerificationValue(k.id),!c)throw new _("UNAUTHORIZED",{error_description:"client_id is required",error:"invalid_client"});if(!g)throw new _("BAD_REQUEST",{error_description:"grant_type is required",error:"invalid_request"});if(g!=="authorization_code")throw new _("BAD_REQUEST",{error_description:"grant_type must be 'authorization_code'",error:"unsupported_grant_type"});if(!v)throw new _("BAD_REQUEST",{error_description:"redirect_uri is required",error:"invalid_request"});const A=await uo(c.toString(),o.context.adapter,n);if(!A)throw new _("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(A.disabled)throw new _("UNAUTHORIZED",{error_description:"client is disabled",error:"invalid_client"});const R=JSON.parse(k.value);if(R.clientId!==c.toString())throw new _("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(R.redirectURI!==v.toString())throw new _("UNAUTHORIZED",{error_description:"invalid redirect_uri",error:"invalid_client"});if(R.codeChallenge&&!E)throw new _("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});if(A.type==="public"){if(!E)throw new _("BAD_REQUEST",{error_description:"code verifier is required for public clients",error:"invalid_request"})}else{if(!A.clientSecret||!d)throw new _("UNAUTHORIZED",{error_description:"client_secret is required for confidential clients",error:"invalid_client"});if(!await i(o,A.clientSecret,d.toString()))throw new _("UNAUTHORIZED",{error_description:"invalid client_secret",error:"invalid_client"})}if((R.codeChallengeMethod==="plain"?E:await Wn("SHA-256","base64urlnopad").digest(E))!==R.codeChallenge)throw new _("UNAUTHORIZED",{error_description:"code verification failed",error:"invalid_request"});const L=R.scope;await o.context.internalAdapter.deleteVerificationValue(k.id);const P=Ct(32,"a-z","A-Z"),W=Ct(32,"A-Z","a-z");await o.context.adapter.create({model:t.oauthAccessToken,data:{accessToken:P,refreshToken:W,accessTokenExpiresAt:p,refreshTokenExpiresAt:w,clientId:c.toString(),userId:R.userId,scopes:L.join(" "),createdAt:new Date(h*1e3),updatedAt:new Date(h*1e3)}});const j=await o.context.internalAdapter.findUserById(R.userId);if(!j)throw new _("UNAUTHORIZED",{error_description:"user not found",error:"invalid_grant"});const V={given_name:j.name.split(" ")[0],family_name:j.name.split(" ")[1],name:j.name,profile:j.image,updated_at:new Date(j.updatedAt).toISOString()},I={email:j.email,email_verified:j.emailVerified},C={...L.includes("profile")?V:{},...L.includes("email")?I:{}},z=e.getAdditionalUserInfoClaim?await e.getAdditionalUserInfoClaim(j,L,A):{},U={sub:j.id,aud:c.toString(),iat:Date.now(),auth_time:o.context.session?new Date(o.context.session.session.createdAt).getTime():void 0,nonce:R.nonce,acr:"urn:mace:incommon:iap:silver",...C,...z},q=Math.floor(Date.now()/1e3)+r.accessTokenExpiresIn;let O;if(e.useJWTPlugin){const D=bg(o);if(!D)throw o.context.logger.error("OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false."),new _("INTERNAL_SERVER_ERROR",{error_description:"JWT plugin is not enabled",error:"internal_server_error"});O=await Tu({...o,context:{...o.context,session:{session:{id:Ct(32,"a-z","A-Z"),createdAt:new Date(h*1e3),updatedAt:new Date(h*1e3),userId:j.id,expiresAt:p,token:P,ipAddress:o.request?.headers.get("x-forwarded-for")},user:j}}},{...D.options,jwt:{...D.options?.jwt,getSubject:()=>j.id,audience:c.toString(),issuer:o.context.options.baseURL,expirationTime:q,definePayload:()=>U}})}else O=await new ud(U).setProtectedHeader({alg:"HS256"}).setIssuedAt(h).setExpirationTime(p).sign(new TextEncoder().encode(A.clientSecret));return o.json({access_token:P,token_type:"Bearer",expires_in:r.accessTokenExpiresIn,refresh_token:L.includes("offline_access")?W:void 0,scope:L.join(" "),id_token:L.includes("openid")?O:void 0},{headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),oAuth2userInfo:K("/oauth2/userinfo",{method:"GET",metadata:{isAction:!1,openapi:{description:"Get OAuth2 user information",responses:{200:{description:"User information retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{sub:{type:"string",description:"Subject identifier (user ID)"},email:{type:"string",format:"email",nullable:!0,description:"User's email address, included if 'email' scope is granted"},name:{type:"string",nullable:!0,description:"User's full name, included if 'profile' scope is granted"},picture:{type:"string",format:"uri",nullable:!0,description:"User's profile picture URL, included if 'profile' scope is granted"},given_name:{type:"string",nullable:!0,description:"User's given name, included if 'profile' scope is granted"},family_name:{type:"string",nullable:!0,description:"User's family name, included if 'profile' scope is granted"},email_verified:{type:"boolean",nullable:!0,description:"Whether the email is verified, included if 'email' scope is granted"}},required:["sub"]}}}}}}}},async o=>{if(!o.request)throw new _("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});const a=o.request.headers.get("authorization");if(!a)throw new _("UNAUTHORIZED",{error_description:"authorization header not found",error:"invalid_request"});const c=a.replace("Bearer ",""),d=await o.context.adapter.findOne({model:t.oauthAccessToken,where:[{field:"accessToken",value:c}]});if(!d)throw new _("UNAUTHORIZED",{error_description:"invalid access token",error:"invalid_token"});if(d.accessTokenExpiresAt<new Date)throw new _("UNAUTHORIZED",{error_description:"The Access Token expired",error:"invalid_token"});const u=await uo(d.clientId,o.context.adapter,n);if(!u)throw new _("UNAUTHORIZED",{error_description:"client not found",error:"invalid_token"});const l=await o.context.internalAdapter.findUserById(d.userId);if(!l)throw new _("UNAUTHORIZED",{error_description:"user not found",error:"invalid_token"});const h=d.scopes.split(" "),m={sub:l.id,email:h.includes("email")?l.email:void 0,name:h.includes("profile")?l.name:void 0,picture:h.includes("profile")?l.image:void 0,given_name:h.includes("profile")?l.name.split(" ")[0]:void 0,family_name:h.includes("profile")?l.name.split(" ")[1]:void 0,email_verified:h.includes("email")?l.emailVerified:void 0},p=e.getAdditionalUserInfoClaim?await e.getAdditionalUserInfoClaim(l,h,u):m;return o.json({...m,...p})}),registerOAuthApplication:K("/oauth2/register",{method:"POST",body:G({redirect_uris:Et(S()).meta({description:'A list of redirect URIs. Eg: ["https://client.example.com/callback"]'}),token_endpoint_auth_method:Mt(["none","client_secret_basic","client_secret_post"]).meta({description:'The authentication method for the token endpoint. Eg: "client_secret_basic"'}).default("client_secret_basic").optional(),grant_types:Et(Mt(["authorization_code","implicit","password","client_credentials","refresh_token","urn:ietf:params:oauth:grant-type:jwt-bearer","urn:ietf:params:oauth:grant-type:saml2-bearer"])).meta({description:'The grant types supported by the application. Eg: ["authorization_code"]'}).default(["authorization_code"]).optional(),response_types:Et(Mt(["code","token"])).meta({description:'The response types supported by the application. Eg: ["code"]'}).default(["code"]).optional(),client_name:S().meta({description:'The name of the application. Eg: "My App"'}).optional(),client_uri:S().meta({description:'The URI of the application. Eg: "https://client.example.com"'}).optional(),logo_uri:S().meta({description:'The URI of the application logo. Eg: "https://client.example.com/logo.png"'}).optional(),scope:S().meta({description:'The scopes supported by the application. Separated by spaces. Eg: "profile email"'}).optional(),contacts:Et(S()).meta({description:'The contact information for the application. Eg: ["admin@example.com"]'}).optional(),tos_uri:S().meta({description:'The URI of the application terms of service. Eg: "https://client.example.com/tos"'}).optional(),policy_uri:S().meta({description:'The URI of the application privacy policy. Eg: "https://client.example.com/policy"'}).optional(),jwks_uri:S().meta({description:'The URI of the application JWKS. Eg: "https://client.example.com/jwks"'}).optional(),jwks:_t(gt(),gt()).meta({description:'The JWKS of the application. Eg: {"keys": [{"kty": "RSA", "alg": "RS256", "use": "sig", "n": "...", "e": "..."}]}'}).optional(),metadata:_t(gt(),gt()).meta({description:'The metadata of the application. Eg: {"key": "value"}'}).optional(),software_id:S().meta({description:'The software ID of the application. Eg: "my-software"'}).optional(),software_version:S().meta({description:'The software version of the application. Eg: "1.0.0"'}).optional(),software_statement:S().meta({description:"The software statement of the application."}).optional()}),metadata:{openapi:{description:"Register an OAuth2 application",responses:{200:{description:"OAuth2 application registered successfully",content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"},metadata:{type:"object",additionalProperties:!0,nullable:!0,description:"Additional metadata for the application"},clientId:{type:"string",description:"Unique identifier for the client"},clientSecret:{type:"string",description:"Secret key for the client"},redirectURLs:{type:"array",items:{type:"string",format:"uri"},description:"List of allowed redirect URLs"},type:{type:"string",description:"Type of the client",enum:["web"]},authenticationScheme:{type:"string",description:"Authentication scheme used by the client",enum:["client_secret"]},disabled:{type:"boolean",description:"Whether the client is disabled",enum:[!1]},userId:{type:"string",nullable:!0,description:"ID of the user who registered the client, null if registered anonymously"},createdAt:{type:"string",format:"date-time",description:"Creation timestamp"},updatedAt:{type:"string",format:"date-time",description:"Last update timestamp"}},required:["name","clientId","clientSecret","redirectURLs","type","authenticationScheme","disabled","createdAt","updatedAt"]}}}}}}}},async o=>{const a=o.body,c=await ut(o);if(!c&&!e.allowDynamicClientRegistration)throw new _("UNAUTHORIZED",{error:"invalid_token",error_description:"Authentication required for client registration"});if((!a.grant_types||a.grant_types.includes("authorization_code")||a.grant_types.includes("implicit"))&&(!a.redirect_uris||a.redirect_uris.length===0))throw new _("BAD_REQUEST",{error:"invalid_redirect_uri",error_description:"Redirect URIs are required for authorization_code and implicit grant types"});if(a.grant_types&&a.response_types){if(a.grant_types.includes("authorization_code")&&!a.response_types.includes("code"))throw new _("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'authorization_code' grant type is used, 'code' response type must be included"});if(a.grant_types.includes("implicit")&&!a.response_types.includes("token"))throw new _("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'implicit' grant type is used, 'token' response type must be included"})}const d=e.generateClientId?.()||Ct(32,"a-z","A-Z"),u=e.generateClientSecret?.()||Ct(32,"a-z","A-Z"),l=await s(o,u),h=await o.context.adapter.create({model:t.oauthClient,data:{name:a.client_name,icon:a.logo_uri,metadata:a.metadata?JSON.stringify(a.metadata):null,clientId:d,clientSecret:l,redirectURLs:a.redirect_uris.join(","),type:"web",authenticationScheme:a.token_endpoint_auth_method||"client_secret_basic",disabled:!1,userId:c?.session.userId,createdAt:new Date,updatedAt:new Date}});return o.json({client_id:d,...h.type!=="public"?{client_secret:u,client_secret_expires_at:0}:{},client_id_issued_at:Math.floor(Date.now()/1e3),client_secret_expires_at:0,redirect_uris:a.redirect_uris,token_endpoint_auth_method:a.token_endpoint_auth_method||"client_secret_basic",grant_types:a.grant_types||["authorization_code"],response_types:a.response_types||["code"],client_name:a.client_name,client_uri:a.client_uri,logo_uri:a.logo_uri,scope:a.scope,contacts:a.contacts,tos_uri:a.tos_uri,policy_uri:a.policy_uri,jwks_uri:a.jwks_uri,jwks:a.jwks,software_id:a.software_id,software_version:a.software_version,software_statement:a.software_statement,metadata:a.metadata},{status:201,headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),getOAuthClient:K("/oauth2/client/:id",{method:"GET",use:[rr],metadata:{openapi:{description:"Get OAuth2 client details",responses:{200:{description:"OAuth2 client retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{clientId:{type:"string",description:"Unique identifier for the client"},name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"}},required:["clientId","name"]}}}}}}}},async o=>{const a=await uo(o.params.id,o.context.adapter,n);if(!a)throw new _("NOT_FOUND",{error_description:"client not found",error:"not_found"});return o.json({clientId:a.clientId,name:a.name,icon:a.icon})})},schema:Ad(ZD,e?.schema)}};G({id:S(),deviceCode:S(),userCode:S(),userId:S().optional(),expiresAt:fr(),status:S(),lastPolledAt:fr().optional(),pollingInterval:Tr().optional(),clientId:S().optional(),scope:S().optional()});const Ep=ss(e=>{try{Ky(e)}catch{return!1}return!0},{message:"Invalid time string format. Use formats like '30m', '5s', '1h', etc."});G({expiresIn:Ep.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),interval:Ep.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),deviceCodeLength:Tr().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),userCodeLength:Tr().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),generateDeviceCode:ss(e=>typeof e=="function",{message:"generateDeviceCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),generateUserCode:ss(e=>typeof e=="function",{message:"generateUserCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),validateClient:ss(e=>typeof e=="function",{message:"validateClient must be a function that returns a boolean or a promise that resolves to a boolean."}).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),onDeviceAuthRequest:ss(e=>typeof e=="function",{message:"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."}).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),schema:ss(()=>!0)});const KD=async e=>{const t=await Wn("SHA-256").digest(new TextEncoder().encode(e));return jn.encode(new Uint8Array(t),{padding:!1})};var Pc={};const Dc="convex_jwt",JD=(e={})=>{const{jwtExpirationSeconds:t=900}=e,r=HD({loginPage:"/not-used",metadata:{issuer:`${Pc.CONVEX_SITE_URL}`,jwks_uri:`${Pc.CONVEX_SITE_URL}${e.options?.basePath??"/api/auth"}/convex/jwks`}}),n=FD({jwt:{issuer:`${Pc.CONVEX_SITE_URL}`,audience:"convex",expirationTime:`${t}s`,definePayload:({user:{id:a,image:c,...d},session:u})=>({...d,sessionId:u.id,iat:Math.floor(new Date().getTime()/1e3)})}}),s=xD(),i={user:{fields:{userId:{type:"string",required:!1,input:!1}}},...n.schema},o=a=>a.split(", ").map(c=>{const d=c.indexOf(";"),u=d===-1?c.length+1:d;return c.slice(0,u)}).join("; ");return{id:"convex",init:({logger:a,options:c})=>{c.plugins?.every(d=>d.id!=="cross-domain")&&!c.baseURL&&a.warn("Better Auth baseURL is undefined. This is probably a mistake.")},hooks:{before:[...s.hooks.before,{matcher:a=>!a.context.adapter.options?.isRunMutationCtx&&a.path==="/get-session",handler:et(async a=>(a.query={...a.query,disableRefresh:!0},a.context.internalAdapter.deleteSession=async(...c)=>{},{context:a}))}],after:[...r.hooks.after,{matcher:a=>a.path.startsWith("/sign-in")||a.path.startsWith("/sign-up")||a.path.startsWith("/callback")||a.path.startsWith("/oauth2/callback")||a.path.startsWith("/magic-link/verify")||a.path.startsWith("/email-otp/verify-email")||a.path.startsWith("/phone-number/verify")||a.path.startsWith("/siwe/verify"),handler:et(async a=>{const c=a.context.responseHeaders?.get("set-cookie")??"";if(c)try{const{token:d}=await n.endpoints.getToken({...a,method:"GET",headers:{cookie:o(c)},returnHeaders:!1}),u=a.context.createAuthCookie(Dc,{maxAge:t});a.setCookie(u.name,d,u.attributes)}catch{}})},{matcher:a=>a.path?.startsWith("/sign-out")||a.path?.startsWith("/delete-user"),handler:et(async a=>{const c=a.context.createAuthCookie(Dc,{maxAge:0});a.setCookie(c.name,"",c.attributes)})}]},endpoints:{getOpenIdConfig:K("/convex/.well-known/openid-configuration",{method:"GET",metadata:{isAction:!1}},async a=>await r.endpoints.getOpenIdConfig({...a,returnHeaders:!1})),getJwks:K("/convex/jwks",{method:"GET",metadata:{openapi:{description:"Get the JSON Web Key Set",responses:{200:{description:"JSON Web Key Set retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{keys:{type:"array",description:"Array of public JSON Web Keys",items:{type:"object",properties:{kid:{type:"string",description:"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk"},kty:{type:"string",description:"Key type (e.g., 'RSA', 'EC', 'OKP')"},alg:{type:"string",description:"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')"},use:{type:"string",description:"Intended use of the public key (e.g., 'sig' for signature)",enum:["sig"],nullable:!0},n:{type:"string",description:"Modulus for RSA keys (base64url-encoded)",nullable:!0},e:{type:"string",description:"Exponent for RSA keys (base64url-encoded)",nullable:!0},crv:{type:"string",description:"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')",nullable:!0},x:{type:"string",description:"X coordinate for elliptic curve keys (base64url-encoded)",nullable:!0},y:{type:"string",description:"Y coordinate for elliptic curve keys (base64url-encoded)",nullable:!0}},required:["kid","kty","alg"]}}},required:["keys"]}}}}}}}},async a=>await n.endpoints.getJwks({...a,returnHeaders:!1})),getToken:K("/convex/token",{method:"GET",requireHeaders:!0,use:[rr],metadata:{openapi:{description:"Get a JWT token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{const c=await n.endpoints.getToken({...a,returnHeaders:!1}),d=a.context.createAuthCookie(Dc,{maxAge:t});return a.setCookie(d.name,c.token,d.attributes),c})},schema:i}},GD=qb,_p="better-auth-secret-123456789";let Gr;async function vg(){if(Gr)return Gr;try{const e=typeof process<"u"&&typeof process.cwd=="function"?process.cwd():"";if(!e)return;const t=i=>Function("mm","return import(mm)")(i),[{default:r},{default:n}]=await Promise.all([t("fs/promises"),t("path")]),s=await r.readFile(n.join(e,"package.json"),"utf-8");return Gr=JSON.parse(s),Gr}catch{}}async function Eg(e){if(Gr)return Gr.dependencies?.[e]||Gr.devDependencies?.[e]||Gr.peerDependencies?.[e];try{const r=typeof process<"u"&&typeof process.cwd=="function"?process.cwd():"";if(!r)throw new Error("no-cwd");const n=u=>Function("mm","return import(mm)")(u),[{default:s},{default:i}]=await Promise.all([n("fs/promises"),n("path")]),o=i.join(r,"node_modules",e,"package.json"),a=await s.readFile(o,"utf-8");return JSON.parse(a).version||await Np(e)||void 0}catch{}return await Np(e)}async function Np(e){const t=await vg();return t?{...t.dependencies,...t.devDependencies,...t.peerDependencies}[e]:void 0}async function QD(){return(await vg())?.name}let Lr=null;async function Ap(e){if(Lr)return Lr;const t=await QD();return t?(Lr=await pp(e?e+t:t),Lr):e?(Lr=await pp(e),Lr):(Lr=Ht(32),Lr)}const Rs=e=>Function("mm","return import(mm)")(e);function Dn(){const e=(...t)=>t.some(r=>!!Ze[r]);return e("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"?"cloudflare":e("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":e("NETLIFY","NETLIFY_URL")?"netlify":e("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":e("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":e("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":e("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":e("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":e("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":e("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":e("DYNO","HEROKU_APP_NAME")?"heroku":e("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":e("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function YD(){try{if(Dn()==="cloudflare")return"cloudflare";const e=await Rs("os"),t=e.cpus();return{deploymentVendor:Dn(),systemPlatform:e.platform(),systemRelease:e.release(),systemArchitecture:e.arch(),cpuCount:t.length,cpuModel:t.length?t[0].model:null,cpuSpeed:t.length?t[0].speed:null,memory:e.totalmem(),isWSL:await tL(),isDocker:await _g(),isTTY:typeof process<"u"&&process.stdout?process.stdout.isTTY:null}}catch{return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}let Lc;async function XD(){if(Dn()==="cloudflare")return!1;try{return(await Rs("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function eL(){if(Dn()==="cloudflare")return!1;try{return(await Rs("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function _g(){return Dn()==="cloudflare"?!1:(Lc===void 0&&(Lc=await XD()||await eL()),Lc)}async function tL(){try{if(Dn()==="cloudflare"||typeof process>"u"||process?.platform!=="linux")return!1;const e=await Rs("fs");return(await Rs("os")).release().toLowerCase().includes("microsoft")?!await kp():e.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!await kp():!1}catch{return!1}}let zc;const rL=async()=>{if(Dn()==="cloudflare")return!1;try{return(await Rs("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function kp(){return zc===void 0&&(zc=await rL()||await _g()),zc}function nL(){return Ze.CI!=="false"&&("BUILD_ID"in Ze||"BUILD_NUMBER"in Ze||"CI"in Ze||"CI_APP_ID"in Ze||"CI_BUILD_ID"in Ze||"CI_BUILD_NUMBER"in Ze||"CI_NAME"in Ze||"CONTINUOUS_INTEGRATION"in Ze||"RUN_ID"in Ze)}function sL(){return typeof Deno<"u"?{name:"deno",version:Deno?.version?.deno??null}:typeof Bun<"u"?{name:"bun",version:Bun?.version??null}:typeof process<"u"&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null}}function iL(){return We("NODE_ENV")==="production"?"production":nL()?"ci":Su()?"test":"development"}const oL={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function aL(){for(const[e,t]of Object.entries(oL)){const r=await Eg(e);if(r)return{name:t,version:r}}}const cL={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function uL(){for(const[e,t]of Object.entries(cL)){const r=await Eg(e);if(r)return{name:t,version:r}}}function dL(){const e=Ze.npm_config_user_agent;if(!e)return;const t=e.split(" ")[0],r=t.lastIndexOf("/"),n=t.substring(0,r);return{name:n==="npminstall"?"cnpm":n,version:t.substring(r+1)}}function lL(e,t){return{database:t?.database,adapter:t?.adapter,emailVerification:{sendVerificationEmail:!!e.emailVerification?.sendVerificationEmail,sendOnSignUp:!!e.emailVerification?.sendOnSignUp,sendOnSignIn:!!e.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!e.emailVerification?.autoSignInAfterVerification,expiresIn:e.emailVerification?.expiresIn,onEmailVerification:!!e.emailVerification?.onEmailVerification,afterEmailVerification:!!e.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!e.emailAndPassword?.enabled,disableSignUp:!!e.emailAndPassword?.disableSignUp,requireEmailVerification:!!e.emailAndPassword?.requireEmailVerification,maxPasswordLength:e.emailAndPassword?.maxPasswordLength,minPasswordLength:e.emailAndPassword?.minPasswordLength,sendResetPassword:!!e.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:e.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!e.emailAndPassword?.onPasswordReset,password:{hash:!!e.emailAndPassword?.password?.hash,verify:!!e.emailAndPassword?.password?.verify},autoSignIn:!!e.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!e.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(e.socialProviders||{}).map(r=>{const n=e.socialProviders?.[r];return n?{id:r,mapProfileToUser:!!n.mapProfileToUser,disableDefaultScope:!!n.disableDefaultScope,disableIdTokenSignIn:!!n.disableIdTokenSignIn,disableImplicitSignUp:n.disableImplicitSignUp,disableSignUp:n.disableSignUp,getUserInfo:!!n.getUserInfo,overrideUserInfoOnSignIn:!!n.overrideUserInfoOnSignIn,prompt:n.prompt,verifyIdToken:!!n.verifyIdToken,scope:n.scope,refreshAccessToken:!!n.refreshAccessToken}:{}}),plugins:e.plugins?.map(r=>r.id.toString()),user:{modelName:e.user?.modelName,fields:e.user?.fields,additionalFields:e.user?.additionalFields,changeEmail:{enabled:e.user?.changeEmail?.enabled,sendChangeEmailVerification:!!e.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:e.verification?.modelName,disableCleanup:e.verification?.disableCleanup,fields:e.verification?.fields},session:{modelName:e.session?.modelName,additionalFields:e.session?.additionalFields,cookieCache:{enabled:e.session?.cookieCache?.enabled,maxAge:e.session?.cookieCache?.maxAge},disableSessionRefresh:e.session?.disableSessionRefresh,expiresIn:e.session?.expiresIn,fields:e.session?.fields,freshAge:e.session?.freshAge,preserveSessionInDatabase:e.session?.preserveSessionInDatabase,storeSessionInDatabase:e.session?.storeSessionInDatabase,updateAge:e.session?.updateAge},account:{modelName:e.account?.modelName,fields:e.account?.fields,encryptOAuthTokens:e.account?.encryptOAuthTokens,updateAccountOnSignIn:e.account?.updateAccountOnSignIn,accountLinking:{enabled:e.account?.accountLinking?.enabled,trustedProviders:e.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:e.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:e.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!e.hooks?.after,before:!!e.hooks?.before},secondaryStorage:!!e.secondaryStorage,advanced:{cookiePrefix:!!e.advanced?.cookiePrefix,cookies:!!e.advanced?.cookies,crossSubDomainCookies:{domain:!!e.advanced?.crossSubDomainCookies?.domain,enabled:e.advanced?.crossSubDomainCookies?.enabled,additionalCookies:e.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!e.advanced?.database?.useNumberId,generateId:e.advanced?.database?.generateId,defaultFindManyLimit:e.advanced?.database?.defaultFindManyLimit},useSecureCookies:e.advanced?.useSecureCookies,ipAddress:{disableIpTracking:e.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:e.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:e.advanced?.disableCSRFCheck,cookieAttributes:{expires:e.advanced?.defaultCookieAttributes?.expires,secure:e.advanced?.defaultCookieAttributes?.secure,sameSite:e.advanced?.defaultCookieAttributes?.sameSite,domain:!!e.advanced?.defaultCookieAttributes?.domain,path:e.advanced?.defaultCookieAttributes?.path,httpOnly:e.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:e.trustedOrigins?.length,rateLimit:{storage:e.rateLimit?.storage,modelName:e.rateLimit?.modelName,window:e.rateLimit?.window,customStorage:!!e.rateLimit?.customStorage,enabled:e.rateLimit?.enabled,max:e.rateLimit?.max},onAPIError:{errorURL:e.onAPIError?.errorURL,onError:!!e.onAPIError?.onError,throw:e.onAPIError?.throw},logger:{disabled:e.logger?.disabled,level:e.logger?.level,log:!!e.logger?.log},databaseHooks:{user:{create:{after:!!e.databaseHooks?.user?.create?.after,before:!!e.databaseHooks?.user?.create?.before},update:{after:!!e.databaseHooks?.user?.update?.after,before:!!e.databaseHooks?.user?.update?.before}},session:{create:{after:!!e.databaseHooks?.session?.create?.after,before:!!e.databaseHooks?.session?.create?.before},update:{after:!!e.databaseHooks?.session?.update?.after,before:!!e.databaseHooks?.session?.update?.before}},account:{create:{after:!!e.databaseHooks?.account?.create?.after,before:!!e.databaseHooks?.account?.create?.before},update:{after:!!e.databaseHooks?.account?.update?.after,before:!!e.databaseHooks?.account?.update?.before}},verification:{create:{after:!!e.databaseHooks?.verification?.create?.after,before:!!e.databaseHooks?.verification?.create?.before},update:{after:!!e.databaseHooks?.verification?.update?.after,before:!!e.databaseHooks?.verification?.update?.before}}}}}async function hL(e,t){const r=e.telemetry?.debug||el("BETTER_AUTH_TELEMETRY_DEBUG",!1),n=Dg.BETTER_AUTH_TELEMETRY_ENDPOINT,s=async c=>{try{t?.customTrack?await t.customTrack(c):r?await Promise.resolve(te.info("telemetry event",JSON.stringify(c,null,2))):await ne(n,{method:"POST",body:c})}catch{}},o=await(async()=>{const c=e.telemetry?.enabled!==void 0?e.telemetry.enabled:!1;return(el("BETTER_AUTH_TELEMETRY",!1)||c)&&(t?.skipTestCheck||!Su())})();let a;if(o){a=await Ap(e.baseURL);const c={config:lL(e),runtime:sL(),database:await aL(),framework:await uL(),environment:iL(),systemInfo:await YD(),packageManager:dL()};s({type:"init",payload:c,anonymousId:a})}return{publish:async c=>{o&&(a||(a=await Ap(e.baseURL)),await s({type:c.type,payload:c.payload,anonymousId:a}))}}}function Ng(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}const fL=async e=>{const t=await $U(e),r=e.plugins||[],n=mL(e),s=Bu(e.logger),i=Iu(e.baseURL,e.basePath),o=e.secret||Ze.BETTER_AUTH_SECRET||Ze.AUTH_SECRET||_p;o===_p&&jc&&s.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),e={...e,secret:o,baseURL:i?new URL(i).origin:"",basePath:e.basePath||"/api/auth",plugins:r.concat(n)},ID(e,s);const a=HU(e),c=li(e),d=Object.entries(e.socialProviders||{}).map(([w,g])=>{if(g==null||g.enabled===!1)return null;g.clientId||s.warn(`Social provider ${w} is missing clientId or clientSecret`);const b=ag[w](g);return b.disableImplicitSignUp=g.disableImplicitSignUp,b}).filter(w=>w!==null),u=({model:w,size:g})=>typeof e.advanced?.generateId=="function"?e.advanced.generateId({model:w,size:g}):typeof e?.advanced?.database?.generateId=="function"?e.advanced.database.generateId({model:w,size:g}):Ht(g),{publish:l}=await hL(e,{adapter:t.id,database:typeof e.database=="function"?"adapter":jd(e.database)||"unknown"});let h={appName:e.appName||"Better Auth",socialProviders:d,options:e,tables:c,trustedOrigins:wL(e),baseURL:i||"",sessionConfig:{updateAge:e.session?.updateAge!==void 0?e.session.updateAge:1440*60,expiresIn:e.session?.expiresIn||3600*24*7,freshAge:e.session?.freshAge===void 0?3600*24:e.session.freshAge},secret:o,rateLimit:{...e.rateLimit,enabled:e.rateLimit?.enabled??jc,window:e.rateLimit?.window||10,max:e.rateLimit?.max||100,storage:e.rateLimit?.storage||(e.secondaryStorage?"secondary-storage":"memory")},authCookies:a,logger:s,generateId:u,session:null,secondaryStorage:e.secondaryStorage,password:{hash:e.emailAndPassword?.password?.hash||rP,verify:e.emailAndPassword?.password?.verify||nP,config:{minPasswordLength:e.emailAndPassword?.minPasswordLength||8,maxPasswordLength:e.emailAndPassword?.maxPasswordLength||128},checkPassword:CD},setNewSession(w){this.newSession=w},newSession:null,adapter:t,internalAdapter:By(t,{options:e,logger:s,hooks:e.databaseHooks?[e.databaseHooks]:[]}),createAuthCookie:Gy(e),async runMigrations(){if(!e.database||"updateMany"in e.database)throw new ve("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");const{runMigrations:w}=await qU(e);await w()},publishTelemetry:l};const m=pL(h);let p;return Ng(m)?{context:p}=await m:{context:p}=m,p};async function pL(e){let t=e.options;const r=t.plugins||[];let n=e;const s=[];for(const i of r)if(i.init){let o=i.init(n),a;if(Ng(o)?a=await o:a=o,typeof a=="object"){if(a.options){const{databaseHooks:c,...d}=a.options;c&&s.push(c),t=sP(t,d)}a.context&&(n={...n,...a.context})}}return s.push(t.databaseHooks),n.internalAdapter=By(e.adapter,{options:t,logger:e.logger,hooks:s.filter(i=>i!==void 0),generateId:e.generateId}),n.options=t,{context:n}}function mL(e){const t=[];return e.advanced?.crossSubDomainCookies?.enabled,t}function wL(e){const t=Iu(e.baseURL,e.basePath);if(!t)return[];const r=[new URL(t).origin];e.trustedOrigins&&Array.isArray(e.trustedOrigins)&&r.push(...e.trustedOrigins);const n=Ze.BETTER_AUTH_TRUSTED_ORIGINS;if(n&&r.push(...n.split(",")),r.filter(s=>!s).length)throw new ve("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return r}const yL=e=>{const t=fL(e),{api:r}=fg(t,e),n=e.plugins?.reduce((s,i)=>i.$ERROR_CODES?{...s,...i.$ERROR_CODES}:s,{});return{handler:async s=>{const i=await t,o=i.options.basePath||"/api/auth";if(!i.options.baseURL){const c=Iu(void 0,o,s);if(c)i.baseURL=c,i.options.baseURL=di(i.baseURL)||void 0;else throw new ve("Could not get base URL from request. Please provide a valid base URL.")}i.trustedOrigins=[...e.trustedOrigins?Array.isArray(e.trustedOrigins)?e.trustedOrigins:await e.trustedOrigins(s):[],i.options.baseURL];const{handler:a}=OD(i,e);return a(s)},api:r,options:e,$context:t,$Infer:{},$ERROR_CODES:{...n,...Q}}},gL=e=>{const t={storeToken:"plain",...e};async function r(n,s){return t.storeToken==="hashed"?await KD(s):typeof t.storeToken=="object"&&"type"in t.storeToken&&t.storeToken.type==="custom-hasher"?await t.storeToken.hash(s):s}return{id:"one-time-token",endpoints:{generateOneTimeToken:K("/one-time-token/generate",{method:"GET",use:[rr]},async n=>{if(t?.disableClientRequest&&n.request)throw n.error("BAD_REQUEST",{message:"Client requests are disabled"});const s=n.context.session,i=t?.generateToken?await t.generateToken(s,n):Ct(32),o=new Date(Date.now()+(t?.expiresIn??3)*60*1e3),a=await r(n,i);return await n.context.internalAdapter.createVerificationValue({value:s.session.token,identifier:`one-time-token:${a}`,expiresAt:o}),n.json({token:i})}),loginWithOTT:K("/sign-in/ott",{method:"POST",body:al({token:cl().describe('The token to verify. Eg: "some-token"')})},async n=>{const{token:s}=n.body,i=await r(n,s),o=await n.context.internalAdapter.findVerificationValue(`one-time-token:${i}`);if(!o)throw n.error("BAD_REQUEST",{message:"Invalid token"});if(await n.context.internalAdapter.deleteVerificationValue(o.id),o.expiresAt<new Date)throw n.error("BAD_REQUEST",{message:"Token expired"});const a=await n.context.internalAdapter.findSession(o.value);if(!a)throw n.error("BAD_REQUEST",{message:"Session not found"});const c=await n.context.internalAdapter.createSession(a.user.id,n,!1);return c?(await Nt(n,{session:c,user:a.user}),n.json({token:c.token,user:a.user})):n.json(null,{status:400,body:{message:"Could not create session"}})}),verifyOneTimeToken:K("/one-time-token/verify",{method:"POST",body:al({token:cl().describe('The token to verify. Eg: "some-token"')})},async n=>{const{token:s}=n.body,i=await r(n,s),o=await n.context.internalAdapter.findVerificationValue(`one-time-token:${i}`);if(!o)throw n.error("BAD_REQUEST",{message:"Invalid token"});if(await n.context.internalAdapter.deleteVerificationValue(o.id),o.expiresAt<new Date)throw n.error("BAD_REQUEST",{message:"Token expired"});const a=await n.context.internalAdapter.findSession(o.value);if(!a)throw n.error("BAD_REQUEST",{message:"Session not found"});return n.json(a)})}}},bL={user:vr({name:N.string(),email:N.string(),emailVerified:N.boolean(),image:N.optional(N.union(N.null(),N.string())),createdAt:N.number(),updatedAt:N.number(),userId:N.optional(N.union(N.null(),N.string())),role:N.optional(N.union(N.null(),N.string())),banned:N.optional(N.union(N.null(),N.boolean())),banReason:N.optional(N.union(N.null(),N.string())),banExpires:N.optional(N.union(N.null(),N.number()))}).index("email_name",["email","name"]).index("name",["name"]).index("userId",["userId"]),session:vr({expiresAt:N.number(),token:N.string(),createdAt:N.number(),updatedAt:N.number(),ipAddress:N.optional(N.union(N.null(),N.string())),userAgent:N.optional(N.union(N.null(),N.string())),userId:N.string(),impersonatedBy:N.optional(N.union(N.null(),N.string()))}).index("expiresAt",["expiresAt"]).index("expiresAt_userId",["expiresAt","userId"]).index("token",["token"]).index("userId",["userId"]),account:vr({accountId:N.string(),providerId:N.string(),userId:N.string(),accessToken:N.optional(N.union(N.null(),N.string())),refreshToken:N.optional(N.union(N.null(),N.string())),idToken:N.optional(N.union(N.null(),N.string())),accessTokenExpiresAt:N.optional(N.union(N.null(),N.number())),refreshTokenExpiresAt:N.optional(N.union(N.null(),N.number())),scope:N.optional(N.union(N.null(),N.string())),password:N.optional(N.union(N.null(),N.string())),createdAt:N.number(),updatedAt:N.number()}).index("accountId",["accountId"]).index("accountId_providerId",["accountId","providerId"]).index("providerId_userId",["providerId","userId"]).index("userId",["userId"]),verification:vr({identifier:N.string(),value:N.string(),expiresAt:N.number(),createdAt:N.number(),updatedAt:N.number()}).index("expiresAt",["expiresAt"]).index("identifier",["identifier"]),jwks:vr({publicKey:N.string(),privateKey:N.string(),createdAt:N.number()}),rateLimit:vr({key:N.optional(N.union(N.null(),N.string())),count:N.optional(N.union(N.null(),N.number())),lastRequest:N.optional(N.union(N.null(),N.number()))}).index("key",["key"]),ratelimit:vr({key:N.string(),count:N.number(),lastRequest:N.number()}).index("key",["key"])},vL=Zp(bL);var pn={};const EL=pn.PUBLIC_CONVEX_SITE_URL,_L=xg.auth,Kd=WU(Ug.betterAuth,{local:{schema:vL},authFunctions:_L,triggers:{user:{onDelete:async(e,t)=>{if(!t?.userId)return;const r=await e.db.query("backups").withIndex("by_user",n=>n.eq("userId",t.userId)).collect();for(const n of r)await e.db.delete(n._id)}}}}),NL=(e,{optionsOnly:t}={optionsOnly:!1})=>yL({logger:{disabled:t},baseURL:EL,trustedOrigins:["*"],database:Kd.adapter(e),emailAndPassword:{enabled:!1},plugins:[JD(),gL(),DD(),{id:"disable-state-check",hooks:{before:[{matcher(){return!0},handler:et(async r=>({context:{context:{oauthConfig:{skipStateCookieCheck:!0}}}}))}]}}],socialProviders:{github:{clientId:pn.GITHUB_CLIENT_ID,clientSecret:pn.GITHUB_CLIENT_SECRET},google:{clientId:pn.GOOGLE_CLIENT_ID,clientSecret:pn.GOOGLE_CLIENT_SECRET},discord:{clientId:pn.DISCORD_CLIENT_ID,clientSecret:pn.DISCORD_CLIENT_SECRET}},advanced:{defaultCookieAttributes:{sameSite:"none",secure:!0,partitioned:!0}},user:{deleteUser:{enabled:!0}},account:{accountLinking:{enabled:!0,allowDifferentEmails:!0}},rateLimit:{window:10,max:100,enabled:!0,storage:"database"}});GD({args:{},handler:async e=>Kd.safeGetAuthUser(e)});Kd.triggersApi();Hy(NL);async function KL(){if(!Vg())throw Tg(null,{status:404})}const JL=kg(function(){const[t,r]=Oi.useState(""),[n,s]=Oi.useState(""),[i,o]=Oi.useState(""),a=qg(dn.backups.getBackups),c=tl(dn.backups.createBackup).withOptimisticUpdate((m,p)=>{const{data:w,name:g,backupKey:b}=p,v=m.getQuery(dn.backups.getBackups);if(v?.success&&v.backups!==void 0){const y=Date.now(),E={_id:crypto.randomUUID(),_creationTime:y,name:g,data:w,version:1,userId:"",backupKey:b};m.setQuery(dn.backups.getBackups,{},{success:!0,backups:[E,...v.backups]})}}),d=Lg.useSession(),u=jg(),l=tl(dn.backups.deleteBackup).withOptimisticUpdate((m,p)=>{const{id:w}=p,g=m.getQuery(dn.backups.getBackups);if(g?.success&&g.backups!==void 0){const b=g.backups.filter(v=>v._id!==w);m.setQuery(dn.backups.getBackups,{},{success:!0,backups:b})}});Oi.useEffect(()=>{r(kl())},[]);const h=async()=>{if(!i.trim()){ln.error("Please enter a backup name");return}const m=crypto.randomUUID(),p=i;o(""),ln.promise(c({data:kl(),name:p,backupKey:m}).then(w=>{if(w?.success)return w;throw new Error(w?.error||"Failed to create backup")}),{loading:"Creating backup...",success:"Backup created",error:w=>w.message||"Failed to create backup"})};return M.jsxs("div",{className:"max-w-4xl mx-auto w-full p-4 flex flex-col gap-4",children:[M.jsx("h1",{className:"text-4xl",children:"Backups"}),M.jsxs(Jd,{children:[M.jsx(Gd,{children:M.jsx(Qd,{children:"Local Backup"})}),M.jsxs(Yd,{className:"flex flex-col gap-4",children:[M.jsxs("div",{className:"flex flex-col gap-2",children:[M.jsx("h2",{className:"font-bold",children:"Export"}),M.jsxs("div",{className:"flex flex-row gap-3",children:[M.jsx(Sa,{disabled:!0,value:t}),M.jsx(Jn,{size:"icon",onClick:()=>{navigator.clipboard.writeText(t).then(()=>{ln.success("Backup copied to clipboard")}).catch(m=>{ln.error("Failed to copy backup to clipboard")})},children:M.jsx(Jg,{})})]})]}),M.jsxs("div",{className:"flex flex-col gap-2",children:[M.jsx("h2",{className:"font-bold",children:"Restore"}),M.jsx("p",{className:"text-sm text-muted-foreground",children:"This will overwrite your current data."}),M.jsxs("div",{className:"flex flex-row gap-3",children:[M.jsx(Sa,{value:n,onChange:m=>s(m.target.value)}),M.jsx(Jn,{disabled:n.length===0,onClick:()=>{Tl(n)},children:"Restore"})]})]})]})]}),d.data?.user&&M.jsx(Xd,{mode:"popLayout",initial:!1,children:u.isLoading||!a?.success?M.jsxs($i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{ease:zs},className:"flex flex-col gap-2",children:[M.jsx(Ci,{className:"h-10 w-[150px]"}),M.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[M.jsx(Ci,{className:"h-24 w-full rounded-xl"}),M.jsx(Ci,{className:"h-24 w-full rounded-xl"}),M.jsx(Ci,{className:"h-24 w-full rounded-xl"})]})]},"loading"):M.jsxs($i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{ease:zs},className:"flex flex-col gap-2",children:[M.jsx("h2",{className:"text-2xl",children:"Cloud Backups"}),M.jsxs(Jd,{children:[M.jsx(Gd,{children:M.jsx(Qd,{children:"Create Backup"})}),M.jsx(Yd,{children:M.jsxs("div",{className:"flex flex-row gap-2",children:[M.jsx(Sa,{value:i,onChange:m=>o(m.target.value),onKeyDown:m=>{m.key==="Enter"&&i.trim()&&h()},autoFocus:!0,placeholder:"Backup Name"}),M.jsx(Jn,{size:"icon",onClick:h,disabled:!i.trim(),children:M.jsx(Fg,{})})]})})]}),M.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:M.jsx(Xd,{mode:"popLayout",initial:!1,children:a?.success&&a?.backups&&a.backups.length>0?a.backups.map(m=>M.jsxs($i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:zs},layout:!0,className:"flex flex-col gap-2 bg-card rounded-xl p-4 border",children:[M.jsx("h3",{className:"text-lg",children:m.name}),M.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created at"," ",new Date(m._creationTime).toLocaleString()]}),M.jsx("div",{className:"grow"}),M.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[M.jsxs(ul,{children:[M.jsx(dl,{asChild:!0,children:M.jsx(Jn,{variant:"destructive",size:"icon",children:M.jsx(Qg,{})})}),M.jsxs(ll,{children:[M.jsxs(hl,{children:[M.jsx(fl,{children:"Delete Backup"}),M.jsx(pl,{children:"Are you sure you want to delete this backup?"})]}),M.jsxs(ml,{children:[M.jsx(wl,{children:"Cancel"}),M.jsx(yl,{onClick:()=>{ln.promise(new Promise(async(p,w)=>{const g=await l({id:m._id});g?.success?p(!0):w(g?.error)}),{loading:"Deleting backup...",success:"Backup deleted",error:"Failed to delete backup"})},children:"Delete"})]})]})]}),M.jsx(Jn,{variant:"outline",size:"icon",onClick:()=>{navigator.clipboard.writeText(m.data).then(()=>{ln.success("Backup copied to clipboard")}).catch(p=>{ln.error("Failed to copy backup to clipboard")})},children:M.jsx(Zg,{})}),M.jsxs(ul,{children:[M.jsx(dl,{asChild:!0,children:M.jsxs(Jn,{children:[M.jsx(Pg,{}),"Restore"]})}),M.jsxs(ll,{children:[M.jsxs(hl,{children:[M.jsx(fl,{children:"Restore Backup"}),M.jsx(pl,{children:"Are you sure you want to restore this backup? This will overwrite your current data."})]}),M.jsxs(ml,{children:[M.jsx(wl,{children:"Cancel"}),M.jsx(yl,{onClick:()=>{Tl(m.data)},children:"Restore"})]})]})]})]})]},m.backupKey)):M.jsx($i.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{ease:zs,delay:.2}},exit:{opacity:0,scale:.95,transition:{ease:zs}},className:"md:col-span-2",children:M.jsx(Sg,{children:M.jsxs(Rg,{children:[M.jsx(Ig,{variant:"icon",children:M.jsx(Hg,{className:"size-6"})}),M.jsx(Og,{children:"No backups yet"}),M.jsx($g,{children:"Create your first backup to get started. Your backups will appear here."})]})})},"empty-state")})})]},"loaded")})]})});export{Vt as C,Aa as D,Ii as a,Ta as b,KL as c,JL as p,qe as s};
