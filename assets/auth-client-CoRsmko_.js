import{a as Hn}from"./chunk-JMJ3UQ3L-DLa4wvEN.js";import{e as wn,f as lo,g as _n,h as Es,i as We,j as rd,k as ia,l as ks,m as Ts,q as Ss,r as qn,t as G,a as bn,v as nd,Z as Br,w as Vn}from"./sha2-CO3l0I8W.js";var od={},fo={};const Lr=Object.create(null),ir=e=>od||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?Lr:globalThis),$e=new Proxy(Lr,{get(e,t){return ir()[t]??Lr[t]},has(e,t){return t in ir()||t in Lr},set(e,t,r){const n=ir(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=ir(!0);return delete r[t],!0},ownKeys(){const e=ir(!0);return Object.keys(e)}});function sd(e){return e?e!=="false":!1}const Wr=typeof process<"u"&&fo&&"production"||"",aa=Wr==="production",Bo=()=>Wr==="dev"||Wr==="development",id=()=>Wr==="test"||sd($e.TEST);function re(e,t){return typeof process<"u"&&fo?fo[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}function oT(e,t=!0){const r=re(e);return r?r!=="0"&&r.toLowerCase()!=="false"&&r!=="":t}const sT=Object.freeze({get BETTER_AUTH_SECRET(){return re("BETTER_AUTH_SECRET")},get AUTH_SECRET(){return re("AUTH_SECRET")},get BETTER_AUTH_TELEMETRY(){return re("BETTER_AUTH_TELEMETRY")},get BETTER_AUTH_TELEMETRY_ID(){return re("BETTER_AUTH_TELEMETRY_ID")},get NODE_ENV(){return re("NODE_ENV","development")},get PACKAGE_VERSION(){return re("PACKAGE_VERSION","0.0.0")},get BETTER_AUTH_TELEMETRY_ENDPOINT(){return re("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}}),ar=1,ye=4,Je=8,Oe=24,Is={eterm:ye,cons25:ye,console:ye,cygwin:ye,dtterm:ye,gnome:ye,hurd:ye,jfbterm:ye,konsole:ye,kterm:ye,mlterm:ye,mosh:Oe,putty:ye,st:ye,"rxvt-unicode-24bit":Oe,terminator:Oe,"xterm-kitty":Oe},ad=new Map(Object.entries({APPVEYOR:Je,BUILDKITE:Je,CIRCLECI:Oe,DRONE:Je,GITEA_ACTIONS:Oe,GITHUB_ACTIONS:Oe,GITLAB_CI:Je,TRAVIS:Je})),cd=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function ud(){if(re("FORCE_COLOR")!==void 0)switch(re("FORCE_COLOR")){case"":case"1":case"true":return ye;case"2":return Je;case"3":return Oe;default:return ar}if(re("NODE_DISABLE_COLORS")!==void 0&&re("NODE_DISABLE_COLORS")!==""||re("NO_COLOR")!==void 0&&re("NO_COLOR")!==""||re("TERM")==="dumb")return ar;if(re("TMUX"))return Oe;if("TF_BUILD"in $e&&"AGENT_NAME"in $e)return ye;if("CI"in $e){for(const{0:e,1:t}of ad)if(e in $e)return t;return re("CI_NAME")==="codeship"?Je:ar}if("TEAMCITY_VERSION"in $e)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(re("TEAMCITY_VERSION"))!==null?ye:ar;switch(re("TERM_PROGRAM")){case"iTerm.app":return!re("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(re("TERM_PROGRAM_VERSION"))!==null?Je:Oe;case"HyperTerm":case"MacTerm":return Oe;case"Apple_Terminal":return Je}if(re("COLORTERM")==="truecolor"||re("COLORTERM")==="24bit")return Oe;if(re("TERM")){if(/truecolor/.exec(re("TERM"))!==null)return Oe;if(/^xterm-256/.exec(re("TERM"))!==null)return Je;const e=re("TERM").toLowerCase();if(Is[e])return Is[e];if(cd.some(t=>t.exec(e)!==null))return ye}return re("COLORTERM")?ye:ar}const Ge={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"},bg:{black:"\x1B[40m"}},po=["debug","info","success","warn","error"];function vn(e,t){return po.indexOf(t)>=po.indexOf(e)}const dd={info:Ge.fg.blue,success:Ge.fg.green,warn:Ge.fg.yellow,error:Ge.fg.red,debug:Ge.fg.magenta},ld=(e,t,r)=>{const n=new Date().toISOString();return r?`${Ge.dim}${n}${Ge.reset} ${dd[e]}${e.toUpperCase()}${Ge.reset} ${Ge.bright}[Better Auth]:${Ge.reset} ${t}`:`${n} ${e.toUpperCase()} [Better Auth]: ${t}`},fd=e=>{const t=e?.disabled!==!0,r=e?.level??"error",n=e?.disableColors!==void 0?!e.disableColors:ud()!==1,o=(s,i,a=[])=>{if(!t||!vn(r,s))return;const c=ld(s,i,n);if(!e||typeof e.log!="function"){s==="error"?console.error(c,...a):s==="warn"?console.warn(c,...a):console.log(c,...a);return}e.log(s==="success"?"info":s,i,...a)};return{...Object.fromEntries(po.map(s=>[s,(...[i,...a])=>o(s,i,a)])),get level(){return r}}},Q=fd();function iT(e){return e}const j={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."};var Y=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function pd(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new Y(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function hd(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new Y(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof Y?t:new Y(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function cr(e,t="/api/auth"){if(hd(e),pd(e))return e;const r=e.replace(/\/+$/,"");return!t||t==="/"?r:(t=t.startsWith("/")?t:`/${t}`,`${r}${t}`)}function md(e,t,r,n,o){if(e)return cr(e,t);{const a=$e.BETTER_AUTH_URL||$e.NEXT_PUBLIC_BETTER_AUTH_URL||$e.PUBLIC_BETTER_AUTH_URL||$e.NUXT_PUBLIC_BETTER_AUTH_URL||$e.NUXT_PUBLIC_AUTH_URL||($e.BASE_URL!=="/"?$e.BASE_URL:void 0);if(a)return cr(a,t)}const s=r?.headers.get("x-forwarded-host"),i=r?.headers.get("x-forwarded-proto");if(s&&i&&o)return cr(`${i}://${s}`,t);if(r){const a=fr(r.url);if(!a)throw new Y("Could not get origin from request. Please provide a valid base URL.");return cr(a,t)}if(typeof window<"u"&&window.location)return cr(window.location.origin,t)}function fr(e){try{const t=new URL(e);return t.origin==="null"?null:t.origin}catch{return null}}function ca(e){try{return new URL(e).protocol}catch{return null}}function ua(e){try{return new URL(e).host}catch{return null}}const gd={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},yd=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,Rs={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},wd=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function _d(e){return e instanceof Date&&!isNaN(e.getTime())}function bd(e){const t=wd.exec(e);if(!t)return null;const[,r,n,o,s,i,a,c,u,d,l]=t;let f=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(o,10),parseInt(s,10),parseInt(i,10),parseInt(a,10),c?parseInt(c.padEnd(3,"0"),10):0));if(u){const p=(parseInt(d,10)*60+parseInt(l,10))*(u==="+"?-1:1);f.setUTCMinutes(f.getUTCMinutes()+p)}return _d(f)?f:null}function vd(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:o,parseDates:s=!0}=t;if(typeof e!="string")return e;const i=e.trim();if(i.length>0&&i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);const a=i.toLowerCase();if(a.length<=9&&a in Rs)return Rs[a];if(!yd.test(i)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(gd).some(([c,u])=>{const d=u.test(i);return d&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${c} pattern`),d})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(u,d)=>{if(u==="__proto__"||u==="constructor"&&d&&typeof d=="object"&&"prototype"in d){n&&console.warn(`[better-json] Dropping "${u}" key to prevent prototype pollution`);return}if(s&&typeof d=="string"){const l=bd(d);if(l)return l}return o?o(u,d):d})}catch(c){if(r)throw c;return e}}function Ad(e,t={strict:!0}){return vd(e,t)}let je=[],at=0;const Er=4;let da=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let s=at+Er;s<je.length;)je[s]===n?je.splice(s,Er):s+=Er;let o=t.indexOf(n);~o&&(t.splice(o,1),--r.lc||r.off())}},notify(n,o){let s=!je.length;for(let i of t)je.push(i,r.value,n,o);if(s){for(at=0;at<je.length;at+=Er)je[at](je[at+1],je[at+2],je[at+3]);je.length=0}},off(){},set(n){let o=r.value;o!==n&&(r.value=n,r.notify(o))},subscribe(n){let o=r.listen(n);return n(r.value),o},value:e};return r};const Ed=5,kr=6,Tr=10;let kd=(e,t,r,n)=>(e.events=e.events||{},e.events[r+Tr]||(e.events[r+Tr]=n(o=>{e.events[r].reduceRight((s,i)=>(i(s),s),{shared:{},...o})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let o=e.events[r],s=o.indexOf(t);o.splice(s,1),o.length||(delete e.events[r],e.events[r+Tr](),delete e.events[r+Tr])}),Td=1e3,la=(e,t)=>kd(e,n=>{let o=t(n);o&&e.events[kr].push(o)},Ed,n=>{let o=e.listen;e.listen=(...i)=>(!e.lc&&!e.active&&(e.active=!0,n()),o(...i));let s=e.off;return e.events[kr]=[],e.off=()=>{s(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let i of e.events[kr])i();e.events[kr]=[]}},Td)},()=>{e.listen=o,e.off=s}});function Sd(e,t,r){let n=new Set(t).add(void 0);return e.listen((o,s,i)=>{n.has(i)&&r(o,s,i)})}var Id=Object.defineProperty,Rd=Object.defineProperties,Ud=Object.getOwnPropertyDescriptors,Us=Object.getOwnPropertySymbols,$d=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,$s=(e,t,r)=>t in e?Id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Me=(e,t)=>{for(var r in t||(t={}))$d.call(t,r)&&$s(e,r,t[r]);if(Us)for(var r of Us(t))Cd.call(t,r)&&$s(e,r,t[r]);return e},Ve=(e,t)=>Rd(e,Ud(t)),Od=class extends Error{constructor(t,r,n){super(r||t.toString(),{cause:n}),this.status=t,this.statusText=r,this.error=n}},Pd=async(e,t)=>{var r,n,o,s,i,a;let c=t||{};const u={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:c,hooks:u};for(const d of t?.plugins||[]){if(d.init){const l=await((r=d.init)==null?void 0:r.call(d,e.toString(),t));c=l.options||c,e=l.url}u.onRequest.push((n=d.hooks)==null?void 0:n.onRequest),u.onResponse.push((o=d.hooks)==null?void 0:o.onResponse),u.onSuccess.push((s=d.hooks)==null?void 0:s.onSuccess),u.onError.push((i=d.hooks)==null?void 0:i.onError),u.onRetry.push((a=d.hooks)==null?void 0:a.onRetry)}return{url:e,options:c,hooks:u}},Cs=class{constructor(t){this.options=t}shouldAttemptRetry(t,r){return this.options.shouldRetry?Promise.resolve(t<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(t<this.options.attempts)}getDelay(){return this.options.delay}},Dd=class{constructor(t){this.options=t}shouldAttemptRetry(t,r){return this.options.shouldRetry?Promise.resolve(t<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(t<this.options.attempts)}getDelay(t){return Math.min(this.options.maxDelay,this.options.baseDelay*2**t)}};function zd(e){if(typeof e=="number")return new Cs({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new Cs(e);case"exponential":return new Dd(e);default:throw new Error("Invalid retry strategy")}}var xd=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e?.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),o=r(e.auth.password);if(!n||!o)return t;t.authorization=`Basic ${btoa(`${n}:${o}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},Ld=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Nd(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return Ld.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function Zd(e){try{return JSON.parse(e),!0}catch{return!1}}function fa(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Os(e){try{return JSON.parse(e)}catch{return e}}function Ps(e){return typeof e=="function"}function jd(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Ps(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Ps(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Md(e){const t=new Headers(e?.headers),r=await xd(e);for(const[n,o]of Object.entries(r||{}))t.set(n,o);if(!t.has("content-type")){const n=Kd(e?.body);n&&t.set("content-type",n)}return t}function Kd(e){return fa(e)?"application/json":null}function Hd(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(fa(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e?.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return e.body}function qd(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return ha.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Vd(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var Bd=class pa extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,pa.prototype)}};async function Nr(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new Bd(r.issues);return r.value}var ha=["get","post","put","patch","delete"],Wd=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,o,s,i;const a=((o=(n=e.plugins)==null?void 0:n.find(c=>{var u;return(u=c.schema)!=null&&u.config?t.startsWith(c.schema.config.baseURL||"")||t.startsWith(c.schema.config.prefix||""):!1}))==null?void 0:o.schema)||e.schema;if(a){let c=t;(s=a.config)!=null&&s.prefix&&c.startsWith(a.config.prefix)&&(c=c.replace(a.config.prefix,""),a.config.baseURL&&(t=t.replace(a.config.prefix,a.config.baseURL))),(i=a.config)!=null&&i.baseURL&&c.startsWith(a.config.baseURL)&&(c=c.replace(a.config.baseURL,""));const u=a.schema[c];if(u){let d=Ve(Me({},r),{method:u.method,output:u.output});return r?.disableValidation||(d=Ve(Me({},d),{body:u.input?await Nr(u.input,r?.body):r?.body,params:u.params?await Nr(u.params,r?.params):r?.params,query:u.query?await Nr(u.query,r?.query):r?.query})),{url:t,options:d}}}return{url:t,options:r}}}),Fd=e=>{async function t(r,n){const o=Ve(Me(Me({},e),n),{plugins:[...e?.plugins||[],Wd(e||{})]});if(e?.catchAllError)try{return await ho(r,o)}catch(s){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:s}}}return await ho(r,o)}return t};function Jd(e,t){let{baseURL:r,params:n,query:o}=t||{query:{},params:{},baseURL:""},s=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const l=e.toString().split("@")[1].split("/")[0];ha.includes(l)&&(e=e.replace(`@${l}/`,"/"))}s.endsWith("/")||(s+="/");let[i,a]=e.replace(s,"").split("?");const c=new URLSearchParams(a);for(const[l,f]of Object.entries(o||{}))f!=null&&c.set(l,String(f));if(n)if(Array.isArray(n)){const l=i.split("/").filter(f=>f.startsWith(":"));for(const[f,p]of l.entries()){const h=n[f];i=i.replace(p,h)}}else for(const[l,f]of Object.entries(n))i=i.replace(`:${l}`,String(f));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let u=c.toString();return u=u.length>0?`?${u}`.replace(/\+/g,"%20"):"",s.startsWith("http")?new URL(`${i}${u}`,s):`${s}${i}${u}`}var ho=async(e,t)=>{var r,n,o,s,i,a,c,u;const{hooks:d,url:l,options:f}=await Pd(e,t),p=jd(f),h=new AbortController,m=(r=f.signal)!=null?r:h.signal,y=Jd(l,f),b=Hd(f),k=await Md(f),v=qd(l,f);let w=Ve(Me({},f),{url:y,headers:k,body:b,method:v,signal:m});for(const R of d.onRequest)if(R){const I=await R(w);I instanceof Object&&(w=I)}("pipeTo"in w&&typeof w.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in w||(w.duplex="half"));const{clearTimeout:N}=Vd(f,h);let T=await p(w.url,w);N();const O={response:T,request:w};for(const R of d.onResponse)if(R){const I=await R(Ve(Me({},O),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?T.clone():T}));I instanceof Response?T=I:I instanceof Object&&(T=I.response)}if(T.ok){if(!(w.method!=="HEAD"))return{data:"",error:null};const I=Nd(T),z={data:"",response:T,request:w};if(I==="json"||I==="text"){const D=await T.text(),V=await((s=w.jsonParser)!=null?s:Os)(D);z.data=V}else z.data=await T[I]();w?.output&&w.output&&!w.disableValidation&&(z.data=await Nr(w.output,z.data));for(const D of d.onSuccess)D&&await D(Ve(Me({},z),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?T.clone():T}));return t?.throw?z.data:{data:z.data,error:null}}const M=(a=t?.jsonParser)!=null?a:Os,x=await T.text(),Z=Zd(x),C=Z?await M(x):null,q={response:T,responseText:x,request:w,error:Ve(Me({},C),{status:T.status,statusText:T.statusText})};for(const R of d.onError)R&&await R(Ve(Me({},q),{response:(c=t?.hookOptions)!=null&&c.cloneResponse?T.clone():T}));if(t?.retry){const R=zd(t.retry),I=(u=t.retryAttempt)!=null?u:0;if(await R.shouldAttemptRetry(I,T)){for(const D of d.onRetry)D&&await D(O);const z=R.getDelay(I);return await new Promise(D=>setTimeout(D,z)),await ho(e,Ve(Me({},t),{retryAttempt:I+1}))}}if(t?.throw)throw new Od(T.status,T.statusText,Z?C:x);return{data:null,error:Ve(Me({},C),{status:T.status,statusText:T.statusText})}};const Bn=Symbol.for("better-auth:broadcast-channel"),Gd=()=>Math.floor(Date.now()/1e3);var Qd=class{listeners=new Set;name;constructor(e="better-auth.message"){this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:Gd()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const r=JSON.parse(t.newValue??"{}");r?.event!=="session"||!r?.data||this.listeners.forEach(n=>n(r))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function Wn(e="better-auth.message"){return globalThis[Bn]||(globalThis[Bn]=new Qd(e)),globalThis[Bn]}const Fn=Symbol.for("better-auth:focus-manager");var Yd=class{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function Ds(){return globalThis[Fn]||(globalThis[Fn]=new Yd),globalThis[Fn]}const Jn=Symbol.for("better-auth:online-manager");var Xd=class{listeners=new Set;isOnline=typeof navigator<"u"?navigator.onLine:!0;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function Gn(){return globalThis[Jn]||(globalThis[Jn]=new Xd),globalThis[Jn]}const el=()=>typeof window>"u",tl=(e,t,r,n)=>{const o=da({data:null,error:null,isPending:!0,isRefetching:!1,refetch:a=>s(a)}),s=async a=>new Promise(c=>{const u=typeof n=="function"?n({data:o.get().data,error:o.get().error,isPending:o.get().isPending}):n;r(t,{...u,query:{...u?.query,...a?.query},async onSuccess(d){o.set({data:d.data,error:null,isPending:!1,isRefetching:!1,refetch:o.value.refetch}),await u?.onSuccess?.(d)},async onError(d){const{request:l}=d,f=typeof l.retry=="number"?l.retry:l.retry?.attempts,p=l.retryAttempt||0;f&&p<f||(o.set({error:d.error,data:null,isPending:!1,isRefetching:!1,refetch:o.value.refetch}),await u?.onError?.(d))},async onRequest(d){const l=o.get();o.set({isPending:l.data===null,data:l.data,error:null,isRefetching:!0,refetch:o.value.refetch}),await u?.onRequest?.(d)}}).catch(d=>{o.set({error:d,data:null,isPending:!1,isRefetching:!1,refetch:o.value.refetch})}).finally(()=>{c(void 0)})});e=Array.isArray(e)?e:[e];let i=!1;for(const a of e)a.subscribe(async()=>{el()||(i?await s():la(o,()=>{const c=setTimeout(async()=>{i||(await s(),i=!0)},0);return()=>{o.off(),a.off(),clearTimeout(c)}}))});return o},jt=()=>Math.floor(Date.now()/1e3),rl=5;function nl(e){const{sessionAtom:t,sessionSignal:r,$fetch:n,options:o={}}=e,s=o.sessionOptions?.refetchInterval??0,i=o.sessionOptions?.refetchOnWindowFocus??!0,a=o.sessionOptions?.refetchWhenOffline??!1,c={lastSync:0,lastSessionRequest:0,cachedSession:void 0},u=()=>a||Gn().isOnline,d=k=>{if(!u())return;if(k?.event==="storage"){c.lastSync=jt(),r.set(!r.get());return}const v=t.get();if(k?.event==="poll"){c.lastSessionRequest=jt(),n("/get-session").then(w=>{t.set({...v,data:w.data,error:w.error||null}),c.lastSync=jt(),r.set(!r.get())}).catch(()=>{});return}k?.event==="visibilitychange"&&jt()-c.lastSessionRequest<rl&&v?.data!==null&&v?.data!==void 0||(v?.data===null||v?.data===void 0||k?.event==="visibilitychange")&&(k?.event==="visibilitychange"&&(c.lastSessionRequest=jt()),c.lastSync=jt(),r.set(!r.get()))},l=k=>{Wn().post({event:"session",data:{trigger:k},clientId:Math.random().toString(36).substring(7)})},f=()=>{s&&s>0&&(c.pollInterval=setInterval(()=>{t.get()?.data&&d({event:"poll"})},s*1e3))},p=()=>{c.unsubscribeBroadcast=Wn().subscribe(()=>{d({event:"storage"})})},h=()=>{i&&(c.unsubscribeFocus=Ds().subscribe(()=>{d({event:"visibilitychange"})}))},m=()=>{c.unsubscribeOnline=Gn().subscribe(k=>{k&&d({event:"visibilitychange"})})};return{init:()=>{f(),p(),h(),m(),Wn().setup(),Ds().setup(),Gn().setup()},cleanup:()=>{c.pollInterval&&(clearInterval(c.pollInterval),c.pollInterval=void 0),c.unsubscribeBroadcast&&(c.unsubscribeBroadcast(),c.unsubscribeBroadcast=void 0),c.unsubscribeFocus&&(c.unsubscribeFocus(),c.unsubscribeFocus=void 0),c.unsubscribeOnline&&(c.unsubscribeOnline(),c.unsubscribeOnline=void 0),c.lastSync=0,c.lastSessionRequest=0,c.cachedSession=void 0},triggerRefetch:d,broadcastSessionUpdate:l}}const ol={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}};function sl(e,t){const r=da(!1),n=tl(r,"/get-session",e,{method:"GET"});return la(n,()=>{const o=nl({sessionAtom:n,sessionSignal:r,$fetch:e,options:t});return o.init(),()=>{o.cleanup()}}),{session:n,$sessionSignal:r}}const il=(e,t)=>{const r="credentials"in Request.prototype,n=md(e?.baseURL,e?.basePath,void 0)??"/api/auth",o=e?.plugins?.flatMap(w=>w.fetchPlugins).filter(w=>w!==void 0)||[],s={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:i,onError:a,onRequest:c,onResponse:u,...d}=e?.fetchOptions||{},l=Fd({baseURL:n,...r?{credentials:"include"}:{},method:"GET",jsonParser(w){return w?Ad(w,{strict:!1}):null},customFetchImpl:fetch,...d,plugins:[s,...d.plugins||[],...e?.disableDefaultFetchPlugins?[]:[ol],...o]}),{$sessionSignal:f,session:p}=sl(l,e),h=e?.plugins||[];let m={},y={$sessionSignal:f,session:p},b={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const k=[{signal:"$sessionSignal",matcher(w){return w==="/sign-out"||w==="/update-user"||w==="/sign-up/email"||w==="/sign-in/email"||w==="/delete-user"||w==="/verify-email"||w==="/revoke-sessions"||w==="/revoke-session"||w==="/change-email"}}];for(const w of h)w.getAtoms&&Object.assign(y,w.getAtoms?.(l)),w.pathMethods&&Object.assign(b,w.pathMethods),w.atomListeners&&k.push(...w.atomListeners);const v={notify:w=>{y[w].set(!y[w].get())},listen:(w,N)=>{y[w].subscribe(N)},atoms:y};for(const w of h)w.getActions&&Object.assign(m,w.getActions?.(l,v,e));return{get baseURL(){return n},pluginsActions:m,pluginsAtoms:y,pluginPathMethods:b,atomListeners:k,$fetch:l,$store:v}};function al(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function cl(e,t,r){const n=t[e],{fetchOptions:o,query:s,...i}=r||{};return n||(o?.method?o.method:i&&Object.keys(i).length>0?"POST":"GET")}function ul(e,t,r,n,o){function s(i=[]){return new Proxy(function(){},{get(a,c){if(typeof c!="string"||c==="then"||c==="catch"||c==="finally")return;const u=[...i,c];let d=e;for(const l of u)if(d&&typeof d=="object"&&l in d)d=d[l];else{d=void 0;break}return typeof d=="function"||al(d)?d:s(u)},apply:async(a,c,u)=>{const d="/"+i.map(k=>k.replace(/[A-Z]/g,v=>`-${v.toLowerCase()}`)).join("/"),l=u[0]||{},f=u[1]||{},{query:p,fetchOptions:h,...m}=l,y={...f,...h},b=cl(d,r,l);return await t(d,{...y,body:b==="GET"?void 0:{...m,...y?.body||{}},query:p||y?.query,method:b,async onSuccess(k){if(await y?.onSuccess?.(k),!o||y.disableSignal)return;const v=o.filter(w=>w.matcher(d));if(v.length)for(const w of v){const N=n[w.signal];if(!N)return;const T=N.get();setTimeout(()=>{N.set(!T)},10)}}})}})}return s()}function dl(e,t={}){let r=Hn.useRef(e.get());const{keys:n,deps:o=[e,n]}=t;let s=Hn.useCallback(a=>{const c=u=>{r.current!==u&&(r.current=u,a())};return c(e.value),n?.length?Sd(e,n,c):e.listen(c)},o),i=()=>r.current;return Hn.useSyncExternalStore(s,i,i)}function ll(e){return`use${fl(e)}`}function fl(e){return e.charAt(0).toUpperCase()+e.slice(1)}function pl(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:o,$store:s,atomListeners:i}=il(e);let a={};for(const[c,u]of Object.entries(n))a[ll(c)]=()=>dl(u);return ul({...r,...a,$fetch:o,$store:s},o,t,n,i)}const hl="modulepreload",ml=function(e){return"/"+e},zs={},gl=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");o=c(r.map(u=>{if(u=ml(u),u in zs)return;zs[u]=!0;const d=u.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":hl,d||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),d)return new Promise((p,h)=>{f.addEventListener("load",p),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})};function Fr(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function ma(e,t,r){let n="",o=0,s=0;for(const i of e)for(o=o<<8|i,s+=8;s>=6;)s-=6,n+=t[o>>s&63];if(s>0&&(n+=t[o<<6-s&63]),r){const i=(4-n.length%4)%4;n+="=".repeat(i)}return n}function ga(e,t){const r=new Map;for(let i=0;i<t.length;i++)r.set(t[i],i);const n=[];let o=0,s=0;for(const i of e){if(i==="=")break;const a=r.get(i);if(a===void 0)throw new Error(`Invalid Base64 character: ${i}`);o=o<<6|a,s+=6,s>=8&&(s-=8,n.push(o>>s&255))}return Uint8Array.from(n)}const Ke={encode(e,t={}){const r=Fr(!1),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return ma(n,r,t.padding??!0)},decode(e){typeof e!="string"&&(e=new TextDecoder().decode(e));const t=e.includes("-")||e.includes("_"),r=Fr(t);return ga(e,r)}},rr={encode(e,t={}){const r=Fr(!0),n=typeof e=="string"?new TextEncoder().encode(e):new Uint8Array(e);return ma(n,r,t.padding??!0)},decode(e){const t=e.includes("-")||e.includes("_"),r=Fr(t);return ga(e,r)}};function Et(){const e=typeof globalThis<"u"&&globalThis.crypto;if(e&&typeof e.subtle=="object"&&e.subtle!=null)return e.subtle;throw new Error("crypto.subtle must be defined")}function An(e,t){return{digest:async r=>{const n=new TextEncoder,o=typeof r=="string"?n.encode(r):r,s=await Et().digest(e,o);return t==="hex"?Array.from(new Uint8Array(s)).map(c=>c.toString(16).padStart(2,"0")).join(""):t==="base64"||t==="base64url"||t==="base64urlnopad"?t.includes("url")?rr.encode(s,{padding:t!=="base64urlnopad"}):Ke.encode(s):s}}}function yl(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function mo(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Zr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function ge(e,t,r=""){const n=yl(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){const i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function xs(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function wl(e,t){ge(e,void 0,"output");const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function ut(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Yt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _l(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}const bl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,ya=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",vl=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Al(e){if(ge(e),ya)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=vl[e[r]];return t}const rt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ls(e){if(e>=rt._0&&e<=rt._9)return e-rt._0;if(e>=rt.A&&e<=rt.F)return e-(rt.A-10);if(e>=rt.a&&e<=rt.f)return e-(rt.a-10)}function El(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ya)return Uint8Array.fromHex(e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){const i=Ls(e.charCodeAt(s)),a=Ls(e.charCodeAt(s+1));if(i===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function kl(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Tl(...e){let t=0;for(let n=0;n<e.length;n++){const o=e[n];ge(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){const s=e[n];r.set(s,o),o+=s.length}return r}function Sl(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Il(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const Rl=(e,t)=>{function r(n,...o){if(ge(n,void 0,"key"),!bl)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const d=o[0];ge(d,e.varSizeNonce?void 0:e.nonceLength,"nonce")}const s=e.tagLength;s&&o[1]!==void 0&&ge(o[1],void 0,"AAD");const i=t(n,...o),a=(d,l)=>{if(l!==void 0){if(d!==2)throw new Error("cipher output not supported");ge(l,void 0,"output")}};let c=!1;return{encrypt(d,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ge(d),a(i.encrypt.length,l),i.encrypt(d,l)},decrypt(d,l){if(ge(d),s&&d.length<s)throw new Error('"ciphertext" expected length bigger than tagLength='+s);return a(i.decrypt.length,l),i.decrypt(d,l)}}}return Object.assign(r,e),r};function Ns(e,t,r=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&!$l(t))throw new Error("invalid output, must be aligned");return t}function Ul(e,t,r){mo(r);const n=new Uint8Array(16),o=_l(n);return o.setBigUint64(0,BigInt(t),r),o.setBigUint64(8,BigInt(e),r),n}function $l(e){return e.byteOffset%4===0}function Jr(e){return Uint8Array.from(e)}function Cl(e=32){const t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}function wa(e,t=Cl){const{nonceLength:r}=e;Zr(r);const n=(o,s)=>{const i=Tl(o,s);return s.fill(0),i};return((o,...s)=>({encrypt(i){ge(i);const a=t(r),c=e(o,a,...s).encrypt(i);return c instanceof Promise?c.then(u=>n(a,u)):n(a,c)},decrypt(i){ge(i);const a=i.subarray(0,r),c=i.subarray(r);return e(o,a,...s).decrypt(c)}}))}const _a=e=>Uint8Array.from(e.split(""),t=>t.charCodeAt(0)),Ol=_a("expand 16-byte k"),Pl=_a("expand 32-byte k"),Dl=ut(Ol),zl=ut(Pl);function U(e,t){return e<<t|e>>>32-t}function go(e){return e.byteOffset%4===0}const Sr=64,xl=16,ba=2**32-1,Zs=Uint32Array.of();function Ll(e,t,r,n,o,s,i,a){const c=o.length,u=new Uint8Array(Sr),d=ut(u),l=go(o)&&go(s),f=l?ut(o):Zs,p=l?ut(s):Zs;for(let h=0;h<c;i++){if(e(t,r,n,d,i,a),i>=ba)throw new Error("arx: counter overflow");const m=Math.min(Sr,c-h);if(l&&m===Sr){const y=h/4;if(h%4!==0)throw new Error("arx: invalid block position");for(let b=0,k;b<xl;b++)k=y+b,p[k]=f[k]^d[b];h+=Sr;continue}for(let y=0,b;y<m;y++)b=h+y,s[b]=o[b]^u[y];h+=m}}function Nl(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=Sl({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Zr(o),Zr(i),mo(s),mo(r),(a,c,u,d,l=0)=>{ge(a,void 0,"key"),ge(c,void 0,"nonce"),ge(u,void 0,"data");const f=u.length;if(d===void 0&&(d=new Uint8Array(f)),ge(d,void 0,"output"),Zr(l),l<0||l>=ba)throw new Error("arx: counter overflow");if(d.length<f)throw new Error(`arx: output (${d.length}) is shorter than data (${f})`);const p=[];let h=a.length,m,y;if(h===32)p.push(m=Jr(a)),y=zl;else if(h===16&&r)m=new Uint8Array(32),m.set(a),m.set(a,16),y=Dl,p.push(m);else throw ge(a,32,"arx key"),new Error("invalid key size");go(c)||p.push(c=Jr(c));const b=ut(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(y,b,ut(c.subarray(0,16)),b),c=c.subarray(16)}const k=16-o;if(k!==c.length)throw new Error(`arx: nonce must be ${k} or 16 bytes`);if(k!==12){const w=new Uint8Array(12);w.set(c,s?0:12-c.length),c=w,p.push(c)}const v=ut(c);return Ll(e,y,b,v,u,d,l,i),Yt(...p),d}}function Ae(e,t){return e[t++]&255|(e[t++]&255)<<8}class Zl{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(t){t=Jr(ge(t,32,"key"));const r=Ae(t,0),n=Ae(t,2),o=Ae(t,4),s=Ae(t,6),i=Ae(t,8),a=Ae(t,10),c=Ae(t,12),u=Ae(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let d=0;d<8;d++)this.pad[d]=Ae(t,16+2*d)}process(t,r,n=!1){const o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],u=i[2],d=i[3],l=i[4],f=i[5],p=i[6],h=i[7],m=i[8],y=i[9],b=Ae(t,r+0),k=Ae(t,r+2),v=Ae(t,r+4),w=Ae(t,r+6),N=Ae(t,r+8),T=Ae(t,r+10),O=Ae(t,r+12),M=Ae(t,r+14);let x=s[0]+(b&8191),Z=s[1]+((b>>>13|k<<3)&8191),C=s[2]+((k>>>10|v<<6)&8191),q=s[3]+((v>>>7|w<<9)&8191),R=s[4]+((w>>>4|N<<12)&8191),I=s[5]+(N>>>1&8191),z=s[6]+((N>>>14|T<<2)&8191),D=s[7]+((T>>>11|O<<5)&8191),W=s[8]+((O>>>8|M<<8)&8191),V=s[9]+(M>>>5|o),S=0,F=S+x*a+Z*(5*y)+C*(5*m)+q*(5*h)+R*(5*p);S=F>>>13,F&=8191,F+=I*(5*f)+z*(5*l)+D*(5*d)+W*(5*u)+V*(5*c),S+=F>>>13,F&=8191;let J=S+x*c+Z*a+C*(5*y)+q*(5*m)+R*(5*h);S=J>>>13,J&=8191,J+=I*(5*p)+z*(5*f)+D*(5*l)+W*(5*d)+V*(5*u),S+=J>>>13,J&=8191;let te=S+x*u+Z*c+C*a+q*(5*y)+R*(5*m);S=te>>>13,te&=8191,te+=I*(5*h)+z*(5*p)+D*(5*f)+W*(5*l)+V*(5*d),S+=te>>>13,te&=8191;let tt=S+x*d+Z*u+C*c+q*a+R*(5*y);S=tt>>>13,tt&=8191,tt+=I*(5*m)+z*(5*h)+D*(5*p)+W*(5*f)+V*(5*l),S+=tt>>>13,tt&=8191;let Dt=S+x*l+Z*d+C*u+q*c+R*a;S=Dt>>>13,Dt&=8191,Dt+=I*(5*y)+z*(5*m)+D*(5*h)+W*(5*p)+V*(5*f),S+=Dt>>>13,Dt&=8191;let zt=S+x*f+Z*l+C*d+q*u+R*c;S=zt>>>13,zt&=8191,zt+=I*a+z*(5*y)+D*(5*m)+W*(5*h)+V*(5*p),S+=zt>>>13,zt&=8191;let xt=S+x*p+Z*f+C*l+q*d+R*u;S=xt>>>13,xt&=8191,xt+=I*c+z*a+D*(5*y)+W*(5*m)+V*(5*h),S+=xt>>>13,xt&=8191;let Lt=S+x*h+Z*p+C*f+q*l+R*d;S=Lt>>>13,Lt&=8191,Lt+=I*u+z*c+D*a+W*(5*y)+V*(5*m),S+=Lt>>>13,Lt&=8191;let Nt=S+x*m+Z*h+C*p+q*f+R*l;S=Nt>>>13,Nt&=8191,Nt+=I*d+z*u+D*c+W*a+V*(5*y),S+=Nt>>>13,Nt&=8191;let Zt=S+x*y+Z*m+C*h+q*p+R*f;S=Zt>>>13,Zt&=8191,Zt+=I*l+z*d+D*u+W*c+V*a,S+=Zt>>>13,Zt&=8191,S=(S<<2)+S|0,S=S+F|0,F=S&8191,S=S>>>13,J+=S,s[0]=F,s[1]=J,s[2]=te,s[3]=tt,s[4]=Dt,s[5]=zt,s[6]=xt,s[7]=Lt,s[8]=Nt,s[9]=Zt}finalize(){const{h:t,pad:r}=this,n=new Uint16Array(10);let o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+r[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+r[a]|0)+(i>>>16)|0,t[a]=i&65535;Yt(n)}update(t){xs(this),ge(t),t=Jr(t);const{buffer:r,blockLen:n}=this,o=t.length;for(let s=0;s<o;){const i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}r.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Yt(this.h,this.r,this.buffer,this.pad)}digestInto(t){xs(this),wl(t,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}}function jl(e){const t=(n,o)=>e(o).update(n).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}const Ml=jl(e=>new Zl(e));function Kl(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],u=e[3],d=t[0],l=t[1],f=t[2],p=t[3],h=t[4],m=t[5],y=t[6],b=t[7],k=o,v=r[0],w=r[1],N=r[2],T=i,O=a,M=c,x=u,Z=d,C=l,q=f,R=p,I=h,z=m,D=y,W=b,V=k,S=v,F=w,J=N;for(let tt=0;tt<s;tt+=2)T=T+Z|0,V=U(V^T,16),I=I+V|0,Z=U(Z^I,12),T=T+Z|0,V=U(V^T,8),I=I+V|0,Z=U(Z^I,7),O=O+C|0,S=U(S^O,16),z=z+S|0,C=U(C^z,12),O=O+C|0,S=U(S^O,8),z=z+S|0,C=U(C^z,7),M=M+q|0,F=U(F^M,16),D=D+F|0,q=U(q^D,12),M=M+q|0,F=U(F^M,8),D=D+F|0,q=U(q^D,7),x=x+R|0,J=U(J^x,16),W=W+J|0,R=U(R^W,12),x=x+R|0,J=U(J^x,8),W=W+J|0,R=U(R^W,7),T=T+C|0,J=U(J^T,16),D=D+J|0,C=U(C^D,12),T=T+C|0,J=U(J^T,8),D=D+J|0,C=U(C^D,7),O=O+q|0,V=U(V^O,16),W=W+V|0,q=U(q^W,12),O=O+q|0,V=U(V^O,8),W=W+V|0,q=U(q^W,7),M=M+R|0,S=U(S^M,16),I=I+S|0,R=U(R^I,12),M=M+R|0,S=U(S^M,8),I=I+S|0,R=U(R^I,7),x=x+Z|0,F=U(F^x,16),z=z+F|0,Z=U(Z^z,12),x=x+Z|0,F=U(F^x,8),z=z+F|0,Z=U(Z^z,7);let te=0;n[te++]=i+T|0,n[te++]=a+O|0,n[te++]=c+M|0,n[te++]=u+x|0,n[te++]=d+Z|0,n[te++]=l+C|0,n[te++]=f+q|0,n[te++]=p+R|0,n[te++]=h+I|0,n[te++]=m+z|0,n[te++]=y+D|0,n[te++]=b+W|0,n[te++]=k+V|0,n[te++]=v+S|0,n[te++]=w+F|0,n[te++]=N+J|0}function Hl(e,t,r,n){let o=e[0],s=e[1],i=e[2],a=e[3],c=t[0],u=t[1],d=t[2],l=t[3],f=t[4],p=t[5],h=t[6],m=t[7],y=r[0],b=r[1],k=r[2],v=r[3];for(let N=0;N<20;N+=2)o=o+c|0,y=U(y^o,16),f=f+y|0,c=U(c^f,12),o=o+c|0,y=U(y^o,8),f=f+y|0,c=U(c^f,7),s=s+u|0,b=U(b^s,16),p=p+b|0,u=U(u^p,12),s=s+u|0,b=U(b^s,8),p=p+b|0,u=U(u^p,7),i=i+d|0,k=U(k^i,16),h=h+k|0,d=U(d^h,12),i=i+d|0,k=U(k^i,8),h=h+k|0,d=U(d^h,7),a=a+l|0,v=U(v^a,16),m=m+v|0,l=U(l^m,12),a=a+l|0,v=U(v^a,8),m=m+v|0,l=U(l^m,7),o=o+u|0,v=U(v^o,16),h=h+v|0,u=U(u^h,12),o=o+u|0,v=U(v^o,8),h=h+v|0,u=U(u^h,7),s=s+d|0,y=U(y^s,16),m=m+y|0,d=U(d^m,12),s=s+d|0,y=U(y^s,8),m=m+y|0,d=U(d^m,7),i=i+l|0,b=U(b^i,16),f=f+b|0,l=U(l^f,12),i=i+l|0,b=U(b^i,8),f=f+b|0,l=U(l^f,7),a=a+c|0,k=U(k^a,16),p=p+k|0,c=U(c^p,12),a=a+c|0,k=U(k^a,8),p=p+k|0,c=U(c^p,7);let w=0;n[w++]=o,n[w++]=s,n[w++]=i,n[w++]=a,n[w++]=y,n[w++]=b,n[w++]=k,n[w++]=v}const ql=Nl(Kl,{counterRight:!1,counterLength:8,extendNonceFn:Hl,allowShortKeys:!1}),Vl=new Uint8Array(16),js=(e,t)=>{e.update(t);const r=t.length%16;r&&e.update(Vl.subarray(r))},Bl=new Uint8Array(32);function Ms(e,t,r,n,o){o!==void 0&&ge(o,void 0,"AAD");const s=e(t,r,Bl),i=Ul(n.length,o?o.length:0,!0),a=Ml.create(s);o&&js(a,o),js(a,n),a.update(i);const c=a.digest();return Yt(s,i),c}const Wl=e=>(t,r,n)=>({encrypt(s,i){const a=s.length;i=Ns(a+16,i,!1),i.set(s);const c=i.subarray(0,-16);e(t,r,c,c,1);const u=Ms(e,t,r,c,n);return i.set(u,a),Yt(u),i},decrypt(s,i){i=Ns(s.length-16,i,!1);const a=s.subarray(0,-16),c=s.subarray(-16),u=Ms(e,t,r,a,n);if(!Il(c,u))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,r,i,i,1),Yt(u),i}}),va=Rl({blockSize:64,nonceLength:24,tagLength:16},Wl(ql));class Aa{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(wn(t),lo(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),_n(o)}update(t){return Es(this),this.iHash.update(t),this}digestInto(t){Es(this),lo(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});const{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const En=(e,t,r)=>new Aa(e,t).update(r).digest();En.create=(e,t)=>new Aa(e,t);function Fl(e,t,r){return wn(e),r===void 0&&(r=new Uint8Array(e.outputLen)),En(e,r,t)}const Qn=Uint8Array.of(0),Ks=Uint8Array.of();function Jl(e,t,r,n=32){wn(e),We(n,"length");const o=e.outputLen;if(n>255*o)throw new Error("Length must be <= 255*HashLen");const s=Math.ceil(n/o);r===void 0?r=Ks:lo(r,void 0,"info");const i=new Uint8Array(s*o),a=En.create(e,t),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)Qn[0]=d+1,c.update(d===0?Ks:u).update(r).update(Qn).digestInto(u),i.set(u,o*d),a._cloneInto(c);return a.destroy(),c.destroy(),_n(u,Qn),i.slice(0,n)}const Ea=(e,t,r,n,o)=>Jl(e,Fl(e,t,r),n,o),Gr=new TextEncoder,ot=new TextDecoder,Qr=2**32;function Xe(...e){const t=e.reduce((o,{length:s})=>o+s,0),r=new Uint8Array(t);let n=0;for(const o of e)r.set(o,n),n+=o.length;return r}function yo(e,t,r){if(t<0||t>=Qr)throw new RangeError(`value must be >= 0 and <= ${Qr-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,t&255],r)}function ka(e){const t=Math.floor(e/Qr),r=e%Qr,n=new Uint8Array(8);return yo(n,t,0),yo(n,r,4),n}function Wo(e){const t=new Uint8Array(4);return yo(t,e),t}function Te(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);if(n>127)throw new TypeError("non-ASCII string encountered in encode()");t[r]=n}return t}function Gl(e){if(Uint8Array.prototype.toBase64)return e.toBase64();const t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))}function Ql(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function be(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:ot.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=ot.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return Ql(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function ve(e){let t=e;return typeof t=="string"&&(t=Gr.encode(t)),Uint8Array.prototype.toBase64?t.toBase64({alphabet:"base64url",omitPadding:!0}):Gl(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class ke extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(t,r){super(t,r),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class Ue extends ke{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(t,r,n="unspecified",o="unspecified"){super(t,{cause:{claim:n,reason:o,payload:r}}),this.claim=n,this.reason=o,this.payload=r}}class wo extends ke{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(t,r,n="unspecified",o="unspecified"){super(t,{cause:{claim:n,reason:o,payload:r}}),this.claim=n,this.reason=o,this.payload=r}}class _o extends ke{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class oe extends ke{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class bo extends ke{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(t="decryption operation failed",r){super(t,r)}}class L extends ke{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class pe extends ke{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class Be extends ke{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class Yl extends ke{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class Ta extends ke{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class Sa extends ke{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(t="no applicable key found in the JSON Web Key Set",r){super(t,r)}}class Xl extends ke{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(t="multiple matching keys found in the JSON Web Key Set",r){super(t,r)}}class ef extends ke{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(t="request timed out",r){super(t,r)}}class tf extends ke{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(t="signature verification failed",r){super(t,r)}}function Ia(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new oe(`Unsupported JWE Algorithm: ${e}`)}}const rf=e=>crypto.getRandomValues(new Uint8Array(Ia(e)>>3));function Ra(e,t){if(t.length<<3!==Ia(e))throw new L("Invalid Initialization Vector length")}function Yr(e,t){const r=e.byteLength<<3;if(r!==t)throw new L(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)}const we=(e,t="algorithm.name")=>new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),Fe=(e,t)=>e.name===t;function jr(e){return parseInt(e.name.slice(4),10)}function nf(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ua(e,t){if(t&&!e.usages.includes(t))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function of(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if(!Fe(e.algorithm,"HMAC"))throw we("HMAC");const n=parseInt(t.slice(2),10);if(jr(e.algorithm.hash)!==n)throw we(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Fe(e.algorithm,"RSASSA-PKCS1-v1_5"))throw we("RSASSA-PKCS1-v1_5");const n=parseInt(t.slice(2),10);if(jr(e.algorithm.hash)!==n)throw we(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Fe(e.algorithm,"RSA-PSS"))throw we("RSA-PSS");const n=parseInt(t.slice(2),10);if(jr(e.algorithm.hash)!==n)throw we(`SHA-${n}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!Fe(e.algorithm,"Ed25519"))throw we("Ed25519");break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{if(!Fe(e.algorithm,t))throw we(t);break}case"ES256":case"ES384":case"ES512":{if(!Fe(e.algorithm,"ECDSA"))throw we("ECDSA");const n=nf(t);if(e.algorithm.namedCurve!==n)throw we(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ua(e,r)}function lt(e,t,r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!Fe(e.algorithm,"AES-GCM"))throw we("AES-GCM");const n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw we(n,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!Fe(e.algorithm,"AES-KW"))throw we("AES-KW");const n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw we(n,"algorithm.length");break}case"ECDH":{switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw we("ECDH or X25519")}break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!Fe(e.algorithm,"PBKDF2"))throw we("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!Fe(e.algorithm,"RSA-OAEP"))throw we("RSA-OAEP");const n=parseInt(t.slice(9),10)||1;if(jr(e.algorithm.hash)!==n)throw we(`SHA-${n}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Ua(e,r)}function $a(e,t,...r){if(r=r.filter(Boolean),r.length>2){const n=r.pop();e+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const It=(e,...t)=>$a("Key must be ",e,...t),Ca=(e,t,...r)=>$a(`Key for the ${e} algorithm must be `,t,...r);function dr(e){if(!nr(e))throw new Error("CryptoKey instance expected")}const nr=e=>e?.[Symbol.toStringTag]==="CryptoKey",Fo=e=>e?.[Symbol.toStringTag]==="KeyObject",Jo=e=>nr(e)||Fo(e);async function sf(e,t){if(!(e instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");const r={name:"HMAC",hash:"SHA-256"},n=await crypto.subtle.generateKey(r,!1,["sign"]),o=new Uint8Array(await crypto.subtle.sign(r,n,e)),s=new Uint8Array(await crypto.subtle.sign(r,n,t));let i=0,a=-1;for(;++a<32;)i|=o[a]^s[a];return i===0}async function af(e,t,r,n,o,s){if(!(t instanceof Uint8Array))throw new TypeError(It(t,"Uint8Array"));const i=parseInt(e.slice(1,4),10),a=await crypto.subtle.importKey("raw",t.subarray(i>>3),"AES-CBC",!1,["decrypt"]),c=await crypto.subtle.importKey("raw",t.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),u=Xe(s,n,r,ka(s.length<<3)),d=new Uint8Array((await crypto.subtle.sign("HMAC",c,u)).slice(0,i>>3));let l;try{l=await sf(o,d)}catch{}if(!l)throw new bo;let f;try{f=new Uint8Array(await crypto.subtle.decrypt({iv:n,name:"AES-CBC"},a,r))}catch{}if(!f)throw new bo;return f}async function cf(e,t,r,n,o,s){let i;t instanceof Uint8Array?i=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(lt(t,e,"decrypt"),i=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:s,iv:n,name:"AES-GCM",tagLength:128},i,Xe(r,o)))}catch{throw new bo}}async function Oa(e,t,r,n,o,s){if(!nr(t)&&!(t instanceof Uint8Array))throw new TypeError(It(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!n)throw new L("JWE Initialization Vector missing");if(!o)throw new L("JWE Authentication Tag missing");switch(Ra(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&Yr(t,parseInt(e.slice(-3),10)),af(e,t,r,n,o,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&Yr(t,parseInt(e.slice(1,4),10)),cf(e,t,r,n,o,s);default:throw new oe("Unsupported JWE Content Encryption Algorithm")}}function kn(...e){const t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(const n of t){const o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(const s of o){if(r.has(s))return!1;r.add(s)}}return!0}const uf=e=>typeof e=="object"&&e!==null;function Se(e){if(!uf(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Pa(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${t}`)}function Da(e,t,r){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[r]):(lt(e,t,r),e)}async function vo(e,t,r){const n=await Da(t,e,"wrapKey");Pa(n,e);const o=await crypto.subtle.importKey("raw",r,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",o,n,"AES-KW"))}async function Ao(e,t,r){const n=await Da(t,e,"unwrapKey");Pa(n,e);const o=await crypto.subtle.unwrapKey("raw",r,n,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",o))}async function za(e,t){const r=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(r,t))}function Yn(e){return Xe(Wo(e.length),e)}async function df(e,t,r){const n=t>>3,o=32,s=Math.ceil(n/o),i=new Uint8Array(s*o);for(let a=1;a<=s;a++){const c=new Uint8Array(4+e.length+r.length);c.set(Wo(a),0),c.set(e,4),c.set(r,4+e.length);const u=await za("sha256",c);i.set(u,(a-1)*o)}return i.slice(0,n)}async function xa(e,t,r,n,o=new Uint8Array,s=new Uint8Array){lt(e,"ECDH"),lt(t,"ECDH","deriveBits");const i=Yn(Te(r)),a=Yn(o),c=Yn(s),u=Wo(n),d=new Uint8Array,l=Xe(i,a,c,u,d),f=new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,lf(e)));return df(f,n,l)}function lf(e){return e.algorithm.name==="X25519"?256:Math.ceil(parseInt(e.algorithm.namedCurve.slice(-3),10)/8)<<3}function La(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return e.algorithm.name==="X25519"}}function ff(e,t){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]):(lt(e,t,"deriveBits"),e)}const pf=(e,t)=>Xe(Te(e),Uint8Array.of(0),t);async function Na(e,t,r,n){if(!(e instanceof Uint8Array)||e.length<8)throw new L("PBES2 Salt Input must be 8 or more octets");const o=pf(t,e),s=parseInt(t.slice(13,16),10),i={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:o},a=await ff(n,t);return new Uint8Array(await crypto.subtle.deriveBits(i,a,s))}async function hf(e,t,r,n=2048,o=crypto.getRandomValues(new Uint8Array(16))){const s=await Na(o,e,n,t);return{encryptedKey:await vo(e.slice(-6),s,r),p2c:n,p2s:ve(o)}}async function mf(e,t,r,n,o){const s=await Na(o,e,n,t);return Ao(e.slice(-6),s,r)}function Tn(e,t){if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}const Za=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new oe(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function gf(e,t,r){return lt(t,e,"encrypt"),Tn(e,t),new Uint8Array(await crypto.subtle.encrypt(Za(e),t,r))}async function yf(e,t,r){return lt(t,e,"decrypt"),Tn(e,t),new Uint8Array(await crypto.subtle.decrypt(Za(e),t,r))}function Go(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new oe(`Unsupported JWE Algorithm: ${e}`)}}const Kt=e=>crypto.getRandomValues(new Uint8Array(Go(e)>>3));function wf(e){let t,r;switch(e.kty){case"AKP":{switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new oe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new oe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new oe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new oe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new oe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}async function Mr(e){if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=wf(e),n={...e};return n.kty!=="AKP"&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??!(e.d||e.priv),e.key_ops??r)}async function or(e,t,r){if(!Se(e))throw new TypeError("JWK must be an object");let n;switch(t??=e.alg,n??=e.ext,e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return be(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new oe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return Mr({...e,alg:t,ext:n});case"AKP":{if(typeof e.alg!="string"||!e.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(t!==void 0&&t!==e.alg)throw new TypeError("JWK alg and alg option value mismatch");return Mr({...e,ext:n})}case"EC":case"OKP":return Mr({...e,alg:t,ext:n});default:throw new oe('Unsupported "kty" (Key Type) Parameter value')}}async function _f(e,t,r,n,o){if(!(r instanceof Uint8Array))throw new TypeError(It(r,"Uint8Array"));const s=parseInt(e.slice(1,4),10),i=await crypto.subtle.importKey("raw",r.subarray(s>>3),"AES-CBC",!1,["encrypt"]),a=await crypto.subtle.importKey("raw",r.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await crypto.subtle.encrypt({iv:n,name:"AES-CBC"},i,t)),u=Xe(o,n,c,ka(o.length<<3)),d=new Uint8Array((await crypto.subtle.sign("HMAC",a,u)).slice(0,s>>3));return{ciphertext:c,tag:d,iv:n}}async function bf(e,t,r,n,o){let s;r instanceof Uint8Array?s=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(lt(r,e,"encrypt"),s=r);const i=new Uint8Array(await crypto.subtle.encrypt({additionalData:o,iv:n,name:"AES-GCM",tagLength:128},s,t)),a=i.slice(-16);return{ciphertext:i.slice(0,-16),tag:a,iv:n}}async function ja(e,t,r,n,o){if(!nr(r)&&!(r instanceof Uint8Array))throw new TypeError(It(r,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));switch(n?Ra(e,n):n=rf(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&Yr(r,parseInt(e.slice(-3),10)),_f(e,t,r,n,o);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&Yr(r,parseInt(e.slice(1,4),10)),bf(e,t,r,n,o);default:throw new oe("Unsupported JWE Content Encryption Algorithm")}}async function vf(e,t,r,n){const o=e.slice(0,7),s=await ja(o,r,t,n,new Uint8Array);return{encryptedKey:s.ciphertext,iv:ve(s.iv),tag:ve(s.tag)}}async function Af(e,t,r,n,o){const s=e.slice(0,7);return Oa(s,t,r,n,o,new Uint8Array)}async function Ef(e,t,r,n,o){switch(e){case"dir":{if(r!==void 0)throw new L("Encountered unexpected JWE Encrypted Key");return t}case"ECDH-ES":if(r!==void 0)throw new L("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Se(n.epk))throw new L('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(dr(t),!La(t))throw new oe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const s=await or(n.epk,e);dr(s);let i,a;if(n.apu!==void 0){if(typeof n.apu!="string")throw new L('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=be(n.apu)}catch{throw new L("Failed to base64url decode the apu")}}if(n.apv!==void 0){if(typeof n.apv!="string")throw new L('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{a=be(n.apv)}catch{throw new L("Failed to base64url decode the apv")}}const c=await xa(s,t,e==="ECDH-ES"?n.enc:e,e==="ECDH-ES"?Go(n.enc):parseInt(e.slice(-5,-2),10),i,a);if(e==="ECDH-ES")return c;if(r===void 0)throw new L("JWE Encrypted Key missing");return Ao(e.slice(-6),c,r)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(r===void 0)throw new L("JWE Encrypted Key missing");return dr(t),yf(e,t,r)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(r===void 0)throw new L("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new L('JOSE Header "p2c" (PBES2 Count) missing or invalid');const s=o?.maxPBES2Count||1e4;if(n.p2c>s)throw new L('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof n.p2s!="string")throw new L('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let i;try{i=be(n.p2s)}catch{throw new L("Failed to base64url decode the p2s")}return mf(e,t,r,n.p2c,i)}case"A128KW":case"A192KW":case"A256KW":{if(r===void 0)throw new L("JWE Encrypted Key missing");return Ao(e,t,r)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(r===void 0)throw new L("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new L('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new L('JOSE Header "tag" (Authentication Tag) missing or invalid');let s;try{s=be(n.iv)}catch{throw new L("Failed to base64url decode the iv")}let i;try{i=be(n.tag)}catch{throw new L("Failed to base64url decode the tag")}return Af(e,t,r,s,i)}default:throw new oe('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function Sn(e,t,r,n,o){if(o.crit!==void 0&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(i=>typeof i!="string"||i.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;r!==void 0?s=new Map([...Object.entries(r),...t.entries()]):s=t;for(const i of n.crit){if(!s.has(i))throw new oe(`Extension Header Parameter "${i}" is not recognized`);if(o[i]===void 0)throw new e(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&n[i]===void 0)throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(n.crit)}function Eo(e,t){if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}const In=e=>Se(e)&&typeof e.kty=="string",kf=e=>e.kty!=="oct"&&(e.kty==="AKP"&&typeof e.priv=="string"||typeof e.d=="string"),Tf=e=>e.kty!=="oct"&&e.d===void 0&&e.priv===void 0,Sf=e=>e.kty==="oct"&&typeof e.k=="string";let Ft;const Hs=async(e,t,r,n=!1)=>{Ft||=new WeakMap;let o=Ft.get(e);if(o?.[r])return o[r];const s=await Mr({...t,alg:r});return n&&Object.freeze(e),o?o[r]=s:Ft.set(e,{[r]:s}),s},If=(e,t)=>{Ft||=new WeakMap;let r=Ft.get(e);if(r?.[t])return r[t];const n=e.type==="public",o=!!n;let s;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}s=e.toCryptoKey(e.asymmetricKeyType,o,n?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");s=e.toCryptoKey(e.asymmetricKeyType,o,[n?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":{if(t!==e.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");s=e.toCryptoKey(e.asymmetricKeyType,o,[n?"verify":"sign"])}}if(e.asymmetricKeyType==="rsa"){let i;switch(t){case"RSA-OAEP":i="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":i="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":i="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":i="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:i},o,n?["encrypt"]:["decrypt"]);s=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:i},o,[n?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){const a=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!a)throw new TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&a==="P-256"&&(s=e.toCryptoKey({name:"ECDSA",namedCurve:a},o,[n?"verify":"sign"])),t==="ES384"&&a==="P-384"&&(s=e.toCryptoKey({name:"ECDSA",namedCurve:a},o,[n?"verify":"sign"])),t==="ES512"&&a==="P-521"&&(s=e.toCryptoKey({name:"ECDSA",namedCurve:a},o,[n?"verify":"sign"])),t.startsWith("ECDH-ES")&&(s=e.toCryptoKey({name:"ECDH",namedCurve:a},o,n?[]:["deriveBits"]))}if(!s)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=s:Ft.set(e,{[t]:s}),s};async function br(e,t){if(e instanceof Uint8Array||nr(e))return e;if(Fo(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return If(e,t)}catch(n){if(n instanceof TypeError)throw n}let r=e.export({format:"jwk"});return Hs(e,r,t)}if(In(e))return e.k?be(e.k):Hs(e,e,t,!0);throw new Error("unreachable")}const Ht=e=>e?.[Symbol.toStringTag],ko=(e,t,r)=>{if(t.use!==void 0){let n;switch(r){case"sign":case"verify":n="sig";break;case"encrypt":case"decrypt":n="enc";break}if(t.use!==n)throw new TypeError(`Invalid key for this operation, its "use" must be "${n}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw new TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case(r==="sign"||r==="verify"):case e==="dir":case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):!e.includes("GCM")&&e.endsWith("KW")?n=r==="encrypt"?"wrapKey":"unwrapKey":n=r;break;case(r==="encrypt"&&e.startsWith("RSA")):n="wrapKey";break;case r==="decrypt":n=e.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(n&&t.key_ops?.includes?.(n)===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0},Rf=(e,t,r)=>{if(!(t instanceof Uint8Array)){if(In(t)){if(Sf(t)&&ko(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Jo(t))throw new TypeError(Ca(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw new TypeError(`${Ht(t)} instances for symmetric algorithms must be of type "secret"`)}},Uf=(e,t,r)=>{if(In(t))switch(r){case"decrypt":case"sign":if(kf(t)&&ko(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(Tf(t)&&ko(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Jo(t))throw new TypeError(Ca(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw new TypeError(`${Ht(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(r){case"sign":throw new TypeError(`${Ht(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${Ht(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(r){case"verify":throw new TypeError(`${Ht(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${Ht(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function Rn(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":Rf(e,t,r);break;default:Uf(e,t,r)}}async function $f(e,t,r){if(!Se(e))throw new L("Flattened JWE must be an object");if(e.protected===void 0&&e.header===void 0&&e.unprotected===void 0)throw new L("JOSE Header missing");if(e.iv!==void 0&&typeof e.iv!="string")throw new L("JWE Initialization Vector incorrect type");if(typeof e.ciphertext!="string")throw new L("JWE Ciphertext missing or incorrect type");if(e.tag!==void 0&&typeof e.tag!="string")throw new L("JWE Authentication Tag incorrect type");if(e.protected!==void 0&&typeof e.protected!="string")throw new L("JWE Protected Header incorrect type");if(e.encrypted_key!==void 0&&typeof e.encrypted_key!="string")throw new L("JWE Encrypted Key incorrect type");if(e.aad!==void 0&&typeof e.aad!="string")throw new L("JWE AAD incorrect type");if(e.header!==void 0&&!Se(e.header))throw new L("JWE Shared Unprotected Header incorrect type");if(e.unprotected!==void 0&&!Se(e.unprotected))throw new L("JWE Per-Recipient Unprotected Header incorrect type");let n;if(e.protected)try{const w=be(e.protected);n=JSON.parse(ot.decode(w))}catch{throw new L("JWE Protected Header is invalid")}if(!kn(n,e.header,e.unprotected))throw new L("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const o={...n,...e.header,...e.unprotected};if(Sn(L,new Map,r?.crit,n,o),o.zip!==void 0)throw new oe('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');const{alg:s,enc:i}=o;if(typeof s!="string"||!s)throw new L("missing JWE Algorithm (alg) in JWE Header");if(typeof i!="string"||!i)throw new L("missing JWE Encryption Algorithm (enc) in JWE Header");const a=r&&Eo("keyManagementAlgorithms",r.keyManagementAlgorithms),c=r&&Eo("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(a&&!a.has(s)||!a&&s.startsWith("PBES2"))throw new _o('"alg" (Algorithm) Header Parameter value not allowed');if(c&&!c.has(i))throw new _o('"enc" (Encryption Algorithm) Header Parameter value not allowed');let u;if(e.encrypted_key!==void 0)try{u=be(e.encrypted_key)}catch{throw new L("Failed to base64url decode the encrypted_key")}let d=!1;typeof t=="function"&&(t=await t(n,e),d=!0),Rn(s==="dir"?i:s,t,"decrypt");const l=await br(t,s);let f;try{f=await Ef(s,l,u,o,r)}catch(w){if(w instanceof TypeError||w instanceof L||w instanceof oe)throw w;f=Kt(i)}let p,h;if(e.iv!==void 0)try{p=be(e.iv)}catch{throw new L("Failed to base64url decode the iv")}if(e.tag!==void 0)try{h=be(e.tag)}catch{throw new L("Failed to base64url decode the tag")}const m=e.protected!==void 0?Te(e.protected):new Uint8Array;let y;e.aad!==void 0?y=Xe(m,Te("."),Te(e.aad)):y=m;let b;try{b=be(e.ciphertext)}catch{throw new L("Failed to base64url decode the ciphertext")}const v={plaintext:await Oa(i,f,b,p,h,y)};if(e.protected!==void 0&&(v.protectedHeader=n),e.aad!==void 0)try{v.additionalAuthenticatedData=be(e.aad)}catch{throw new L("Failed to base64url decode the aad")}return e.unprotected!==void 0&&(v.sharedUnprotectedHeader=e.unprotected),e.header!==void 0&&(v.unprotectedHeader=e.header),d?{...v,key:l}:v}async function Cf(e,t,r){if(e instanceof Uint8Array&&(e=ot.decode(e)),typeof e!="string")throw new L("Compact JWE must be a string or Uint8Array");const{0:n,1:o,2:s,3:i,4:a,length:c}=e.split(".");if(c!==5)throw new L("Invalid Compact JWE");const u=await $f({ciphertext:i,iv:s||void 0,protected:n,tag:a||void 0,encrypted_key:o||void 0},t,r),d={plaintext:u.plaintext,protectedHeader:u.protectedHeader};return typeof t=="function"?{...d,key:u.key}:d}const Of=Symbol();async function Pf(e){if(Fo(e))if(e.type==="secret")e=e.export();else return e.export({format:"jwk"});if(e instanceof Uint8Array)return{kty:"oct",k:ve(e)};if(!nr(e))throw new TypeError(It(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:r,alg:n,use:o,...s}=await crypto.subtle.exportKey("jwk",e);return s.kty==="AKP"&&(s.alg=n),s}async function Xr(e){return Pf(e)}async function Df(e,t,r,n,o={}){let s,i,a;switch(e){case"dir":{a=r;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(dr(r),!La(r))throw new oe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:c,apv:u}=o;let d;o.epk?d=await br(o.epk,e):d=(await crypto.subtle.generateKey(r.algorithm,!0,["deriveBits"])).privateKey;const{x:l,y:f,crv:p,kty:h}=await Xr(d),m=await xa(r,d,e==="ECDH-ES"?t:e,e==="ECDH-ES"?Go(t):parseInt(e.slice(-5,-2),10),c,u);if(i={epk:{x:l,crv:p,kty:h}},h==="EC"&&(i.epk.y=f),c&&(i.apu=ve(c)),u&&(i.apv=ve(u)),e==="ECDH-ES"){a=m;break}a=n||Kt(t);const y=e.slice(-6);s=await vo(y,m,a);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{a=n||Kt(t),dr(r),s=await gf(e,r,a);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{a=n||Kt(t);const{p2c:c,p2s:u}=o;({encryptedKey:s,...i}=await hf(e,r,a,c,u));break}case"A128KW":case"A192KW":case"A256KW":{a=n||Kt(t),s=await vo(e,r,a);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{a=n||Kt(t);const{iv:c}=o;({encryptedKey:s,...i}=await vf(e,r,a,c));break}default:throw new oe('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:a,encryptedKey:s,parameters:i}}class zf{#e;#t;#r;#n;#a;#s;#i;#o;constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this.#e=t}setKeyManagementParameters(t){if(this.#o)throw new TypeError("setKeyManagementParameters can only be called once");return this.#o=t,this}setProtectedHeader(t){if(this.#t)throw new TypeError("setProtectedHeader can only be called once");return this.#t=t,this}setSharedUnprotectedHeader(t){if(this.#r)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this.#r=t,this}setUnprotectedHeader(t){if(this.#n)throw new TypeError("setUnprotectedHeader can only be called once");return this.#n=t,this}setAdditionalAuthenticatedData(t){return this.#a=t,this}setContentEncryptionKey(t){if(this.#s)throw new TypeError("setContentEncryptionKey can only be called once");return this.#s=t,this}setInitializationVector(t){if(this.#i)throw new TypeError("setInitializationVector can only be called once");return this.#i=t,this}async encrypt(t,r){if(!this.#t&&!this.#n&&!this.#r)throw new L("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!kn(this.#t,this.#n,this.#r))throw new L("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const n={...this.#t,...this.#n,...this.#r};if(Sn(L,new Map,r?.crit,this.#t,n),n.zip!==void 0)throw new oe('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');const{alg:o,enc:s}=n;if(typeof o!="string"||!o)throw new L('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof s!="string"||!s)throw new L('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let i;if(this.#s&&(o==="dir"||o==="ECDH-ES"))throw new TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${o}`);Rn(o==="dir"?s:o,t,"encrypt");let a;{let y;const b=await br(t,o);({cek:a,encryptedKey:i,parameters:y}=await Df(o,s,b,this.#s,this.#o)),y&&(r&&Of in r?this.#n?this.#n={...this.#n,...y}:this.setUnprotectedHeader(y):this.#t?this.#t={...this.#t,...y}:this.setProtectedHeader(y))}let c,u,d,l;if(this.#t?(u=ve(JSON.stringify(this.#t)),d=Te(u)):(u="",d=new Uint8Array),this.#a){l=ve(this.#a);const y=Te(l);c=Xe(d,Te("."),y)}else c=d;const{ciphertext:f,tag:p,iv:h}=await ja(s,this.#e,a,this.#i,c),m={ciphertext:ve(f)};return h&&(m.iv=ve(h)),p&&(m.tag=ve(p)),i&&(m.encrypted_key=ve(i)),l&&(m.aad=l),this.#t&&(m.protected=u),this.#r&&(m.unprotected=this.#r),this.#n&&(m.header=this.#n),m}}function Ma(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new oe(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function Ka(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(It(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return of(t,e,r),t}async function xf(e,t,r,n){const o=await Ka(e,t,"verify");Tn(e,o);const s=Ma(e,o.algorithm);try{return await crypto.subtle.verify(s,o,r,n)}catch{return!1}}async function Lf(e,t,r){if(!Se(e))throw new pe("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new pe('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new pe("JWS Protected Header incorrect type");if(e.payload===void 0)throw new pe("JWS Payload missing");if(typeof e.signature!="string")throw new pe("JWS Signature missing or incorrect type");if(e.header!==void 0&&!Se(e.header))throw new pe("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const y=be(e.protected);n=JSON.parse(ot.decode(y))}catch{throw new pe("JWS Protected Header is invalid")}if(!kn(n,e.header))throw new pe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...n,...e.header},s=Sn(pe,new Map([["b64",!0]]),r?.crit,n,o);let i=!0;if(s.has("b64")&&(i=n.b64,typeof i!="boolean"))throw new pe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=o;if(typeof a!="string"||!a)throw new pe('JWS "alg" (Algorithm) Header Parameter missing or invalid');const c=r&&Eo("algorithms",r.algorithms);if(c&&!c.has(a))throw new _o('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof e.payload!="string")throw new pe("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new pe("JWS Payload must be a string or an Uint8Array instance");let u=!1;typeof t=="function"&&(t=await t(n,e),u=!0),Rn(a,t,"verify");const d=Xe(e.protected!==void 0?Te(e.protected):new Uint8Array,Te("."),typeof e.payload=="string"?i?Te(e.payload):Gr.encode(e.payload):e.payload);let l;try{l=be(e.signature)}catch{throw new pe("Failed to base64url decode the signature")}const f=await br(t,a);if(!await xf(a,f,l,d))throw new tf;let h;if(i)try{h=be(e.payload)}catch{throw new pe("Failed to base64url decode the payload")}else typeof e.payload=="string"?h=Gr.encode(e.payload):h=e.payload;const m={payload:h};return e.protected!==void 0&&(m.protectedHeader=n),e.header!==void 0&&(m.unprotectedHeader=e.header),u?{...m,key:f}:m}async function Nf(e,t,r){if(e instanceof Uint8Array&&(e=ot.decode(e)),typeof e!="string")throw new pe("Compact JWS must be a string or Uint8Array");const{0:n,1:o,2:s,length:i}=e.split(".");if(i!==3)throw new pe("Invalid Compact JWS");const a=await Lf({payload:o,protected:n,signature:s},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return typeof t=="function"?{...c,key:a.key}:c}const ct=e=>Math.floor(e.getTime()/1e3),Ha=60,qa=Ha*60,Qo=qa*24,Zf=Qo*7,jf=Qo*365.25,Mf=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function lr(e){const t=Mf.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let o;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":o=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":o=Math.round(r*Ha);break;case"hour":case"hours":case"hr":case"hrs":case"h":o=Math.round(r*qa);break;case"day":case"days":case"d":o=Math.round(r*Qo);break;case"week":case"weeks":case"w":o=Math.round(r*Zf);break;default:o=Math.round(r*jf);break}return t[1]==="-"||t[4]==="ago"?-o:o}function yt(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}const qs=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,Kf=(e,t)=>typeof e=="string"?t.includes(e):Array.isArray(e)?t.some(Set.prototype.has.bind(new Set(e))):!1;function Va(e,t,r={}){let n;try{n=JSON.parse(ot.decode(t))}catch{}if(!Se(n))throw new Be("JWT Claims Set must be a top-level JSON object");const{typ:o}=r;if(o&&(typeof e.typ!="string"||qs(e.typ)!==qs(o)))throw new Ue('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:s=[],issuer:i,subject:a,audience:c,maxTokenAge:u}=r,d=[...s];u!==void 0&&d.push("iat"),c!==void 0&&d.push("aud"),a!==void 0&&d.push("sub"),i!==void 0&&d.push("iss");for(const h of new Set(d.reverse()))if(!(h in n))throw new Ue(`missing required "${h}" claim`,n,h,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new Ue('unexpected "iss" claim value',n,"iss","check_failed");if(a&&n.sub!==a)throw new Ue('unexpected "sub" claim value',n,"sub","check_failed");if(c&&!Kf(n.aud,typeof c=="string"?[c]:c))throw new Ue('unexpected "aud" claim value',n,"aud","check_failed");let l;switch(typeof r.clockTolerance){case"string":l=lr(r.clockTolerance);break;case"number":l=r.clockTolerance;break;case"undefined":l=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=r,p=ct(f||new Date);if((n.iat!==void 0||u)&&typeof n.iat!="number")throw new Ue('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new Ue('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>p+l)throw new Ue('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new Ue('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=p-l)throw new wo('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){const h=p-n.iat,m=typeof u=="number"?u:lr(u);if(h-l>m)throw new wo('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(h<0-l)throw new Ue('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n}class Ba{#e;constructor(t){if(!Se(t))throw new TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(t)}data(){return Gr.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(t){this.#e.iss=t}get sub(){return this.#e.sub}set sub(t){this.#e.sub=t}get aud(){return this.#e.aud}set aud(t){this.#e.aud=t}set jti(t){this.#e.jti=t}set nbf(t){typeof t=="number"?this.#e.nbf=yt("setNotBefore",t):t instanceof Date?this.#e.nbf=yt("setNotBefore",ct(t)):this.#e.nbf=ct(new Date)+lr(t)}set exp(t){typeof t=="number"?this.#e.exp=yt("setExpirationTime",t):t instanceof Date?this.#e.exp=yt("setExpirationTime",ct(t)):this.#e.exp=ct(new Date)+lr(t)}set iat(t){t===void 0?this.#e.iat=ct(new Date):t instanceof Date?this.#e.iat=yt("setIssuedAt",ct(t)):typeof t=="string"?this.#e.iat=yt("setIssuedAt",ct(new Date)+lr(t)):this.#e.iat=yt("setIssuedAt",t)}}async function Rt(e,t,r){const n=await Nf(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&n.protectedHeader.b64===!1)throw new Be("JWTs MUST NOT use unencoded payload");const s={payload:Va(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof t=="function"?{...s,key:n.key}:s}async function Hf(e,t,r){const n=await Cf(e,t,r),o=Va(n.protectedHeader,n.plaintext,r),{protectedHeader:s}=n;if(s.iss!==void 0&&s.iss!==o.iss)throw new Ue('replicated "iss" claim header parameter mismatch',o,"iss","mismatch");if(s.sub!==void 0&&s.sub!==o.sub)throw new Ue('replicated "sub" claim header parameter mismatch',o,"sub","mismatch");if(s.aud!==void 0&&JSON.stringify(s.aud)!==JSON.stringify(o.aud))throw new Ue('replicated "aud" claim header parameter mismatch',o,"aud","mismatch");const i={payload:o,protectedHeader:s};return typeof t=="function"?{...i,key:n.key}:i}class qf{#e;constructor(t){this.#e=new zf(t)}setContentEncryptionKey(t){return this.#e.setContentEncryptionKey(t),this}setInitializationVector(t){return this.#e.setInitializationVector(t),this}setProtectedHeader(t){return this.#e.setProtectedHeader(t),this}setKeyManagementParameters(t){return this.#e.setKeyManagementParameters(t),this}async encrypt(t,r){const n=await this.#e.encrypt(t,r);return[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join(".")}}async function Vf(e,t,r){const n=await Ka(e,t,"sign");Tn(e,n);const o=await crypto.subtle.sign(Ma(e,n.algorithm),n,r);return new Uint8Array(o)}class Bf{#e;#t;#r;constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this.#e=t}setProtectedHeader(t){if(this.#t)throw new TypeError("setProtectedHeader can only be called once");return this.#t=t,this}setUnprotectedHeader(t){if(this.#r)throw new TypeError("setUnprotectedHeader can only be called once");return this.#r=t,this}async sign(t,r){if(!this.#t&&!this.#r)throw new pe("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!kn(this.#t,this.#r))throw new pe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...this.#t,...this.#r},o=Sn(pe,new Map([["b64",!0]]),r?.crit,this.#t,n);let s=!0;if(o.has("b64")&&(s=this.#t.b64,typeof s!="boolean"))throw new pe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:i}=n;if(typeof i!="string"||!i)throw new pe('JWS "alg" (Algorithm) Header Parameter missing or invalid');Rn(i,t,"sign");let a,c;s?(a=ve(this.#e),c=Te(a)):(c=this.#e,a="");let u,d;this.#t?(u=ve(JSON.stringify(this.#t)),d=Te(u)):(u="",d=new Uint8Array);const l=Xe(d,Te("."),c),f=await br(t,i),p=await Vf(i,f,l),h={signature:ve(p),payload:a};return this.#r&&(h.header=this.#r),this.#t&&(h.protected=u),h}}class Wf{#e;constructor(t){this.#e=new Bf(t)}setProtectedHeader(t){return this.#e.setProtectedHeader(t),this}async sign(t,r){const n=await this.#e.sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}}class Yo{#e;#t;constructor(t={}){this.#t=new Ba(t)}setIssuer(t){return this.#t.iss=t,this}setSubject(t){return this.#t.sub=t,this}setAudience(t){return this.#t.aud=t,this}setJti(t){return this.#t.jti=t,this}setNotBefore(t){return this.#t.nbf=t,this}setExpirationTime(t){return this.#t.exp=t,this}setIssuedAt(t){return this.#t.iat=t,this}setProtectedHeader(t){return this.#e=t,this}async sign(t,r){const n=new Wf(this.#t.data());if(n.setProtectedHeader(this.#e),Array.isArray(this.#e?.crit)&&this.#e.crit.includes("b64")&&this.#e.b64===!1)throw new Be("JWTs MUST NOT use unencoded payload");return n.sign(t,r)}}class Ff{#e;#t;#r;#n;#a;#s;#i;#o;constructor(t={}){this.#o=new Ba(t)}setIssuer(t){return this.#o.iss=t,this}setSubject(t){return this.#o.sub=t,this}setAudience(t){return this.#o.aud=t,this}setJti(t){return this.#o.jti=t,this}setNotBefore(t){return this.#o.nbf=t,this}setExpirationTime(t){return this.#o.exp=t,this}setIssuedAt(t){return this.#o.iat=t,this}setProtectedHeader(t){if(this.#n)throw new TypeError("setProtectedHeader can only be called once");return this.#n=t,this}setKeyManagementParameters(t){if(this.#r)throw new TypeError("setKeyManagementParameters can only be called once");return this.#r=t,this}setContentEncryptionKey(t){if(this.#e)throw new TypeError("setContentEncryptionKey can only be called once");return this.#e=t,this}setInitializationVector(t){if(this.#t)throw new TypeError("setInitializationVector can only be called once");return this.#t=t,this}replicateIssuerAsHeader(){return this.#a=!0,this}replicateSubjectAsHeader(){return this.#s=!0,this}replicateAudienceAsHeader(){return this.#i=!0,this}async encrypt(t,r){const n=new qf(this.#o.data());return this.#n&&(this.#a||this.#s||this.#i)&&(this.#n={...this.#n,iss:this.#a?this.#o.iss:void 0,sub:this.#s?this.#o.sub:void 0,aud:this.#i?this.#o.aud:void 0}),n.setProtectedHeader(this.#n),this.#t&&n.setInitializationVector(this.#t),this.#e&&n.setContentEncryptionKey(this.#e),this.#r&&n.setKeyManagementParameters(this.#r),n.encrypt(t,r)}}const qe=(e,t)=>{if(typeof e!="string"||!e)throw new Yl(`${t} missing or invalid`)};async function Wa(e,t){let r;if(In(e))r=e;else if(Jo(e))r=await Xr(e);else throw new TypeError(It(e,"CryptoKey","KeyObject","JSON Web Key"));if(t??="sha256",t!=="sha256"&&t!=="sha384"&&t!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let n;switch(r.kty){case"AKP":qe(r.alg,'"alg" (Algorithm) Parameter'),qe(r.pub,'"pub" (Public key) Parameter'),n={alg:r.alg,kty:r.kty,pub:r.pub};break;case"EC":qe(r.crv,'"crv" (Curve) Parameter'),qe(r.x,'"x" (X Coordinate) Parameter'),qe(r.y,'"y" (Y Coordinate) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":qe(r.crv,'"crv" (Subtype of Key Pair) Parameter'),qe(r.x,'"x" (Public Key) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":qe(r.e,'"e" (Exponent) Parameter'),qe(r.n,'"n" (Modulus) Parameter'),n={e:r.e,kty:r.kty,n:r.n};break;case"oct":qe(r.k,'"k" (Key Value) Parameter'),n={k:r.k,kty:r.kty};break;default:throw new oe('"kty" (Key Type) Parameter missing or unsupported')}const o=Te(JSON.stringify(n));return ve(await za(t,o))}function Jf(e){switch(typeof e=="string"&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new oe('Unsupported "alg" value for a JSON Web Key Set')}}function Gf(e){return e&&typeof e=="object"&&Array.isArray(e.keys)&&e.keys.every(Qf)}function Qf(e){return Se(e)}class Yf{#e;#t=new WeakMap;constructor(t){if(!Gf(t))throw new Ta("JSON Web Key Set malformed");this.#e=structuredClone(t)}jwks(){return this.#e}async getKey(t,r){const{alg:n,kid:o}={...t,...r?.header},s=Jf(n),i=this.#e.keys.filter(u=>{let d=s===u.kty;if(d&&typeof o=="string"&&(d=o===u.kid),d&&(typeof u.alg=="string"||s==="AKP")&&(d=n===u.alg),d&&typeof u.use=="string"&&(d=u.use==="sig"),d&&Array.isArray(u.key_ops)&&(d=u.key_ops.includes("verify")),d)switch(n){case"ES256":d=u.crv==="P-256";break;case"ES384":d=u.crv==="P-384";break;case"ES512":d=u.crv==="P-521";break;case"Ed25519":case"EdDSA":d=u.crv==="Ed25519";break}return d}),{0:a,length:c}=i;if(c===0)throw new Sa;if(c!==1){const u=new Xl,d=this.#t;throw u[Symbol.asyncIterator]=async function*(){for(const l of i)try{yield await Vs(d,l,n)}catch{}},u}return Vs(this.#t,a,n)}}async function Vs(e,t,r){const n=e.get(t)||e.set(t,{}).get(t);if(n[r]===void 0){const o=await or({...t,ext:!0},r);if(o instanceof Uint8Array||o.type!=="public")throw new Ta("JSON Web Key Set members must be public keys");n[r]=o}return n[r]}function Bs(e){const t=new Yf(e),r=async(n,o)=>t.getKey(n,o);return Object.defineProperties(r,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),r}function Xf(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}let To;(typeof navigator>"u"||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(To="jose/v6.1.1");const ep=Symbol();async function tp(e,t,r,n=fetch){const o=await n(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(s=>{throw s.name==="TimeoutError"?new ef:s});if(o.status!==200)throw new ke("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await o.json()}catch{throw new ke("Failed to parse the JSON Web Key Set HTTP response as JSON")}}const Xn=Symbol();function rp(e,t){return!(typeof e!="object"||e===null||!("uat"in e)||typeof e.uat!="number"||Date.now()-e.uat>=t||!("jwks"in e)||!Se(e.jwks)||!Array.isArray(e.jwks.keys)||!Array.prototype.every.call(e.jwks.keys,Se))}class np{#e;#t;#r;#n;#a;#s;#i;#o;#c;#u;constructor(t,r){if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");this.#e=new URL(t.href),this.#t=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this.#r=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this.#n=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5,this.#i=new Headers(r?.headers),To&&!this.#i.has("User-Agent")&&this.#i.set("User-Agent",To),this.#i.has("accept")||(this.#i.set("accept","application/json"),this.#i.append("accept","application/jwk-set+json")),this.#o=r?.[ep],r?.[Xn]!==void 0&&(this.#u=r?.[Xn],rp(r?.[Xn],this.#n)&&(this.#a=this.#u.uat,this.#c=Bs(this.#u.jwks)))}pendingFetch(){return!!this.#s}coolingDown(){return typeof this.#a=="number"?Date.now()<this.#a+this.#r:!1}fresh(){return typeof this.#a=="number"?Date.now()<this.#a+this.#n:!1}jwks(){return this.#c?.jwks()}async getKey(t,r){(!this.#c||!this.fresh())&&await this.reload();try{return await this.#c(t,r)}catch(n){if(n instanceof Sa&&this.coolingDown()===!1)return await this.reload(),this.#c(t,r);throw n}}async reload(){this.#s&&Xf()&&(this.#s=void 0),this.#s||=tp(this.#e.href,this.#i,AbortSignal.timeout(this.#t),this.#o).then(t=>{this.#c=Bs(t),this.#u&&(this.#u.uat=Date.now(),this.#u.jwks=t),this.#a=Date.now(),this.#s=void 0}).catch(t=>{throw this.#s=void 0,t}),await this.#s}}function op(e,t){const r=new np(e,t),n=async(o,s)=>r.getKey(o,s);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>r.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>r.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}function Fa(e){let t;if(typeof e=="string"){const r=e.split(".");(r.length===3||r.length===5)&&([t]=r)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw new Error;const r=JSON.parse(ot.decode(be(t)));if(!Se(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function it(e){if(typeof e!="string")throw new Be("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(r===5)throw new Be("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new Be("Invalid JWT");if(!t)throw new Be("JWTs must contain a payload");let n;try{n=be(t)}catch{throw new Be("Failed to base64url decode the payload")}let o;try{o=JSON.parse(ot.decode(n))}catch{throw new Be("Failed to parse the decoded payload as JSON")}if(!Se(o))throw new Be("Invalid JWT Claims Set");return o}function eo(e){const t=e?.modulusLength??2048;if(typeof t!="number"||t<2048)throw new oe("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function sp(e,t){let r,n;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:eo(t)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:eo(t)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:eo(t)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"Ed25519":case"EdDSA":{n=["sign","verify"],r={name:"Ed25519"};break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{n=["sign","verify"],r={name:e};break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveBits"];const o=t?.crv??"P-256";switch(o){case"P-256":case"P-384":case"P-521":{r={name:"ECDH",namedCurve:o};break}case"X25519":r={name:"X25519"};break;default:throw new oe("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, and X25519")}break}default:throw new oe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(r,t?.extractable,n)}const ip="0123456789abcdef",en={encode:e=>{if(typeof e=="string"&&(e=new TextEncoder().encode(e)),e.byteLength===0)return"";const t=new Uint8Array(e);let r="";for(const n of t)r+=n.toString(16).padStart(2,"0");return r},decode:e=>{if(!e)return"";if(typeof e=="string"){if(e.length%2!==0)throw new Error("Invalid hexadecimal string");if(!new RegExp(`^[${ip}]+$`).test(e))throw new Error("Invalid hexadecimal string");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}};function ap(e,t,r,n){wn(e);const o=ia({dkLen:32,asyncTick:10},n),{c:s,dkLen:i,asyncTick:a}=o;if(We(s,"c"),We(i,"dkLen"),We(a,"asyncTick"),s<1)throw new Error("iterations (c) must be >= 1");const c=ks(t,"password"),u=ks(r,"salt"),d=new Uint8Array(i),l=En.create(e,c),f=l._cloneInto().update(u);return{c:s,dkLen:i,asyncTick:a,DK:d,PRF:l,PRFSalt:f}}function cp(e,t,r,n,o){return e.destroy(),t.destroy(),n&&n.destroy(),_n(o),r}function Ja(e,t,r,n){const{c:o,dkLen:s,DK:i,PRF:a,PRFSalt:c}=ap(e,t,r,n);let u;const d=new Uint8Array(4),l=rd(d),f=new Uint8Array(a.outputLen);for(let p=1,h=0;h<s;p++,h+=a.outputLen){const m=i.subarray(h,h+a.outputLen);l.setInt32(0,p,!1),(u=c._cloneInto(u)).update(d).digestInto(f),m.set(f.subarray(0,m.length));for(let y=1;y<o;y++){a._cloneInto(u).update(f).digestInto(f);for(let b=0;b<m.length;b++)m[b]^=f[b]}}return cp(a,c,i,u,f)}function Ws(e,t,r,n,o,s){let i=e[t++]^r[n++],a=e[t++]^r[n++],c=e[t++]^r[n++],u=e[t++]^r[n++],d=e[t++]^r[n++],l=e[t++]^r[n++],f=e[t++]^r[n++],p=e[t++]^r[n++],h=e[t++]^r[n++],m=e[t++]^r[n++],y=e[t++]^r[n++],b=e[t++]^r[n++],k=e[t++]^r[n++],v=e[t++]^r[n++],w=e[t++]^r[n++],N=e[t++]^r[n++],T=i,O=a,M=c,x=u,Z=d,C=l,q=f,R=p,I=h,z=m,D=y,W=b,V=k,S=v,F=w,J=N;for(let te=0;te<8;te+=2)Z^=G(T+V|0,7),I^=G(Z+T|0,9),V^=G(I+Z|0,13),T^=G(V+I|0,18),z^=G(C+O|0,7),S^=G(z+C|0,9),O^=G(S+z|0,13),C^=G(O+S|0,18),F^=G(D+q|0,7),M^=G(F+D|0,9),q^=G(M+F|0,13),D^=G(q+M|0,18),x^=G(J+W|0,7),R^=G(x+J|0,9),W^=G(R+x|0,13),J^=G(W+R|0,18),O^=G(T+x|0,7),M^=G(O+T|0,9),x^=G(M+O|0,13),T^=G(x+M|0,18),q^=G(C+Z|0,7),R^=G(q+C|0,9),Z^=G(R+q|0,13),C^=G(Z+R|0,18),W^=G(D+z|0,7),I^=G(W+D|0,9),z^=G(I+W|0,13),D^=G(z+I|0,18),V^=G(J+F|0,7),S^=G(V+J|0,9),F^=G(S+V|0,13),J^=G(F+S|0,18);o[s++]=i+T|0,o[s++]=a+O|0,o[s++]=c+M|0,o[s++]=u+x|0,o[s++]=d+Z|0,o[s++]=l+C|0,o[s++]=f+q|0,o[s++]=p+R|0,o[s++]=h+I|0,o[s++]=m+z|0,o[s++]=y+D|0,o[s++]=b+W|0,o[s++]=k+V|0,o[s++]=v+S|0,o[s++]=w+F|0,o[s++]=N+J|0}function to(e,t,r,n,o){let s=n+0,i=n+16*o;for(let a=0;a<16;a++)r[i+a]=e[t+(2*o-1)*16+a];for(let a=0;a<o;a++,s+=16,t+=16)Ws(r,i,e,t,r,s),a>0&&(i+=16),Ws(r,s,e,t+=16,r,i)}function up(e,t,r){const n=ia({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:o,r:s,p:i,dkLen:a,asyncTick:c,maxmem:u,onProgress:d}=n;if(We(o,"N"),We(s,"r"),We(i,"p"),We(a,"dkLen"),We(c,"asyncTick"),We(u,"maxmem"),d!==void 0&&typeof d!="function")throw new Error("progressCb must be a function");const l=128*s,f=l/4,p=Math.pow(2,32);if(o<=1||(o&o-1)!==0||o>p)throw new Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(i<1||i>(p-1)*32/l)throw new Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(a<1||a>(p-1)*32)throw new Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(l*(o+i)>u)throw new Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+u);const m=Ja(bn,e,t,{c:1,dkLen:l*i}),y=qn(m),b=qn(new Uint8Array(l*o)),k=qn(new Uint8Array(l));let v=()=>{};if(d){const w=2*o*i,N=Math.max(Math.floor(w/1e4),1);let T=0;v=()=>{T++,d&&(!(T%N)||T===w)&&d(T/w)}}return{N:o,r:s,p:i,dkLen:a,blockSize32:f,V:b,B32:y,B:m,tmp:k,blockMixCb:v,asyncTick:c}}function dp(e,t,r,n,o){const s=Ja(bn,e,r,{c:1,dkLen:t});return _n(r,n,o),s}async function lp(e,t,r){const{N:n,r:o,p:s,dkLen:i,blockSize32:a,V:c,B32:u,B:d,tmp:l,blockMixCb:f,asyncTick:p}=up(e,t,r);Ts(u);for(let h=0;h<s;h++){const m=a*h;for(let b=0;b<a;b++)c[b]=u[m+b];let y=0;await Ss(n-1,p,()=>{to(c,y,c,y+=a,o),f()}),to(c,(n-1)*a,u,m,o),f(),await Ss(n,p,()=>{const b=(u[m+a-16]&n-1)>>>0;for(let k=0;k<a;k++)l[k]=u[m+k]^c[b*a+k];to(l,0,u,m,o),f()})}return Ts(u),dp(e,i,d,c,l)}function Fs(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw new Error(`Unsupported alphabet: ${e}`)}}function Ga(...e){const t=e.map(Fs).join("");if(t.length===0)throw new Error("No valid characters provided for random string generation.");const r=t.length;return(n,...o)=>{if(n<=0)throw new Error("Length must be a positive integer.");let s=t,i=r;o.length>0&&(s=o.map(Fs).join(""),i=s.length);const a=Math.floor(256/i)*i,c=new Uint8Array(n*2),u=c.length;let d="",l=u,f;for(;d.length<n;)l>=u&&(crypto.getRandomValues(c),l=0),f=c[l++],f<a&&(d+=s[f%i]);return d}}function fp(e,t){typeof e=="string"&&(e=new TextEncoder().encode(e)),typeof t=="string"&&(t=new TextEncoder().encode(t));const r=new Uint8Array(e),n=new Uint8Array(t);let o=r.length^n.length;const s=Math.max(r.length,n.length);for(let i=0;i<s;i++)o|=(i<r.length?r[i]:0)^(i<n.length?n[i]:0);return o===0}async function Qa(e,t,r=3600){return await new Yo(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}async function pp(e,t){try{return(await Rt(e,new TextEncoder().encode(t))).payload}catch{return null}}const Ya=new Uint8Array([66,101,116,116,101,114,65,117,116,104,46,106,115,32,71,101,110,101,114,97,116,101,100,32,69,110,99,114,121,112,116,105,111,110,32,75,101,121]),hp=()=>Date.now()/1e3|0,Xa="dir",ec="A256CBC-HS512";async function tc(e,t,r,n=3600){const o=Ea(bn,new TextEncoder().encode(t),new TextEncoder().encode(r),Ya,64),s=await Wa({kty:"oct",k:ve(o)},"sha256");return await new Ff(e).setProtectedHeader({alg:Xa,enc:ec,kid:s}).setIssuedAt().setExpirationTime(hp()+n).setJti(crypto.randomUUID()).encrypt(o)}async function rc(e,t,r){if(!e)return null;try{const{payload:n}=await Hf(e,async({kid:o})=>{const s=Ea(bn,new TextEncoder().encode(t),new TextEncoder().encode(r),Ya,64);if(o===void 0||o===await Wa({kty:"oct",k:ve(s)},"sha256"))return s;throw new Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:[Xa],contentEncryptionAlgorithms:[ec,"A256GCM"]});return n}catch{return null}}const Mt={N:16384,r:16,p:1,dkLen:64};async function nc(e,t){return await lp(e.normalize("NFKC"),t,{N:Mt.N,p:Mt.p,r:Mt.r,dkLen:Mt.dkLen,maxmem:128*Mt.N*Mt.r*2})}const dT=async e=>{const t=en.encode(crypto.getRandomValues(new Uint8Array(16))),r=await nc(e,t);return`${t}:${en.encode(r)}`},lT=async({hash:e,password:t})=>{const[r,n]=e.split(":");if(!r||!n)throw new Y("Invalid password hash");return fp(await nc(t,r),nd(n))},ze=Ga("a-z","0-9","A-Z","-_"),Un=async({key:e,data:t})=>{const r=await An("SHA-256").digest(e),n=kl(t);return Al(wa(va)(new Uint8Array(r)).encrypt(n))},$n=async({key:e,data:t})=>{const r=await An("SHA-256").digest(e),n=El(t),o=wa(va)(new Uint8Array(r));return new TextDecoder().decode(o.decrypt(n))},mp=gl(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]).then(e=>e.AsyncLocalStorage).catch(e=>{if("AsyncLocalStorage"in globalThis)return globalThis.AsyncLocalStorage;throw console.warn("[better-auth] Warning: AsyncLocalStorage is not available in this environment. Some features may not work as expected."),console.warn("[better-auth] Please read more about this warning at https://better-auth.com/docs/installation#mount-handler"),console.warn("[better-auth] If you are using Cloudflare Workers, please see: https://developers.cloudflare.com/workers/configuration/compatibility-flags/#nodejs-compatibility-flag"),e});async function Xo(){return mp}let ro=null;const oc=async()=>(ro||(ro=new(await Xo())),ro);async function sc(){const e=(await oc()).getStore();if(!e)throw new Error("No auth context found. Please make sure you are calling this function within a `runWithEndpointContext` callback.");return e}async function So(e,t){return(await oc()).run(e,t)}let no=null;const es=async()=>(no||(no=new(await Xo())),no);async function gp(){return(await es()).getStore()!==void 0}async function Js(){const e=(await es()).getStore();if(!e)throw new Error("No request state found. Please make sure you are calling this function within a `runWithRequestState` callback.");return e}async function yp(e,t){return(await es()).run(e,t)}function wp(e){const t=Object.freeze({});return{get ref(){return t},async get(){const r=await Js();if(!r.has(t)){const n=await e();return r.set(t,n),n}return r.get(t)},async set(r){(await Js()).set(t,r)}}}let oo=null;const ts=async()=>(oo||(oo=new(await Xo())),oo),fT=async e=>ts().then(t=>t.getStore()||e).catch(()=>e),pT=async(e,t)=>{let r=!0;return ts().then(n=>(r=!0,n.run(e,t))).catch(n=>{if(!r)return t();throw n})},_p=async(e,t)=>{let r=!0;return ts().then(n=>(r=!0,e.transaction(async o=>n.run(o,t)))).catch(n=>{if(!r)return t();throw n})},tn=(()=>{const e=function(){};return e.prototype=Object.create(null),Object.freeze(e.prototype),e})();function Gs(){return{root:{key:""},static:new tn}}function rs(e){const[t,...r]=e.split("/");return r[r.length-1]===""?r.slice(0,-1):r}function ic(e,t){const r=new tn;for(const[n,o]of t){const s=n<0?e.slice(-(n+1)).join("/"):e[n];if(typeof o=="string")r[o]=s;else{const i=s.match(o);if(i)for(const a in i.groups)r[a]=i.groups[a]}}return r}function Qs(e,t="",r,n){t=t.toUpperCase(),r.charCodeAt(0)!==47&&(r=`/${r}`),r=r.replace(/\\:/g,"%3A");const o=rs(r);let s=e.root,i=0;const a=[],c=[];for(let d=0;d<o.length;d++){let l=o[d];if(l.startsWith("**")){s.wildcard||(s.wildcard={key:"**"}),s=s.wildcard,a.push([-(d+1),l.split(":")[1]||"_",l.length===2]);break}if(l==="*"||l.includes(":")){if(s.param||(s.param={key:"*"}),s=s.param,l==="*")a.push([d,`_${i++}`,!0]);else if(l.includes(":",1)){const p=bp(l);c[d]=p,s.hasRegexParam=!0,a.push([d,p,!1])}else a.push([d,l.slice(1),!1]);continue}l==="\\*"?l=o[d]="*":l==="\\*\\*"&&(l=o[d]="**");const f=s.static?.[l];if(f)s=f;else{const p={key:l};s.static||(s.static=new tn),s.static[l]=p,s=p}}const u=a.length>0;s.methods||(s.methods=new tn),s.methods[t]??=[],s.methods[t].push({data:n||null,paramsRegexp:c,paramsMap:u?a:void 0}),u||(e.static["/"+o.join("/")]=s)}function bp(e){const t=e.replace(/:(\w+)/g,(r,n)=>`(?<${n}>[^/]+)`).replace(/\./g,"\\.");return new RegExp(`^${t}$`)}function vp(e,t="",r,n){r.charCodeAt(r.length-1)===47&&(r=r.slice(0,-1));const o=e.static[r];if(o&&o.methods){const a=o.methods[t]||o.methods[""];if(a!==void 0)return a[0]}const s=rs(r),i=Io(e,e.root,t,s,0)?.[0];if(i!==void 0)return{data:i.data,params:i.paramsMap?ic(s,i.paramsMap):void 0}}function Io(e,t,r,n,o){if(o===n.length){if(t.methods){const i=t.methods[r]||t.methods[""];if(i)return i}if(t.param&&t.param.methods){const i=t.param.methods[r]||t.param.methods[""];if(i){const a=i[0].paramsMap;if(a?.[a?.length-1]?.[2])return i}}if(t.wildcard&&t.wildcard.methods){const i=t.wildcard.methods[r]||t.wildcard.methods[""];if(i){const a=i[0].paramsMap;if(a?.[a?.length-1]?.[2])return i}}return}const s=n[o];if(t.static){const i=t.static[s];if(i){const a=Io(e,i,r,n,o+1);if(a)return a}}if(t.param){const i=Io(e,t.param,r,n,o+1);if(i){if(t.param.hasRegexParam){const a=i.find(c=>c.paramsRegexp[o]?.test(s))||i.find(c=>!c.paramsRegexp[o]);return a?[a]:void 0}return i}}if(t.wildcard&&t.wildcard.methods)return t.wildcard.methods[r]||t.wildcard.methods[""]}function Ap(e,t="",r,n){r.charCodeAt(r.length-1)===47&&(r=r.slice(0,-1));const o=rs(r);return Ro(e,e.root,t,o,0).map(i=>({data:i.data,params:i.paramsMap?ic(o,i.paramsMap):void 0}))}function Ro(e,t,r,n,o,s=[]){const i=n[o];if(t.wildcard&&t.wildcard.methods){const c=t.wildcard.methods[r]||t.wildcard.methods[""];c&&s.push(...c)}if(t.param&&(Ro(e,t.param,r,n,o+1,s),o===n.length&&t.param.methods)){const c=t.param.methods[r]||t.param.methods[""];if(c){const u=c[0].paramsMap;u?.[u?.length-1]?.[2]&&s.push(...c)}}const a=t.static?.[i];if(a&&Ro(e,a,r,n,o+1,s),o===n.length&&t.methods){const c=t.methods[r]||t.methods[""];c&&s.push(...c)}return s}function Ep(){const e=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return e===void 0?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(e,"writable")?e.writable:e.set!==void 0}function kp(e){const t=e.split(`
    at `);return t.length<=1?e:(t.splice(1,1),t.join(`
    at `))}function Tp(e,t){class r extends e{#e;constructor(...o){if(Ep()){const i=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...o),Error.stackTraceLimit=i}else super(...o);const s=new Error().stack;s&&(this.#e=kp(s.replace(/^Error/,this.name)))}get errorStack(){return this.#e}}return Object.defineProperty(r.prototype,"constructor",{get(){return t},enumerable:!1,configurable:!0}),r}const Sp={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511};var ac=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t=void 0,r={},n=typeof e=="number"?e:Sp[e]){super(t?.message,t?.cause?{cause:t.cause}:void 0),this.status=e,this.body=t,this.headers=r,this.statusCode=n,this.name="APIError",this.status=e,this.headers=r,this.statusCode=n,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0}},cc=class extends ac{constructor(t,r){super(400,{message:t,code:"VALIDATION_ERROR"}),this.message=t,this.issues=r,this.issues=r}},Ip=class extends Error{constructor(e){super(e),this.name="BetterCallError"}};const g=Tp(ac,Error),Rp=/^application\/([a-z0-9.+-]*\+)?json/i;async function Up(e,t){const r=e.headers.get("content-type")||"",n=r.toLowerCase();if(e.body){if(t&&t.length>0&&!t.some(o=>{const s=n.split(";")[0].trim(),i=o.toLowerCase().trim();return s===i||s.includes(i)}))throw n?new g(415,{message:`Content-Type "${r}" is not allowed. Allowed types: ${t.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"}):new g(415,{message:`Content-Type is required. Allowed types: ${t.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"});if(Rp.test(n))return await e.json();if(n.includes("application/x-www-form-urlencoded")){const o=await e.formData(),s={};return o.forEach((i,a)=>{s[a]=i.toString()}),s}if(n.includes("multipart/form-data")){const o=await e.formData(),s={};return o.forEach((i,a)=>{s[a]=i}),s}return n.includes("text/plain")?await e.text():n.includes("application/octet-stream")?await e.arrayBuffer():n.includes("application/pdf")||n.includes("image/")||n.includes("video/")?await e.blob():n.includes("application/stream")||e.body instanceof ReadableStream?e.body:await e.text()}}function rn(e){return e instanceof g||e?.name==="APIError"}function $p(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}async function Cp(e){try{return{data:await e,error:null}}catch(t){return{data:null,error:t}}}function Op(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Pp(e,t,r){let n=0;const o=new WeakMap;return JSON.stringify(e,(i,a)=>{if(typeof a=="bigint")return a.toString();if(typeof a=="object"&&a!==null){if(o.has(a))return`[Circular ref-${o.get(a)}]`;o.set(a,n++)}return a},r)}function Dp(e){return!e||typeof e!="object"?!1:"_flag"in e&&e._flag==="json"}function kt(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach((o,s)=>{e.headers.set(s,o)}),e;if(Dp(e)){const o=e.body,s=e.routerResponse;if(s instanceof Response)return s;const i=new Headers;if(s?.headers){const a=new Headers(s.headers);for(const[c,u]of a.entries())a.set(c,u)}if(e.headers)for(const[a,c]of new Headers(e.headers).entries())i.set(a,c);if(t?.headers)for(const[a,c]of new Headers(t.headers).entries())i.set(a,c);return i.set("Content-Type","application/json"),new Response(JSON.stringify(o),{...s,headers:i,status:e.status??t?.status??s?.status,statusText:t?.statusText??s?.statusText})}if(rn(e))return kt(e.body,{status:t?.status??e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let r=e,n=new Headers(t?.headers);return e?typeof e=="string"?(r=e,n.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(r=e,n.set("Content-Type","application/octet-stream")):e instanceof Blob?(r=e,n.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?r=e:e instanceof URLSearchParams?(r=e,n.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(r=e,n.set("Content-Type","application/octet-stream")):Op(e)&&(r=Pp(e),n.set("Content-Type","application/json")):(e===null&&(r=JSON.stringify(null)),n.set("content-type","application/json")),new Response(r,{...t,headers:n})}async function zp(e,t={}){let r={body:t.body,query:t.query};if(e.body){const n=await e.body["~standard"].validate(t.body);if(n.issues)return{data:null,error:Ys(n.issues,"body")};r.body=n.value}if(e.query){const n=await e.query["~standard"].validate(t.query);if(n.issues)return{data:null,error:Ys(n.issues,"query")};r.query=n.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required",issues:[]}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required",issues:[]}}:{data:r,error:null}}function Ys(e,t){return{message:e.map(r=>`[${r.path?.length?`${t}.`+r.path.map(n=>typeof n=="object"?n.key:n).join("."):t}] ${r.message}`).join("; "),issues:e}}const ns={name:"HMAC",hash:"SHA-256"},uc=async e=>{const t=typeof e=="string"?new TextEncoder().encode(e):e;return await Et().importKey("raw",t,ns,!1,["sign","verify"])},xp=async(e,t,r)=>{try{const n=atob(e),o=new Uint8Array(n.length);for(let s=0,i=n.length;s<i;s++)o[s]=n.charCodeAt(s);return await Et().verify(ns,r,o,new TextEncoder().encode(t))}catch{return!1}},Lp=async(e,t)=>{const r=await uc(t),n=await Et().sign(ns.name,r,new TextEncoder().encode(e));return btoa(String.fromCharCode(...new Uint8Array(n)))},Np=async(e,t)=>{const r=await Lp(e,t);return e=`${e}.${r}`,e=encodeURIComponent(e),e},Xs=(e,t)=>{let r=e;if(t)if(t==="secure")r="__Secure-"+e;else if(t==="host")r="__Host-"+e;else return;return r};function Zp(e){if(typeof e!="string")throw new TypeError("argument str must be a string");const t=new Map;let r=0;for(;r<e.length;){const n=e.indexOf("=",r);if(n===-1)break;let o=e.indexOf(";",r);if(o===-1)o=e.length;else if(o<n){r=e.lastIndexOf(";",n-1)+1;continue}const s=e.slice(r,n).trim();if(!t.has(s)){let i=e.slice(n+1,o).trim();i.codePointAt(0)===34&&(i=i.slice(1,-1)),t.set(s,$p(i))}r=o+1}return t}const dc=(e,t,r={})=>{let n;if(r?.prefix==="secure"?n=`${`__Secure-${e}`}=${t}`:r?.prefix==="host"?n=`${`__Host-${e}`}=${t}`:n=`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),r.path!=="/"&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&typeof r.maxAge=="number"&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");n+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&r.prefix!=="host"&&(n+=`; Domain=${r.domain}`),r.path&&(n+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");n+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite&&(n+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),n+="; Partitioned"),n},jp=(e,t,r)=>(t=encodeURIComponent(t),dc(e,t,r)),Mp=async(e,t,r,n)=>(t=await Np(t,r),dc(e,t,n)),lc=async(e,{options:t,path:r})=>{const n=new Headers;let o;const{data:s,error:i}=await zp(t,e);if(i)throw new cc(i.message,i.issues);const a="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,c=a?.get("cookie"),u=c?Zp(c):void 0,d={...e,body:s.body,query:s.query,path:e.path||r||"virtual:",context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(l,f)=>{n.set(l,f)},getHeader:l=>a?a.get(l):null,getCookie:(l,f)=>{const p=Xs(l,f);return p&&u?.get(p)||null},getSignedCookie:async(l,f,p)=>{const h=Xs(l,p);if(!h)return null;const m=u?.get(h);if(!m)return null;const y=m.lastIndexOf(".");if(y<1)return null;const b=m.substring(0,y),k=m.substring(y+1);return k.length!==44||!k.endsWith("=")?null:await xp(k,b,await uc(f))?b:!1},setCookie:(l,f,p)=>{const h=jp(l,f,p);return n.append("set-cookie",h),h},setSignedCookie:async(l,f,p,h)=>{const m=await Mp(l,f,p,h);return n.append("set-cookie",m),m},redirect:l=>(n.set("location",l),new g("FOUND",void 0,n)),error:(l,f,p)=>new g(l,f,p),setStatus:l=>{o=l},json:(l,f)=>e.asResponse?{body:f?.body||l,routerResponse:f,_flag:"json"}:l,responseHeaders:n,get responseStatus(){return o}};for(const l of t.use||[]){const f=await l({...d,returnHeaders:!0,asResponse:!1});f.response&&Object.assign(d.context,f.response),f.headers&&f.headers.forEach((p,h)=>{d.responseHeaders.set(h,p)})}return d};function nn(e,t,r){const n=typeof e=="string"?e:void 0,o=typeof t=="object"?t:e,s=typeof t=="function"?t:r;if((o.method==="GET"||o.method==="HEAD")&&o.body)throw new Ip("Body is not allowed with GET or HEAD methods");const i=async(...a)=>{const c=a[0]||{},{data:u,error:d}=await Cp(lc(c,{options:o,path:n}));if(d)throw d instanceof cc?(o.onValidationError&&await o.onValidationError({message:d.message,issues:d.issues}),new g(400,{message:d.message,code:"VALIDATION_ERROR"})):d;const l=await s(u).catch(async h=>{if(rn(h)){const m=o.onAPIError;if(m&&await m(h),c.asResponse)return h}throw h}),f=u.responseHeaders,p=u.responseStatus;return c.asResponse?kt(l,{headers:f,status:p}):c.returnHeaders?c.returnStatus?{headers:f,response:l,status:p}:{headers:f,response:l}:c.returnStatus?{response:l,status:p}:l};return i.options=o,i.path=n,i}nn.create=e=>(t,r,n)=>nn(t,{...r,use:[...r?.use||[],...e?.use||[]]},n);function Jt(e,t){const r=async n=>{const o=n,s=typeof e=="function"?e:t,i=await lc(o,{options:typeof e=="function"?{}:e,path:"/"});if(!s)throw new Error("handler must be defined");const a=await s(i),c=i.responseHeaders;return o.returnHeaders?{headers:c,response:a}:a};return r.options=typeof e=="function"?{}:e,r}Jt.create=e=>{function t(r,n){if(typeof r=="function")return Jt({use:e?.use},r);if(!n)throw new Error("Middleware handler is required");return Jt({...r,method:"*",use:[...e?.use||[],...r.use||[]]},n)}return t};const so={};function fc(e){switch(e.constructor.name){case"ZodString":return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array";default:return"string"}}function ei(e){const t=[];return e.metadata?.openapi?.parameters?(t.push(...e.metadata.openapi.parameters),t):(e.query instanceof Br&&Object.entries(e.query.shape).forEach(([r,n])=>{n instanceof Br&&t.push({name:r,in:"query",schema:{type:fc(n),..."minLength"in n&&n.minLength?{minLength:n.minLength}:{},description:n.description}})}),t)}function Kp(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof Br||e.body instanceof Vn)){const t=e.body.shape;if(!t)return;const r={},n=[];return Object.entries(t).forEach(([o,s])=>{s instanceof Br&&(r[o]={type:fc(s),description:s.description},s instanceof Vn||n.push(o))}),{required:e.body instanceof Vn?!1:!!e.body,content:{"application/json":{schema:{type:"object",properties:r,required:n}}}}}}function ti(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function Hp(e,t){const r={schemas:{}};return Object.entries(e).forEach(([n,o])=>{const s=o.options;if(!(!o.path||s.metadata?.SERVER_ONLY)&&(s.method==="GET"&&(so[o.path]={get:{tags:["Default",...s.metadata?.openapi?.tags||[]],description:s.metadata?.openapi?.description,operationId:s.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ei(s),responses:ti(s.metadata?.openapi?.responses)}}),s.method==="POST")){const i=Kp(s);so[o.path]={post:{tags:["Default",...s.metadata?.openapi?.tags||[]],description:s.metadata?.openapi?.description,operationId:s.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ei(s),...i?{requestBody:i}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:ti(s.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:r,security:[{apiKeyCookie:[]}],servers:[{url:t?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:so}}const qp=(e,t)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    <\/script>
	 <script>
      var configuration = {
	  	favicon: ${t?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(t.logo)}`:void 0} ,
	   	theme: ${t?.theme||"saturn"},
        metaData: {
			title: ${t?.title||"Open API Reference"},
			description: ${t?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    <\/script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"><\/script>
  </body>
</html>`,Vp=(e,t)=>{if(!t?.openapi?.disabled){const s={path:"/api/reference",...t?.openapi};e.openapi=nn(s.path,{method:"GET"},async i=>{const a=await Hp(e);return new Response(qp(a,s.scalar),{headers:{"Content-Type":"text/html"}})})}const r=Gs(),n=Gs();for(const s of Object.values(e)){if(!s.options||!s.path||s.options?.metadata?.SERVER_ONLY)continue;const i=Array.isArray(s.options?.method)?s.options.method:[s.options?.method];for(const a of i)Qs(r,a,s.path,s)}if(t?.routerMiddleware?.length)for(const{path:s,middleware:i}of t.routerMiddleware)Qs(n,"*",s,i);const o=async s=>{const i=new URL(s.url),a=t?.basePath?i.pathname.split(t.basePath).reduce((l,f,p)=>(p!==0&&(p>1?l.push(`${t.basePath}${f}`):l.push(f)),l),[]).join(""):i.pathname;if(!a?.length)return new Response(null,{status:404,statusText:"Not Found"});const c=vp(r,s.method,a);if(!c?.data)return new Response(null,{status:404,statusText:"Not Found"});const u={};i.searchParams.forEach((l,f)=>{f in u?Array.isArray(u[f])?u[f].push(l):u[f]=[u[f],l]:u[f]=l});const d=c.data;try{const l=d.options.metadata?.allowedMediaTypes||t?.allowedMediaTypes,f={path:a,method:s.method,headers:s.headers,params:c.params?JSON.parse(JSON.stringify(c.params)):{},request:s,body:d.options.disableBody?void 0:await Up(d.options.cloneRequest?s.clone():s,l),query:u,_flag:"router",asResponse:!0,context:t?.routerContext},p=Ap(n,"*",a);if(p?.length)for(const{data:h,params:m}of p){const y=await h({...f,params:m,asResponse:!1});if(y instanceof Response)return y}return await d(f)}catch(l){if(t?.onError)try{const f=await t.onError(l);if(f instanceof Response)return kt(f)}catch(f){if(rn(f))return kt(f);throw f}if(t?.throwError)throw l;return rn(l)?kt(l):(console.error("# SERVER_ERROR: ",l),new Response(null,{status:500,statusText:"Internal Server Error"}))}};return{handler:async s=>{const i=await t?.onRequest?.(s);if(i instanceof Response)return i;const a=await o(i instanceof Request?i:s),c=await t?.onResponse?.(a);return c instanceof Response?c:a},endpoints:e}};function A(e,t,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(e),t(a,c);for(const d in i.prototype)d in a||Object.defineProperty(a,d,{value:i.prototype[d].bind(a)});a._zod.constr=i,a._zod.def=c}const o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}let Gt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},pc=class extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}};const hc={};function ft(e){return hc}function Bp(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,o])=>t.indexOf(+n)===-1).map(([n,o])=>o)}function Uo(e,t){return typeof t=="bigint"?t.toString():t}function os(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ss(e){return e==null}function is(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Wp(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}const s=r>o?r:o,i=Number.parseInt(e.toFixed(s).replace(".","")),a=Number.parseInt(t.toFixed(s).replace(".",""));return i%a/10**s}const ri=Symbol("evaluating");function se(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==ri)return n===void 0&&(n=ri,n=r()),n},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function Ut(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function $t(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function ni(e){return JSON.stringify(e)}const mc="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function on(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Fp=os(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Xt(e){if(on(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(on(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function gc(e){return Xt(e)?{...e}:Array.isArray(e)?[...e]:e}const Jp=new Set(["string","number","symbol"]);function Cn(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function mt(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function $(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Gp(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Qp={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Yp(e,t){const r=e._zod.def,n=$t(e._zod.def,{get shape(){const o={};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(o[s]=r.shape[s])}return Ut(this,"shape",o),o},checks:[]});return mt(e,n)}function Xp(e,t){const r=e._zod.def,n=$t(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete o[s]}return Ut(this,"shape",o),o},checks:[]});return mt(e,n)}function eh(e,t){if(!Xt(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const o=$t(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return Ut(this,"shape",s),s},checks:[]});return mt(e,o)}function th(e,t){if(!Xt(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Ut(this,"shape",n),n},checks:e._zod.def.checks};return mt(e,r)}function rh(e,t){const r=$t(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Ut(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return mt(e,r)}function nh(e,t,r){const n=$t(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)s[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return Ut(this,"shape",s),s},checks:[]});return mt(t,n)}function oh(e,t,r){const n=$t(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return Ut(this,"shape",s),s},checks:[]});return mt(t,n)}function Vt(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function Bt(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Ir(e){return typeof e=="string"?e:e?.message}function pt(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const o=Ir(e.inst?._zod.def?.error?.(e))??Ir(t?.error?.(e))??Ir(r.customError?.(e))??Ir(r.localeError?.(e))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function as(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function pr(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const yc=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Uo,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},wc=A("$ZodError",yc),_c=A("$ZodError",yc,{Parent:Error});function sh(e,t=r=>r.message){const r={},n=[];for(const o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}}function ih(e,t=r=>r.message){const r={_errors:[]},n=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>n({issues:i}));else if(s.code==="invalid_key")n({issues:s.issues});else if(s.code==="invalid_element")n({issues:s.issues});else if(s.path.length===0)r._errors.push(t(s));else{let i=r,a=0;for(;a<s.path.length;){const c=s.path[a];a===s.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(s))):i[c]=i[c]||{_errors:[]},i=i[c],a++}}};return n(e),r}const cs=e=>(t,r,n,o)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Gt;if(i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>pt(c,s,ft())));throw mc(a,o?.callee),a}return i.value},us=e=>async(t,r,n,o)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>pt(c,s,ft())));throw mc(a,o?.callee),a}return i.value},On=e=>(t,r,n)=>{const o=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Gt;return s.issues.length?{success:!1,error:new(e??wc)(s.issues.map(i=>pt(i,o,ft())))}:{success:!0,data:s.value}},ah=On(_c),Pn=e=>async(t,r,n)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>pt(i,o,ft())))}:{success:!0,data:s.value}},ch=Pn(_c),uh=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return cs(e)(t,r,o)},dh=e=>(t,r,n)=>cs(e)(t,r,n),lh=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return us(e)(t,r,o)},fh=e=>async(t,r,n)=>us(e)(t,r,n),ph=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return On(e)(t,r,o)},hh=e=>(t,r,n)=>On(e)(t,r,n),mh=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Pn(e)(t,r,o)},gh=e=>async(t,r,n)=>Pn(e)(t,r,n),yh=/^[cC][^\s-]{8,}$/,wh=/^[0-9a-z]+$/,_h=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,bh=/^[0-9a-vA-V]{20}$/,vh=/^[A-Za-z0-9]{27}$/,Ah=/^[a-zA-Z0-9_-]{21}$/,Eh=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,kh=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,oi=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Th=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Sh="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Ih(){return new RegExp(Sh,"u")}const Rh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Uh=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,$h=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Ch=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Oh=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,bc=/^[A-Za-z0-9_-]*$/,Ph=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,Dh=/^\+(?:[0-9]){6,14}[0-9]$/,vc="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",zh=new RegExp(`^${vc}$`);function Ac(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function xh(e){return new RegExp(`^${Ac(e)}$`)}function Lh(e){const t=Ac({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${vc}T(?:${n})$`)}const Nh=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Zh=/^-?\d+$/,jh=/^-?\d+(?:\.\d+)?/,Mh=/^(?:true|false)$/i,Kh=/^undefined$/i,Hh=/^[^A-Z]*$/,qh=/^[^a-z]*$/,Ie=A("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Ec={number:"number",bigint:"bigint",object:"date"},kc=A("$ZodCheckLessThan",(e,t)=>{Ie.init(e,t);const r=Ec[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Tc=A("$ZodCheckGreaterThan",(e,t)=>{Ie.init(e,t);const r=Ec[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Vh=A("$ZodCheckMultipleOf",(e,t)=>{Ie.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Wp(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Bh=A("$ZodCheckNumberFormat",(e,t)=>{Ie.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[o,s]=Qp[t.format];e._zod.onattach.push(i=>{const a=i._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,r&&(a.pattern=Zh)}),e._zod.check=i=>{const a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:e})}}),Wh=A("$ZodCheckMaxLength",(e,t)=>{var r;Ie.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ss(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const o=n.value;if(o.length<=t.maximum)return;const i=as(o);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),Fh=A("$ZodCheckMinLength",(e,t)=>{var r;Ie.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ss(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const o=n.value;if(o.length>=t.minimum)return;const i=as(o);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),Jh=A("$ZodCheckLengthEquals",(e,t)=>{var r;Ie.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ss(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=n=>{const o=n.value,s=o.length;if(s===t.length)return;const i=as(o),a=s>t.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Dn=A("$ZodCheckStringFormat",(e,t)=>{var r,n;Ie.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),Gh=A("$ZodCheckRegex",(e,t)=>{Dn.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Qh=A("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Hh),Dn.init(e,t)}),Yh=A("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=qh),Dn.init(e,t)}),Xh=A("$ZodCheckIncludes",(e,t)=>{Ie.init(e,t);const r=Cn(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),em=A("$ZodCheckStartsWith",(e,t)=>{Ie.init(e,t);const r=new RegExp(`^${Cn(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),tm=A("$ZodCheckEndsWith",(e,t)=>{Ie.init(e,t);const r=new RegExp(`.*${Cn(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),rm=A("$ZodCheckOverwrite",(e,t)=>{Ie.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});let nm=class{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...r,o.join(`
`))}};const om={major:4,minor:1,patch:12},ae=A("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=om;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const o of n)for(const s of o._zod.onattach)s(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,a,c)=>{let u=Vt(i),d;for(const l of a){if(l._zod.def.when){if(!l._zod.def.when(i))continue}else if(u)continue;const f=i.issues.length,p=l._zod.check(i);if(p instanceof Promise&&c?.async===!1)throw new Gt;if(d||p instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await p,i.issues.length!==f&&(u||(u=Vt(i,f)))});else{if(i.issues.length===f)continue;u||(u=Vt(i,f))}}return d?d.then(()=>i):i},s=(i,a,c)=>{if(Vt(i))return i.aborted=!0,i;const u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new Gt;return u.then(d=>e._zod.parse(d,c))}return e._zod.parse(u,c)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(d=>s(d,i,a)):s(u,i,a)}const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new Gt;return c.then(u=>o(u,n,a))}return o(c,n,a)}}e["~standard"]={validate:o=>{try{const s=ah(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return ch(e,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),ds=A("$ZodString",(e,t)=>{ae.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Nh(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),ce=A("$ZodStringFormat",(e,t)=>{Dn.init(e,t),ds.init(e,t)}),sm=A("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=kh),ce.init(e,t)}),im=A("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=oi(n))}else t.pattern??(t.pattern=oi());ce.init(e,t)}),am=A("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Th),ce.init(e,t)}),cm=A("$ZodURL",(e,t)=>{ce.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),o=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Ph.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),um=A("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Ih()),ce.init(e,t)}),dm=A("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Ah),ce.init(e,t)}),lm=A("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=yh),ce.init(e,t)}),fm=A("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=wh),ce.init(e,t)}),pm=A("$ZodULID",(e,t)=>{t.pattern??(t.pattern=_h),ce.init(e,t)}),hm=A("$ZodXID",(e,t)=>{t.pattern??(t.pattern=bh),ce.init(e,t)}),mm=A("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=vh),ce.init(e,t)}),gm=A("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Lh(t)),ce.init(e,t)}),ym=A("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=zh),ce.init(e,t)}),wm=A("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=xh(t)),ce.init(e,t)}),_m=A("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Eh),ce.init(e,t)}),bm=A("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Rh),ce.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),vm=A("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Uh),ce.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),Am=A("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=$h),ce.init(e,t)}),Em=A("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Ch),ce.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[o,s]=n;if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Sc(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const km=A("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Oh),ce.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Sc(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function Tm(e){if(!bc.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Sc(r)}const Sm=A("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=bc),ce.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Tm(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),Im=A("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Dh),ce.init(e,t)});function Rm(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const Um=A("$ZodJWT",(e,t)=>{ce.init(e,t),e._zod.check=r=>{Rm(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Ic=A("$ZodNumber",(e,t)=>{ae.init(e,t),e._zod.pattern=e._zod.bag.pattern??jh,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),r}}),$m=A("$ZodNumber",(e,t)=>{Bh.init(e,t),Ic.init(e,t)}),Cm=A("$ZodBoolean",(e,t)=>{ae.init(e,t),e._zod.pattern=Mh,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),r}}),Om=A("$ZodUndefined",(e,t)=>{ae.init(e,t),e._zod.pattern=Kh,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(r,n)=>{const o=r.value;return typeof o>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:o,inst:e}),r}}),Pm=A("$ZodAny",(e,t)=>{ae.init(e,t),e._zod.parse=r=>r}),Dm=A("$ZodUnknown",(e,t)=>{ae.init(e,t),e._zod.parse=r=>r}),zm=A("$ZodNever",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),xm=A("$ZodDate",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const o=r.value,s=o instanceof Date;return s&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...s?{received:"Invalid Date"}:{},inst:e}),r}});function si(e,t,r){e.issues.length&&t.issues.push(...Bt(r,e.issues)),t.value[r]=e.value}const Lm=A("$ZodArray",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),r;r.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>si(u,r,i))):si(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function sn(e,t,r,n){e.issues.length&&t.issues.push(...Bt(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function Rc(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=Gp(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function Uc(e,t,r,n,o,s){const i=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(const d of Object.keys(t)){if(a.has(d))continue;if(u==="never"){i.push(d);continue}const l=c.run({value:t[d],issues:[]},n);l instanceof Promise?e.push(l.then(f=>sn(f,r,d,t))):sn(l,r,d,t)}return i.length&&r.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:s}),e.length?Promise.all(e).then(()=>r):r}const Nm=A("$ZodObject",(e,t)=>{if(ae.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=os(()=>Rc(t));se(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const d=a[u]._zod;if(d.values){c[u]??(c[u]=new Set);for(const l of d.values)c[u].add(l)}}return c});const o=on,s=t.catchall;let i;e._zod.parse=(a,c)=>{i??(i=n.value);const u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const d=[],l=i.shape;for(const f of i.keys){const h=l[f]._zod.run({value:u[f],issues:[]},c);h instanceof Promise?d.push(h.then(m=>sn(m,a,f,u))):sn(h,a,f,u)}return s?Uc(d,u,a,c,n.value,e):d.length?Promise.all(d).then(()=>a):a}}),Zm=A("$ZodObjectJIT",(e,t)=>{Nm.init(e,t);const r=e._zod.parse,n=os(()=>Rc(t)),o=f=>{const p=new nm(["shape","payload","ctx"]),h=n.value,m=v=>{const w=ni(v);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};p.write("const input = payload.value;");const y=Object.create(null);let b=0;for(const v of h.keys)y[v]=`key_${b++}`;p.write("const newResult = {};");for(const v of h.keys){const w=y[v],N=ni(v);p.write(`const ${w} = ${m(v)};`),p.write(`
        if (${w}.issues.length) {
          payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${N}, ...iss.path] : [${N}]
          })));
        }
        
        
        if (${w}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${w}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const k=p.compile();return(v,w)=>k(f,v,w)};let s;const i=on,a=!hc.jitless,u=a&&Fp.value,d=t.catchall;let l;e._zod.parse=(f,p)=>{l??(l=n.value);const h=f.value;return i(h)?a&&u&&p?.async===!1&&p.jitless!==!0?(s||(s=o(t.shape)),f=s(f,p),d?Uc([],h,f,p,l,e):f):r(f,p):(f.issues.push({expected:"object",code:"invalid_type",input:h,inst:e}),f)}});function ii(e,t,r,n){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!Vt(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(s=>s.issues.map(i=>pt(i,n,ft())))}),t)}const jm=A("$ZodUnion",(e,t)=>{ae.init(e,t),se(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),se(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),se(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),se(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${o.map(s=>is(s.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(o,s)=>{if(r)return n(o,s);let i=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:o.value,issues:[]},s);if(u instanceof Promise)a.push(u),i=!0;else{if(u.issues.length===0)return u;a.push(u)}}return i?Promise.all(a).then(c=>ii(c,o,e,s)):ii(a,o,e,s)}}),Mm=A("$ZodIntersection",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>{const o=r.value,s=t.left._zod.run({value:o,issues:[]},n),i=t.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>ai(r,c,u)):ai(r,s,i)}});function $o(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Xt(e)&&Xt(t)){const r=Object.keys(t),n=Object.keys(e).filter(s=>r.indexOf(s)!==-1),o={...e,...t};for(const s of n){const i=$o(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=t[n],i=$o(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function ai(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),Vt(e))return e;const n=$o(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const Km=A("$ZodRecord",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Xt(o))return r.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),r;const s=[];if(t.keyType._zod.values){const i=t.keyType._zod.values;r.value={};for(const c of i)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=t.valueType._zod.run({value:o[c],issues:[]},n);u instanceof Promise?s.push(u.then(d=>{d.issues.length&&r.issues.push(...Bt(c,d.issues)),r.value[c]=d.value})):(u.issues.length&&r.issues.push(...Bt(c,u.issues)),r.value[c]=u.value)}let a;for(const c in o)i.has(c)||(a=a??[],a.push(c));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:a})}else{r.value={};for(const i of Reflect.ownKeys(o)){if(i==="__proto__")continue;const a=t.keyType._zod.run({value:i,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(u=>pt(u,n,ft())),input:i,path:[i],inst:e}),r.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:o[i],issues:[]},n);c instanceof Promise?s.push(c.then(u=>{u.issues.length&&r.issues.push(...Bt(i,u.issues)),r.value[a.value]=u.value})):(c.issues.length&&r.issues.push(...Bt(i,c.issues)),r.value[a.value]=c.value)}}return s.length?Promise.all(s).then(()=>r):r}}),Hm=A("$ZodEnum",(e,t)=>{ae.init(e,t);const r=Bp(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(o=>Jp.has(typeof o)).map(o=>typeof o=="string"?Cn(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return n.has(i)||o.issues.push({code:"invalid_value",values:r,input:i,inst:e}),o}}),qm=A("$ZodTransform",(e,t)=>{ae.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new pc(e.constructor.name);const o=t.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Gt;return r.value=o,r}});function ci(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Vm=A("$ZodOptional",(e,t)=>{ae.init(e,t),e._zod.optin="optional",e._zod.optout="optional",se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),se(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${is(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>ci(s,r.value)):ci(o,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),Bm=A("$ZodNullable",(e,t)=>{ae.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${is(r.source)}|null)$`):void 0}),se(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Wm=A("$ZodDefault",(e,t)=>{ae.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>ui(s,t)):ui(o,t)}});function ui(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Fm=A("$ZodPrefault",(e,t)=>{ae.init(e,t),e._zod.optin="optional",se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Jm=A("$ZodNonOptional",(e,t)=>{ae.init(e,t),se(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>di(s,e)):di(o,e)}});function di(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Gm=A("$ZodCatch",(e,t)=>{ae.init(e,t),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),se(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>pt(i,n,ft()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>pt(s,n,ft()))},input:r.value}),r.issues=[]),r)}}),Qm=A("$ZodPipe",(e,t)=>{ae.init(e,t),se(e._zod,"values",()=>t.in._zod.values),se(e._zod,"optin",()=>t.in._zod.optin),se(e._zod,"optout",()=>t.out._zod.optout),se(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const s=t.out._zod.run(r,n);return s instanceof Promise?s.then(i=>Rr(i,t.in,n)):Rr(s,t.in,n)}const o=t.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Rr(s,t.out,n)):Rr(o,t.out,n)}});function Rr(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const Ym=A("$ZodReadonly",(e,t)=>{ae.init(e,t),se(e._zod,"propValues",()=>t.innerType._zod.propValues),se(e._zod,"values",()=>t.innerType._zod.values),se(e._zod,"optin",()=>t.innerType._zod.optin),se(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(li):li(o)}});function li(e){return e.value=Object.freeze(e.value),e}const Xm=A("$ZodCustom",(e,t)=>{Ie.init(e,t),ae.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,o=t.fn(n);if(o instanceof Promise)return o.then(s=>fi(s,r,n,e));fi(o,r,n,e)}});function fi(e,t,r,n){if(!e){const o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),t.issues.push(pr(o))}}let eg=class{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const o={...n,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}};function tg(){return new eg}const Ur=tg();function rg(e,t){return new e({type:"string",...$(t)})}function ng(e,t){return new e({type:"string",coerce:!0,...$(t)})}function $c(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...$(t)})}function pi(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...$(t)})}function og(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...$(t)})}function sg(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...$(t)})}function ig(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...$(t)})}function ag(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...$(t)})}function cg(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...$(t)})}function ug(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...$(t)})}function dg(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...$(t)})}function lg(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...$(t)})}function fg(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...$(t)})}function pg(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...$(t)})}function hg(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...$(t)})}function mg(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...$(t)})}function Cc(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...$(t)})}function Oc(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...$(t)})}function gg(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...$(t)})}function yg(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...$(t)})}function wg(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...$(t)})}function _g(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...$(t)})}function bg(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...$(t)})}function vg(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...$(t)})}function Ag(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...$(t)})}function Eg(e,t){return new e({type:"string",format:"date",check:"string_format",...$(t)})}function kg(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...$(t)})}function Tg(e,t){return new e({type:"string",format:"duration",check:"string_format",...$(t)})}function Sg(e,t){return new e({type:"number",checks:[],...$(t)})}function Ig(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...$(t)})}function Rg(e,t){return new e({type:"boolean",...$(t)})}function Ug(e,t){return new e({type:"boolean",coerce:!0,...$(t)})}function $g(e,t){return new e({type:"undefined",...$(t)})}function Cg(e){return new e({type:"any"})}function Og(e){return new e({type:"unknown"})}function Pg(e,t){return new e({type:"never",...$(t)})}function Dg(e,t){return new e({type:"date",...$(t)})}function hi(e,t){return new kc({check:"less_than",...$(t),value:e,inclusive:!1})}function Kr(e,t){return new kc({check:"less_than",...$(t),value:e,inclusive:!0})}function mi(e,t){return new Tc({check:"greater_than",...$(t),value:e,inclusive:!1})}function Hr(e,t){return new Tc({check:"greater_than",...$(t),value:e,inclusive:!0})}function gi(e,t){return new Vh({check:"multiple_of",...$(t),value:e})}function Pc(e,t){return new Wh({check:"max_length",...$(t),maximum:e})}function an(e,t){return new Fh({check:"min_length",...$(t),minimum:e})}function Dc(e,t){return new Jh({check:"length_equals",...$(t),length:e})}function zg(e,t){return new Gh({check:"string_format",format:"regex",...$(t),pattern:e})}function xg(e){return new Qh({check:"string_format",format:"lowercase",...$(e)})}function Lg(e){return new Yh({check:"string_format",format:"uppercase",...$(e)})}function Ng(e,t){return new Xh({check:"string_format",format:"includes",...$(t),includes:e})}function Zg(e,t){return new em({check:"string_format",format:"starts_with",...$(t),prefix:e})}function jg(e,t){return new tm({check:"string_format",format:"ends_with",...$(t),suffix:e})}function vr(e){return new rm({check:"overwrite",tx:e})}function Mg(e){return vr(t=>t.normalize(e))}function Kg(){return vr(e=>e.trim())}function Hg(){return vr(e=>e.toLowerCase())}function qg(){return vr(e=>e.toUpperCase())}function Vg(e,t,r){return new e({type:"array",element:t,...$(r)})}function Bg(e,t,r){const n=$(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function Wg(e,t,r){return new e({type:"custom",check:"custom",fn:t,...$(r)})}function Fg(e){const t=Jg(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(pr(n,r.value,t._zod.def));else{const o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),r.issues.push(pr(o))}},e(r.value,r)));return t}function Jg(e,t){const r=new Ie({check:"custom",...$(t)});return r._zod.check=e,r}const Gg=A("ZodISODateTime",(e,t)=>{gm.init(e,t),le.init(e,t)});function Qg(e){return Ag(Gg,e)}const Yg=A("ZodISODate",(e,t)=>{ym.init(e,t),le.init(e,t)});function Xg(e){return Eg(Yg,e)}const ey=A("ZodISOTime",(e,t)=>{wm.init(e,t),le.init(e,t)});function ty(e){return kg(ey,e)}const ry=A("ZodISODuration",(e,t)=>{_m.init(e,t),le.init(e,t)});function ny(e){return Tg(ry,e)}const oy=(e,t)=>{wc.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>ih(e,r)},flatten:{value:r=>sh(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,Uo,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,Uo,2)}},isEmpty:{get(){return e.issues.length===0}}})},Ne=A("ZodError",oy,{Parent:Error}),sy=cs(Ne),iy=us(Ne),ay=On(Ne),cy=Pn(Ne),uy=uh(Ne),dy=dh(Ne),ly=lh(Ne),fy=fh(Ne),py=ph(Ne),hy=hh(Ne),my=mh(Ne),gy=gh(Ne),ue=A("ZodType",(e,t)=>(ae.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone($t(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>mt(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>sy(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>ay(e,r,n),e.parseAsync=async(r,n)=>iy(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>cy(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>uy(e,r,n),e.decode=(r,n)=>dy(e,r,n),e.encodeAsync=async(r,n)=>ly(e,r,n),e.decodeAsync=async(r,n)=>fy(e,r,n),e.safeEncode=(r,n)=>py(e,r,n),e.safeDecode=(r,n)=>hy(e,r,n),e.safeEncodeAsync=async(r,n)=>my(e,r,n),e.safeDecodeAsync=async(r,n)=>gy(e,r,n),e.refine=(r,n)=>e.check(sw(r,n)),e.superRefine=r=>e.check(iw(r)),e.overwrite=r=>e.check(vr(r)),e.optional=()=>er(e),e.nullable=()=>_i(e),e.nullish=()=>er(_i(e)),e.nonoptional=r=>Xy(e,r),e.array=()=>Qe(e),e.or=r=>Hc([e,r]),e.and=r=>qy(e,r),e.transform=r=>bi(e,Wy(r)),e.default=r=>Gy(e,r),e.prefault=r=>Yy(e,r),e.catch=r=>tw(e,r),e.pipe=r=>bi(e,r),e.readonly=()=>ow(e),e.describe=r=>{const n=e.clone();return Ur.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Ur.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Ur.get(e);const n=e.clone();return Ur.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),zc=A("_ZodString",(e,t)=>{ds.init(e,t),ue.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(zg(...n)),e.includes=(...n)=>e.check(Ng(...n)),e.startsWith=(...n)=>e.check(Zg(...n)),e.endsWith=(...n)=>e.check(jg(...n)),e.min=(...n)=>e.check(an(...n)),e.max=(...n)=>e.check(Pc(...n)),e.length=(...n)=>e.check(Dc(...n)),e.nonempty=(...n)=>e.check(an(1,...n)),e.lowercase=n=>e.check(xg(n)),e.uppercase=n=>e.check(Lg(n)),e.trim=()=>e.check(Kg()),e.normalize=(...n)=>e.check(Mg(...n)),e.toLowerCase=()=>e.check(Hg()),e.toUpperCase=()=>e.check(qg())}),xc=A("ZodString",(e,t)=>{ds.init(e,t),zc.init(e,t),e.email=r=>e.check($c(Lc,r)),e.url=r=>e.check(cg(yy,r)),e.jwt=r=>e.check(vg(Oy,r)),e.emoji=r=>e.check(ug(wy,r)),e.guid=r=>e.check(pi(yi,r)),e.uuid=r=>e.check(og($r,r)),e.uuidv4=r=>e.check(sg($r,r)),e.uuidv6=r=>e.check(ig($r,r)),e.uuidv7=r=>e.check(ag($r,r)),e.nanoid=r=>e.check(dg(_y,r)),e.guid=r=>e.check(pi(yi,r)),e.cuid=r=>e.check(lg(by,r)),e.cuid2=r=>e.check(fg(vy,r)),e.ulid=r=>e.check(pg(Ay,r)),e.base64=r=>e.check(wg(Uy,r)),e.base64url=r=>e.check(_g($y,r)),e.xid=r=>e.check(hg(Ey,r)),e.ksuid=r=>e.check(mg(ky,r)),e.ipv4=r=>e.check(Cc(Nc,r)),e.ipv6=r=>e.check(Oc(Zc,r)),e.cidrv4=r=>e.check(gg(Iy,r)),e.cidrv6=r=>e.check(yg(Ry,r)),e.e164=r=>e.check(bg(Cy,r)),e.datetime=r=>e.check(Qg(r)),e.date=r=>e.check(Xg(r)),e.time=r=>e.check(ty(r)),e.duration=r=>e.check(ny(r))});function _(e){return rg(xc,e)}const le=A("ZodStringFormat",(e,t)=>{ce.init(e,t),zc.init(e,t)}),Lc=A("ZodEmail",(e,t)=>{am.init(e,t),le.init(e,t)});function sr(e){return $c(Lc,e)}const yi=A("ZodGUID",(e,t)=>{sm.init(e,t),le.init(e,t)}),$r=A("ZodUUID",(e,t)=>{im.init(e,t),le.init(e,t)}),yy=A("ZodURL",(e,t)=>{cm.init(e,t),le.init(e,t)}),wy=A("ZodEmoji",(e,t)=>{um.init(e,t),le.init(e,t)}),_y=A("ZodNanoID",(e,t)=>{dm.init(e,t),le.init(e,t)}),by=A("ZodCUID",(e,t)=>{lm.init(e,t),le.init(e,t)}),vy=A("ZodCUID2",(e,t)=>{fm.init(e,t),le.init(e,t)}),Ay=A("ZodULID",(e,t)=>{pm.init(e,t),le.init(e,t)}),Ey=A("ZodXID",(e,t)=>{hm.init(e,t),le.init(e,t)}),ky=A("ZodKSUID",(e,t)=>{mm.init(e,t),le.init(e,t)}),Nc=A("ZodIPv4",(e,t)=>{bm.init(e,t),le.init(e,t)});function Ty(e){return Cc(Nc,e)}const Zc=A("ZodIPv6",(e,t)=>{vm.init(e,t),le.init(e,t)});function Sy(e){return Oc(Zc,e)}const Iy=A("ZodCIDRv4",(e,t)=>{Am.init(e,t),le.init(e,t)}),Ry=A("ZodCIDRv6",(e,t)=>{Em.init(e,t),le.init(e,t)}),Uy=A("ZodBase64",(e,t)=>{km.init(e,t),le.init(e,t)}),$y=A("ZodBase64URL",(e,t)=>{Sm.init(e,t),le.init(e,t)}),Cy=A("ZodE164",(e,t)=>{Im.init(e,t),le.init(e,t)}),Oy=A("ZodJWT",(e,t)=>{Um.init(e,t),le.init(e,t)}),jc=A("ZodNumber",(e,t)=>{Ic.init(e,t),ue.init(e,t),e.gt=(n,o)=>e.check(mi(n,o)),e.gte=(n,o)=>e.check(Hr(n,o)),e.min=(n,o)=>e.check(Hr(n,o)),e.lt=(n,o)=>e.check(hi(n,o)),e.lte=(n,o)=>e.check(Kr(n,o)),e.max=(n,o)=>e.check(Kr(n,o)),e.int=n=>e.check(wi(n)),e.safe=n=>e.check(wi(n)),e.positive=n=>e.check(mi(0,n)),e.nonnegative=n=>e.check(Hr(0,n)),e.negative=n=>e.check(hi(0,n)),e.nonpositive=n=>e.check(Kr(0,n)),e.multipleOf=(n,o)=>e.check(gi(n,o)),e.step=(n,o)=>e.check(gi(n,o)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function hr(e){return Sg(jc,e)}const Py=A("ZodNumberFormat",(e,t)=>{$m.init(e,t),jc.init(e,t)});function wi(e){return Ig(Py,e)}const Mc=A("ZodBoolean",(e,t)=>{Cm.init(e,t),ue.init(e,t)});function He(e){return Rg(Mc,e)}const Dy=A("ZodUndefined",(e,t)=>{Om.init(e,t),ue.init(e,t)});function _T(e){return $g(Dy,e)}const zy=A("ZodAny",(e,t)=>{Pm.init(e,t),ue.init(e,t)});function Ce(){return Cg(zy)}const xy=A("ZodUnknown",(e,t)=>{Dm.init(e,t),ue.init(e,t)});function cn(){return Og(xy)}const Ly=A("ZodNever",(e,t)=>{zm.init(e,t),ue.init(e,t)});function Ny(e){return Pg(Ly,e)}const Zy=A("ZodDate",(e,t)=>{xm.init(e,t),ue.init(e,t),e.min=(n,o)=>e.check(Hr(n,o)),e.max=(n,o)=>e.check(Kr(n,o));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function Pe(e){return Dg(Zy,e)}const jy=A("ZodArray",(e,t)=>{Lm.init(e,t),ue.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(an(r,n)),e.nonempty=r=>e.check(an(1,r)),e.max=(r,n)=>e.check(Pc(r,n)),e.length=(r,n)=>e.check(Dc(r,n)),e.unwrap=()=>e.element});function Qe(e,t){return Vg(jy,e,t)}const Kc=A("ZodObject",(e,t)=>{Zm.init(e,t),ue.init(e,t),se(e,"shape",()=>t.shape),e.keyof=()=>dt(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:cn()}),e.loose=()=>e.clone({...e._zod.def,catchall:cn()}),e.strict=()=>e.clone({...e._zod.def,catchall:Ny()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>eh(e,r),e.safeExtend=r=>th(e,r),e.merge=r=>rh(e,r),e.pick=r=>Yp(e,r),e.omit=r=>Xp(e,r),e.partial=(...r)=>nh(qc,e,r[0]),e.required=(...r)=>oh(Vc,e,r[0])});function B(e,t){const r={type:"object",shape:e??{},...$(t)};return new Kc(r)}function My(e,t){return new Kc({type:"object",shape:e,catchall:cn(),...$(t)})}const Ky=A("ZodUnion",(e,t)=>{jm.init(e,t),ue.init(e,t),e.options=t.options});function Hc(e,t){return new Ky({type:"union",options:e,...$(t)})}const Hy=A("ZodIntersection",(e,t)=>{Mm.init(e,t),ue.init(e,t)});function qy(e,t){return new Hy({type:"intersection",left:e,right:t})}const Vy=A("ZodRecord",(e,t)=>{Km.init(e,t),ue.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function xe(e,t,r){return new Vy({type:"record",keyType:e,valueType:t,...$(r)})}const Co=A("ZodEnum",(e,t)=>{Hm.init(e,t),ue.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,o)=>{const s={};for(const i of n)if(r.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Co({...t,checks:[],...$(o),entries:s})},e.exclude=(n,o)=>{const s={...t.entries};for(const i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Co({...t,checks:[],...$(o),entries:s})}});function dt(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new Co({type:"enum",entries:r,...$(t)})}const By=A("ZodTransform",(e,t)=>{qm.init(e,t),ue.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new pc(e.constructor.name);r.addIssue=s=>{if(typeof s=="string")r.issues.push(pr(s,r.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(pr(i))}};const o=t.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function Wy(e){return new By({type:"transform",transform:e})}const qc=A("ZodOptional",(e,t)=>{Vm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType});function er(e){return new qc({type:"optional",innerType:e})}const Fy=A("ZodNullable",(e,t)=>{Bm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType});function _i(e){return new Fy({type:"nullable",innerType:e})}const Jy=A("ZodDefault",(e,t)=>{Wm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Gy(e,t){return new Jy({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():gc(t)}})}const Qy=A("ZodPrefault",(e,t)=>{Fm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Yy(e,t){return new Qy({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():gc(t)}})}const Vc=A("ZodNonOptional",(e,t)=>{Jm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Xy(e,t){return new Vc({type:"nonoptional",innerType:e,...$(t)})}const ew=A("ZodCatch",(e,t)=>{Gm.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function tw(e,t){return new ew({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const rw=A("ZodPipe",(e,t)=>{Qm.init(e,t),ue.init(e,t),e.in=t.in,e.out=t.out});function bi(e,t){return new rw({type:"pipe",in:e,out:t})}const nw=A("ZodReadonly",(e,t)=>{Ym.init(e,t),ue.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ow(e){return new nw({type:"readonly",innerType:e})}const Bc=A("ZodCustom",(e,t)=>{Xm.init(e,t),ue.init(e,t)});function qt(e,t){return Bg(Bc,e??(()=>!0),t)}function sw(e,t={}){return Wg(Bc,e,t)}function iw(e){return Fg(e)}function Wc(e){return ng(xc,e)}function vi(e){return Ug(Mc,e)}const{set:Fc}=wp(()=>null);async function Jc(e,t,r){const n=e.body?.callbackURL||e.context.options.baseURL;if(!n)throw new g("BAD_REQUEST",{message:"callbackURL is required"});const o=ze(128),s=ze(32),i=e.context.oauthConfig?.storeStateStrategy||"cookie",a={...r||{},callbackURL:n,codeVerifier:o,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+600*1e3,requestSignUp:e.body?.requestSignUp};if(await Fc(a),i==="cookie"){const l=await Un({key:e.context.secret,data:JSON.stringify(a)}),f=e.context.createAuthCookie("oauth_state",{maxAge:600*1e3});return e.setCookie(f.name,l,f.attributes),{state:s,codeVerifier:o}}const c=e.context.createAuthCookie("state",{maxAge:300*1e3});await e.setSignedCookie(c.name,s,e.context.secret,c.attributes);const u=new Date;u.setMinutes(u.getMinutes()+10);const d=await e.context.internalAdapter.createVerificationValue({value:JSON.stringify(a),identifier:s,expiresAt:u});if(!d)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new g("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:d.identifier,codeVerifier:o}}async function aw(e){const t=e.query.state||e.body.state,r=e.context.oauthConfig.storeStateStrategy||"cookie",n=My({callbackURL:_(),codeVerifier:_(),errorURL:_().optional(),newUserURL:_().optional(),expiresAt:hr(),link:B({email:_(),userId:Wc()}).optional(),requestSignUp:He().optional()});let o;if(r==="cookie"){const s=e.context.createAuthCookie("oauth_state"),i=e.getCookie(s.name);if(!i){e.context.logger.error("State Mismatch. OAuth state cookie not found",{state:t});const a=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${a}?error=please_restart_the_process`)}try{const a=await $n({key:e.context.secret,data:i});o=n.parse(JSON.parse(a))}catch(a){e.context.logger.error("Failed to decrypt or parse OAuth state cookie",{error:a});const c=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${c}?error=please_restart_the_process`)}e.setCookie(s.name,"",{maxAge:0})}else{const s=await e.context.internalAdapter.findVerificationValue(t);if(!s){e.context.logger.error("State Mismatch. Verification not found",{state:t});const c=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${c}?error=please_restart_the_process`)}o=n.parse(JSON.parse(s.value));const i=e.context.createAuthCookie("state"),a=await e.getSignedCookie(i.name,e.context.secret);if(!e.context.oauthConfig?.skipStateCookieCheck&&(!a||a!==t)){const c=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${c}?error=state_mismatch`)}e.setCookie(i.name,"",{maxAge:0}),await e.context.internalAdapter.deleteVerificationValue(s.id)}if(o.errorURL||(o.errorURL=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`),o.expiresAt<Date.now()){const s=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${s}?error=please_restart_the_process`)}return o&&await Fc(o),o}const ls={isAction:!1},ht=e=>Ga("a-z","A-Z","0-9")(e||32),un=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e)),Cr=new WeakMap;function Gc(e,t){const r=t.fields,n={};for(const o in e){const s=r[o];if(!s){n[o]=e[o];continue}s.returned!==!1&&(n[o]=e[o])}return n}function zn(e,t){Cr.has(e)||Cr.set(e,new Map);const r=Cr.get(e);if(r.has(t))return r.get(t);let n={...t==="user"?e.user?.additionalFields:{},...t==="session"?e.session?.additionalFields:{}};for(const o of e.plugins||[])o.schema&&o.schema[t]&&(n={...n,...o.schema[t].fields});return Cr.get(e).set(t,n),n}function nt(e,t){return{...Gc(t,{fields:zn(e,"user")}),id:t.id}}function Or(e,t){return Gc(t,{fields:zn(e,"session")})}function Qc(e,t){const r=t.action||"create",n=t.fields,o=Object.assign(Object.create(null),null);for(const s in n){if(s in e){if(n[s].input===!1){if(n[s].defaultValue!==void 0&&r!=="update"){o[s]=n[s].defaultValue;continue}if(e[s])throw new g("BAD_REQUEST",{message:`${s} is not allowed to be set`});continue}if(n[s].validator?.input&&e[s]!==void 0){o[s]=n[s].validator.input["~standard"].validate(e[s]);continue}if(n[s].transform?.input&&e[s]!==void 0){o[s]=n[s].transform?.input(e[s]);continue}o[s]=e[s];continue}if(n[s].defaultValue!==void 0&&r==="create"){if(typeof n[s].defaultValue=="function"){o[s]=n[s].defaultValue();continue}o[s]=n[s].defaultValue;continue}if(n[s].required&&r==="create")throw new g("BAD_REQUEST",{message:`${s} is required`})}return o}function Yc(e,t={},r){return Qc(t,{fields:zn(e,"user"),action:r})}function bT(e,t){return Qc(t,{fields:zn(e,"session")})}function Xc(e,t){if(!t)return e;for(const r in t){const n=t[r]?.modelName;n&&(e[r].modelName=n);for(const o in e[r].fields){const s=t[r]?.fields?.[o];s&&(e[r].fields[o].fieldName=s)}}return e}const cw="127.0.0.1";function uw(e,t){if(t.advanced?.ipAddress?.disableIpTracking)return null;if(id()||Bo())return cw;const r="headers"in e?e.headers:e,n=t.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"];for(const o of n){const s="get"in r?r.get(o):r[o];if(typeof s=="string"){const i=s.split(",")[0].trim();if(dw(i))return i}}return null}function dw(e){return!!(Ty().safeParse(e).success||Sy().safeParse(e).success)}function xn(e){function t(r,n){if(typeof n=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(n)){const o=new Date(n);if(!isNaN(o.getTime()))return o}return n}try{return typeof e!="string"?e:JSON.parse(e,t)}catch(r){return Q.error("Error parsing JSON",{error:r}),null}}const io=new Map,lw=new TextEncoder,fw={decode:(e,t="utf-8")=>(io.has(t)||io.set(t,new TextDecoder(t)),io.get(t).decode(e)),encode:lw.encode},eu=(e="SHA-256",t="none")=>{const r={importKey:async(n,o)=>Et().importKey("raw",typeof n=="string"?new TextEncoder().encode(n):n,{name:"HMAC",hash:{name:e}},!1,[o]),sign:async(n,o)=>{typeof n=="string"&&(n=await r.importKey(n,"sign"));const s=await Et().sign("HMAC",n,typeof o=="string"?new TextEncoder().encode(o):o);return t==="hex"?en.encode(s):t==="base64"||t==="base64url"||t==="base64urlnopad"?rr.encode(s,{padding:t!=="base64urlnopad"}):s},verify:async(n,o,s)=>(typeof n=="string"&&(n=await r.importKey(n,"verify")),t==="hex"&&(s=en.decode(s)),(t==="base64"||t==="base64url"||t==="base64urlnopad")&&(s=await Ke.decode(s)),Et().verify("HMAC",n,typeof s=="string"?new TextEncoder().encode(s):s,typeof o=="string"?new TextEncoder().encode(o):o))};return r},dn=1e3,ln=dn*60,fn=ln*60,mr=fn*24,Oo=mr*7,pn=mr*365.25,Po=pn/12;function tu(e,t){if(typeof e=="string")return pw(e);if(typeof e=="number")return mw(e);throw new Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(e)}`)}function pw(e){if(typeof e!="string"||e.length===0||e.length>100)throw new Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(e)}`);const t=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(e);if(!t?.groups)return NaN;const{value:r,unit:n="ms"}=t.groups,o=parseFloat(r),s=n.toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return o*pn;case"months":case"month":case"mo":return o*Po;case"weeks":case"week":case"w":return o*Oo;case"days":case"day":case"d":return o*mr;case"hours":case"hour":case"hrs":case"hr":case"h":return o*fn;case"minutes":case"minute":case"mins":case"min":case"m":return o*ln;case"seconds":case"second":case"secs":case"sec":case"s":return o*dn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:throw new Error(`Unknown unit "${s}" provided to ms.parse(). value=${JSON.stringify(e)}`)}}function hw(e){const t=Math.abs(e);return t>=pn?`${Math.round(e/pn)}y`:t>=Po?`${Math.round(e/Po)}mo`:t>=Oo?`${Math.round(e/Oo)}w`:t>=mr?`${Math.round(e/mr)}d`:t>=fn?`${Math.round(e/fn)}h`:t>=ln?`${Math.round(e/ln)}m`:t>=dn?`${Math.round(e/dn)}s`:`${e}ms`}function mw(e,t){if(typeof e!="number"||!Number.isFinite(e))throw new Error("Value provided to ms.format() must be of type number.");return hw(e)}const fs=4096,Do=200,ao=fs-Do;function gw(e){const t=e.headers?.get("cookie");if(!t)return{};const r={},n=t.split("; ");for(const o of n){const[s,...i]=o.split("=");s&&i.length>0&&(r[s]=i.join("="))}return r}function Ai(e){const t=e.split("."),r=t[t.length-1],n=parseInt(r||"0",10);return isNaN(n)?0:n}function yw(e,t){const r={},n=gw(t);for(const[o,s]of Object.entries(n))o.startsWith(e)&&(r[o]=s);return r}function ww(e){return Object.keys(e).sort((t,r)=>Ai(t)-Ai(r)).map(t=>e[t]).join("")}function _w(e,t,r,n){const o=Math.ceil(t.value.length/ao);if(o===1)return r[t.name]=t.value,[t];const s=[];for(let i=0;i<o;i++){const a=`${t.name}.${i}`,c=i*ao,u=t.value.substring(c,c+ao);s.push({...t,name:a,value:u}),r[a]=u}return n.debug(`CHUNKING_${e.toUpperCase()}_COOKIE`,{message:`${e} cookie exceeds allowed ${fs} bytes.`,emptyCookieSize:Do,valueSize:t.value.length,chunkCount:o,chunks:s.map(i=>i.value.length+Do)}),s}function Ei(e,t){const r={};for(const n in e)r[n]={name:n,value:"",options:{...t,maxAge:0}};return r}const ru=e=>(t,r,n)=>{const o=yw(t,n),s=n.context.logger;return{getValue(){return ww(o)},hasChunks(){return Object.keys(o).length>0},chunk(i,a){const c=Ei(o,r);for(const l in o)delete o[l];const u=c,d=_w(e,{name:t,value:i,options:{...r,...a}},o,s);for(const l of d)u[l.name]=l;return Object.values(u)},clean(){const i=Ei(o,r);for(const a in o)delete o[a];return Object.values(i)},setCookies(i){for(const a of i)n.setCookie(a.name,a.value,a.options)}}},zo=ru("Session"),ki=ru("Account");function nu(e,t){const r=e.getCookie(t);if(r)return r;const n=[],o=e.headers?.get("cookie");if(!o)return null;const s={},i=o.split("; ");for(const a of i){const[c,...u]=a.split("=");c&&u.length>0&&(s[c]=u.join("="))}for(const[a,c]of Object.entries(s))if(a.startsWith(t+".")){const u=a.split(".").at(-1),d=parseInt(u||"0",10);isNaN(d)||n.push({index:d,value:c})}return n.length>0?(n.sort((a,c)=>a.index-c.index),n.map(a=>a.value).join("")):null}async function hn(e,t){const r=e.context.authCookies.accountData,n={maxAge:300,...r.options},o=await tc(t,e.context.secret,"better-auth-account",n.maxAge);if(o.length>fs){const s=ki(r.name,n,e),i=s.chunk(o,n);s.setCookies(i)}else{const s=ki(r.name,n,e);if(s.hasChunks()){const i=s.clean();s.setCookies(i)}e.setCookie(r.name,o,n)}}async function ps(e){const t=nu(e,e.context.authCookies.accountData.name);if(t){const r=xn(await rc(t,e.context.secret,"better-auth-account"));if(r)return r}return null}const bw=er(B({disableCookieCache:vi().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:vi().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));function vw(e){const t=new Map;return e.split(", ").forEach(r=>{const[n,...o]=r.split(";").map(u=>u.trim()),[s,...i]=(n||"").split("="),a=i.join("=");if(!s||a===void 0)return;const c={value:a};o.forEach(u=>{const[d,...l]=u.split("="),f=l.join("="),p=d.trim().toLowerCase();switch(p){case"max-age":c["max-age"]=f?parseInt(f.trim(),10):void 0;break;case"expires":c.expires=f?new Date(f.trim()):void 0;break;case"domain":c.domain=f?f.trim():void 0;break;case"path":c.path=f?f.trim():void 0;break;case"secure":c.secure=!0;break;case"httponly":c.httponly=!0;break;case"samesite":c.samesite=f?f.trim().toLowerCase():void 0;break;default:c[p]=f?f.trim():!0;break}}),t.set(s,c)}),t}function Aw(e){const t=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:e.baseURL!==void 0?e.baseURL.startsWith("https://"):aa)?"__Secure-":"",r=!!e.advanced?.crossSubDomainCookies?.enabled,n=r?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(r&&!n)throw new Y("baseURL is required when crossSubdomainCookies are enabled");function o(s,i={}){const a=e.advanced?.cookiePrefix||"better-auth",c=e.advanced?.cookies?.[s]?.name||`${a}.${s}`,u=e.advanced?.cookies?.[s]?.attributes;return{name:`${t}${c}`,attributes:{secure:!!t,sameSite:"lax",path:"/",httpOnly:!0,...r?{domain:n}:{},...e.advanced?.defaultCookieAttributes,...i,...u}}}return o}function vT(e){const t=Aw(e),r=t("session_token",{maxAge:e.session?.expiresIn||tu("7d")/1e3}),n=t("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),o=t("account_data",{maxAge:e.session?.cookieCache?.maxAge||300}),s=t("dont_remember");return{sessionToken:{name:r.name,options:r.attributes},sessionData:{name:n.name,options:n.attributes},dontRememberToken:{name:s.name,options:s.attributes},accountData:{name:o.name,options:o.attributes}}}async function xo(e,t,r){if(e.context.options.session?.cookieCache?.enabled){const n=Object.entries(t.session).reduce((f,[p,h])=>{const m=e.context.options.session?.additionalFields?.[p];return(!m||m.returned!==!1)&&(f[p]=h),f},{}),o=nt(e.context.options,t.user),s=e.context.options.session?.cookieCache?.version;let i="1";if(s){if(typeof s=="string")i=s;else if(typeof s=="function"){const f=s(t.session,t.user);i=f instanceof Promise?await f:f}}const a={session:n,user:o,updatedAt:Date.now(),version:i},c={...e.context.authCookies.sessionData.options,maxAge:r?void 0:e.context.authCookies.sessionData.options.maxAge},u=un(c.maxAge||60,"sec").getTime(),d=e.context.options.session?.cookieCache?.strategy||"compact";let l;if(d==="jwe"?l=await tc(a,e.context.secret,"better-auth-session",c.maxAge||300):d==="jwt"?l=await Qa(a,e.context.secret,c.maxAge||300):l=rr.encode(JSON.stringify({session:a,expiresAt:u,signature:await eu("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...a,expiresAt:u}))}),{padding:!1}),l.length>4093){const f=zo(e.context.authCookies.sessionData.name,c,e),p=f.chunk(l,c);f.setCookies(p)}else{const f=zo(e.context.authCookies.sessionData.name,c,e);if(f.hasChunks()){const p=f.clean();f.setCookies(p)}e.setCookie(e.context.authCookies.sessionData.name,l,c)}}}async function Le(e,t,r,n){const o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=r!==void 0?r:!!o;const s=e.context.authCookies.sessionToken.options,i=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...s,maxAge:i,...n}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await xo(e,t,r),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function gr(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0});const r=zo(e.context.authCookies.sessionData.name,e.context.authCookies.sessionData.options,e),n=r.clean();r.setCookies(n),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}const ou=Jt(async()=>({})),et=Jt.create({use:[ou,Jt(async()=>({}))]}),Ew=[ou],K=(e,t,r)=>nn(e,{...t,use:[...t?.use||[],...Ew]},async n=>So(n,()=>r(n))),su=()=>K("/get-session",{method:"GET",operationId:"getSession",query:bw,requireHeaders:!0,metadata:{openapi:{operationId:"getSession",description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{try{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;const r=nu(e,e.context.authCookies.sessionData.name);let n=null;if(r){const c=e.context.options.session?.cookieCache?.strategy||"compact";if(c==="jwe"){const u=await rc(r,e.context.secret,"better-auth-session");if(u&&u.session&&u.user)n={session:{session:u.session,user:u.user,updatedAt:u.updatedAt,version:u.version},expiresAt:u.exp?u.exp*1e3:Date.now()};else{const d=e.context.authCookies.sessionData.name;return e.setCookie(d,"",{maxAge:0}),e.json(null)}}else if(c==="jwt"){const u=await pp(r,e.context.secret);if(u&&u.session&&u.user)n={session:{session:u.session,user:u.user,updatedAt:u.updatedAt,version:u.version},expiresAt:u.exp?u.exp*1e3:Date.now()};else{const d=e.context.authCookies.sessionData.name;return e.setCookie(d,"",{maxAge:0}),e.json(null)}}else{const u=xn(fw.decode(rr.decode(r)));if(u)if(await eu("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...u.session,expiresAt:u.expiresAt}),u.signature))n=u;else{const d=e.context.authCookies.sessionData.name;return e.setCookie(d,"",{maxAge:0}),e.json(null)}}}const o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(n?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){const c=n.session,u=e.context.options.session?.cookieCache?.version;let d="1";if(u){if(typeof u=="string")d=u;else if(typeof u=="function"){const l=u(c.session,c.user);d=l instanceof Promise?await l:l}}if((c.version||"1")!==d){const l=e.context.authCookies.sessionData.name;e.setCookie(l,"",{maxAge:0})}else if(n.expiresAt<Date.now()||c.session.expiresAt<new Date){const l=e.context.authCookies.sessionData.name;e.setCookie(l,"",{maxAge:0})}else{const l=e.context.sessionConfig.cookieRefreshCache;if(l===!1)return e.context.session=c,e.json({session:c.session,user:c.user});if(n.expiresAt-Date.now()<l.updateAge*1e3){const h=un(e.context.options.session?.cookieCache?.maxAge||300,"sec"),m={session:{...c.session,expiresAt:h},user:c.user,updatedAt:Date.now()};await xo(e,m,!1);const y=Or(e.context.options,{...m.session,expiresAt:new Date(m.session.expiresAt),createdAt:new Date(m.session.createdAt),updatedAt:new Date(m.session.updatedAt)}),b=nt(e.context.options,{...m.user,createdAt:new Date(m.user.createdAt),updatedAt:new Date(m.user.updatedAt)});return e.context.session={session:y,user:b},e.json({session:y,user:b})}const f=Or(e.context.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),p=nt(e.context.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)});return e.context.session={session:f,user:p},e.json({session:f,user:p})}}const s=await e.context.internalAdapter.findSession(t);if(e.context.session=s,!s||s.session.expiresAt<new Date)return gr(e),s&&await e.context.internalAdapter.deleteSession(s.session.token),e.json(null);if(o||e.query?.disableRefresh){const c=Or(e.context.options,s.session),u=nt(e.context.options,s.user);return e.json({session:c,user:u})}const i=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge;if(s.session.expiresAt.valueOf()-i*1e3+a*1e3<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){const c=await e.context.internalAdapter.updateSession(s.session.token,{expiresAt:un(e.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!c)return gr(e),e.json(null,{status:401});const u=(c.expiresAt.valueOf()-Date.now())/1e3;await Le(e,{session:c,user:s.user},!1,{maxAge:u});const d=Or(e.context.options,c),l=nt(e.context.options,s.user);return e.json({session:d,user:l})}return await xo(e,s,!!o),e.json(s)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new g("INTERNAL_SERVER_ERROR",{message:j.FAILED_TO_GET_SESSION})}}),De=async(e,t)=>{if(e.context.session)return e.context.session;const r=await su()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,returnStatus:!1,query:{...t,...e.query}}).catch(n=>null);return e.context.session=r,r},st=et(async e=>{const t=await De(e);if(!t?.session)throw new g("UNAUTHORIZED");return{session:t}}),Ct=et(async e=>{const t=await De(e,{disableCookieCache:!0});if(!t?.session)throw new g("UNAUTHORIZED");return{session:t}});et(async e=>{const t=await De(e);if(!t?.session&&(e.request||e.headers))throw new g("UNAUTHORIZED");return{session:t}});const kw=et(async e=>{const t=await De(e);if(!t?.session)throw new g("UNAUTHORIZED");if(e.context.sessionConfig.freshAge===0)return{session:t};const r=e.context.sessionConfig.freshAge,n=new Date(t.session.updatedAt||t.session.createdAt).getTime();if(!(Date.now()-n<r*1e3))throw new g("FORBIDDEN",{message:"Session is not fresh"});return{session:t}}),Tw=()=>K("/list-sessions",{method:"GET",operationId:"listUserSessions",use:[st],requireHeaders:!0,metadata:{openapi:{operationId:"listUserSessions",description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async e=>{try{const t=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter(r=>r.expiresAt>new Date);return e.json(t)}catch(t){throw e.context.logger.error(t),e.error("INTERNAL_SERVER_ERROR")}}),Sw=K("/revoke-session",{method:"POST",body:B({token:_().meta({description:"The token to revoke"})}),use:[Ct],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.body.token;if((await e.context.internalAdapter.findSession(t))?.session.userId===e.context.session.user.id)try{await e.context.internalAdapter.deleteSession(t)}catch(r){throw e.context.logger.error(r&&typeof r=="object"&&"name"in r?r.name:"",r),new g("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),Iw=K("/revoke-sessions",{method:"POST",use:[Ct],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&typeof t=="object"&&"name"in t?t.name:"",t),new g("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),Rw=K("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[Ct],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{const t=e.context.session;if(!t.user)throw new g("UNAUTHORIZED");const r=(await e.context.internalAdapter.listSessions(t.user.id)).filter(n=>n.expiresAt>new Date).filter(n=>n.token!==e.context.session.session.token);return await Promise.all(r.map(n=>e.context.internalAdapter.deleteSession(n.token))),e.json({status:!0})});var Uw=Object.defineProperty,$w=Object.defineProperties,Cw=Object.getOwnPropertyDescriptors,Ti=Object.getOwnPropertySymbols,Ow=Object.prototype.hasOwnProperty,Pw=Object.prototype.propertyIsEnumerable,Si=(e,t,r)=>t in e?Uw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wt=(e,t)=>{for(var r in t||(t={}))Ow.call(t,r)&&Si(e,r,t[r]);if(Ti)for(var r of Ti(t))Pw.call(t,r)&&Si(e,r,t[r]);return e},_t=(e,t)=>$w(e,Cw(t)),Dw=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},zw=async(e,t)=>{var r,n,o,s,i,a;let c=t||{};const u={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:c,hooks:u};for(const d of t?.plugins||[]){if(d.init){const l=await((r=d.init)==null?void 0:r.call(d,e.toString(),t));c=l.options||c,e=l.url}u.onRequest.push((n=d.hooks)==null?void 0:n.onRequest),u.onResponse.push((o=d.hooks)==null?void 0:o.onResponse),u.onSuccess.push((s=d.hooks)==null?void 0:s.onSuccess),u.onError.push((i=d.hooks)==null?void 0:i.onError),u.onRetry.push((a=d.hooks)==null?void 0:a.onRetry)}return{url:e,options:c,hooks:u}},Ii=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},xw=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Lw(e){if(typeof e=="number")return new Ii({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new Ii(e);case"exponential":return new xw(e);default:throw new Error("Invalid retry strategy")}}var Nw=async e=>{const t={},r=async n=>typeof n=="function"?await n():n;if(e?.auth){if(e.auth.type==="Bearer"){const n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),o=r(e.auth.password);if(!n||!o)return t;t.authorization=`Basic ${btoa(`${n}:${o}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},Zw=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function jw(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return Zw.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function Mw(e){try{return JSON.parse(e),!0}catch{return!1}}function iu(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Ri(e){try{return JSON.parse(e)}catch{return e}}function Ui(e){return typeof e=="function"}function Kw(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Ui(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Ui(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Hw(e){const t=new Headers(e?.headers),r=await Nw(e);for(const[n,o]of Object.entries(r||{}))t.set(n,o);if(!t.has("content-type")){const n=qw(e?.body);n&&t.set("content-type",n)}return t}function qw(e){return iu(e)?"application/json":null}function Vw(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(iu(e.body)&&!t.has("content-type")){for(const[r,n]of Object.entries(e?.body))n instanceof Date&&(e.body[r]=n.toISOString());return JSON.stringify(e.body)}return e.body}function Bw(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return cu.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Ww(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}var Fw=class au extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,au.prototype)}};async function Jw(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new Fw(r.issues);return r.value}var cu=["get","post","put","patch","delete"];function Gw(e,t){let{baseURL:r,params:n,query:o}=t||{query:{},params:{},baseURL:""},s=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){const l=e.toString().split("@")[1].split("/")[0];cu.includes(l)&&(e=e.replace(`@${l}/`,"/"))}s.endsWith("/")||(s+="/");let[i,a]=e.replace(s,"").split("?");const c=new URLSearchParams(a);for(const[l,f]of Object.entries(o||{}))f!=null&&c.set(l,String(f));if(n)if(Array.isArray(n)){const l=i.split("/").filter(f=>f.startsWith(":"));for(const[f,p]of l.entries()){const h=n[f];i=i.replace(p,h)}}else for(const[l,f]of Object.entries(n))i=i.replace(`:${l}`,String(f));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let u=c.toString();return u=u.length>0?`?${u}`.replace(/\+/g,"%20"):"",s.startsWith("http")?new URL(`${i}${u}`,s):`${s}${i}${u}`}var H=async(e,t)=>{var r,n,o,s,i,a,c,u;const{hooks:d,url:l,options:f}=await zw(e,t),p=Kw(f),h=new AbortController,m=(r=f.signal)!=null?r:h.signal,y=Gw(l,f),b=Vw(f),k=await Hw(f),v=Bw(l,f);let w=_t(wt({},f),{url:y,headers:k,body:b,method:v,signal:m});for(const R of d.onRequest)if(R){const I=await R(w);I instanceof Object&&(w=I)}("pipeTo"in w&&typeof w.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in w||(w.duplex="half"));const{clearTimeout:N}=Ww(f,h);let T=await p(w.url,w);N();const O={response:T,request:w};for(const R of d.onResponse)if(R){const I=await R(_t(wt({},O),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?T.clone():T}));I instanceof Response?T=I:I instanceof Object&&(T=I.response)}if(T.ok){if(!(w.method!=="HEAD"))return{data:"",error:null};const I=jw(T),z={data:"",response:T,request:w};if(I==="json"||I==="text"){const D=await T.text(),V=await((s=w.jsonParser)!=null?s:Ri)(D);z.data=V}else z.data=await T[I]();w?.output&&w.output&&!w.disableValidation&&(z.data=await Jw(w.output,z.data));for(const D of d.onSuccess)D&&await D(_t(wt({},z),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?T.clone():T}));return t?.throw?z.data:{data:z.data,error:null}}const M=(a=t?.jsonParser)!=null?a:Ri,x=await T.text(),Z=Mw(x),C=Z?await M(x):null,q={response:T,responseText:x,request:w,error:_t(wt({},C),{status:T.status,statusText:T.statusText})};for(const R of d.onError)R&&await R(_t(wt({},q),{response:(c=t?.hookOptions)!=null&&c.cloneResponse?T.clone():T}));if(t?.retry){const R=Lw(t.retry),I=(u=t.retryAttempt)!=null?u:0;if(await R.shouldAttemptRetry(I,T)){for(const D of d.onRetry)D&&await D(O);const z=R.getDelay(I);return await new Promise(D=>setTimeout(D,z)),await H(e,_t(wt({},t),{retryAttempt:I+1}))}}if(t?.throw)throw new Dw(T.status,T.statusText,Z?C:x);return{data:null,error:_t(wt({},C),{status:T.status,statusText:T.statusText})}};function uu(e){const t=r=>{const n=new Date;return new Date(n.getTime()+r*1e3)};return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?t(e.expires_in):void 0,refreshTokenExpiresAt:e.refresh_token_expires_in?t(e.refresh_token_expires_in):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token,raw:e}}async function du(e){const t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return rr.encode(new Uint8Array(r),{padding:!1})}async function ne({id:e,options:t,authorizationEndpoint:r,state:n,codeVerifier:o,scopes:s,claims:i,redirectURI:a,duration:c,prompt:u,accessType:d,responseType:l,display:f,loginHint:p,hd:h,responseMode:m,additionalParams:y,scopeJoiner:b}){const k=new URL(r);k.searchParams.set("response_type",l||"code");const v=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;if(k.searchParams.set("client_id",v),k.searchParams.set("state",n),s&&k.searchParams.set("scope",s.join(b||" ")),k.searchParams.set("redirect_uri",t.redirectURI||a),c&&k.searchParams.set("duration",c),f&&k.searchParams.set("display",f),p&&k.searchParams.set("login_hint",p),u&&k.searchParams.set("prompt",u),h&&k.searchParams.set("hd",h),d&&k.searchParams.set("access_type",d),m&&k.searchParams.set("response_mode",m),o){const w=await du(o);k.searchParams.set("code_challenge_method","S256"),k.searchParams.set("code_challenge",w)}if(i){const w=i.reduce((N,T)=>(N[T]=null,N),{});k.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...w}}))}return y&&Object.entries(y).forEach(([w,N])=>{k.searchParams.set(w,N)}),k}function Qw({refreshToken:e,options:t,authentication:r,extraParams:n,resource:o}){const s=new URLSearchParams,i={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(s.set("grant_type","refresh_token"),s.set("refresh_token",e),r==="basic"){const a=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;a?i.authorization="Basic "+Ke.encode(`${a}:${t.clientSecret??""}`):i.authorization="Basic "+Ke.encode(`:${t.clientSecret??""}`)}else{const a=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;s.set("client_id",a),t.clientSecret&&s.set("client_secret",t.clientSecret)}if(o)if(typeof o=="string")s.append("resource",o);else for(const a of o)s.append("resource",a);if(n)for(const[a,c]of Object.entries(n))s.set(a,c);return{body:s,headers:i}}async function ee({refreshToken:e,options:t,tokenEndpoint:r,authentication:n,extraParams:o}){const{body:s,headers:i}=Qw({refreshToken:e,options:t,authentication:n,extraParams:o}),{data:a,error:c}=await H(r,{method:"POST",body:s,headers:i});if(c)throw c;const u={accessToken:a.access_token,refreshToken:a.refresh_token,tokenType:a.token_type,scopes:a.scope?.split(" "),idToken:a.id_token};if(a.expires_in){const d=new Date;u.accessTokenExpiresAt=new Date(d.getTime()+a.expires_in*1e3)}return u}function Yw({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:o,deviceId:s,headers:i,additionalParams:a={},resource:c}){const u=new URLSearchParams,d={"content-type":"application/x-www-form-urlencoded",accept:"application/json",...i};if(u.set("grant_type","authorization_code"),u.set("code",e),t&&u.set("code_verifier",t),n.clientKey&&u.set("client_key",n.clientKey),s&&u.set("device_id",s),u.set("redirect_uri",n.redirectURI||r),c)if(typeof c=="string")u.append("resource",c);else for(const l of c)u.append("resource",l);if(o==="basic"){const l=Array.isArray(n.clientId)?n.clientId[0]:n.clientId;d.authorization=`Basic ${Ke.encode(`${l}:${n.clientSecret??""}`)}`}else{const l=Array.isArray(n.clientId)?n.clientId[0]:n.clientId;u.set("client_id",l),n.clientSecret&&u.set("client_secret",n.clientSecret)}for(const[l,f]of Object.entries(a))u.has(l)||u.append(l,f);return{body:u,headers:d}}async function X({code:e,codeVerifier:t,redirectURI:r,options:n,tokenEndpoint:o,authentication:s,deviceId:i,headers:a,additionalParams:c={},resource:u}){const{body:d,headers:l}=Yw({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:s,deviceId:i,headers:a,additionalParams:c,resource:u}),{data:f,error:p}=await H(o,{method:"POST",body:d,headers:l});if(p)throw p;return uu(f)}function E(e,t,r){function n(a,c){var u;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(u=a._zod).traits??(u.traits=new Set),a._zod.traits.add(e),t(a,c);for(const d in i.prototype)d in a||Object.defineProperty(a,d,{value:i.prototype[d].bind(a)});a._zod.constr=i,a._zod.def=c}const o=r?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const u=r?.Parent?new s:this;n(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>r?.Parent&&a instanceof r.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class Qt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class lu extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const fu={};function Tt(e){return fu}function Xw(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,o])=>t.indexOf(+n)===-1).map(([n,o])=>o)}function Lo(e,t){return typeof t=="bigint"?t.toString():t}function hs(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ms(e){return e==null}function gs(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function e_(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let o=(n.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(n)){const c=n.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}const s=r>o?r:o,i=Number.parseInt(e.toFixed(s).replace(".","")),a=Number.parseInt(t.toFixed(s).replace(".",""));return i%a/10**s}const $i=Symbol("evaluating");function ie(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==$i)return n===void 0&&(n=$i,n=r()),n},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function Ot(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function Pt(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function Ci(e){return JSON.stringify(e)}const pu="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function mn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const t_=hs(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function yr(e){if(mn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(mn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function hu(e){return yr(e)?{...e}:Array.isArray(e)?[...e]:e}const r_=new Set(["string","number","symbol"]);function Ln(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gt(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function P(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function n_(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const o_={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function s_(e,t){const r=e._zod.def,n=Pt(e._zod.def,{get shape(){const o={};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(o[s]=r.shape[s])}return Ot(this,"shape",o),o},checks:[]});return gt(e,n)}function i_(e,t){const r=e._zod.def,n=Pt(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const s in t){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete o[s]}return Ot(this,"shape",o),o},checks:[]});return gt(e,n)}function a_(e,t){if(!yr(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const o=Pt(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return Ot(this,"shape",s),s},checks:[]});return gt(e,o)}function c_(e,t){if(!yr(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Ot(this,"shape",n),n},checks:e._zod.def.checks};return gt(e,r)}function u_(e,t){const r=Pt(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Ot(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return gt(e,r)}function d_(e,t,r){const n=Pt(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)s[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return Ot(this,"shape",s),s},checks:[]});return gt(t,n)}function l_(e,t,r){const n=Pt(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(r)for(const i in r){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return Ot(this,"shape",s),s},checks:[]});return gt(t,n)}function Wt(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function mu(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function Pr(e){return typeof e=="string"?e:e?.message}function St(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const o=Pr(e.inst?._zod.def?.error?.(e))??Pr(t?.error?.(e))??Pr(r.customError?.(e))??Pr(r.localeError?.(e))??"Invalid input";n.message=o}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function ys(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function wr(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const gu=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Lo,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},yu=E("$ZodError",gu),wu=E("$ZodError",gu,{Parent:Error});function f_(e,t=r=>r.message){const r={},n=[];for(const o of e.issues)o.path.length>0?(r[o.path[0]]=r[o.path[0]]||[],r[o.path[0]].push(t(o))):n.push(t(o));return{formErrors:n,fieldErrors:r}}function p_(e,t=r=>r.message){const r={_errors:[]},n=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>n({issues:i}));else if(s.code==="invalid_key")n({issues:s.issues});else if(s.code==="invalid_element")n({issues:s.issues});else if(s.path.length===0)r._errors.push(t(s));else{let i=r,a=0;for(;a<s.path.length;){const c=s.path[a];a===s.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(s))):i[c]=i[c]||{_errors:[]},i=i[c],a++}}};return n(e),r}const ws=e=>(t,r,n,o)=>{const s=n?Object.assign(n,{async:!1}):{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new Qt;if(i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>St(c,s,Tt())));throw pu(a,o?.callee),a}return i.value},_s=e=>async(t,r,n,o)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>St(c,s,Tt())));throw pu(a,o?.callee),a}return i.value},Nn=e=>(t,r,n)=>{const o=n?{...n,async:!1}:{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Qt;return s.issues.length?{success:!1,error:new(e??yu)(s.issues.map(i=>St(i,o,Tt())))}:{success:!0,data:s.value}},h_=Nn(wu),Zn=e=>async(t,r,n)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>St(i,o,Tt())))}:{success:!0,data:s.value}},m_=Zn(wu),g_=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return ws(e)(t,r,o)},y_=e=>(t,r,n)=>ws(e)(t,r,n),w_=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _s(e)(t,r,o)},__=e=>async(t,r,n)=>_s(e)(t,r,n),b_=e=>(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Nn(e)(t,r,o)},v_=e=>(t,r,n)=>Nn(e)(t,r,n),A_=e=>async(t,r,n)=>{const o=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Zn(e)(t,r,o)},E_=e=>async(t,r,n)=>Zn(e)(t,r,n),k_=/^[cC][^\s-]{8,}$/,T_=/^[0-9a-z]+$/,S_=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,I_=/^[0-9a-vA-V]{20}$/,R_=/^[A-Za-z0-9]{27}$/,U_=/^[a-zA-Z0-9_-]{21}$/,$_=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,C_=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Oi=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,O_=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,P_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function D_(){return new RegExp(P_,"u")}const z_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,x_=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,L_=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,N_=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Z_=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,_u=/^[A-Za-z0-9_-]*$/,j_=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,M_=/^\+(?:[0-9]){6,14}[0-9]$/,bu="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",K_=new RegExp(`^${bu}$`);function vu(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function H_(e){return new RegExp(`^${vu(e)}$`)}function q_(e){const t=vu({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${bu}T(?:${n})$`)}const V_=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},B_=/^-?\d+$/,W_=/^-?\d+(?:\.\d+)?/,F_=/^(?:true|false)$/i,J_=/^[^A-Z]*$/,G_=/^[^a-z]*$/,Re=E("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Au={number:"number",bigint:"bigint",object:"date"},Eu=E("$ZodCheckLessThan",(e,t)=>{Re.init(e,t);const r=Au[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),ku=E("$ZodCheckGreaterThan",(e,t)=>{Re.init(e,t);const r=Au[typeof t.value];e._zod.onattach.push(n=>{const o=n._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Q_=E("$ZodCheckMultipleOf",(e,t)=>{Re.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):e_(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Y_=E("$ZodCheckNumberFormat",(e,t)=>{Re.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[o,s]=o_[t.format];e._zod.onattach.push(i=>{const a=i._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,r&&(a.pattern=B_)}),e._zod.check=i=>{const a=i.value;if(r){if(!Number.isInteger(a)){i.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:e})}}),X_=E("$ZodCheckMaxLength",(e,t)=>{var r;Re.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ms(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const o=n.value;if(o.length<=t.maximum)return;const i=ys(o);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),eb=E("$ZodCheckMinLength",(e,t)=>{var r;Re.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ms(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const o=n.value;if(o.length>=t.minimum)return;const i=ys(o);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),tb=E("$ZodCheckLengthEquals",(e,t)=>{var r;Re.init(e,t),(r=e._zod.def).when??(r.when=n=>{const o=n.value;return!ms(o)&&o.length!==void 0}),e._zod.onattach.push(n=>{const o=n._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=n=>{const o=n.value,s=o.length;if(s===t.length)return;const i=ys(o),a=s>t.length;n.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),jn=E("$ZodCheckStringFormat",(e,t)=>{var r,n;Re.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),rb=E("$ZodCheckRegex",(e,t)=>{jn.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),nb=E("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=J_),jn.init(e,t)}),ob=E("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=G_),jn.init(e,t)}),sb=E("$ZodCheckIncludes",(e,t)=>{Re.init(e,t);const r=Ln(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),ib=E("$ZodCheckStartsWith",(e,t)=>{Re.init(e,t);const r=new RegExp(`^${Ln(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),ab=E("$ZodCheckEndsWith",(e,t)=>{Re.init(e,t);const r=new RegExp(`.*${Ln(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const o=n._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),cb=E("$ZodCheckOverwrite",(e,t)=>{Re.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class ub{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(i=>i),o=Math.min(...n.map(i=>i.length-i.trimStart().length)),s=n.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,r=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...r,o.join(`
`))}}const db={major:4,minor:1,patch:12},he=E("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=db;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const o of n)for(const s of o._zod.onattach)s(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,a,c)=>{let u=Wt(i),d;for(const l of a){if(l._zod.def.when){if(!l._zod.def.when(i))continue}else if(u)continue;const f=i.issues.length,p=l._zod.check(i);if(p instanceof Promise&&c?.async===!1)throw new Qt;if(d||p instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await p,i.issues.length!==f&&(u||(u=Wt(i,f)))});else{if(i.issues.length===f)continue;u||(u=Wt(i,f))}}return d?d.then(()=>i):i},s=(i,a,c)=>{if(Wt(i))return i.aborted=!0,i;const u=o(a,n,c);if(u instanceof Promise){if(c.async===!1)throw new Qt;return u.then(d=>e._zod.parse(d,c))}return e._zod.parse(u,c)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(d=>s(d,i,a)):s(u,i,a)}const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new Qt;return c.then(u=>o(u,n,a))}return o(c,n,a)}}e["~standard"]={validate:o=>{try{const s=h_(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return m_(e,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),bs=E("$ZodString",(e,t)=>{he.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??V_(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),de=E("$ZodStringFormat",(e,t)=>{jn.init(e,t),bs.init(e,t)}),lb=E("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=C_),de.init(e,t)}),fb=E("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Oi(n))}else t.pattern??(t.pattern=Oi());de.init(e,t)}),pb=E("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=O_),de.init(e,t)}),hb=E("$ZodURL",(e,t)=>{de.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),o=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:j_.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=o.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),mb=E("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=D_()),de.init(e,t)}),gb=E("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=U_),de.init(e,t)}),yb=E("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=k_),de.init(e,t)}),wb=E("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=T_),de.init(e,t)}),_b=E("$ZodULID",(e,t)=>{t.pattern??(t.pattern=S_),de.init(e,t)}),bb=E("$ZodXID",(e,t)=>{t.pattern??(t.pattern=I_),de.init(e,t)}),vb=E("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=R_),de.init(e,t)}),Ab=E("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=q_(t)),de.init(e,t)}),Eb=E("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=K_),de.init(e,t)}),kb=E("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=H_(t)),de.init(e,t)}),Tb=E("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=$_),de.init(e,t)}),Sb=E("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=z_),de.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),Ib=E("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=x_),de.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),Rb=E("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=L_),de.init(e,t)}),Ub=E("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=N_),de.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[o,s]=n;if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Tu(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const $b=E("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Z_),de.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Tu(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function Cb(e){if(!_u.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Tu(r)}const Ob=E("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=_u),de.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Cb(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),Pb=E("$ZodE164",(e,t)=>{t.pattern??(t.pattern=M_),de.init(e,t)});function Db(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const o=JSON.parse(atob(n));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const zb=E("$ZodJWT",(e,t)=>{de.init(e,t),e._zod.check=r=>{Db(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Su=E("$ZodNumber",(e,t)=>{he.init(e,t),e._zod.pattern=e._zod.bag.pattern??W_,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const o=r.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return r;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),r}}),xb=E("$ZodNumber",(e,t)=>{Y_.init(e,t),Su.init(e,t)}),Lb=E("$ZodBoolean",(e,t)=>{he.init(e,t),e._zod.pattern=F_,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const o=r.value;return typeof o=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),r}}),Nb=E("$ZodUnknown",(e,t)=>{he.init(e,t),e._zod.parse=r=>r}),Zb=E("$ZodNever",(e,t)=>{he.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),jb=E("$ZodDate",(e,t)=>{he.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const o=r.value,s=o instanceof Date;return s&&!Number.isNaN(o.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:o,...s?{received:"Invalid Date"}:{},inst:e}),r}});function Pi(e,t,r){e.issues.length&&t.issues.push(...mu(r,e.issues)),t.value[r]=e.value}const Mb=E("$ZodArray",(e,t)=>{he.init(e,t),e._zod.parse=(r,n)=>{const o=r.value;if(!Array.isArray(o))return r.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),r;r.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},n);c instanceof Promise?s.push(c.then(u=>Pi(u,r,i))):Pi(c,r,i)}return s.length?Promise.all(s).then(()=>r):r}});function gn(e,t,r,n){e.issues.length&&t.issues.push(...mu(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function Iu(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=n_(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function Ru(e,t,r,n,o,s){const i=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(const d of Object.keys(t)){if(a.has(d))continue;if(u==="never"){i.push(d);continue}const l=c.run({value:t[d],issues:[]},n);l instanceof Promise?e.push(l.then(f=>gn(f,r,d,t))):gn(l,r,d,t)}return i.length&&r.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:s}),e.length?Promise.all(e).then(()=>r):r}const Kb=E("$ZodObject",(e,t)=>{if(he.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const n=hs(()=>Iu(t));ie(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const d=a[u]._zod;if(d.values){c[u]??(c[u]=new Set);for(const l of d.values)c[u].add(l)}}return c});const o=mn,s=t.catchall;let i;e._zod.parse=(a,c)=>{i??(i=n.value);const u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const d=[],l=i.shape;for(const f of i.keys){const h=l[f]._zod.run({value:u[f],issues:[]},c);h instanceof Promise?d.push(h.then(m=>gn(m,a,f,u))):gn(h,a,f,u)}return s?Ru(d,u,a,c,n.value,e):d.length?Promise.all(d).then(()=>a):a}}),Hb=E("$ZodObjectJIT",(e,t)=>{Kb.init(e,t);const r=e._zod.parse,n=hs(()=>Iu(t)),o=f=>{const p=new ub(["shape","payload","ctx"]),h=n.value,m=v=>{const w=Ci(v);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};p.write("const input = payload.value;");const y=Object.create(null);let b=0;for(const v of h.keys)y[v]=`key_${b++}`;p.write("const newResult = {};");for(const v of h.keys){const w=y[v],N=Ci(v);p.write(`const ${w} = ${m(v)};`),p.write(`
        if (${w}.issues.length) {
          payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${N}, ...iss.path] : [${N}]
          })));
        }
        
        
        if (${w}.value === undefined) {
          if (${N} in input) {
            newResult[${N}] = undefined;
          }
        } else {
          newResult[${N}] = ${w}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const k=p.compile();return(v,w)=>k(f,v,w)};let s;const i=mn,a=!fu.jitless,u=a&&t_.value,d=t.catchall;let l;e._zod.parse=(f,p)=>{l??(l=n.value);const h=f.value;return i(h)?a&&u&&p?.async===!1&&p.jitless!==!0?(s||(s=o(t.shape)),f=s(f,p),d?Ru([],h,f,p,l,e):f):r(f,p):(f.issues.push({expected:"object",code:"invalid_type",input:h,inst:e}),f)}});function Di(e,t,r,n){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!Wt(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(s=>s.issues.map(i=>St(i,n,Tt())))}),t)}const qb=E("$ZodUnion",(e,t)=>{he.init(e,t),ie(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),ie(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),ie(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),ie(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${o.map(s=>gs(s.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(o,s)=>{if(r)return n(o,s);let i=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:o.value,issues:[]},s);if(u instanceof Promise)a.push(u),i=!0;else{if(u.issues.length===0)return u;a.push(u)}}return i?Promise.all(a).then(c=>Di(c,o,e,s)):Di(a,o,e,s)}}),Vb=E("$ZodIntersection",(e,t)=>{he.init(e,t),e._zod.parse=(r,n)=>{const o=r.value,s=t.left._zod.run({value:o,issues:[]},n),i=t.right._zod.run({value:o,issues:[]},n);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>zi(r,c,u)):zi(r,s,i)}});function No(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(yr(e)&&yr(t)){const r=Object.keys(t),n=Object.keys(e).filter(s=>r.indexOf(s)!==-1),o={...e,...t};for(const s of n){const i=No(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const o=e[n],s=t[n],i=No(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function zi(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),Wt(e))return e;const n=No(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const Bb=E("$ZodEnum",(e,t)=>{he.init(e,t);const r=Xw(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(o=>r_.has(typeof o)).map(o=>typeof o=="string"?Ln(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return n.has(i)||o.issues.push({code:"invalid_value",values:r,input:i,inst:e}),o}}),Wb=E("$ZodTransform",(e,t)=>{he.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new lu(e.constructor.name);const o=t.transform(r.value,r);if(n.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(r.value=i,r));if(o instanceof Promise)throw new Qt;return r.value=o,r}});function xi(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Fb=E("$ZodOptional",(e,t)=>{he.init(e,t),e._zod.optin="optional",e._zod.optout="optional",ie(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),ie(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${gs(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>xi(s,r.value)):xi(o,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),Jb=E("$ZodNullable",(e,t)=>{he.init(e,t),ie(e._zod,"optin",()=>t.innerType._zod.optin),ie(e._zod,"optout",()=>t.innerType._zod.optout),ie(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${gs(r.source)}|null)$`):void 0}),ie(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Gb=E("$ZodDefault",(e,t)=>{he.init(e,t),e._zod.optin="optional",ie(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Li(s,t)):Li(o,t)}});function Li(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Qb=E("$ZodPrefault",(e,t)=>{he.init(e,t),e._zod.optin="optional",ie(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Yb=E("$ZodNonOptional",(e,t)=>{he.init(e,t),ie(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>Ni(s,e)):Ni(o,e)}});function Ni(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Xb=E("$ZodCatch",(e,t)=>{he.init(e,t),ie(e._zod,"optin",()=>t.innerType._zod.optin),ie(e._zod,"optout",()=>t.innerType._zod.optout),ie(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(s=>(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>St(i,n,Tt()))},input:r.value}),r.issues=[]),r)):(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>St(s,n,Tt()))},input:r.value}),r.issues=[]),r)}}),ev=E("$ZodPipe",(e,t)=>{he.init(e,t),ie(e._zod,"values",()=>t.in._zod.values),ie(e._zod,"optin",()=>t.in._zod.optin),ie(e._zod,"optout",()=>t.out._zod.optout),ie(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const s=t.out._zod.run(r,n);return s instanceof Promise?s.then(i=>Dr(i,t.in,n)):Dr(s,t.in,n)}const o=t.in._zod.run(r,n);return o instanceof Promise?o.then(s=>Dr(s,t.out,n)):Dr(o,t.out,n)}});function Dr(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const tv=E("$ZodReadonly",(e,t)=>{he.init(e,t),ie(e._zod,"propValues",()=>t.innerType._zod.propValues),ie(e._zod,"values",()=>t.innerType._zod.values),ie(e._zod,"optin",()=>t.innerType._zod.optin),ie(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const o=t.innerType._zod.run(r,n);return o instanceof Promise?o.then(Zi):Zi(o)}});function Zi(e){return e.value=Object.freeze(e.value),e}const rv=E("$ZodCustom",(e,t)=>{Re.init(e,t),he.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,o=t.fn(n);if(o instanceof Promise)return o.then(s=>ji(s,r,n,e));ji(o,r,n,e)}});function ji(e,t,r,n){if(!e){const o={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(o.params=n._zod.def.params),t.issues.push(wr(o))}}class nv{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const o={...n,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function ov(){return new nv}const zr=ov();function sv(e,t){return new e({type:"string",...P(t)})}function iv(e,t){return new e({type:"string",coerce:!0,...P(t)})}function av(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...P(t)})}function Mi(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...P(t)})}function cv(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...P(t)})}function uv(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...P(t)})}function dv(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...P(t)})}function lv(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...P(t)})}function fv(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...P(t)})}function pv(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...P(t)})}function hv(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...P(t)})}function mv(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...P(t)})}function gv(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...P(t)})}function yv(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...P(t)})}function wv(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...P(t)})}function _v(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...P(t)})}function bv(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...P(t)})}function vv(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...P(t)})}function Av(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...P(t)})}function Ev(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...P(t)})}function kv(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...P(t)})}function Tv(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...P(t)})}function Sv(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...P(t)})}function Iv(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...P(t)})}function Rv(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...P(t)})}function Uv(e,t){return new e({type:"string",format:"date",check:"string_format",...P(t)})}function $v(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...P(t)})}function Cv(e,t){return new e({type:"string",format:"duration",check:"string_format",...P(t)})}function Ov(e,t){return new e({type:"number",checks:[],...P(t)})}function Pv(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...P(t)})}function Dv(e,t){return new e({type:"boolean",...P(t)})}function zv(e){return new e({type:"unknown"})}function xv(e,t){return new e({type:"never",...P(t)})}function Lv(e,t){return new e({type:"date",...P(t)})}function Ki(e,t){return new Eu({check:"less_than",...P(t),value:e,inclusive:!1})}function qr(e,t){return new Eu({check:"less_than",...P(t),value:e,inclusive:!0})}function Hi(e,t){return new ku({check:"greater_than",...P(t),value:e,inclusive:!1})}function Vr(e,t){return new ku({check:"greater_than",...P(t),value:e,inclusive:!0})}function qi(e,t){return new Q_({check:"multiple_of",...P(t),value:e})}function Uu(e,t){return new X_({check:"max_length",...P(t),maximum:e})}function yn(e,t){return new eb({check:"min_length",...P(t),minimum:e})}function $u(e,t){return new tb({check:"length_equals",...P(t),length:e})}function Nv(e,t){return new rb({check:"string_format",format:"regex",...P(t),pattern:e})}function Zv(e){return new nb({check:"string_format",format:"lowercase",...P(e)})}function jv(e){return new ob({check:"string_format",format:"uppercase",...P(e)})}function Mv(e,t){return new sb({check:"string_format",format:"includes",...P(t),includes:e})}function Kv(e,t){return new ib({check:"string_format",format:"starts_with",...P(t),prefix:e})}function Hv(e,t){return new ab({check:"string_format",format:"ends_with",...P(t),suffix:e})}function Ar(e){return new cb({check:"overwrite",tx:e})}function qv(e){return Ar(t=>t.normalize(e))}function Vv(){return Ar(e=>e.trim())}function Bv(){return Ar(e=>e.toLowerCase())}function Wv(){return Ar(e=>e.toUpperCase())}function Fv(e,t,r){return new e({type:"array",element:t,...P(r)})}function Jv(e,t,r){return new e({type:"custom",check:"custom",fn:t,...P(r)})}function Gv(e){const t=Qv(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(wr(n,r.value,t._zod.def));else{const o=n;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),r.issues.push(wr(o))}},e(r.value,r)));return t}function Qv(e,t){const r=new Re({check:"custom",...P(t)});return r._zod.check=e,r}const Yv=E("ZodISODateTime",(e,t)=>{Ab.init(e,t),fe.init(e,t)});function Xv(e){return Rv(Yv,e)}const eA=E("ZodISODate",(e,t)=>{Eb.init(e,t),fe.init(e,t)});function tA(e){return Uv(eA,e)}const rA=E("ZodISOTime",(e,t)=>{kb.init(e,t),fe.init(e,t)});function nA(e){return $v(rA,e)}const oA=E("ZodISODuration",(e,t)=>{Tb.init(e,t),fe.init(e,t)});function sA(e){return Cv(oA,e)}const iA=(e,t)=>{yu.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>p_(e,r)},flatten:{value:r=>f_(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,Lo,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,Lo,2)}},isEmpty:{get(){return e.issues.length===0}}})},Ze=E("ZodError",iA,{Parent:Error}),aA=ws(Ze),cA=_s(Ze),uA=Nn(Ze),dA=Zn(Ze),lA=g_(Ze),fA=y_(Ze),pA=w_(Ze),hA=__(Ze),mA=b_(Ze),gA=v_(Ze),yA=A_(Ze),wA=E_(Ze),me=E("ZodType",(e,t)=>(he.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(Pt(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>gt(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>aA(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>uA(e,r,n),e.parseAsync=async(r,n)=>cA(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>dA(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>lA(e,r,n),e.decode=(r,n)=>fA(e,r,n),e.encodeAsync=async(r,n)=>pA(e,r,n),e.decodeAsync=async(r,n)=>hA(e,r,n),e.safeEncode=(r,n)=>mA(e,r,n),e.safeDecode=(r,n)=>gA(e,r,n),e.safeEncodeAsync=async(r,n)=>yA(e,r,n),e.safeDecodeAsync=async(r,n)=>wA(e,r,n),e.refine=(r,n)=>e.check(dE(r,n)),e.superRefine=r=>e.check(lE(r)),e.overwrite=r=>e.check(Ar(r)),e.optional=()=>Ji(e),e.nullable=()=>Gi(e),e.nullish=()=>Ji(Gi(e)),e.nonoptional=r=>nE(e,r),e.array=()=>qA(e),e.or=r=>WA([e,r]),e.and=r=>JA(e,r),e.transform=r=>Qi(e,QA(r)),e.default=r=>eE(e,r),e.prefault=r=>rE(e,r),e.catch=r=>sE(e,r),e.pipe=r=>Qi(e,r),e.readonly=()=>cE(e),e.describe=r=>{const n=e.clone();return zr.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return zr.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return zr.get(e);const n=e.clone();return zr.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Cu=E("_ZodString",(e,t)=>{bs.init(e,t),me.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Nv(...n)),e.includes=(...n)=>e.check(Mv(...n)),e.startsWith=(...n)=>e.check(Kv(...n)),e.endsWith=(...n)=>e.check(Hv(...n)),e.min=(...n)=>e.check(yn(...n)),e.max=(...n)=>e.check(Uu(...n)),e.length=(...n)=>e.check($u(...n)),e.nonempty=(...n)=>e.check(yn(1,...n)),e.lowercase=n=>e.check(Zv(n)),e.uppercase=n=>e.check(jv(n)),e.trim=()=>e.check(Vv()),e.normalize=(...n)=>e.check(qv(...n)),e.toLowerCase=()=>e.check(Bv()),e.toUpperCase=()=>e.check(Wv())}),Ou=E("ZodString",(e,t)=>{bs.init(e,t),Cu.init(e,t),e.email=r=>e.check(av(_A,r)),e.url=r=>e.check(fv(bA,r)),e.jwt=r=>e.check(Iv(zA,r)),e.emoji=r=>e.check(pv(vA,r)),e.guid=r=>e.check(Mi(Vi,r)),e.uuid=r=>e.check(cv(xr,r)),e.uuidv4=r=>e.check(uv(xr,r)),e.uuidv6=r=>e.check(dv(xr,r)),e.uuidv7=r=>e.check(lv(xr,r)),e.nanoid=r=>e.check(hv(AA,r)),e.guid=r=>e.check(Mi(Vi,r)),e.cuid=r=>e.check(mv(EA,r)),e.cuid2=r=>e.check(gv(kA,r)),e.ulid=r=>e.check(yv(TA,r)),e.base64=r=>e.check(kv(OA,r)),e.base64url=r=>e.check(Tv(PA,r)),e.xid=r=>e.check(wv(SA,r)),e.ksuid=r=>e.check(_v(IA,r)),e.ipv4=r=>e.check(bv(RA,r)),e.ipv6=r=>e.check(vv(UA,r)),e.cidrv4=r=>e.check(Av($A,r)),e.cidrv6=r=>e.check(Ev(CA,r)),e.e164=r=>e.check(Sv(DA,r)),e.datetime=r=>e.check(Xv(r)),e.date=r=>e.check(tA(r)),e.time=r=>e.check(nA(r)),e.duration=r=>e.check(sA(r))});function _e(e){return sv(Ou,e)}const fe=E("ZodStringFormat",(e,t)=>{de.init(e,t),Cu.init(e,t)}),_A=E("ZodEmail",(e,t)=>{pb.init(e,t),fe.init(e,t)}),Vi=E("ZodGUID",(e,t)=>{lb.init(e,t),fe.init(e,t)}),xr=E("ZodUUID",(e,t)=>{fb.init(e,t),fe.init(e,t)}),bA=E("ZodURL",(e,t)=>{hb.init(e,t),fe.init(e,t)}),vA=E("ZodEmoji",(e,t)=>{mb.init(e,t),fe.init(e,t)}),AA=E("ZodNanoID",(e,t)=>{gb.init(e,t),fe.init(e,t)}),EA=E("ZodCUID",(e,t)=>{yb.init(e,t),fe.init(e,t)}),kA=E("ZodCUID2",(e,t)=>{wb.init(e,t),fe.init(e,t)}),TA=E("ZodULID",(e,t)=>{_b.init(e,t),fe.init(e,t)}),SA=E("ZodXID",(e,t)=>{bb.init(e,t),fe.init(e,t)}),IA=E("ZodKSUID",(e,t)=>{vb.init(e,t),fe.init(e,t)}),RA=E("ZodIPv4",(e,t)=>{Sb.init(e,t),fe.init(e,t)}),UA=E("ZodIPv6",(e,t)=>{Ib.init(e,t),fe.init(e,t)}),$A=E("ZodCIDRv4",(e,t)=>{Rb.init(e,t),fe.init(e,t)}),CA=E("ZodCIDRv6",(e,t)=>{Ub.init(e,t),fe.init(e,t)}),OA=E("ZodBase64",(e,t)=>{$b.init(e,t),fe.init(e,t)}),PA=E("ZodBase64URL",(e,t)=>{Ob.init(e,t),fe.init(e,t)}),DA=E("ZodE164",(e,t)=>{Pb.init(e,t),fe.init(e,t)}),zA=E("ZodJWT",(e,t)=>{zb.init(e,t),fe.init(e,t)}),Pu=E("ZodNumber",(e,t)=>{Su.init(e,t),me.init(e,t),e.gt=(n,o)=>e.check(Hi(n,o)),e.gte=(n,o)=>e.check(Vr(n,o)),e.min=(n,o)=>e.check(Vr(n,o)),e.lt=(n,o)=>e.check(Ki(n,o)),e.lte=(n,o)=>e.check(qr(n,o)),e.max=(n,o)=>e.check(qr(n,o)),e.int=n=>e.check(Wi(n)),e.safe=n=>e.check(Wi(n)),e.positive=n=>e.check(Hi(0,n)),e.nonnegative=n=>e.check(Vr(0,n)),e.negative=n=>e.check(Ki(0,n)),e.nonpositive=n=>e.check(qr(0,n)),e.multipleOf=(n,o)=>e.check(qi(n,o)),e.step=(n,o)=>e.check(qi(n,o)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function Bi(e){return Ov(Pu,e)}const xA=E("ZodNumberFormat",(e,t)=>{xb.init(e,t),Pu.init(e,t)});function Wi(e){return Pv(xA,e)}const LA=E("ZodBoolean",(e,t)=>{Lb.init(e,t),me.init(e,t)});function NA(e){return Dv(LA,e)}const ZA=E("ZodUnknown",(e,t)=>{Nb.init(e,t),me.init(e,t)});function Fi(){return zv(ZA)}const jA=E("ZodNever",(e,t)=>{Zb.init(e,t),me.init(e,t)});function MA(e){return xv(jA,e)}const KA=E("ZodDate",(e,t)=>{jb.init(e,t),me.init(e,t),e.min=(n,o)=>e.check(Vr(n,o)),e.max=(n,o)=>e.check(qr(n,o));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function tr(e){return Lv(KA,e)}const HA=E("ZodArray",(e,t)=>{Mb.init(e,t),me.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(yn(r,n)),e.nonempty=r=>e.check(yn(1,r)),e.max=(r,n)=>e.check(Uu(r,n)),e.length=(r,n)=>e.check($u(r,n)),e.unwrap=()=>e.element});function qA(e,t){return Fv(HA,e,t)}const VA=E("ZodObject",(e,t)=>{Hb.init(e,t),me.init(e,t),ie(e,"shape",()=>t.shape),e.keyof=()=>zu(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Fi()}),e.loose=()=>e.clone({...e._zod.def,catchall:Fi()}),e.strict=()=>e.clone({...e._zod.def,catchall:MA()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>a_(e,r),e.safeExtend=r=>c_(e,r),e.merge=r=>u_(e,r),e.pick=r=>s_(e,r),e.omit=r=>i_(e,r),e.partial=(...r)=>d_(xu,e,r[0]),e.required=(...r)=>l_(Lu,e,r[0])});function Du(e,t){const r={type:"object",shape:e??{},...P(t)};return new VA(r)}const BA=E("ZodUnion",(e,t)=>{qb.init(e,t),me.init(e,t),e.options=t.options});function WA(e,t){return new BA({type:"union",options:e,...P(t)})}const FA=E("ZodIntersection",(e,t)=>{Vb.init(e,t),me.init(e,t)});function JA(e,t){return new FA({type:"intersection",left:e,right:t})}const Zo=E("ZodEnum",(e,t)=>{Bb.init(e,t),me.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,o)=>{const s={};for(const i of n)if(r.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Zo({...t,checks:[],...P(o),entries:s})},e.exclude=(n,o)=>{const s={...t.entries};for(const i of n)if(r.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new Zo({...t,checks:[],...P(o),entries:s})}});function zu(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new Zo({type:"enum",entries:r,...P(t)})}const GA=E("ZodTransform",(e,t)=>{Wb.init(e,t),me.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new lu(e.constructor.name);r.addIssue=s=>{if(typeof s=="string")r.issues.push(wr(s,r.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(wr(i))}};const o=t.transform(r.value,r);return o instanceof Promise?o.then(s=>(r.value=s,r)):(r.value=o,r)}});function QA(e){return new GA({type:"transform",transform:e})}const xu=E("ZodOptional",(e,t)=>{Fb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ji(e){return new xu({type:"optional",innerType:e})}const YA=E("ZodNullable",(e,t)=>{Jb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Gi(e){return new YA({type:"nullable",innerType:e})}const XA=E("ZodDefault",(e,t)=>{Gb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function eE(e,t){return new XA({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():hu(t)}})}const tE=E("ZodPrefault",(e,t)=>{Qb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType});function rE(e,t){return new tE({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():hu(t)}})}const Lu=E("ZodNonOptional",(e,t)=>{Yb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nE(e,t){return new Lu({type:"nonoptional",innerType:e,...P(t)})}const oE=E("ZodCatch",(e,t)=>{Xb.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function sE(e,t){return new oE({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const iE=E("ZodPipe",(e,t)=>{ev.init(e,t),me.init(e,t),e.in=t.in,e.out=t.out});function Qi(e,t){return new iE({type:"pipe",in:e,out:t})}const aE=E("ZodReadonly",(e,t)=>{tv.init(e,t),me.init(e,t),e.unwrap=()=>e._zod.def.innerType});function cE(e){return new aE({type:"readonly",innerType:e})}const uE=E("ZodCustom",(e,t)=>{rv.init(e,t),me.init(e,t)});function dE(e,t={}){return Jv(uE,e,t)}function lE(e){return Gv(e)}function Nu(e){return iv(Ou,e)}const fE=e=>{const t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",async createAuthorizationURL({state:r,scopes:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["email","name"];return e.scope&&s.push(...e.scope),n&&s.push(...n),await ne({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:s,state:r,redirectURI:o,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:o})=>X({code:r,codeVerifier:n,redirectURI:o,options:e,tokenEndpoint:t}),async verifyIdToken(r,n){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,n);const{kid:o,alg:s}=Fa(r);if(!o||!s)return!1;const{payload:i}=await Rt(r,await pE(o),{algorithms:[s],issuer:"https://appleid.apple.com",audience:e.audience&&e.audience.length?e.audience:e.appBundleIdentifier?e.appBundleIdentifier:e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{i[a]!==void 0&&(i[a]=!!i[a])}),n&&i.nonce!==n?!1:!!i},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;const n=it(r.idToken);if(!n)return null;const o=r.user?`${r.user.name?.firstName} ${r.user.name?.lastName}`:n.name||n.email,s=typeof n.email_verified=="boolean"?n.email_verified:n.email_verified==="true",i={...n,name:o},a=await e.mapProfileToUser?.(i);return{user:{id:n.sub,name:i.name,emailVerified:s,email:n.email,...a},data:i}},options:e}},pE=async e=>{const{data:t}=await H("https://appleid.apple.com/auth/keys");if(!t?.keys)throw new g("BAD_REQUEST",{message:"Keys not found"});const r=t.keys.find(n=>n.kid===e);if(!r)throw new Error(`JWK with kid ${e} not found`);return await or(r,r.alg)},hE=e=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Secret are required for Atlassian"),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new Y("codeVerifier is required for Atlassian");const s=e.disableDefaultScope?[]:["read:jira-user","offline_access"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"atlassian",options:e,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o,additionalParams:{audience:"api.atlassian.com"},prompt:e.prompt})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;try{const{data:r}=await H("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.account_id,name:r.name,email:r.email,image:r.picture,emailVerified:!1,...n},data:r}}catch(r){return Q.error("Failed to fetch user info from Figma:",r),null}},options:e}),mE=e=>{if(!e.domain||!e.region||!e.userPoolId)throw Q.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new Y("DOMAIN_AND_REGION_REQUIRED");const t=e.domain.replace(/^https?:\/\//,""),r=`https://${t}/oauth2/authorize`,n=`https://${t}/oauth2/token`,o=`https://${t}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:s,scopes:i,codeVerifier:a,redirectURI:c}){if(!e.clientId)throw Q.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(e.requireClientSecret&&!e.clientSecret)throw Q.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new Y("CLIENT_SECRET_REQUIRED");const u=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&u.push(...e.scope),i&&u.push(...i),await ne({id:"cognito",options:{...e},authorizationEndpoint:r,scopes:u,state:s,codeVerifier:a,redirectURI:c,prompt:e.prompt})},validateAuthorizationCode:async({code:s,codeVerifier:i,redirectURI:a})=>X({code:s,codeVerifier:i,redirectURI:a,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>ee({refreshToken:s,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:n}),async verifyIdToken(s,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(s,i);try{const{kid:a,alg:c}=Fa(s);if(!a||!c)return!1;const u=await gE(a,e.region,e.userPoolId),d=`https://cognito-idp.${e.region}.amazonaws.com/${e.userPoolId}`,{payload:l}=await Rt(s,u,{algorithms:[c],issuer:d,audience:e.clientId,maxTokenAge:"1h"});return!(i&&l.nonce!==i)}catch(a){return Q.error("Failed to verify ID token:",a),!1}},async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);if(s.idToken)try{const i=it(s.idToken);if(!i)return null;const a=i.name||i.given_name||i.username||i.email,c={...i,name:a},u=await e.mapProfileToUser?.(c);return{user:{id:i.sub,name:c.name,email:i.email,image:i.picture,emailVerified:i.email_verified,...u},data:c}}catch(i){Q.error("Failed to decode ID token:",i)}if(s.accessToken)try{const{data:i}=await H(o,{headers:{Authorization:`Bearer ${s.accessToken}`}});if(i){const a=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.name||i.given_name||i.username,email:i.email,image:i.picture,emailVerified:i.email_verified,...a},data:i}}}catch(i){Q.error("Failed to fetch user info from Cognito:",i)}return null},options:e}},gE=async(e,t,r)=>{const n=`https://cognito-idp.${t}.amazonaws.com/${r}/.well-known/jwks.json`;try{const{data:o}=await H(n);if(!o?.keys)throw new g("BAD_REQUEST",{message:"Keys not found"});const s=o.keys.find(i=>i.kid===e);if(!s)throw new Error(`JWK with kid ${e} not found`);return await or(s,s.alg)}catch(o){throw Q.error("Failed to fetch Cognito public key:",o),o}},yE=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["identify","email"];r&&o.push(...r),e.scope&&o.push(...e.scope);const s=o.includes("bot")&&e.permissions!==void 0?`&permissions=${e.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"none"}${s}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;if(r.avatar===null)r.image_url=`https://cdn.discordapp.com/embed/avatars/${r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5}.png`;else{const s=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${s}`}const o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...o},data:r}},options:e}),wE=e=>{const t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:n,codeVerifier:o,redirectURI:s})=>{const i=e.disableDefaultScope?[]:["account_info.read"];e.scope&&i.push(...e.scope),n&&i.push(...n);const a={};return e.accessType&&(a.token_access_type=e.accessType),await ne({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:i,state:r,redirectURI:s,codeVerifier:o,additionalParams:a})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:o})=>await X({code:r,codeVerifier:n,redirectURI:o,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await H("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(o)return null;const s=await e.mapProfileToUser?.(n);return{user:{id:n.account_id,name:n.name?.display_name,email:n.email,emailVerified:n.email_verified||!1,image:n.profile_photo_url,...s},data:n}},options:e}},_E=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:n,loginHint:o}){const s=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&s.push(...e.scope),r&&s.push(...r),await ne({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:s,state:t,redirectURI:n,loginHint:o,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(t.split(".").length===3)try{const{payload:n}=await Rt(t,op(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});return r&&n.nonce!==r?!1:!!n}catch{return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken&&t.idToken.split(".").length===3){const s=it(t.idToken),i={id:s.sub,name:s.name,email:s.email,picture:{data:{url:s.picture,height:100,width:100,is_silhouette:!1}}},a=await e.mapProfileToUser?.({...i,email_verified:!1});return{user:{...i,emailVerified:!1,...a},data:s}}const{data:r,error:n}=await H("https://graph.facebook.com/me?fields="+["id","name","email","picture",...e?.fields||[]].join(","),{auth:{type:"Bearer",token:t.accessToken}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.email,image:r.picture.data.url,emailVerified:r.email_verified,...o},data:r}},options:e}),bE=e=>({id:"figma",name:"Figma",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new Y("codeVerifier is required for Figma");const s=e.disableDefaultScope?[]:["file_read"];return e.scope&&s.push(...e.scope),r&&s.push(...r),await ne({id:"figma",options:e,authorizationEndpoint:"https://www.figma.com/oauth",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);try{const{data:r}=await H("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return Q.error("Failed to fetch user from Figma"),null;const n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.handle,email:r.email,image:r.img_url,emailVerified:!!r.email,...n},data:r}}catch(r){return Q.error("Failed to fetch user info from Figma:",r),null}},options:e}),vE=e=>{const t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:n,loginHint:o,codeVerifier:s,redirectURI:i}){const a=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&a.push(...e.scope),n&&a.push(...n),ne({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:a,state:r,codeVerifier:s,redirectURI:i,loginHint:o,prompt:e.prompt})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:o})=>X({code:r,codeVerifier:n,redirectURI:o,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await H("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(o)return null;const{data:s}=await H("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});!n.email&&s&&(n.email=(s.find(c=>c.primary)??s[0])?.email);const i=s?.find(c=>c.email===n.email)?.verified??!1,a=await e.mapProfileToUser?.(n);return{user:{id:n.id,name:n.name||n.login,email:n.email,image:n.avatar_url,emailVerified:i,...a},data:n}},options:e}},co=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),AE=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:co(`${t}/oauth/authorize`),tokenEndpoint:co(`${t}/oauth/token`),userinfoEndpoint:co(`${t}/api/v4/user`)}},EE=e=>{const{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:n}=AE(e.issuer),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:s,scopes:i,codeVerifier:a,loginHint:c,redirectURI:u})=>{const d=e.disableDefaultScope?[]:["read_user"];return e.scope&&d.push(...e.scope),i&&d.push(...i),await ne({id:o,options:e,authorizationEndpoint:t,scopes:d,state:s,redirectURI:u,codeVerifier:a,loginHint:c})},validateAuthorizationCode:async({code:s,redirectURI:i,codeVerifier:a})=>X({code:s,redirectURI:i,options:e,codeVerifier:a,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>ee({refreshToken:s,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:r}),async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);const{data:i,error:a}=await H(n,{headers:{authorization:`Bearer ${s.accessToken}`}});if(a||i.state!=="active"||i.locked)return null;const c=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.name??i.username,email:i.email,image:i.avatar_url,emailVerified:i.email_verified??!1,...c},data:i}},options:e}},kE=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o,loginHint:s,display:i}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new Y("codeVerifier is required for Google");const a=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&a.push(...e.scope),r&&a.push(...r),await ne({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:n,redirectURI:o,prompt:e.prompt,accessType:e.accessType,display:i||e.display,loginHint:s,hd:e.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const{data:n}=await H(`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`);return n?n.aud===e.clientId&&(n.iss==="https://accounts.google.com"||n.iss==="accounts.google.com"):!1},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=it(t.idToken),n=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...n},data:r}},options:e}),TE=e=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"huggingface",options:e,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name||r.preferred_username,email:r.email,image:r.picture,emailVerified:r.email_verified??!1,...o},data:r}},options:e}),SE=e=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return e.scope&&o.push(...e.scope),r&&o.push(...r),ne({id:"kakao",options:e,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:o,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r)return null;const o=await e.mapProfileToUser?.(r),s=r.kakao_account||{},i=s.profile||{};return{user:{id:String(r.id),name:i.nickname||s.name||void 0,email:s.email,image:i.profile_image_url||i.thumbnail_image_url,emailVerified:!!s.is_email_valid&&!!s.is_email_verified,...o},data:r}},options:e}),IE=e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:n,codeVerifier:o}){const s=e.disableDefaultScope?[]:["user:read"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"kick",redirectURI:n,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:s,codeVerifier:o,state:t})},async validateAuthorizationCode({code:t,redirectURI:r,codeVerifier:n}){return X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:n})},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=r.data[0],s=await e.mapProfileToUser?.(o);return{user:{id:o.user_id,name:o.name,email:o.email,image:o.profile_picture,emailVerified:!1,...s},data:o}},options:e}),RE=e=>{const t="https://access.line.me/oauth2/v2.1/authorize",r="https://api.line.me/oauth2/v2.1/token",n="https://api.line.me/oauth2/v2.1/userinfo",o="https://api.line.me/oauth2/v2.1/verify";return{id:"line",name:"LINE",async createAuthorizationURL({state:s,scopes:i,codeVerifier:a,redirectURI:c,loginHint:u}){const d=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&d.push(...e.scope),i&&d.push(...i),await ne({id:"line",options:e,authorizationEndpoint:t,scopes:d,state:s,codeVerifier:a,redirectURI:c,loginHint:u})},validateAuthorizationCode:async({code:s,codeVerifier:i,redirectURI:a})=>X({code:s,codeVerifier:i,redirectURI:a,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>ee({refreshToken:s,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:r}),async verifyIdToken(s,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(s,i);const a=new URLSearchParams;a.set("id_token",s),a.set("client_id",e.clientId),i&&a.set("nonce",i);const{data:c,error:u}=await H(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:a});return!(u||!c||c.aud!==e.clientId||i&&c.nonce&&c.nonce!==i)},async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);let i=null;if(s.idToken)try{i=it(s.idToken)}catch{}if(!i){const{data:l}=await H(n,{headers:{authorization:`Bearer ${s.accessToken}`}});i=l||null}if(!i)return null;const a=await e.mapProfileToUser?.(i),c=i.sub||i.userId,u=i.name||i.displayName,d=i.picture||i.pictureUrl||void 0;return{user:{id:c,name:u,email:i.email,image:d,emailVerified:!1,...a},data:i}},options:e}},UE=e=>{const t="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:r,scopes:n,loginHint:o,redirectURI:s}){const i=e.disableDefaultScope?[]:["read"];return e.scope&&i.push(...e.scope),n&&i.push(...n),ne({id:"linear",options:e,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:i,state:r,redirectURI:s,loginHint:o})},validateAuthorizationCode:async({code:r,redirectURI:n})=>X({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await H("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(o||!n?.data?.viewer)return null;const s=n.data.viewer,i=await e.mapProfileToUser?.(s);return{user:{id:n.data.viewer.id,name:n.data.viewer.name,email:n.data.viewer.email,image:n.data.viewer.avatarUrl,emailVerified:!1,...i},data:s}},options:e}},$E=e=>{const t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:n,scopes:o,redirectURI:s,loginHint:i})=>{const a=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&a.push(...e.scope),o&&a.push(...o),await ne({id:"linkedin",options:e,authorizationEndpoint:t,scopes:a,state:n,loginHint:i,redirectURI:s})},validateAuthorizationCode:async({code:n,redirectURI:o})=>await X({code:n,redirectURI:o,options:e,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async n=>ee({refreshToken:n,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:r}),async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);const{data:o,error:s}=await H("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${n.accessToken}`}});if(s)return null;const i=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,emailVerified:o.email_verified||!1,image:o.picture,...i},data:o}},options:e}},CE=e=>{const t=e.tenantId||"common",r=e.authority||"https://login.microsoftonline.com",n=`${r}/${t}/oauth2/v2.0/authorize`,o=`${r}/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(s){const i=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&i.push(...e.scope),s.scopes&&i.push(...s.scopes),ne({id:"microsoft",options:e,authorizationEndpoint:n,state:s.state,codeVerifier:s.codeVerifier,scopes:i,redirectURI:s.redirectURI,prompt:e.prompt,loginHint:s.loginHint})},validateAuthorizationCode({code:s,codeVerifier:i,redirectURI:a}){return X({code:s,codeVerifier:i,redirectURI:a,options:e,tokenEndpoint:o})},async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);if(!s.idToken)return null;const i=it(s.idToken),a=e.profilePhotoSize||48;await H(`https://graph.microsoft.com/v1.0/me/photos/${a}x${a}/$value`,{headers:{Authorization:`Bearer ${s.accessToken}`},async onResponse(d){if(!(e.disableProfilePhoto||!d.response.ok))try{const l=await d.response.clone().arrayBuffer();i.picture=`data:image/jpeg;base64, ${Ke.encode(l)}`}catch(l){Q.error(l&&typeof l=="object"&&"name"in l?l.name:"",l)}}});const c=await e.mapProfileToUser?.(i),u=i.email_verified!==void 0?i.email_verified:!!(i.email&&(i.verified_primary_email?.includes(i.email)||i.verified_secondary_email?.includes(i.email)));return{user:{id:i.sub,name:i.name,email:i.email,image:i.picture,emailVerified:u,...c},data:i}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>{const i=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&i.push(...e.scope),ee({refreshToken:s,options:{clientId:e.clientId,clientSecret:e.clientSecret},extraParams:{scope:i.join(" ")},tokenEndpoint:o})},options:e}},OE=e=>({id:"naver",name:"Naver",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["profile","email"];return e.scope&&o.push(...e.scope),r&&o.push(...r),ne({id:"naver",options:e,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:o,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r||r.resultcode!=="00")return null;const o=await e.mapProfileToUser?.(r),s=r.response||{};return{user:{id:s.id,name:s.name||s.nickname,email:s.email,image:s.profile_image,emailVerified:!1,...o},data:r}},options:e}),PE=e=>{const t="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:r,scopes:n,loginHint:o,redirectURI:s}){const i=e.disableDefaultScope?[]:[];return e.scope&&i.push(...e.scope),n&&i.push(...n),ne({id:"notion",options:e,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:i,state:r,redirectURI:s,loginHint:o,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:r,redirectURI:n})=>X({code:r,redirectURI:n,options:e,tokenEndpoint:t,authentication:"basic"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);const{data:n,error:o}=await H("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${r.accessToken}`,"Notion-Version":"2022-06-28"}});if(o||!n)return null;const s=n.bot?.owner?.user;if(!s)return null;const i=await e.mapProfileToUser?.(s);return{user:{id:s.id,name:s.name||"Notion User",email:s.person?.email||null,image:s.avatar_url,emailVerified:!!s.person?.email,...i},data:s}},options:e}},DE=e=>{const t=e.issuer||"https://idp.paybin.io",r=`${t}/oauth2/authorize`,n=`${t}/oauth2/token`;return{id:"paybin",name:"Paybin",async createAuthorizationURL({state:o,scopes:s,codeVerifier:i,redirectURI:a,loginHint:c}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Client Secret is required for Paybin. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new Y("codeVerifier is required for Paybin");const u=e.disableDefaultScope?[]:["openid","email","profile"];return e.scope&&u.push(...e.scope),s&&u.push(...s),await ne({id:"paybin",options:e,authorizationEndpoint:r,scopes:u,state:o,codeVerifier:i,redirectURI:a,prompt:e.prompt,loginHint:c})},validateAuthorizationCode:async({code:o,codeVerifier:s,redirectURI:i})=>X({code:o,codeVerifier:s,redirectURI:i,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async o=>ee({refreshToken:o,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:n}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;const s=it(o.idToken),i=await e.mapProfileToUser?.(s);return{user:{id:s.sub,name:s.name||s.preferred_username||(s.email?s.email.split("@")[0]:"User")||"User",email:s.email,image:s.picture,emailVerified:s.email_verified||!1,...i},data:s}},options:e}},zE=e=>{const t=(e.environment||"sandbox")==="sandbox",r=t?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",n=t?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",o=t?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:s,codeVerifier:i,redirectURI:a}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");return await ne({id:"paypal",options:e,authorizationEndpoint:r,scopes:[],state:s,codeVerifier:i,redirectURI:a,prompt:e.prompt})},validateAuthorizationCode:async({code:s,redirectURI:i})=>{const a=Ke.encode(`${e.clientId}:${e.clientSecret}`);try{const c=await H(n,{method:"POST",headers:{Authorization:`Basic ${a}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:s,redirect_uri:i}).toString()});if(!c.data)throw new Y("FAILED_TO_GET_ACCESS_TOKEN");const u=c.data;return{accessToken:u.access_token,refreshToken:u.refresh_token,accessTokenExpiresAt:u.expires_in?new Date(Date.now()+u.expires_in*1e3):void 0,idToken:u.id_token}}catch(c){throw Q.error("PayPal token exchange failed:",c),new Y("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>{const i=Ke.encode(`${e.clientId}:${e.clientSecret}`);try{const a=await H(n,{method:"POST",headers:{Authorization:`Basic ${i}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:s}).toString()});if(!a.data)throw new Y("FAILED_TO_REFRESH_ACCESS_TOKEN");const c=a.data;return{accessToken:c.access_token,refreshToken:c.refresh_token,accessTokenExpiresAt:c.expires_in?new Date(Date.now()+c.expires_in*1e3):void 0}}catch(a){throw Q.error("PayPal token refresh failed:",a),new Y("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(s,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(s,i);try{return!!it(s).sub}catch(a){return Q.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);if(!s.accessToken)return Q.error("Access token is required to fetch PayPal user info"),null;try{const i=await H(`${o}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${s.accessToken}`,Accept:"application/json"}});if(!i.data)return Q.error("Failed to fetch user info from PayPal"),null;const a=i.data,c=await e.mapProfileToUser?.(a);return{user:{id:a.user_id,name:a.name,email:a.email,image:a.picture,emailVerified:a.email_verified,...c},data:a}}catch(i){return Q.error("Failed to fetch user info from PayPal:",i),null}},options:e}},xE=e=>({id:"polar",name:"Polar",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"polar",options:e,authorizationEndpoint:"https://polar.sh/oauth2/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o,prompt:e.prompt})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://api.polar.sh/v1/oauth2/userinfo",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.public_name||r.username,email:r.email,image:r.avatar_url,emailVerified:r.email_verified??!1,...o},data:r}},options:e}),LE=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["identity"];return e.scope&&o.push(...e.scope),r&&o.push(...r),ne({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:t,redirectURI:n,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{const n=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),{data:o,error:s}=await H("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Ke.encode(`${e.clientId}:${e.clientSecret}`)}`},body:n.toString()});if(s)throw s;return uu(o)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...o},data:r}},options:e}),NE=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!1,...o},data:{...r}}},options:e}),ZE=e=>{const t=(e.environment??"production")==="sandbox",r=e.loginUrl?`https://${e.loginUrl}/services/oauth2/authorize`:t?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",n=e.loginUrl?`https://${e.loginUrl}/services/oauth2/token`:t?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",o=e.loginUrl?`https://${e.loginUrl}/services/oauth2/userinfo`:t?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:s,scopes:i,codeVerifier:a,redirectURI:c}){if(!e.clientId||!e.clientSecret)throw Q.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new Y("CLIENT_ID_AND_SECRET_REQUIRED");if(!a)throw new Y("codeVerifier is required for Salesforce");const u=e.disableDefaultScope?[]:["openid","email","profile"];return e.scope&&u.push(...e.scope),i&&u.push(...i),ne({id:"salesforce",options:e,authorizationEndpoint:r,scopes:u,state:s,codeVerifier:a,redirectURI:e.redirectURI||c})},validateAuthorizationCode:async({code:s,codeVerifier:i,redirectURI:a})=>X({code:s,codeVerifier:i,redirectURI:e.redirectURI||a,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async s=>ee({refreshToken:s,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:n}),async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);try{const{data:i}=await H(o,{headers:{Authorization:`Bearer ${s.accessToken}`}});if(!i)return Q.error("Failed to fetch user info from Salesforce"),null;const a=await e.mapProfileToUser?.(i);return{user:{id:i.user_id,name:i.name,email:i.email,image:i.photos?.picture||i.photos?.thumbnail,emailVerified:i.email_verified??!1,...a},data:i}}catch(i){return Q.error("Failed to fetch user info from Salesforce:",i),null}},options:e}},jE=e=>({id:"slack",name:"Slack",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["openid","profile","email"];r&&o.push(...r),e.scope&&o.push(...e.scope);const s=new URL("https://slack.com/openid/connect/authorize");return s.searchParams.set("scope",o.join(" ")),s.searchParams.set("response_type","code"),s.searchParams.set("client_id",e.clientId),s.searchParams.set("redirect_uri",e.redirectURI||n),s.searchParams.set("state",t),s},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r["https://slack.com/user_id"],name:r.name||"",email:r.email,emailVerified:r.email_verified,image:r.picture||r["https://slack.com/user_image_512"],...o},data:r}},options:e}),ME=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...o},data:r}},options:e}),KE=e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${o.join(",")}&response_type=code&client_key=${e.clientKey}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:e.redirectURI||r,options:{clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:e.clientKey}}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H(`https://open.tiktokapis.com/v2/user/info/?fields=${["open_id","avatar_large_url","display_name","username"].join(",")}`,{headers:{authorization:`Bearer ${t.accessToken}`}});return n?null:{user:{email:r.data.user.email||r.data.user.username,id:r.data.user.open_id,name:r.data.user.display_name||r.data.user.username,image:r.data.user.avatar_large_url,emailVerified:!!r.data.user.email},data:r}},options:e}),HE=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){const o=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&o.push(...e.scope),r&&o.push(...r),ne({id:"twitch",redirectURI:n,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>X({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=t.idToken;if(!r)return Q.error("No idToken found in token"),null;const n=it(r),o=await e.mapProfileToUser?.(n);return{user:{id:n.sub,name:n.preferred_username,email:n.email,image:n.picture,emailVerified:n.email_verified,...o},data:n}},options:e}),qE=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){const r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),ne({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,authentication:"basic",redirectURI:n,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const{data:o,error:s}=await H("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});let i=!1;!s&&o?.data?.confirmed_email&&(r.data.email=o.data.confirmed_email,i=!0);const a=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.email||r.data.username||null,image:r.data.profile_image_url,emailVerified:i,...a},data:r}},options:e}),VE=e=>({id:"vercel",name:"Vercel",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){if(!n)throw new Y("codeVerifier is required for Vercel");let s;return(e.scope!==void 0||r!==void 0)&&(s=[],e.scope&&s.push(...e.scope),r&&s.push(...r)),ne({id:"vercel",options:e,authorizationEndpoint:"https://vercel.com/oauth/authorize",scopes:s,state:t,codeVerifier:n,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>X({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://api.vercel.com/login/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await H("https://api.vercel.com/login/oauth/userinfo",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r)return null;const o=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name??r.preferred_username,email:r.email,image:r.picture,emailVerified:r.email_verified??!1,...o},data:r}},options:e}),BE=e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:o}){const s=e.disableDefaultScope?[]:["email","phone"];return e.scope&&s.push(...e.scope),r&&s.push(...r),ne({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:s,state:t,redirectURI:o,codeVerifier:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n,deviceId:o})=>X({code:t,codeVerifier:r,redirectURI:e.redirectURI||n,options:e,deviceId:o,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>ee({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;const r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:n,error:o}=await H("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(o)return null;const s=await e.mapProfileToUser?.(n);return!n.user.email&&!s?.email?null:{user:{id:n.user.user_id,first_name:n.user.first_name,last_name:n.user.last_name,email:n.user.email,image:n.user.avatar,emailVerified:!!n.user.email,birthday:n.user.birthday,sex:n.user.sex,name:`${n.user.first_name} ${n.user.last_name}`,...s},data:n}},options:e}),WE=e=>{const t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:r,redirectURI:n,codeVerifier:o})=>{const s=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:n,client_id:t.clientId,state:r});if(t.pkce){const a=await du(o);s.set("code_challenge_method","S256"),s.set("code_challenge",a)}const i=new URL("https://zoom.us/oauth/authorize");return i.search=s.toString(),i},validateAuthorizationCode:async({code:r,redirectURI:n,codeVerifier:o})=>X({code:r,redirectURI:t.redirectURI||n,codeVerifier:o,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),refreshAccessToken:t.refreshAccessToken?t.refreshAccessToken:async r=>ee({refreshToken:r,options:{clientId:t.clientId,clientKey:t.clientKey,clientSecret:t.clientSecret},tokenEndpoint:"https://zoom.us/oauth/token"}),async getUserInfo(r){if(t.getUserInfo)return t.getUserInfo(r);const{data:n,error:o}=await H("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${r.accessToken}`}});if(o)return null;const s=await t.mapProfileToUser?.(n);return{user:{id:n.id,name:n.display_name,image:n.pic_url,email:n.email,emailVerified:!!n.verified,...s},data:{...n}}}}},FE={apple:fE,atlassian:hE,cognito:mE,discord:yE,facebook:_E,figma:bE,github:vE,microsoft:CE,google:kE,huggingface:TE,slack:jE,spotify:ME,twitch:HE,twitter:qE,dropbox:wE,kick:IE,linear:UE,linkedin:$E,gitlab:EE,tiktok:KE,reddit:LE,roblox:NE,salesforce:ZE,vk:BE,zoom:WE,notion:PE,kakao:SE,naver:OE,line:RE,paybin:DE,paypal:zE,polar:xE,vercel:VE},JE=Object.keys(FE),Zu=zu(JE).or(_e());function uo(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function jo(e,t,r=".",n){if(!uo(t))return jo(e,{},r,n);const o=Object.assign({},t);for(const s in e){if(s==="__proto__"||s==="constructor")continue;const i=e[s];i!=null&&(n&&n(o,s,i,r)||(Array.isArray(i)&&Array.isArray(o[s])?o[s]=[...i,...o[s]]:uo(i)&&uo(o[s])?o[s]=jo(i,o[s],(r?`${r}.`:"")+s.toString(),n):o[s]=i))}return o}function ju(e){return(...t)=>t.reduce((r,n)=>jo(r,n,"",e),{})}const AT=ju();function Mo(e){return e==="-"||e==="^"||e==="$"||e==="+"||e==="."||e==="("||e===")"||e==="|"||e==="["||e==="]"||e==="{"||e==="}"||e==="*"||e==="?"||e==="\\"?`\\${e}`:e}function GE(e){let t="";for(let r=0;r<e.length;r++)t+=Mo(e[r]);return t}function Mu(e,t=!0){if(Array.isArray(e))return`(?:${e.map(u=>`^${Mu(u,t)}$`).join("|")})`;let r="",n="",o=".";t===!0?(r="/",n="[/\\\\]",o="[^/\\\\]"):t&&(r=t,n=GE(r),n.length>1?(n=`(?:${n})`,o=`((?!${n}).)`):o=`[^${n}]`);let s=t?`${n}+?`:"",i=t?`${n}*?`:"",a=t?e.split(r):[e],c="";for(let u=0;u<a.length;u++){let d=a[u],l=a[u+1],f="";if(!(!d&&u>0)){if(t&&(u===a.length-1?f=i:l!=="**"?f=s:f=""),t&&d==="**"){f&&(c+=u===0?"":f,c+=`(?:${o}*?${f})*?`);continue}for(let p=0;p<d.length;p++){let h=d[p];h==="\\"?p<d.length-1&&(c+=Mo(d[p+1]),p++):h==="?"?c+=o:h==="*"?c+=`${o}*?`:c+=Mo(h)}c+=f}}return c}function QE(e,t){if(typeof t!="string")throw new TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function _r(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if((typeof t=="string"||typeof t=="boolean")&&(t={separator:t}),arguments.length===2&&!(typeof t>"u"||typeof t=="object"&&t!==null&&!Array.isArray(t)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if(t=t||{},t.separator==="\\")throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=Mu(e,t.separator),n=new RegExp(`^${r}$`,t.flags),o=QE.bind(null,n);return o.options=t,o.pattern=e,o.regexp=n,o}const YE=et(async e=>{if(e.request?.method==="GET"||e.request?.method==="OPTIONS"||e.request?.method==="HEAD"||!e.request)return;const t=e.request?.headers,r=e.request,{body:n,query:o,context:s}=e,i=t?.get("origin")||t?.get("referer")||"",a=n?.callbackURL||o?.callbackURL,c=n?.redirectTo,u=n?.errorCallbackURL,d=n?.newUserCallbackURL,l=Array.isArray(s.options.trustedOrigins)?s.trustedOrigins:[...s.trustedOrigins,...await s.options.trustedOrigins?.(r)||[]],f=t?.has("cookie"),p=(m,y)=>{if(m.startsWith("/"))return!1;if(y.includes("*")){if(y.includes("://"))return _r(y)(fr(m)||m);const k=ua(m);return k?_r(y)(k):!1}const b=ca(m);return b==="http:"||b==="https:"||!b?y===fr(m):m.startsWith(y)},h=(m,y)=>{if(m&&!l.some(b=>p(m,b)||m?.startsWith("/")&&y!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(m)))throw e.context.logger.error(`Invalid ${y}: ${m}`),e.context.logger.info(`If it's a valid URL, please add ${m} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${l}`),new g("FORBIDDEN",{message:`Invalid ${y}`})};if(f&&!e.context.skipCSRFCheck&&!e.context.skipOriginCheck){if(!i||i==="null")throw new g("FORBIDDEN",{message:"Missing or null Origin"});h(i,"origin")}a&&h(a,"callbackURL"),c&&h(c,"redirectURL"),u&&h(u,"errorCallbackURL"),d&&h(d,"newUserCallbackURL")}),vs=e=>et(async t=>{if(!t.request)return;const{context:r}=t,n=e(t),o=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(t.request)||[]],s=(c,u)=>{if(c.startsWith("/"))return!1;if(u.includes("*")){if(u.includes("://"))return _r(u)(fr(c)||c);const l=ua(c);return l?_r(u)(l):!1}const d=ca(c);return d==="http:"||d==="https:"||!d?u===fr(c):c.startsWith(u)},i=(c,u)=>{if(c&&!o.some(d=>s(c,d)||c?.startsWith("/")&&u!=="origin"&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(c)))throw t.context.logger.error(`Invalid ${u}: ${c}`),t.context.logger.info(`If it's a valid URL, please add ${c} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${o}`),new g("FORBIDDEN",{message:`Invalid ${u}`})},a=Array.isArray(n)?n:[n];for(const c of a)i(c,"callbackURL")});function XE(e,t,r){const n=Date.now(),o=t*1e3;return n-r.lastRequest<o&&r.count>=e}function ek(e){return new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":e.toString()}})}function tk(e,t){const r=Date.now(),n=t*1e3;return Math.ceil((e+n-r)/1e3)}function rk(e){const t="rateLimit",r=e.adapter;return{get:async n=>{const o=(await r.findMany({model:t,where:[{field:"key",value:n}]}))[0];return typeof o?.lastRequest=="bigint"&&(o.lastRequest=Number(o.lastRequest)),o},set:async(n,o,s)=>{try{s?await r.updateMany({model:t,where:[{field:"key",value:n}],update:{count:o.count,lastRequest:o.lastRequest}}):await r.create({model:t,data:{key:n,count:o.count,lastRequest:o.lastRequest}})}catch(i){e.logger.error("Error setting rate limit",i)}}}}const Yi=new Map;function nk(e,t){if(e.options.rateLimit?.customStorage)return e.options.rateLimit.customStorage;const r=e.rateLimit.storage;return r==="secondary-storage"?{get:async n=>{const o=await e.options.secondaryStorage?.get(n);return o?xn(o):void 0},set:async(n,o,s)=>{const i=t?.window??e.options.rateLimit?.window??10;await e.options.secondaryStorage?.set?.(n,JSON.stringify(o),i)}}:r==="memory"?{async get(n){return Yi.get(n)},async set(n,o,s){Yi.set(n,o)}}:rk(e)}async function Xi(e,t){if(!t.rateLimit.enabled)return;const r=new URL(e.url).pathname.replace(t.options.basePath||"/api/auth","");let n=t.rateLimit.window,o=t.rateLimit.max;const s=uw(e,t.options);if(!s)return;const i=s+r,a=ok().find(l=>l.pathMatcher(r));a&&(n=a.window,o=a.max);for(const l of t.options.plugins||[])if(l.rateLimit){const f=l.rateLimit.find(p=>p.pathMatcher(r));if(f){n=f.window,o=f.max;break}}if(t.rateLimit.customRules){const l=Object.keys(t.rateLimit.customRules).find(f=>f.includes("*")?_r(f)(r):f===r);if(l){const f=t.rateLimit.customRules[l],p=typeof f=="function"?await f(e):f;if(p&&(n=p.window,o=p.max),p===!1)return}}const c=nk(t,{window:n}),u=await c.get(i),d=Date.now();if(!u)await c.set(i,{key:i,count:1,lastRequest:d});else{const l=d-u.lastRequest;if(XE(o,n,u))return ek(tk(u.lastRequest,n));l>n*1e3?await c.set(i,{...u,count:1,lastRequest:d},!0):await c.set(i,{...u,count:u.count+1,lastRequest:d},!0)}}function ok(){return[{pathMatcher(e){return e.startsWith("/sign-in")||e.startsWith("/sign-up")||e.startsWith("/change-password")||e.startsWith("/change-email")},window:10,max:3}]}function Ko(e,t){return e&&(t.options.account?.encryptOAuthTokens?$n({key:t.secret,data:e}):e)}function Ee(e,t){return t.options.account?.encryptOAuthTokens&&e?Un({key:t.secret,data:e}):e}const sk=K("/list-accounts",{method:"GET",use:[st],metadata:{openapi:{operationId:"listUserAccounts",description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},userId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","userId","scopes"]}}}}}}}}},async e=>{const t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(n=>({id:n.id,providerId:n.providerId,createdAt:n.createdAt,updatedAt:n.updatedAt,accountId:n.accountId,userId:n.userId,scopes:n.scope?.split(",")||[]})))}),ik=K("/link-social",{method:"POST",requireHeaders:!0,body:B({callbackURL:_().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:Zu,idToken:B({token:_(),nonce:_().optional(),accessToken:_().optional(),refreshToken:_().optional(),scopes:Qe(_()).optional()}).optional(),requestSignUp:He().optional(),scopes:Qe(_()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:_().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:He().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),additionalData:xe(_(),Ce()).optional()}),use:[st],metadata:{openapi:{description:"Link a social account to the user",operationId:"linkSocialAccount",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{const t=e.context.session,r=e.context.socialProviders.find(s=>s.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new g("NOT_FOUND",{message:j.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!r.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new g("NOT_FOUND",{message:j.ID_TOKEN_NOT_SUPPORTED});const{token:s,nonce:i}=e.body.idToken;if(!await r.verifyIdToken(s,i))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.INVALID_TOKEN});const a=await r.getUserInfo({idToken:s,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!a||!a?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.FAILED_TO_GET_USER_INFO});const c=String(a.user.id);if(!a.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.USER_EMAIL_NOT_FOUND});if((await e.context.internalAdapter.findAccounts(t.user.id)).find(u=>u.providerId===r.id&&u.accountId===c))return e.json({url:"",status:!0,redirect:!1});if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.id)&&!a.user.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)throw new g("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(a.user.email!==t.user.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new g("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await e.context.internalAdapter.createAccount({userId:t.user.id,providerId:r.id,accountId:c,accessToken:e.body.idToken.accessToken,idToken:s,refreshToken:e.body.idToken.refreshToken,scope:e.body.idToken.scopes?.join(",")})}catch{throw new g("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(e.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await e.context.internalAdapter.updateUser(t.user.id,{name:a.user?.name,image:a.user?.image})}catch(u){console.warn("Could not update user - "+u.toString())}return e.json({url:"",status:!0,redirect:!1})}const n=await Jc(e,{userId:t.user.id,email:t.user.email},e.body.additionalData),o=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:o.toString(),redirect:!e.body.disableRedirect})}),ak=K("/unlink-account",{method:"POST",body:B({providerId:_(),accountId:_().optional()}),use:[kw],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const{providerId:t,accountId:r}=e.body,n=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(n.length===1&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new g("BAD_REQUEST",{message:j.FAILED_TO_UNLINK_LAST_ACCOUNT});const o=n.find(s=>r?s.accountId===r&&s.providerId===t:s.providerId===t);if(!o)throw new g("BAD_REQUEST",{message:j.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(o.id),e.json({status:!0})}),Ku=K("/get-access-token",{method:"POST",body:B({providerId:_().meta({description:"The provider ID for the OAuth provider"}),accountId:_().meta({description:"The account ID associated with the refresh token"}).optional(),userId:_().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{const{providerId:t,accountId:r,userId:n}=e.body||{},o=e.request,s=await De(e);if(o&&!s)throw e.error("UNAUTHORIZED");let i=s?.user?.id||n;if(!i)throw e.error("UNAUTHORIZED");if(!e.context.socialProviders.find(d=>d.id===t))throw new g("BAD_REQUEST",{message:`Provider ${t} is not supported.`});const a=await ps(e);let c;if(a&&t===a.providerId&&(!r||a.id===r)?c=a:c=(await e.context.internalAdapter.findAccounts(i)).find(d=>r?d.id===r&&d.providerId===t:d.providerId===t),!c)throw new g("BAD_REQUEST",{message:"Account not found"});const u=e.context.socialProviders.find(d=>d.id===t);if(!u)throw new g("BAD_REQUEST",{message:`Provider ${t} not found.`});try{let d=null;const l=c.accessTokenExpiresAt&&new Date(c.accessTokenExpiresAt).getTime()-Date.now()<5e3;if(c.refreshToken&&l&&u.refreshAccessToken){const p=await Ko(c.refreshToken,e.context);d=await u.refreshAccessToken(p);const h=await e.context.internalAdapter.updateAccount(c.id,{accessToken:await Ee(d.accessToken,e.context),accessTokenExpiresAt:d.accessTokenExpiresAt,refreshToken:await Ee(d.refreshToken,e.context),refreshTokenExpiresAt:d.refreshTokenExpiresAt});e.context.options.account?.storeAccountCookie&&h&&await hn(e,h)}const f={accessToken:d?.accessToken??await Ko(c.accessToken??"",e.context),accessTokenExpiresAt:d?.accessTokenExpiresAt??c.accessTokenExpiresAt??void 0,scopes:c.scope?.split(",")??[],idToken:d?.idToken??c.idToken??void 0};return e.json(f)}catch(d){throw new g("BAD_REQUEST",{message:"Failed to get a valid access token",cause:d})}}),ck=K("/refresh-token",{method:"POST",body:B({providerId:_().meta({description:"The provider ID for the OAuth provider"}),accountId:_().meta({description:"The account ID associated with the refresh token"}).optional(),userId:_().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{const{providerId:t,accountId:r,userId:n}=e.body,o=e.request,s=await De(e);if(o&&!s)throw e.error("UNAUTHORIZED");let i=s?.user?.id||n;if(!i)throw new g("BAD_REQUEST",{message:"Either userId or session is required"});const a=e.context.socialProviders.find(l=>l.id===t);if(!a)throw new g("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!a.refreshAccessToken)throw new g("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});let c;const u=await ps(e);if(u&&(!t||t===u?.providerId)?c=u:c=(await e.context.internalAdapter.findAccounts(i)).find(l=>r?l.id===r&&l.providerId===t:l.providerId===t),!c)throw new g("BAD_REQUEST",{message:"Account not found"});let d;if(u&&t===u.providerId?d=u.refreshToken??void 0:d=c.refreshToken??void 0,!d)throw new g("BAD_REQUEST",{message:"Refresh token not found"});try{const l=await Ko(d,e.context),f=await a.refreshAccessToken(l);if(c.id){const p={...c||{},accessToken:await Ee(f.accessToken,e.context),refreshToken:await Ee(f.refreshToken,e.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||c.scope,idToken:f.idToken||c.idToken};await e.context.internalAdapter.updateAccount(c.id,p)}return u&&t===u.providerId&&e.context.options.account?.storeAccountCookie&&await hn(e,{...u,accessToken:await Ee(f.accessToken,e.context),refreshToken:await Ee(f.refreshToken,e.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||u.scope,idToken:f.idToken||u.idToken}),e.json({accessToken:f.accessToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||c.scope,idToken:f.idToken||c.idToken,providerId:c.providerId,accountId:c.accountId})}catch(l){throw new g("BAD_REQUEST",{message:"Failed to refresh access token",cause:l})}}),uk=er(B({accountId:_().meta({description:"The provider given account id for which to get the account info"}).optional()})),dk=K("/account-info",{method:"GET",use:[st],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},query:uk},async e=>{const t=e.query?.accountId;let r;if(t){const i=await e.context.internalAdapter.findAccount(t);i&&(r=i)}else if(e.context.options.account?.storeAccountCookie){const i=await ps(e);i&&(r=i)}if(!r||r.userId!==e.context.session.user.id)throw new g("BAD_REQUEST",{message:"Account not found"});const n=e.context.socialProviders.find(i=>i.id===r.providerId);if(!n)throw new g("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${r.providerId} but it is not configured`});const o=await Ku({...e,method:"POST",body:{accountId:r.id,providerId:r.providerId},returnHeaders:!1,returnStatus:!1});if(!o.accessToken)throw new g("BAD_REQUEST",{message:"Access token not found"});const s=await n.getUserInfo({...o,accessToken:o.accessToken});return e.json(s)});async function Hu(e,{userInfo:t,account:r,callbackURL:n,disableSignUp:o,overrideUserInfo:s}){const i=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(d=>{Q.error(`Better auth was unable to query your database.
Error: `,d);const l=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${l}?error=internal_server_error`)});let a=i?.user,c=!a;if(i){const d=i.accounts.find(l=>l.providerId===r.providerId&&l.accountId===r.accountId);if(d){if(e.context.options.account?.updateAccountOnSignIn!==!1){const l=Object.fromEntries(Object.entries({idToken:r.idToken,accessToken:await Ee(r.accessToken,e.context),refreshToken:await Ee(r.refreshToken,e.context),accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([f,p])=>p!==void 0));e.context.options.account?.storeAccountCookie&&await hn(e,l),Object.keys(l).length>0&&await e.context.internalAdapter.updateAccount(d.id,l)}t.emailVerified&&!i.user.emailVerified&&t.email.toLowerCase()===i.user.email&&await e.context.internalAdapter.updateUser(i.user.id,{emailVerified:!0})}else{if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(r.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return Bo()&&Q.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:i.user.id,accessToken:await Ee(r.accessToken,e.context),refreshToken:await Ee(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope})}catch(l){return Q.error("Unable to link account",l),{error:"unable to link account",data:null}}t.emailVerified&&!i.user.emailVerified&&t.email.toLowerCase()===i.user.email&&await e.context.internalAdapter.updateUser(i.user.id,{emailVerified:!0})}if(s){const{id:l,...f}=t;a=await e.context.internalAdapter.updateUser(i.user.id,{...f,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===i.user.email&&i.user.emailVerified||t.emailVerified})}}else{if(o)return{error:"signup disabled",data:null,isRegister:!1};try{const{id:d,...l}=t,f={accessToken:await Ee(r.accessToken,e.context),refreshToken:await Ee(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},{user:p,account:h}=await e.context.internalAdapter.createOAuthUser({...l,email:t.email.toLowerCase()},f);if(a=p,e.context.options.account?.storeAccountCookie&&await hn(e,h),!t.emailVerified&&a&&e.context.options.emailVerification?.sendOnSignUp){const m=await Ye(e.context.secret,a.email,void 0,e.context.options.emailVerification?.expiresIn),y=`${e.context.baseURL}/verify-email?token=${m}&callbackURL=${n}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:a,url:y,token:m},e.request)}}catch(d){return Q.error(d),d instanceof g?{error:d.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}}if(!a)return{error:"unable to create user",data:null,isRegister:!1};const u=await e.context.internalAdapter.createSession(a.id);return u?{data:{session:u,user:a},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}const bt=B({code:_().optional(),error:_().optional(),device_id:_().optional(),error_description:_().optional(),state:_().optional(),user:_().optional()}),lk=K("/callback/:id",{method:["GET","POST"],operationId:"handleOAuthCallback",body:bt.optional(),query:bt.optional(),metadata:{...ls,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async e=>{let t;const r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;if(e.method==="POST"){const O=e.body?bt.parse(e.body):{},M=e.query?bt.parse(e.query):{},x=bt.parse({...O,...M}),Z=new URLSearchParams;for(const[q,R]of Object.entries(x))R!=null&&Z.set(q,String(R));const C=`${e.context.baseURL}/callback/${e.params.id}?${Z.toString()}`;throw e.redirect(C)}try{if(e.method==="GET")t=bt.parse(e.query);else if(e.method==="POST")t=bt.parse(e.body);else throw new Error("Unsupported method")}catch(O){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",O),e.redirect(`${r}?error=invalid_callback_request`)}const{code:n,error:o,state:s,error_description:i,device_id:a}=t;if(!s){e.context.logger.error("State not found",o);const O=`${r}${r.includes("?")?"&":"?"}state=state_not_found`;throw e.redirect(O)}const{codeVerifier:c,callbackURL:u,link:d,errorURL:l,newUserURL:f,requestSignUp:p}=await aw(e);function h(O,M){const x=l??r,Z=new URLSearchParams({error:O});M&&Z.set("error_description",M);const C=`${x}${x.includes("?")?"&":"?"}${Z.toString()}`;throw e.redirect(C)}if(o&&h(o,i),!n)throw e.context.logger.error("Code not found"),h("no_code");const m=e.context.socialProviders.find(O=>O.id===e.params.id);if(!m)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),h("oauth_provider_not_found");let y;try{y=await m.validateAuthorizationCode({code:n,codeVerifier:c,deviceId:a,redirectURI:`${e.context.baseURL}/callback/${m.id}`})}catch(O){throw e.context.logger.error("",O),h("invalid_code")}const b=await m.getUserInfo({...y,user:e.body?.user?xn(e.body.user):void 0}).then(O=>O?.user);if(!b)return e.context.logger.error("Unable to get user info"),h("unable_to_get_user_info");if(!u)throw e.context.logger.error("No callback URL found"),h("no_callback_url");if(d){if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(m.id)&&!b.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return e.context.logger.error("Unable to link account - untrusted provider"),h("unable_to_link_account");if(b.email!==d.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return h("email_doesn't_match");const O=await e.context.internalAdapter.findAccount(String(b.id));if(O){if(O.userId.toString()!==d.userId.toString())return h("account_already_linked_to_different_user");const x=Object.fromEntries(Object.entries({accessToken:await Ee(y.accessToken,e.context),refreshToken:await Ee(y.refreshToken,e.context),idToken:y.idToken,accessTokenExpiresAt:y.accessTokenExpiresAt,refreshTokenExpiresAt:y.refreshTokenExpiresAt,scope:y.scopes?.join(",")}).filter(([Z,C])=>C!==void 0));await e.context.internalAdapter.updateAccount(O.id,x)}else if(!await e.context.internalAdapter.createAccount({userId:d.userId,providerId:m.id,accountId:String(b.id),...y,accessToken:await Ee(y.accessToken,e.context),refreshToken:await Ee(y.refreshToken,e.context),scope:y.scopes?.join(",")}))return h("unable_to_link_account");let M;try{M=u.toString()}catch{M=u}throw e.redirect(M)}if(!b.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),h("email_not_found");const k={providerId:m.id,accountId:String(b.id),...y,scope:y.scopes?.join(",")},v=await Hu(e,{userInfo:{...b,id:String(b.id),email:b.email,name:b.name||b.email},account:k,callbackURL:u,disableSignUp:m.disableImplicitSignUp&&!p||m.options?.disableSignUp,overrideUserInfo:m.options?.overrideUserInfoOnSignIn});if(v.error)return e.context.logger.error(v.error.split(" ").join("_")),h(v.error.split(" ").join("_"));const{session:w,user:N}=v.data;await Le(e,{session:w,user:N});let T;try{T=(v.isRegister&&f||u).toString()}catch{T=v.isRegister&&f||u}throw e.redirect(T)});async function Ye(e,t,r,n=3600,o){return await Qa({email:t.toLowerCase(),updateTo:r,...o},e,n)}async function ea(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new g("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await Ye(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),n=e.body.callbackURL?encodeURIComponent(e.body.callbackURL):encodeURIComponent("/"),o=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${n}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:o,token:r},e.request)}const fk=K("/send-verification-email",{method:"POST",operationId:"sendVerificationEmail",body:B({email:sr().meta({description:"The email to send the verification email to"}),callbackURL:_().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{operationId:"sendVerificationEmail",description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new g("BAD_REQUEST",{message:"Verification email isn't enabled"});const{email:t}=e.body,r=await De(e);if(!r){const n=await e.context.internalAdapter.findUserByEmail(t);return n?(await ea(e,n.user),e.json({status:!0})):(await Ye(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),e.json({status:!0}))}if(r?.user.emailVerified)throw new g("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(r?.user.email!==t)throw new g("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await ea(e,r.user),e.json({status:!0})}),pk=K("/verify-email",{method:"GET",operationId:"verifyEmail",query:B({token:_().meta({description:"The token to verify the email"}),callbackURL:_().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[vs(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{function t(a){throw e.query.callbackURL?e.query.callbackURL.includes("?")?e.redirect(`${e.query.callbackURL}&error=${a}`):e.redirect(`${e.query.callbackURL}?error=${a}`):new g("UNAUTHORIZED",{message:a})}const{token:r}=e.query;let n;try{n=await Rt(r,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(a){return a instanceof wo?t("token_expired"):t("invalid_token")}const o=B({email:sr(),updateTo:_().optional(),requestType:_().optional()}).parse(n.payload),s=await e.context.internalAdapter.findUserByEmail(o.email);if(!s)return t("user_not_found");if(o.updateTo){let a=await De(e);if(a&&a.user.email!==o.email)return t("unauthorized");if(o.requestType==="change-email-confirmation"){const l=await Ye(e.context.secret,o.email,o.updateTo,e.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),f=e.query.callbackURL?encodeURIComponent(e.query.callbackURL):encodeURIComponent("/"),p=`${e.context.baseURL}/verify-email?token=${l}&callbackURL=${f}`;if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:{...s.user,email:o.updateTo},url:p,token:l},e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0})}if(!a){const l=await e.context.internalAdapter.createSession(s.user.id);if(!l)throw new g("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});a={session:l,user:s.user}}if(o.requestType==="change-email-verification"){const l=await e.context.internalAdapter.updateUserByEmail(o.email,{email:o.updateTo,emailVerified:!0});if(await Le(e,{session:a.session,user:{...a.user,email:o.updateTo,emailVerified:!0}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:l})}const c=await e.context.internalAdapter.updateUserByEmail(o.email,{email:o.updateTo,emailVerified:!1}),u=await Ye(e.context.secret,o.updateTo),d=e.query.callbackURL?encodeURIComponent(e.query.callbackURL):encodeURIComponent("/");if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:c,url:`${e.context.baseURL}/verify-email?token=${u}&callbackURL=${d}`,token:u},e.request),await Le(e,{session:a.session,user:{...a.user,email:o.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:c.id,email:c.email,name:c.name,image:c.image,emailVerified:c.emailVerified,createdAt:c.createdAt,updatedAt:c.updatedAt}})}if(s.user.emailVerified){if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})}e.context.options.emailVerification?.onEmailVerification&&await e.context.options.emailVerification.onEmailVerification(s.user,e.request);const i=await e.context.internalAdapter.updateUserByEmail(o.email,{emailVerified:!0});if(e.context.options.emailVerification?.afterEmailVerification&&await e.context.options.emailVerification.afterEmailVerification(i,e.request),e.context.options.emailVerification?.autoSignInAfterVerification){const a=await De(e);if(!a||a.user.email!==o.email){const c=await e.context.internalAdapter.createSession(s.user.id);if(!c)throw new g("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await Le(e,{session:c,user:{...s.user,emailVerified:!0}})}else await Le(e,{session:a.session,user:{...a.user,emailVerified:!0}})}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})});function qu(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g,"&amp;")}const hk=(e,t="Unknown",r=null)=>{const n=e.onAPIError?.customizeDefaultErrorPage;return`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: ${n?.font?.defaultFamily||"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"};
        background: ${n?.colors?.background||"var(--background)"};
        color: var(--foreground);
        margin: 0;
      }
      :root,
      :host {
        --spacing: 0.25rem;
        --container-md: 28rem;
        --text-sm: ${n?.size?.textSm||"0.875rem"};
        --text-sm--line-height: calc(1.25 / 0.875);
        --text-2xl: ${n?.size?.text2xl||"1.5rem"};
        --text-2xl--line-height: calc(2 / 1.5);
        --text-4xl: ${n?.size?.text4xl||"2.25rem"};
        --text-4xl--line-height: calc(2.5 / 2.25);
        --text-6xl: ${n?.size?.text6xl||"3rem"};
        --text-6xl--line-height: 1;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --default-transition-duration: 150ms;
        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        --radius: ${n?.size?.radiusSm||"0.625rem"};
        --default-mono-font-family: ${n?.font?.monoFamily||"var(--font-geist-mono)"};
        --primary: ${n?.colors?.primary||"black"};
        --primary-foreground: ${n?.colors?.primaryForeground||"white"};
        --background: ${n?.colors?.background||"white"};
        --foreground: ${n?.colors?.foreground||"oklch(0.271 0 0)"};
        --border: ${n?.colors?.border||"oklch(0.89 0 0)"};
        --destructive: ${n?.colors?.destructive||"oklch(0.55 0.15 25.723)"};
        --muted-foreground: ${n?.colors?.mutedForeground||"oklch(0.545 0 0)"};
        --corner-border: ${n?.colors?.cornerBorder||"#404040"};
      }

      button, .btn {
        cursor: pointer;
        background: none;
        border: none;
        color: inherit;
        font: inherit;
        transition: all var(--default-transition-duration)
          var(--default-transition-timing-function);
      }
      button:hover, .btn:hover {
        opacity: 0.8;
      }

      @media (prefers-color-scheme: dark) {
        :root,
        :host {
          --primary: ${n?.colors?.primary||"white"};
          --primary-foreground: ${n?.colors?.primaryForeground||"black"};
          --background: ${n?.colors?.background||"oklch(0.15 0 0)"};
          --foreground: ${n?.colors?.foreground||"oklch(0.98 0 0)"};
          --border: ${n?.colors?.border||"oklch(0.27 0 0)"};
          --destructive: ${n?.colors?.destructive||"oklch(0.65 0.15 25.723)"};
          --muted-foreground: ${n?.colors?.mutedForeground||"oklch(0.65 0 0)"};
          --corner-border: ${n?.colors?.cornerBorder||"#a0a0a0"};
        }
      }
      @media (max-width: 640px) {
        :root, :host {
          --text-6xl: 2.5rem;
          --text-2xl: 1.25rem;
          --text-sm: 0.8125rem;
        }
      }
      @media (max-width: 480px) {
        :root, :host {
          --text-6xl: 2rem;
          --text-2xl: 1.125rem;
        }
      }
    </style>
  </head>
  <body style="width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;">
    <div
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        "
        >
${n?.disableBackgroundGrid?"":`
      <div
        style="
          position: absolute;
          inset: 0;
          background-image: linear-gradient(to right, ${n?.colors?.gridColor||"var(--border)"} 1px, transparent 1px),
            linear-gradient(to bottom, ${n?.colors?.gridColor||"var(--border)"} 1px, transparent 1px);
          background-size: 40px 40px;
          opacity: 0.6;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
        "
      ></div>
      <div
        style="
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: ${n?.colors?.background||"var(--background)"};
          mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          pointer-events: none;
        "
      ></div>
`}

<div
  style="
    position: relative;
    z-index: 10;
    border: 2px solid var(--border);
    background: ${n?.colors?.cardBackground||"var(--background)"};
    padding: 1.5rem;
    max-width: 42rem;
    width: 100%;
  "
>
    ${n?.disableCornerDecorations?"":`
        <!-- Corner decorations -->
        <div
          style="
            position: absolute;
            top: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            top: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>
  
        <div
          style="
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>`}

        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="margin-bottom: 1.5rem;">
            <div
              style="
                display: inline-block;
                border: 2px solid ${n?.disableTitleBorder?"transparent":n?.colors?.titleBorder||"var(--destructive)"};
                padding: 0.375rem 1rem;
              "
            >
              <h1
                style="
                  font-size: var(--text-6xl);
                  font-weight: var(--font-weight-semibold);
                  color: ${n?.colors?.titleColor||"var(--foreground)"};
                  letter-spacing: -0.02em;
                  margin: 0;
                "
              >
                ERROR
              </h1>
            </div>
            <div
              style="
                height: 2px;
                background-color: var(--border);
                width: calc(100% + 3rem);
                margin-left: -1.5rem;
                margin-top: 1.5rem;
              "
            ></div>
          </div>

          <h2
            style="
              font-size: var(--text-2xl);
              font-weight: var(--font-weight-semibold);
              color: var(--foreground);
              margin: 0 0 1rem;
            "
          >
            Something went wrong
          </h2>

          <div
            style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                border: 2px solid var(--border);
                background-color: var(--muted);
                padding: 0.375rem 0.75rem;
                margin: 0 0 1rem;
                flex-wrap: wrap;
                justify-content: center;
            "
            >
            <span
                style="
                font-size: 0.75rem;
                color: var(--muted-foreground);
                font-weight: var(--font-weight-semibold);
                "
            >
                CODE:
            </span>
            <span
                style="
                font-size: var(--text-sm);
                font-family: var(--default-mono-font-family, monospace);
                color: var(--foreground);
                word-break: break-all;
                "
            >
                ${qu(t)}
            </span>
            </div>

          <p
            style="
              color: var(--muted-foreground);
              max-width: 28rem;
              margin: 0 auto;
              font-size: var(--text-sm);
              line-height: 1.5;
              text-wrap: pretty;
            "
          >
            ${r||`We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/errors/${encodeURIComponent(t)}' target='_blank' rel="noopener noreferrer" style='color: var(--foreground); text-decoration: underline;'>here</a>.`}
          </p>
        </div>

        <div
          style="
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <a
            href="/"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: var(--primary);
                color: var(--primary-foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Go Home
            </div>
          </a>
          <a
            href="https://better-auth.com/docs/errors/${encodeURIComponent(t)}?askai=${encodeURIComponent(`What does the error code ${t} mean?`)}"
            target="_blank"
            rel="noopener noreferrer"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: transparent;
                color: var(--foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Ask AI
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>`},mk=K("/error",{method:"GET",metadata:{...ls,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>{const t=new URL(e.request?.url||""),r=t.searchParams.get("error")||"UNKNOWN",n=t.searchParams.get("error_description")||null,o=/^[\'A-Za-z0-9_-]+$/.test(r)?r:"UNKNOWN",s=n?qu(n):null,i=new URLSearchParams;i.set("error",o),n&&i.set("error_description",n);const a=e.context.options,c=a.onAPIError?.errorURL;return c?new Response(null,{status:302,headers:{Location:`${c}${c.includes("?")?"&":"?"}${i.toString()}`}}):aa&&!a.onAPIError?.customizeDefaultErrorPage?new Response(null,{status:302,headers:{Location:`/?${i.toString()}`}}):new Response(hk(e.context.options,o,s),{headers:{"Content-Type":"text/html"}})}),gk=K("/ok",{method:"GET",metadata:{...ls,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0}));function ta(e,t,r){const n=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([o,s])=>n.searchParams.set(o,s)),n.href}function yk(e,t,r){const n=new URL(t,e.baseURL);return r&&Object.entries(r).forEach(([o,s])=>n.searchParams.set(o,s)),n.href}const wk=K("/request-password-reset",{method:"POST",body:B({email:sr().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:_().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{operationId:"requestPasswordReset",description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new g("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return ht(24),await e.context.internalAdapter.findVerificationValue("dummy-verification-token"),e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});const o=un(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600*1,"sec"),s=ht(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${s}`,expiresAt:o});const i=r?encodeURIComponent(r):"",a=`${e.context.baseURL}/reset-password/${s}?callbackURL=${i}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:a,token:s},e.request).catch(c=>{e.context.logger.error("Failed to send reset password email",c)}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),_k=K("/reset-password/:token",{method:"GET",operationId:"forgetPasswordCallback",query:B({callbackURL:_().meta({description:"The URL to redirect the user to reset their password"})}),use:[vs(e=>e.query.callbackURL)],metadata:{openapi:{operationId:"resetPasswordCallback",description:"Redirects the user to the callback URL with the token",parameters:[{name:"token",in:"path",required:!0,description:"The token to reset the password",schema:{type:"string"}},{name:"callbackURL",in:"query",required:!0,description:"The URL to redirect the user to reset their password",schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{const{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(ta(e.context,r,{error:"INVALID_TOKEN"}));const n=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);throw!n||n.expiresAt<new Date?e.redirect(ta(e.context,r,{error:"INVALID_TOKEN"})):e.redirect(yk(e.context,r,{token:t}))}),bk=K("/reset-password",{method:"POST",operationId:"resetPassword",query:B({token:_().optional()}).optional(),body:B({newPassword:_().meta({description:"The new password to set"}),token:_().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{operationId:"resetPassword",description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{const t=e.body.token||e.query?.token;if(!t)throw new g("BAD_REQUEST",{message:j.INVALID_TOKEN});const{newPassword:r}=e.body,n=e.context.password?.config.minPasswordLength,o=e.context.password?.config.maxPasswordLength;if(r.length<n)throw new g("BAD_REQUEST",{message:j.PASSWORD_TOO_SHORT});if(r.length>o)throw new g("BAD_REQUEST",{message:j.PASSWORD_TOO_LONG});const s=`reset-password:${t}`,i=await e.context.internalAdapter.findVerificationValue(s);if(!i||i.expiresAt<new Date)throw new g("BAD_REQUEST",{message:j.INVALID_TOKEN});const a=i.value,c=await e.context.password.hash(r);if((await e.context.internalAdapter.findAccounts(a)).find(u=>u.providerId==="credential")?await e.context.internalAdapter.updatePassword(a,c):await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:c,accountId:a}),await e.context.internalAdapter.deleteVerificationValue(i.id),e.context.options.emailAndPassword?.onPasswordReset){const u=await e.context.internalAdapter.findUserById(a);u&&await e.context.options.emailAndPassword.onPasswordReset({user:u},e.request)}return e.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(a),e.json({status:!0})}),vk=B({callbackURL:_().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:_().optional(),errorCallbackURL:_().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:Zu,disableRedirect:He().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:er(B({token:_().meta({description:"ID token from the provider"}),nonce:_().meta({description:"Nonce used to generate the token"}).optional(),accessToken:_().meta({description:"Access token from the provider"}).optional(),refreshToken:_().meta({description:"Refresh token from the provider"}).optional(),expiresAt:hr().meta({description:"Expiry date of the token"}).optional()})),scopes:Qe(_()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:He().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:_().meta({description:"The login hint to use for the authorization code request"}).optional(),additionalData:xe(_(),Ce()).optional().meta({description:"Additional data to be passed through the OAuth flow"})}),Ak=()=>K("/sign-in/social",{method:"POST",operationId:"socialSignIn",body:vk,metadata:{$Infer:{body:{},returned:{}},openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{token:{type:"string"},user:{type:"object",$ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean",enum:[!1]}},required:["redirect","token","user"]}}}}}}}},async e=>{const t=e.context.socialProviders.find(s=>s.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new g("NOT_FOUND",{message:j.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new g("NOT_FOUND",{message:j.ID_TOKEN_NOT_SUPPORTED});const{token:s,nonce:i}=e.body.idToken;if(!await t.verifyIdToken(s,i))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.INVALID_TOKEN});const a=await t.getUserInfo({idToken:s,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!a||!a?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.FAILED_TO_GET_USER_INFO});if(!a.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new g("UNAUTHORIZED",{message:j.USER_EMAIL_NOT_FOUND});const c=await Hu(e,{userInfo:{...a.user,email:a.user.email,id:String(a.user.id),name:a.user.name||"",image:a.user.image,emailVerified:a.user.emailVerified||!1},account:{providerId:t.id,accountId:String(a.user.id),accessToken:e.body.idToken.accessToken},callbackURL:e.body.callbackURL,disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(c.error)throw new g("UNAUTHORIZED",{message:c.error});return await Le(e,c.data),e.json({redirect:!1,token:c.data.session.token,url:void 0,user:nt(e.context.options,c.data.user)})}const{codeVerifier:r,state:n}=await Jc(e,void 0,e.body.additionalData),o=await t.createAuthorizationURL({state:n,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:o.toString(),redirect:!e.body.disableRedirect})}),Ek=()=>K("/sign-in/email",{method:"POST",operationId:"signInEmail",body:B({email:_().meta({description:"Email of the user"}),password:_().meta({description:"Password of the user"}),callbackURL:_().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:He().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signInEmail",description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"string",nullable:!0},user:{type:"object",$ref:"#/components/schemas/User"}},required:["redirect","token","user"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new g("BAD_REQUEST",{message:"Email and password is not enabled"});const{email:t,password:r}=e.body;if(!sr().safeParse(t).success)throw new g("BAD_REQUEST",{message:j.INVALID_EMAIL});const n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new g("UNAUTHORIZED",{message:j.INVALID_EMAIL_OR_PASSWORD});const o=n.accounts.find(a=>a.providerId==="credential");if(!o)throw await e.context.password.hash(r),e.context.logger.error("Credential account not found",{email:t}),new g("UNAUTHORIZED",{message:j.INVALID_EMAIL_OR_PASSWORD});const s=o?.password;if(!s)throw await e.context.password.hash(r),e.context.logger.error("Password not found",{email:t}),new g("UNAUTHORIZED",{message:j.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:s,password:r}))throw e.context.logger.error("Invalid password"),new g("UNAUTHORIZED",{message:j.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!n.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new g("FORBIDDEN",{message:j.EMAIL_NOT_VERIFIED});if(e.context.options?.emailVerification?.sendOnSignIn){const a=await Ye(e.context.secret,n.user.email,void 0,e.context.options.emailVerification?.expiresIn),c=e.body.callbackURL?encodeURIComponent(e.body.callbackURL):encodeURIComponent("/"),u=`${e.context.baseURL}/verify-email?token=${a}&callbackURL=${c}`;await e.context.options.emailVerification.sendVerificationEmail({user:n.user,url:u,token:a},e.request)}throw new g("FORBIDDEN",{message:j.EMAIL_NOT_VERIFIED})}const i=await e.context.internalAdapter.createSession(n.user.id,e.body.rememberMe===!1);if(!i)throw e.context.logger.error("Failed to create session"),new g("UNAUTHORIZED",{message:j.FAILED_TO_CREATE_SESSION});return await Le(e,{session:i,user:n.user},e.body.rememberMe===!1),e.json({redirect:!!e.body.callbackURL,token:i.token,url:e.body.callbackURL,user:nt(e.context.options,n.user)})}),kk=K("/sign-out",{method:"POST",operationId:"signOut",requireHeaders:!0,metadata:{openapi:{operationId:"signOut",description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(t)try{await e.context.internalAdapter.deleteSession(t)}catch(r){e.context.logger.error("Failed to delete session from database",r)}return gr(e),e.json({success:!0})}),Tk=()=>K("/sign-up/email",{method:"POST",operationId:"signUpWithEmailAndPassword",body:xe(_(),Ce()),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signUpWithEmailAndPassword",description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>_p(e.context.adapter,async()=>{if(!e.context.options.emailAndPassword?.enabled||e.context.options.emailAndPassword?.disableSignUp)throw new g("BAD_REQUEST",{message:"Email and password sign up is not enabled"});const t=e.body,{name:r,email:n,password:o,image:s,callbackURL:i,rememberMe:a,...c}=t;if(!sr().safeParse(n).success)throw new g("BAD_REQUEST",{message:j.INVALID_EMAIL});const u=e.context.password.config.minPasswordLength;if(o.length<u)throw e.context.logger.error("Password is too short"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_SHORT});const d=e.context.password.config.maxPasswordLength;if(o.length>d)throw e.context.logger.error("Password is too long"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_LONG});if((await e.context.internalAdapter.findUserByEmail(n))?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${n}`),new g("UNPROCESSABLE_ENTITY",{message:j.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});const l=await e.context.password.hash(o);let f;try{const h=Yc(e.context.options,c,"create");if(f=await e.context.internalAdapter.createUser({email:n.toLowerCase(),name:r,image:s,...h,emailVerified:!1}),!f)throw new g("BAD_REQUEST",{message:j.FAILED_TO_CREATE_USER})}catch(h){throw Bo()&&e.context.logger.error("Failed to create user",h),h instanceof g?h:(e.context.logger?.error("Failed to create user",h),new g("UNPROCESSABLE_ENTITY",{message:j.FAILED_TO_CREATE_USER,details:h}))}if(!f)throw new g("UNPROCESSABLE_ENTITY",{message:j.FAILED_TO_CREATE_USER});if(await e.context.internalAdapter.linkAccount({userId:f.id,providerId:"credential",accountId:f.id,password:l}),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){const h=await Ye(e.context.secret,f.email,void 0,e.context.options.emailVerification?.expiresIn),m=t.callbackURL?encodeURIComponent(t.callbackURL):encodeURIComponent("/"),y=`${e.context.baseURL}/verify-email?token=${h}&callbackURL=${m}`,b=e.request?[{user:f,url:y,token:h},e.request]:[{user:f,url:y,token:h}];await e.context.options.emailVerification?.sendVerificationEmail?.(...b)}if(e.context.options.emailAndPassword.autoSignIn===!1||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null,user:nt(e.context.options,f)});const p=await e.context.internalAdapter.createSession(f.id,a===!1);if(!p)throw new g("BAD_REQUEST",{message:j.FAILED_TO_CREATE_SESSION});return await Le(e,{session:p,user:f},a===!1),e.json({token:p.token,user:nt(e.context.options,f)})})),Sk=()=>K("/update-user",{method:"POST",operationId:"updateUser",body:xe(_().meta({description:"Field name must be a string"}),Ce()),use:[st],metadata:{$Infer:{body:{}},openapi:{operationId:"updateUser",description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user",nullable:!0}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{const t=e.body;if(t.email)throw new g("BAD_REQUEST",{message:j.EMAIL_CAN_NOT_BE_UPDATED});const{name:r,image:n,...o}=t,s=e.context.session,i=Yc(e.context.options,o,"update");if(n===void 0&&r===void 0&&Object.keys(i).length===0)throw new g("BAD_REQUEST",{message:"No fields to update"});const a=await e.context.internalAdapter.updateUser(s.user.id,{name:r,image:n,...i});return await Le(e,{session:s.session,user:a}),e.json({status:!0})}),Ik=K("/change-password",{method:"POST",operationId:"changePassword",body:B({newPassword:_().meta({description:"The new password to set"}),currentPassword:_().meta({description:"The current password is required"}),revokeOtherSessions:He().meta({description:"Must be a boolean value"}).optional()}),use:[Ct],metadata:{openapi:{operationId:"changePassword",description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{const{newPassword:t,currentPassword:r,revokeOtherSessions:n}=e.body,o=e.context.session,s=e.context.password.config.minPasswordLength;if(t.length<s)throw e.context.logger.error("Password is too short"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_SHORT});const i=e.context.password.config.maxPasswordLength;if(t.length>i)throw e.context.logger.error("Password is too long"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_LONG});const a=(await e.context.internalAdapter.findAccounts(o.user.id)).find(d=>d.providerId==="credential"&&d.password);if(!a||!a.password)throw new g("BAD_REQUEST",{message:j.CREDENTIAL_ACCOUNT_NOT_FOUND});const c=await e.context.password.hash(t);if(!await e.context.password.verify({hash:a.password,password:r}))throw new g("BAD_REQUEST",{message:j.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(a.id,{password:c});let u=null;if(n){await e.context.internalAdapter.deleteSessions(o.user.id);const d=await e.context.internalAdapter.createSession(o.user.id);if(!d)throw new g("INTERNAL_SERVER_ERROR",{message:j.FAILED_TO_GET_SESSION});await Le(e,{session:d,user:o.user}),u=d.token}return e.json({token:u,user:{id:o.user.id,email:o.user.email,name:o.user.name,image:o.user.image,emailVerified:o.user.emailVerified,createdAt:o.user.createdAt,updatedAt:o.user.updatedAt}})}),Rk=K("/set-password",{method:"POST",body:B({newPassword:_().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[Ct]},async e=>{const{newPassword:t}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(t.length<n)throw e.context.logger.error("Password is too short"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_SHORT});const o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new g("BAD_REQUEST",{message:j.PASSWORD_TOO_LONG});const s=(await e.context.internalAdapter.findAccounts(r.user.id)).find(a=>a.providerId==="credential"&&a.password),i=await e.context.password.hash(t);if(!s)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:i}),e.json({status:!0});throw new g("BAD_REQUEST",{message:"user already has a password"})}),Uk=K("/delete-user",{method:"POST",use:[Ct],body:B({callbackURL:_().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:_().meta({description:"The password of the user is required to delete the user"}).optional(),token:_().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{operationId:"deleteUser",description:"Delete the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{callbackURL:{type:"string",description:"The callback URL to redirect to after the user is deleted"},password:{type:"string",description:"The user's password. Required if session is not fresh"},token:{type:"string",description:"The deletion verification token"}}}}}},responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new g("NOT_FOUND");const t=e.context.session;if(e.body.password){const o=(await e.context.internalAdapter.findAccounts(t.user.id)).find(s=>s.providerId==="credential"&&s.password);if(!o||!o.password)throw new g("BAD_REQUEST",{message:j.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:o.password,password:e.body.password}))throw new g("BAD_REQUEST",{message:j.INVALID_PASSWORD})}if(e.body.token)return await Vu({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){const o=ze(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${o}`,expiresAt:new Date(Date.now()+(e.context.options.user.deleteUser?.deleteTokenExpiresIn||3600*24)*1e3)});const s=`${e.context.baseURL}/delete-user/callback?token=${o}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:s,token:o},e.request),e.json({success:!0,message:"Verification email sent"})}if(!e.body.password&&e.context.sessionConfig.freshAge!==0){const o=new Date(t.session.createdAt).getTime(),s=e.context.sessionConfig.freshAge*1e3;if(Date.now()-o>s*1e3)throw new g("BAD_REQUEST",{message:j.SESSION_EXPIRED})}const r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),gr(e);const n=e.context.options.user.deleteUser?.afterDelete;return n&&await n(t.user,e.request),e.json({success:!0,message:"User deleted"})}),Vu=K("/delete-user/callback",{method:"GET",query:B({token:_().meta({description:"The token to verify the deletion request"}),callbackURL:_().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[vs(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new g("NOT_FOUND");const t=await De(e);if(!t)throw new g("NOT_FOUND",{message:j.FAILED_TO_GET_USER_INFO});const r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date)throw new g("NOT_FOUND",{message:j.INVALID_TOKEN});if(r.value!==t.user.id)throw new g("NOT_FOUND",{message:j.INVALID_TOKEN});const n=e.context.options.user.deleteUser?.beforeDelete;n&&await n(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),gr(e);const o=e.context.options.user.deleteUser?.afterDelete;if(o&&await o(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})}),$k=K("/change-email",{method:"POST",body:B({newEmail:sr().meta({description:"The new email address to set must be a valid email address"}),callbackURL:_().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[Ct],metadata:{openapi:{operationId:"changeEmail",responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new g("BAD_REQUEST",{message:"Change email is disabled"});const t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new g("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new g("UNPROCESSABLE_ENTITY",{message:j.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(e.context.session.user.emailVerified!==!0&&e.context.options.user.changeEmail.updateEmailWithoutVerification){if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t}),await Le(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){const o=await Ye(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${o}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:s,token:o},e.request)}return e.json({status:!0})}if(e.context.session.user.emailVerified&&(e.context.options.user.changeEmail.sendChangeEmailConfirmation||e.context.options.user.changeEmail.sendChangeEmailVerification)){const o=await Ye(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn,{requestType:"change-email-confirmation"}),s=`${e.context.baseURL}/verify-email?token=${o}&callbackURL=${e.body.callbackURL||"/"}`,i=e.context.options.user.changeEmail.sendChangeEmailConfirmation||e.context.options.user.changeEmail.sendChangeEmailVerification;return i&&await i({user:e.context.session.user,newEmail:t,url:s,token:o},e.request),e.json({status:!0})}if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new g("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await Ye(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:n,token:r},e.request),e.json({status:!0})}),Bu=ju((e,t,r)=>{if(Array.isArray(e[t])&&Array.isArray(r))return e[t]=r,!0});function Ck(e,t){const r={};for(const[n,o]of Object.entries(e))r[n]=async s=>{const i=async()=>{const a=await t;let c={...s,context:{...a,returned:void 0,responseHeaders:void 0,session:null},path:o.path,headers:s?.headers?new Headers(s?.headers):void 0};return So(c,async()=>{const{beforeHooks:u,afterHooks:d}=Dk(a),l=await Ok(c,u);if("context"in l&&l.context&&typeof l.context=="object"){const{headers:h,...m}=l.context;h&&h.forEach((y,b)=>{c.headers.set(b,y)}),c=Bu(m,c)}else if(l)return s?.asResponse?kt(l,{headers:s?.headers}):s?.returnHeaders?{headers:s?.headers,response:l}:l;c.asResponse=!1,c.returnHeaders=!0,c.returnStatus=!0;const f=await So(c,()=>o(c)).catch(h=>{if(h instanceof g)return{response:h,status:h.statusCode,headers:h.headers?new Headers(h.headers):null};throw h});if(f&&f instanceof Response)return f;c.context.returned=f.response,c.context.responseHeaders=f.headers;const p=await Pk(c,d);if(p.response&&(f.response=p.response),f.response instanceof g&&vn(a.logger.level,"debug")&&(f.response.stack=f.response.errorStack),f.response instanceof g&&!s?.asResponse)throw f.response;return s?.asResponse?kt(f.response,{headers:f.headers,status:f.status}):s?.returnHeaders?s?.returnStatus?{headers:f.headers,response:f.response,status:f.status}:{headers:f.headers,response:f.response}:s?.returnStatus?{response:f.response,status:f.status}:f.response})};return await gp()?i():yp(new WeakMap,i)},r[n].path=o.path,r[n].options=o.options;return r}async function Ok(e,t){let r={};for(const n of t)if(n.matcher(e)){const o=await n.handler({...e,returnHeaders:!1}).catch(s=>{throw s instanceof g&&vn(e.context.logger.level,"debug")&&(s.stack=s.errorStack),s});if(o&&typeof o=="object"){if("context"in o&&typeof o.context=="object"){const{headers:s,...i}=o.context;s instanceof Headers&&(r.headers?s.forEach((a,c)=>{r.headers?.set(c,a)}):r.headers=s),r=Bu(i,r);continue}return o}}return{context:r}}async function Pk(e,t){for(const r of t)if(r.matcher(e)){const n=await r.handler(e).catch(o=>{if(o instanceof g)return vn(e.context.logger.level,"debug")&&(o.stack=o.errorStack),{response:o,headers:o.headers?new Headers(o.headers):null};throw o});n.headers&&n.headers.forEach((o,s)=>{e.context.responseHeaders?s.toLowerCase()==="set-cookie"?e.context.responseHeaders.append(s,o):e.context.responseHeaders.set(s,o):e.context.responseHeaders=new Headers({[s]:o})}),n.response&&(e.context.returned=n.response)}return{response:e.context.returned,headers:e.context.responseHeaders}}function Dk(e){const t=e.options.plugins||[],r=[],n=[];e.options.hooks?.before&&r.push({matcher:()=>!0,handler:e.options.hooks.before}),e.options.hooks?.after&&n.push({matcher:()=>!0,handler:e.options.hooks.after});const o=t.map(i=>{if(i.hooks?.before)return i.hooks.before}).filter(i=>i!==void 0).flat(),s=t.map(i=>{if(i.hooks?.after)return i.hooks.after}).filter(i=>i!==void 0).flat();return o.length&&r.push(...o),s.length&&n.push(...s),{beforeHooks:r,afterHooks:n}}function ET(e,t){const r=new Map;e.plugins?.forEach(o=>{if(o.endpoints){for(const[s,i]of Object.entries(o.endpoints))if(i&&"path"in i){const a=i.path;let c=[];i.options&&"method"in i.options&&(Array.isArray(i.options.method)?c=i.options.method:typeof i.options.method=="string"&&(c=[i.options.method])),c.length===0&&(c=["*"]),r.has(a)||r.set(a,[]),r.get(a).push({pluginId:o.id,endpointKey:s,methods:c})}}});const n=[];for(const[o,s]of r.entries())if(s.length>1){const i=new Map;let a=!1;for(const c of s)for(const u of c.methods)i.has(u)||i.set(u,[]),i.get(u).push(c.pluginId),i.get(u).length>1&&(a=!0),(u==="*"&&s.length>1||u!=="*"&&i.has("*"))&&(a=!0);if(a){const c=[...new Set(s.map(d=>d.pluginId))],u=[];for(const[d,l]of i.entries())(l.length>1||d==="*"&&s.length>1||d!=="*"&&i.has("*"))&&u.push(d);n.push({path:o,plugins:c,conflictingMethods:u})}}if(n.length>0){const o=n.map(s=>`  - "${s.path}" [${s.conflictingMethods.join(", ")}] used by plugins: ${s.plugins.join(", ")}`).join(`
`);t.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${o}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}function zk(e,t){const r=t.plugins?.reduce((o,s)=>({...o,...s.endpoints}),{})??{},n=t.plugins?.map(o=>o.middlewares?.map(s=>{const i=(async a=>{const c=await e;return s.middleware({...a,context:{...c,...a.context}})});return i.options=s.middleware.options,{path:s.path,middleware:i}})).filter(o=>o!==void 0).flat()||[];return{api:Ck({signInSocial:Ak(),callbackOAuth:lk,getSession:su(),signOut:kk,signUpEmail:Tk(),signInEmail:Ek(),resetPassword:bk,verifyEmail:pk,sendVerificationEmail:fk,changeEmail:$k,changePassword:Ik,setPassword:Rk,updateUser:Sk(),deleteUser:Uk,requestPasswordReset:wk,requestPasswordResetCallback:_k,listSessions:Tw(),revokeSession:Sw,revokeSessions:Iw,revokeOtherSessions:Rw,linkSocialAccount:ik,listUserAccounts:sk,deleteUserCallback:Vu,unlinkAccount:ak,refreshToken:ck,getAccessToken:Ku,accountInfo:dk,...r,ok:gk,error:mk},e),middlewares:n}}const kT=(e,t)=>{const{api:r,middlewares:n}=zk(e,t),o=new URL(e.baseURL).pathname;return Vp(r,{routerContext:e,openapi:{disabled:!0},basePath:o,routerMiddleware:[{path:"/**",middleware:YE},...n],allowedMediaTypes:["application/json"],async onRequest(s){const i=e.options.disabledPaths||[],a=new URL(s.url).pathname.replace(o,"");if(i.includes(a))return new Response("Not Found",{status:404});for(const c of e.options.plugins||[])if(c.onRequest){const u=await c.onRequest(s,e);if(u&&"response"in u)return u.response;if(u&&"request"in u){const d=await Xi(u.request,e);return d||u.request}}return Xi(s,e)},async onResponse(s){for(const i of e.options.plugins||[])if(i.onResponse){const a=await i.onResponse(s,e);if(a)return a.response}return s},onError(s){if(s instanceof g&&s.status==="FOUND")return;if(t.onAPIError?.throw)throw s;if(t.onAPIError?.onError){t.onAPIError.onError(s,e);return}const i=t.logger?.level,a=i==="error"||i==="warn"||i==="debug"?Q:void 0;if(t.logger?.disabled!==!0){if(s&&typeof s=="object"&&"message"in s&&typeof s.message=="string"&&(s.message.includes("no column")||s.message.includes("column")||s.message.includes("relation")||s.message.includes("table")||s.message.includes("does not exist"))){e.logger?.error(s.message);return}s instanceof g?(s.status==="INTERNAL_SERVER_ERROR"&&e.logger.error(s.status,s),a?.error(s.message)):e.logger?.error(s&&typeof s=="object"&&"name"in s?s.name:"",s)}}})},Mn=Du({id:_e(),createdAt:tr().default(()=>new Date),updatedAt:tr().default(()=>new Date)});Mn.extend({providerId:_e(),accountId:_e(),userId:Nu(),accessToken:_e().nullish(),refreshToken:_e().nullish(),idToken:_e().nullish(),accessTokenExpiresAt:tr().nullish(),refreshTokenExpiresAt:tr().nullish(),scope:_e().nullish(),password:_e().nullish()});Du({key:_e(),count:Bi(),lastRequest:Bi()});Mn.extend({userId:Nu(),expiresAt:tr(),token:_e(),ipAddress:_e().nullish(),userAgent:_e().nullish()});Mn.extend({email:_e().transform(e=>e.toLowerCase()),emailVerified:NA().default(!1),name:_e(),image:_e().nullish()});Mn.extend({value:_e(),expiresAt:tr(),identifier:_e()});function xk(e){return{authorize(t,r="AND"){let n=!1;for(const[o,s]of Object.entries(t)){const i=e[o];if(!i)return{success:!1,error:`You are not allowed to access resource: ${o}`};if(Array.isArray(s))n=s.every(a=>i.includes(a));else if(typeof s=="object"){const a=s;a.connector==="OR"?n=a.actions.some(c=>i.includes(c)):n=a.actions.every(c=>i.includes(c))}else throw new Y("Invalid access control request");if(n&&r==="OR")return{success:n};if(!n&&r==="AND")return{success:!1,error:`unauthorized to access resource "${o}"`}}return n?{success:n}:{success:!1,error:"Not authorized"}},statements:e}}function Lk(e){return{newRole(t){return xk(t)},statements:e}}const Nk={user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]},Wu=Lk(Nk),Fu=Wu.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),Ju=Wu.newRole({user:[],session:[]}),Zk={admin:Fu,user:Ju},jk=e=>{if(e.userId&&e.options?.adminUserIds?.includes(e.userId))return!0;if(!e.permissions&&!e.permission)return!1;const t=(e.role||e.options?.defaultRole||"user").split(","),r=e.options?.roles||Zk;for(const n of t)if(r[n]?.authorize(e.permission??e.permissions)?.success)return!0;return!1},Kn=(e,t)=>({getAllKeys:async r=>t?.adapter?.getJwks?await t.adapter.getJwks(r):await e.findMany({model:"jwks"}),getLatestKey:async r=>t?.adapter?.getJwks?(await t.adapter.getJwks(r))?.sort((n,o)=>o.createdAt.getTime()-n.createdAt.getTime())[0]:(await e.findMany({model:"jwks"}))?.sort((n,o)=>o.createdAt.getTime()-n.createdAt.getTime())[0],createJwk:async(r,n)=>t?.adapter?.createJwk?await t.adapter.createJwk(n,r):await e.create({model:"jwks",data:{...n,createdAt:new Date}})}),Mk={jwks:{fields:{publicKey:{type:"string",required:!0},privateKey:{type:"string",required:!0},createdAt:{type:"date",required:!0},expiresAt:{type:"date",required:!1}}}},Gu=60,Qu=Gu*60,As=Qu*24,Kk=As*7,Hk=As*365.25,qk=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Vk(e){const t=qk.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]),n=t[3].toLowerCase();let o;switch(n){case"sec":case"secs":case"second":case"seconds":case"s":o=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":o=Math.round(r*Gu);break;case"hour":case"hours":case"hr":case"hrs":case"h":o=Math.round(r*Qu);break;case"day":case"days":case"d":o=Math.round(r*As);break;case"week":case"weeks":case"w":o=Math.round(r*Kk);break;default:o=Math.round(r*Hk);break}return t[1]==="-"||t[4]==="ago"?-o:o}function Bk(e,t){return typeof e=="number"?e:e instanceof Date?Math.floor(e.getTime()/1e3):t+Vk(e)}async function Wk(e){const{alg:t,...r}=e?.jwks?.keyPairConfig??{alg:"EdDSA",crv:"Ed25519"},{publicKey:n,privateKey:o}=await sp(t,{...r,extractable:!0});return{publicWebKey:await Xr(n),privateWebKey:await Xr(o),alg:t,cfg:r}}async function Yu(e,t){const{publicWebKey:r,privateWebKey:n,alg:o,cfg:s}=await Wk(t),i=JSON.stringify(n),a=!t?.jwks?.disablePrivateKeyEncryption;let c={alg:o,...s&&"crv"in s?{crv:s.crv}:{},publicKey:JSON.stringify(r),privateKey:a?JSON.stringify(await Un({key:e.context.secret,data:i})):i,createdAt:new Date,...t?.jwks?.rotationInterval?{expiresAt:new Date(Date.now()+t.jwks.rotationInterval*1e3)}:{}};return await Kn(e.context.adapter,t).createJwk(e,c)}async function Xu(e,t){const{options:r,payload:n}=t,o=Math.floor(Date.now()/1e3),s=n.iat;let i=n.exp;const a=Bk(r?.jwt?.expirationTime??"15m",s??o);i=i??a;const c=n.nbf,u=n.iss,d=r?.jwt?.issuer??e.context.options.baseURL,l=n.aud,f=r?.jwt?.audience??e.context.options.baseURL;if(r?.jwt?.sign){const k={...n,iat:s,exp:i,nbf:c,iss:u??d,aud:l??f};return r.jwt.sign(k)}let p=await Kn(e.context.adapter,r).getLatestKey(e);(!p||p.expiresAt&&p.expiresAt<new Date)&&(p=await Yu(e,r));let h=r?.jwks?.disablePrivateKeyEncryption?p.privateKey:await $n({key:e.context.secret,data:JSON.parse(p.privateKey)}).catch(()=>{throw new Y("Failed to decrypt private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either clean up your JWKS or disable private key encryption.")});const m=p.alg??r?.jwks?.keyPairConfig?.alg??"EdDSA",y=await or(JSON.parse(h),m),b=new Yo(n).setProtectedHeader({alg:m,kid:p.id}).setExpirationTime(i).setIssuer(u??d).setAudience(l??f);return s&&b.setIssuedAt(s),n.sub&&b.setSubject(n.sub),n.nbf&&b.setNotBefore(n.nbf),n.jti&&b.setJti(n.jti),await b.sign(y)}async function Ho(e,t){const r=t?.jwt?.definePayload?await t?.jwt.definePayload(e.context.session):e.context.session.user;return await Xu(e,{options:t,payload:{iat:Math.floor(Date.now()/1e3),...r,sub:await t?.jwt?.getSubject?.(e.context.session)??e.context.session.user.id}})}async function ed(e,t){const r=await sc();try{const n=e.split(".");if(n.length!==3)return null;const o=new TextDecoder().decode(Ke.decode(n[0])),s=JSON.parse(o).kid;if(!s)return r.context.logger.debug("JWT missing kid in header"),null;const i=await Kn(r.context.adapter,t).getAllKeys(r);if(!i||i.length===0)return r.context.logger.debug("No JWKS keys available"),null;const a=i.find(u=>u.id===s);if(!a)return r.context.logger.debug(`No JWKS key found for kid: ${s}`),null;const{payload:c}=await Rt(e,await or(JSON.parse(a.publicKey),a.alg??t?.jwks?.keyPairConfig?.alg??"EdDSA"),{issuer:t?.jwt?.issuer??r.context.options.baseURL});return!c.sub||!c.aud?null:c}catch(n){return r.context.logger.debug("JWT verification failed",n),null}}const TT=e=>{if(e?.jwt?.sign&&!e.jwks?.remoteUrl)throw new Y("jwks_config","jwks.remoteUrl must be set when using jwt.sign");if(e?.jwks?.remoteUrl&&!e.jwks?.keyPairConfig?.alg)throw new Y("jwks_config","must specify alg when using the oidc plugin and jwks.remoteUrl");const t=e?.jwks?.jwksPath??"/jwks";if(typeof t!="string"||t.length===0||!t.startsWith("/")||t.includes(".."))throw new Y("jwks_config","jwksPath must be a non-empty string starting with '/' and not contain '..'");return{id:"jwt",options:e,endpoints:{getJwks:K(t,{method:"GET",metadata:{openapi:{operationId:"getJSONWebKeySet",description:"Get the JSON Web Key Set",responses:{200:{description:"JSON Web Key Set retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{keys:{type:"array",description:"Array of public JSON Web Keys",items:{type:"object",properties:{kid:{type:"string",description:"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk"},kty:{type:"string",description:"Key type (e.g., 'RSA', 'EC', 'OKP')"},alg:{type:"string",description:"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')"},use:{type:"string",description:"Intended use of the public key (e.g., 'sig' for signature)",enum:["sig"],nullable:!0},n:{type:"string",description:"Modulus for RSA keys (base64url-encoded)",nullable:!0},e:{type:"string",description:"Exponent for RSA keys (base64url-encoded)",nullable:!0},crv:{type:"string",description:"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')",nullable:!0},x:{type:"string",description:"X coordinate for elliptic curve keys (base64url-encoded)",nullable:!0},y:{type:"string",description:"Y coordinate for elliptic curve keys (base64url-encoded)",nullable:!0}},required:["kid","kty","alg"]}}},required:["keys"]}}}}}}}},async r=>{if(e?.jwks?.remoteUrl)throw new g("NOT_FOUND");const n=Kn(r.context.adapter,e);let o=await n.getAllKeys(r);if((!o||o?.length===0)&&(await Yu(r,e),o=await n.getAllKeys(r)),!o?.length)throw new Y("No key sets found. Make sure you have a key in your database.");const s=Date.now(),i=(e?.jwks?.gracePeriod??3600*24*30)*1e3,a=o.filter(d=>d.expiresAt?d.expiresAt.getTime()+i>s:!0),c=e?.jwks?.keyPairConfig,u=c&&"crv"in c?c.crv:void 0;return r.json({keys:a.map(d=>({alg:d.alg??e?.jwks?.keyPairConfig?.alg??"EdDSA",crv:d.crv??u,...JSON.parse(d.publicKey),kid:d.id}))})}),getToken:K("/token",{method:"GET",requireHeaders:!0,use:[st],metadata:{openapi:{operationId:"getJSONWebToken",description:"Get a JWT token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async r=>{const n=await Ho(r,e);return r.json({token:n})}),signJWT:K("/sign-jwt",{method:"POST",metadata:{SERVER_ONLY:!0,$Infer:{body:{}}},body:B({payload:xe(_(),Ce()),overrideOptions:xe(_(),Ce()).optional()})},async r=>{const n=await Xu(r,{options:{...e,...r.body.overrideOptions},payload:r.body.payload});return r.json({token:n})}),verifyJWT:K("/verify-jwt",{method:"POST",metadata:{SERVER_ONLY:!0,$Infer:{body:{},response:{}}},body:B({token:_(),issuer:_().optional()})},async r=>{const n=r.body.issuer?{...e,jwt:{...e?.jwt,issuer:r.body.issuer}}:e,o=await ed(r.body.token,n);return r.json({payload:o})})},hooks:{after:[{matcher(r){return r.path==="/get-session"},handler:et(async r=>{if(e?.disableSettingJwtHeader)return;const n=r.context.session||r.context.newSession;if(n&&n.session){const o=await Ho(r,e),s=r.context.responseHeaders?.get("access-control-expose-headers")||"",i=new Set(s.split(",").map(a=>a.trim()).filter(Boolean));i.add("set-auth-jwt"),r.setHeader("set-auth-jwt",o),r.setHeader("Access-Control-Expose-Headers",Array.from(i).join(", "))}})}]},schema:Xc(Mk,e?.schema)}};var Fk=class extends g{},Jk=class extends Fk{constructor(e,t){super("BAD_REQUEST",{message:"invalid_request",error_description:e,error_detail:t})}};function qo(e){const t=e.split(" ").map(n=>n.trim()),r=new Set;for(const n of t)(n==="login"||n==="consent"||n==="select_account"||n==="none")&&r.add(n);if(r.has("none")&&r.size>1)throw new Jk("prompt none must only be used alone");return new Set(r)}function vt(e,t,r){return`${e.includes("?")?"&":"?"}error=${t}&error_description=${r}`}function ur(e,t,r){return vt(e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`,t,r)}async function ra(e,t){const r=v=>{if(e.request?.headers.get("sec-fetch-mode")==="cors")return e.json({redirect:!0,url:v});throw e.redirect(v)},n={codeExpiresIn:600,defaultScope:"openid",...t,scopes:["openid","profile","email","offline_access",...t?.scopes||[]]};if(!e.request)throw new g("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});const o=await De(e);if(!o){const v=e.query;if(qo(v.prompt??"").has("none")&&v.redirect_uri)return r(vt(v.redirect_uri,"login_required","Authentication required but prompt is none"));await e.setSignedCookie("oidc_login_prompt",JSON.stringify(e.query),e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});const w=e.request.url?.split("?")[1];return r(`${t.loginPage}?${w}`)}const s=e.query;if(!s.client_id){const v=ur(e,"invalid_client","client_id is required");throw e.redirect(v)}if(!s.response_type){const v=ur(e,"invalid_request","response_type is required");throw e.redirect(v)}const i=await At(e.query.client_id,t.trustedClients||[]);if(!i){const v=ur(e,"invalid_client","client_id is required");throw e.redirect(v)}const a=i.redirectUrls.find(v=>v===e.query.redirect_uri);if(!a||!s.redirect_uri)throw new g("BAD_REQUEST",{message:"Invalid redirect URI"});if(i.disabled){const v=ur(e,"client_disabled","client is disabled");throw e.redirect(v)}if(s.response_type!=="code"){const v=ur(e,"unsupported_response_type","unsupported response type");throw e.redirect(v)}const c=s.scope?.split(" ").filter(v=>v)||n.defaultScope.split(" "),u=c.filter(v=>!n.scopes.includes(v));if(u.length)return r(vt(s.redirect_uri,"invalid_scope",`The following scopes are invalid: ${u.join(", ")}`));if((!s.code_challenge||!s.code_challenge_method)&&t.requirePKCE)return r(vt(s.redirect_uri,"invalid_request","pkce is required"));if(s.code_challenge_method||(s.code_challenge_method="plain"),!["s256",t.allowPlainCodeChallengeMethod?"plain":"s256"].includes(s.code_challenge_method?.toLowerCase()||""))return r(vt(s.redirect_uri,"invalid_request","invalid code_challenge method"));const d=ze(32,"a-z","A-Z","0-9"),l=n.codeExpiresIn*1e3,f=new Date(Date.now()+l),p=i.skipConsent,h=await e.context.adapter.findOne({model:"oauthConsent",where:[{field:"clientId",value:i.clientId},{field:"userId",value:o.user.id}]}).then(v=>{if(!v?.consentGiven)return!1;const w=v.scopes?v.scopes.split(" "):[];return c.every(N=>w.includes(N))}),m=qo(s.prompt??"");if(m.has("none")&&!p&&!h)return r(vt(s.redirect_uri,"consent_required","Consent required but prompt is none"));let y=m.has("login");if(s.max_age!==void 0){const v=Number(s.max_age);Number.isInteger(v)&&v>=0&&(Date.now()-new Date(o.session.createdAt).getTime())/1e3>v&&(y=!0)}const b=!p&&(!h||m.has("consent"));try{await e.context.internalAdapter.createVerificationValue({value:JSON.stringify({clientId:i.clientId,redirectURI:s.redirect_uri,scope:c,userId:o.user.id,authTime:new Date(o.session.createdAt).getTime(),requireConsent:b,state:b?s.state:null,codeChallenge:s.code_challenge,codeChallengeMethod:s.code_challenge_method,nonce:s.nonce}),identifier:d,expiresAt:f})}catch{return r(vt(s.redirect_uri,"server_error","An error occurred while processing the request"))}if(y)return await e.setSignedCookie("oidc_login_prompt",JSON.stringify(e.query),e.context.secret,{maxAge:600,path:"/",sameSite:"lax"}),await e.setSignedCookie("oidc_consent_prompt",d,e.context.secret,{maxAge:600,path:"/",sameSite:"lax"}),r(`${t.loginPage}?${new URLSearchParams({client_id:i.clientId,code:d,state:s.state}).toString()}`);if(!b){const v=new URL(a);return v.searchParams.set("code",d),v.searchParams.set("state",e.query.state),r(v.toString())}if(t?.consentPage){await e.setSignedCookie("oidc_consent_prompt",d,e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});const v=new URLSearchParams;return v.set("consent_code",d),v.set("client_id",i.clientId),v.set("scope",c.join(" ")),r(`${t.consentPage}?${v.toString()}`)}const k=t?.getConsentHTML;if(!k)throw new g("INTERNAL_SERVER_ERROR",{message:"No consent page provided"});return new Response(k({scopes:c,clientMetadata:i.metadata,clientIcon:i?.icon,clientId:i.clientId,clientName:i.name,code:d}),{headers:{"content-type":"text/html"}})}B({clientId:_(),clientSecret:_().optional(),type:dt(["web","native","user-agent-based","public"]),name:_(),icon:_().optional(),metadata:_().optional(),disabled:He().optional().default(!1),redirectUrls:_(),userId:_().optional(),createdAt:Pe(),updatedAt:Pe()});const Gk={oauthApplication:{modelName:"oauthApplication",fields:{name:{type:"string"},icon:{type:"string",required:!1},metadata:{type:"string",required:!1},clientId:{type:"string",unique:!0},clientSecret:{type:"string",required:!1},redirectUrls:{type:"string"},type:{type:"string"},disabled:{type:"boolean",required:!1,defaultValue:!1},userId:{type:"string",required:!1,references:{model:"user",field:"id",onDelete:"cascade"},index:!0},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthAccessToken:{modelName:"oauthAccessToken",fields:{accessToken:{type:"string",unique:!0},refreshToken:{type:"string",unique:!0},accessTokenExpiresAt:{type:"date"},refreshTokenExpiresAt:{type:"date"},clientId:{type:"string",references:{model:"oauthApplication",field:"clientId",onDelete:"cascade"},index:!0},userId:{type:"string",required:!1,references:{model:"user",field:"id",onDelete:"cascade"},index:!0},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthConsent:{modelName:"oauthConsent",fields:{clientId:{type:"string",references:{model:"oauthApplication",field:"clientId",onDelete:"cascade"},index:!0},userId:{type:"string",references:{model:"user",field:"id",onDelete:"cascade"},index:!0},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"},consentGiven:{type:"boolean"}}}},na=async e=>{const t=await An("SHA-256").digest(new TextEncoder().encode(e));return rr.encode(new Uint8Array(t),{padding:!1})},Vo=e=>e.context.options.plugins?.find(t=>t.id==="jwt");async function At(e,t=[]){const{context:{adapter:r}}=await sc(),n=t.find(o=>o.clientId===e);return n||r.findOne({model:"oauthApplication",where:[{field:"clientId",value:e}]}).then(o=>o?{clientId:o.clientId,clientSecret:o.clientSecret,type:o.type,name:o.name,icon:o.icon,disabled:o.disabled,redirectUrls:(o.redirectUrls??"").split(","),metadata:o.metadata?JSON.parse(o.metadata):{}}:null)}const Qk=(e,t)=>{const r=Vo(e),n=r&&r.options?.jwt&&r.options.jwt.issuer?r.options.jwt.issuer:e.context.options.baseURL,o=e.context.baseURL,s=t?.useJWTPlugin?["RS256","EdDSA","none"]:["HS256","none"];return{issuer:n,authorization_endpoint:`${o}/oauth2/authorize`,token_endpoint:`${o}/oauth2/token`,userinfo_endpoint:`${o}/oauth2/userinfo`,jwks_uri:`${o}/jwks`,registration_endpoint:`${o}/oauth2/register`,end_session_endpoint:`${o}/oauth2/endsession`,scopes_supported:["openid","profile","email","offline_access"],response_types_supported:["code"],response_modes_supported:["query"],grant_types_supported:["authorization_code","refresh_token"],acr_values_supported:["urn:mace:incommon:iap:silver","urn:mace:incommon:iap:bronze"],subject_types_supported:["public"],id_token_signing_alg_values_supported:s,token_endpoint_auth_methods_supported:["client_secret_basic","client_secret_post","none"],code_challenge_methods_supported:["S256"],claims_supported:["sub","iss","aud","exp","nbf","iat","jti","email","email_verified","name"],...t?.metadata}},ST=e=>{const t={oauthClient:"oauthApplication",oauthAccessToken:"oauthAccessToken",oauthConsent:"oauthConsent"},r={codeExpiresIn:600,defaultScope:"openid",accessTokenExpiresIn:3600,refreshTokenExpiresIn:604800,allowPlainCodeChallengeMethod:!0,storeClientSecret:"plain",...e,scopes:["openid","profile","email","offline_access",...e?.scopes||[]]},n=e.trustedClients||[];async function o(i,a){return r.storeClientSecret==="encrypted"?await Un({key:i.context.secret,data:a}):r.storeClientSecret==="hashed"?await na(a):typeof r.storeClientSecret=="object"&&"hash"in r.storeClientSecret?await r.storeClientSecret.hash(a):typeof r.storeClientSecret=="object"&&"encrypt"in r.storeClientSecret?await r.storeClientSecret.encrypt(a):a}async function s(i,a,c){return r.storeClientSecret==="encrypted"?await $n({key:i.context.secret,data:a})===c:r.storeClientSecret==="hashed"?await na(c)===a:typeof r.storeClientSecret=="object"&&"hash"in r.storeClientSecret?await r.storeClientSecret.hash(c)===a:typeof r.storeClientSecret=="object"&&"decrypt"in r.storeClientSecret?await r.storeClientSecret.decrypt(a)===c:c===a}return{id:"oidc",hooks:{after:[{matcher(){return!0},handler:et(async i=>{const a=await i.getSignedCookie("oidc_login_prompt",i.context.secret),c=i.context.authCookies.sessionToken.name,u=vw(i.context.responseHeaders?.get("set-cookie")||""),d=u.has(c);if(!a||!d)return;i.setCookie("oidc_login_prompt","",{maxAge:0});const l=u.get(c)?.value?.split(".")[0];if(!l)return;const f=await i.context.internalAdapter.findSession(l)||i.context.newSession;if(!f)return;i.query=JSON.parse(a);const p=qo(String(i.query?.prompt));if(p.has("login")){const h=new Set(p);h.delete("login"),i.query={...i.query,prompt:Array.from(h).join(" ")}}return i.context.session=f,await ra(i,r)})}]},endpoints:{getOpenIdConfig:K("/.well-known/openid-configuration",{method:"GET",operationId:"getOpenIdConfig",metadata:{isAction:!1}},async i=>{const a=Qk(i,e);return i.json(a)}),oAuth2authorize:K("/oauth2/authorize",{method:"GET",operationId:"oauth2Authorize",query:xe(_(),Ce()),metadata:{openapi:{description:"Authorize an OAuth2 request",responses:{200:{description:"Authorization response generated successfully",content:{"application/json":{schema:{type:"object",additionalProperties:!0,description:"Authorization response, contents depend on the authorize function implementation"}}}}}}}},async i=>ra(i,r)),oAuthConsent:K("/oauth2/consent",{method:"POST",operationId:"oauth2Consent",body:B({accept:He(),consent_code:_().optional().nullish()}),use:[st],metadata:{openapi:{description:"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).",requestBody:{required:!0,content:{"application/json":{schema:{type:"object",properties:{accept:{type:"boolean",description:"Whether the user accepts or denies the consent request"},consent_code:{type:"string",description:"The consent code from the authorization request. Optional if using cookie-based flow."}},required:["accept"]}}}},responses:{200:{description:"Consent processed successfully",content:{"application/json":{schema:{type:"object",properties:{redirectURI:{type:"string",format:"uri",description:"The URI to redirect to, either with an authorization code or an error"}},required:["redirectURI"]}}}}}}}},async i=>{let a=i.body.consent_code||null;if(!a){const h=await i.getSignedCookie("oidc_consent_prompt",i.context.secret);h&&(a=h)}if(!a)throw new g("UNAUTHORIZED",{error_description:"consent_code is required (either in body or cookie)",error:"invalid_request"});const c=await i.context.internalAdapter.findVerificationValue(a);if(!c)throw new g("UNAUTHORIZED",{error_description:"Invalid code",error:"invalid_request"});if(c.expiresAt<new Date)throw new g("UNAUTHORIZED",{error_description:"Code expired",error:"invalid_request"});i.setCookie("oidc_consent_prompt","",{maxAge:0});const u=JSON.parse(c.value);if(!u.requireConsent)throw new g("UNAUTHORIZED",{error_description:"Consent not required",error:"invalid_request"});if(!i.body.accept)return await i.context.internalAdapter.deleteVerificationValue(c.id),i.json({redirectURI:`${u.redirectURI}?error=access_denied&error_description=User denied access`});const d=ze(32,"a-z","A-Z","0-9"),l=r.codeExpiresIn*1e3,f=new Date(Date.now()+l);await i.context.internalAdapter.updateVerificationValue(c.id,{value:JSON.stringify({...u,requireConsent:!1}),identifier:d,expiresAt:f}),await i.context.adapter.create({model:t.oauthConsent,data:{clientId:u.clientId,userId:u.userId,scopes:u.scope.join(" "),consentGiven:!0,createdAt:new Date,updatedAt:new Date}});const p=new URL(u.redirectURI);return p.searchParams.set("code",d),u.state&&p.searchParams.set("state",u.state),i.json({redirectURI:p.toString()})}),oAuth2token:K("/oauth2/token",{method:"POST",operationId:"oauth2Token",body:xe(Ce(),Ce()),metadata:{isAction:!1,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async i=>{let{body:a}=i;if(!a)throw new g("BAD_REQUEST",{error_description:"request body not found",error:"invalid_request"});if(a instanceof FormData&&(a=Object.fromEntries(a.entries())),!(a instanceof Object))throw new g("BAD_REQUEST",{error_description:"request body is not an object",error:"invalid_request"});let{client_id:c,client_secret:u}=a;const d=i.request?.headers.get("authorization")||null;if(d&&!c&&!u&&d.startsWith("Basic "))try{const S=d.replace("Basic ",""),F=new TextDecoder().decode(Ke.decode(S));if(!F.includes(":"))throw new g("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});const[J,te]=F.split(":");if(!J||!te)throw new g("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});c=J,u=te}catch{throw new g("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"})}const l=Date.now(),f=Math.floor(l/1e3),p=f+(r.accessTokenExpiresIn??3600),h=new Date(p*1e3),m=new Date((f+(r.refreshTokenExpiresIn??604800))*1e3),{grant_type:y,code:b,redirect_uri:k,refresh_token:v,code_verifier:w}=a;if(y==="refresh_token"){if(!v)throw new g("BAD_REQUEST",{error_description:"refresh_token is required",error:"invalid_request"});const S=await i.context.adapter.findOne({model:t.oauthAccessToken,where:[{field:"refreshToken",value:v.toString()}]});if(!S)throw new g("UNAUTHORIZED",{error_description:"invalid refresh token",error:"invalid_grant"});if(S.clientId!==c?.toString())throw new g("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(S.refreshTokenExpiresAt<new Date)throw new g("UNAUTHORIZED",{error_description:"refresh token expired",error:"invalid_grant"});const F=ze(32,"a-z","A-Z"),J=ze(32,"a-z","A-Z");return await i.context.adapter.create({model:t.oauthAccessToken,data:{accessToken:F,refreshToken:J,accessTokenExpiresAt:h,refreshTokenExpiresAt:m,clientId:c.toString(),userId:S.userId,scopes:S.scopes,createdAt:new Date(f*1e3),updatedAt:new Date(f*1e3)}}),i.json({access_token:F,token_type:"Bearer",expires_in:r.accessTokenExpiresIn,refresh_token:J,scope:S.scopes})}if(!b)throw new g("BAD_REQUEST",{error_description:"code is required",error:"invalid_request"});if(e.requirePKCE&&!w)throw new g("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});const N=await i.context.internalAdapter.findVerificationValue(b.toString());if(!N)throw new g("UNAUTHORIZED",{error_description:"invalid code",error:"invalid_grant"});if(N.expiresAt<new Date)throw new g("UNAUTHORIZED",{error_description:"code expired",error:"invalid_grant"});if(await i.context.internalAdapter.deleteVerificationValue(N.id),!c)throw new g("UNAUTHORIZED",{error_description:"client_id is required",error:"invalid_client"});if(!y)throw new g("BAD_REQUEST",{error_description:"grant_type is required",error:"invalid_request"});if(y!=="authorization_code")throw new g("BAD_REQUEST",{error_description:"grant_type must be 'authorization_code'",error:"unsupported_grant_type"});if(!k)throw new g("BAD_REQUEST",{error_description:"redirect_uri is required",error:"invalid_request"});const T=await At(c.toString(),n);if(!T)throw new g("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(T.disabled)throw new g("UNAUTHORIZED",{error_description:"client is disabled",error:"invalid_client"});const O=JSON.parse(N.value);if(O.clientId!==c.toString())throw new g("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(O.redirectURI!==k.toString())throw new g("UNAUTHORIZED",{error_description:"invalid redirect_uri",error:"invalid_client"});if(O.codeChallenge&&!w)throw new g("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});if(T.type==="public"){if(!w)throw new g("BAD_REQUEST",{error_description:"code verifier is required for public clients",error:"invalid_request"})}else{if(!T.clientSecret||!u)throw new g("UNAUTHORIZED",{error_description:"client_secret is required for confidential clients",error:"invalid_client"});if(!await s(i,T.clientSecret,u.toString()))throw new g("UNAUTHORIZED",{error_description:"invalid client_secret",error:"invalid_client"})}if((O.codeChallengeMethod==="plain"?w:await An("SHA-256","base64urlnopad").digest(w))!==O.codeChallenge)throw new g("UNAUTHORIZED",{error_description:"code verification failed",error:"invalid_request"});const M=O.scope;await i.context.internalAdapter.deleteVerificationValue(N.id);const x=ze(32,"a-z","A-Z"),Z=ze(32,"A-Z","a-z");await i.context.adapter.create({model:t.oauthAccessToken,data:{accessToken:x,refreshToken:Z,accessTokenExpiresAt:h,refreshTokenExpiresAt:m,clientId:c.toString(),userId:O.userId,scopes:M.join(" "),createdAt:new Date(f*1e3),updatedAt:new Date(f*1e3)}});const C=await i.context.internalAdapter.findUserById(O.userId);if(!C)throw new g("UNAUTHORIZED",{error_description:"user not found",error:"invalid_grant"});const q={given_name:C.name.split(" ")[0],family_name:C.name.split(" ")[1],name:C.name,profile:C.image,updated_at:new Date(C.updatedAt).toISOString()},R={email:C.email,email_verified:C.emailVerified},I={...M.includes("profile")?q:{},...M.includes("email")?R:{}},z=e.getAdditionalUserInfoClaim?await e.getAdditionalUserInfoClaim(C,M,T):{},D={sub:C.id,aud:c.toString(),iat:f,auth_time:i.context.session?new Date(i.context.session.session.createdAt).getTime():void 0,nonce:O.nonce,acr:"urn:mace:incommon:iap:silver",...I,...z},W=Math.floor(Date.now()/1e3)+r.accessTokenExpiresIn;let V;if(e.useJWTPlugin){const S=Vo(i);if(!S)throw i.context.logger.error("OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false."),new g("INTERNAL_SERVER_ERROR",{error_description:"JWT plugin is not enabled",error:"internal_server_error"});V=await Ho({...i,context:{...i.context,session:{session:{id:ze(32,"a-z","A-Z"),createdAt:new Date(f*1e3),updatedAt:new Date(f*1e3),userId:C.id,expiresAt:h,token:x,ipAddress:i.request?.headers.get("x-forwarded-for")},user:C}}},{...S.options,jwt:{...S.options?.jwt,getSubject:()=>C.id,audience:c.toString(),issuer:S.options?.jwt?.issuer??i.context.options.baseURL,expirationTime:W,definePayload:()=>D}})}else V=await new Yo(D).setProtectedHeader({alg:"HS256"}).setIssuedAt(f).setExpirationTime(h).sign(new TextEncoder().encode(T.clientSecret));return i.json({access_token:x,token_type:"Bearer",expires_in:r.accessTokenExpiresIn,refresh_token:M.includes("offline_access")?Z:void 0,scope:M.join(" "),id_token:M.includes("openid")?V:void 0},{headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),oAuth2userInfo:K("/oauth2/userinfo",{method:"GET",operationId:"oauth2Userinfo",metadata:{isAction:!1,openapi:{description:"Get OAuth2 user information",responses:{200:{description:"User information retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{sub:{type:"string",description:"Subject identifier (user ID)"},email:{type:"string",format:"email",nullable:!0,description:"User's email address, included if 'email' scope is granted"},name:{type:"string",nullable:!0,description:"User's full name, included if 'profile' scope is granted"},picture:{type:"string",format:"uri",nullable:!0,description:"User's profile picture URL, included if 'profile' scope is granted"},given_name:{type:"string",nullable:!0,description:"User's given name, included if 'profile' scope is granted"},family_name:{type:"string",nullable:!0,description:"User's family name, included if 'profile' scope is granted"},email_verified:{type:"boolean",nullable:!0,description:"Whether the email is verified, included if 'email' scope is granted"}},required:["sub"]}}}}}}}},async i=>{if(!i.request)throw new g("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});const a=i.request.headers.get("authorization");if(!a)throw new g("UNAUTHORIZED",{error_description:"authorization header not found",error:"invalid_request"});const c=a.replace("Bearer ",""),u=await i.context.adapter.findOne({model:t.oauthAccessToken,where:[{field:"accessToken",value:c}]});if(!u)throw new g("UNAUTHORIZED",{error_description:"invalid access token",error:"invalid_token"});if(u.accessTokenExpiresAt<new Date)throw new g("UNAUTHORIZED",{error_description:"The Access Token expired",error:"invalid_token"});const d=await At(u.clientId,n);if(!d)throw new g("UNAUTHORIZED",{error_description:"client not found",error:"invalid_token"});const l=await i.context.internalAdapter.findUserById(u.userId);if(!l)throw new g("UNAUTHORIZED",{error_description:"user not found",error:"invalid_token"});const f=u.scopes.split(" "),p={sub:l.id,email:f.includes("email")?l.email:void 0,name:f.includes("profile")?l.name:void 0,picture:f.includes("profile")?l.image:void 0,given_name:f.includes("profile")?l.name.split(" ")[0]:void 0,family_name:f.includes("profile")?l.name.split(" ")[1]:void 0,email_verified:f.includes("email")?l.emailVerified:void 0},h=e.getAdditionalUserInfoClaim?await e.getAdditionalUserInfoClaim(l,f,d):p;return i.json({...p,...h})}),registerOAuthApplication:K("/oauth2/register",{method:"POST",body:B({redirect_uris:Qe(_()).meta({description:'A list of redirect URIs. Eg: ["https://client.example.com/callback"]'}),token_endpoint_auth_method:dt(["none","client_secret_basic","client_secret_post"]).meta({description:'The authentication method for the token endpoint. Eg: "client_secret_basic"'}).default("client_secret_basic").optional(),grant_types:Qe(dt(["authorization_code","implicit","password","client_credentials","refresh_token","urn:ietf:params:oauth:grant-type:jwt-bearer","urn:ietf:params:oauth:grant-type:saml2-bearer"])).meta({description:'The grant types supported by the application. Eg: ["authorization_code"]'}).default(["authorization_code"]).optional(),response_types:Qe(dt(["code","token"])).meta({description:'The response types supported by the application. Eg: ["code"]'}).default(["code"]).optional(),client_name:_().meta({description:'The name of the application. Eg: "My App"'}).optional(),client_uri:_().meta({description:'The URI of the application. Eg: "https://client.example.com"'}).optional(),logo_uri:_().meta({description:'The URI of the application logo. Eg: "https://client.example.com/logo.png"'}).optional(),scope:_().meta({description:'The scopes supported by the application. Separated by spaces. Eg: "profile email"'}).optional(),contacts:Qe(_()).meta({description:'The contact information for the application. Eg: ["admin@example.com"]'}).optional(),tos_uri:_().meta({description:'The URI of the application terms of service. Eg: "https://client.example.com/tos"'}).optional(),policy_uri:_().meta({description:'The URI of the application privacy policy. Eg: "https://client.example.com/policy"'}).optional(),jwks_uri:_().meta({description:'The URI of the application JWKS. Eg: "https://client.example.com/jwks"'}).optional(),jwks:xe(Ce(),Ce()).meta({description:'The JWKS of the application. Eg: {"keys": [{"kty": "RSA", "alg": "RS256", "use": "sig", "n": "...", "e": "..."}]}'}).optional(),metadata:xe(Ce(),Ce()).meta({description:'The metadata of the application. Eg: {"key": "value"}'}).optional(),software_id:_().meta({description:'The software ID of the application. Eg: "my-software"'}).optional(),software_version:_().meta({description:'The software version of the application. Eg: "1.0.0"'}).optional(),software_statement:_().meta({description:"The software statement of the application."}).optional()}),metadata:{openapi:{description:"Register an OAuth2 application",responses:{200:{description:"OAuth2 application registered successfully",content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"},metadata:{type:"object",additionalProperties:!0,nullable:!0,description:"Additional metadata for the application"},clientId:{type:"string",description:"Unique identifier for the client"},clientSecret:{type:"string",description:"Secret key for the client"},redirectURLs:{type:"array",items:{type:"string",format:"uri"},description:"List of allowed redirect URLs"},type:{type:"string",description:"Type of the client",enum:["web"]},authenticationScheme:{type:"string",description:"Authentication scheme used by the client",enum:["client_secret"]},disabled:{type:"boolean",description:"Whether the client is disabled",enum:[!1]},userId:{type:"string",nullable:!0,description:"ID of the user who registered the client, null if registered anonymously"},createdAt:{type:"string",format:"date-time",description:"Creation timestamp"},updatedAt:{type:"string",format:"date-time",description:"Last update timestamp"}},required:["name","clientId","clientSecret","redirectURLs","type","authenticationScheme","disabled","createdAt","updatedAt"]}}}}}}}},async i=>{const a=i.body,c=await De(i);if(!c&&!e.allowDynamicClientRegistration)throw new g("UNAUTHORIZED",{error:"invalid_token",error_description:"Authentication required for client registration"});if((!a.grant_types||a.grant_types.includes("authorization_code")||a.grant_types.includes("implicit"))&&(!a.redirect_uris||a.redirect_uris.length===0))throw new g("BAD_REQUEST",{error:"invalid_redirect_uri",error_description:"Redirect URIs are required for authorization_code and implicit grant types"});if(a.grant_types&&a.response_types){if(a.grant_types.includes("authorization_code")&&!a.response_types.includes("code"))throw new g("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'authorization_code' grant type is used, 'code' response type must be included"});if(a.grant_types.includes("implicit")&&!a.response_types.includes("token"))throw new g("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'implicit' grant type is used, 'token' response type must be included"})}const u=e.generateClientId?.()||ze(32,"a-z","A-Z"),d=e.generateClientSecret?.()||ze(32,"a-z","A-Z"),l=await o(i,d),f=await i.context.adapter.create({model:t.oauthClient,data:{name:a.client_name,icon:a.logo_uri,metadata:a.metadata?JSON.stringify(a.metadata):null,clientId:u,clientSecret:l,redirectUrls:a.redirect_uris.join(","),type:"web",authenticationScheme:a.token_endpoint_auth_method||"client_secret_basic",disabled:!1,userId:c?.session.userId,createdAt:new Date,updatedAt:new Date}});return i.json({client_id:u,...f.type!=="public"?{client_secret:d,client_secret_expires_at:0}:{},client_id_issued_at:Math.floor(Date.now()/1e3),client_secret_expires_at:0,redirect_uris:a.redirect_uris,token_endpoint_auth_method:a.token_endpoint_auth_method||"client_secret_basic",grant_types:a.grant_types||["authorization_code"],response_types:a.response_types||["code"],client_name:a.client_name,client_uri:a.client_uri,logo_uri:a.logo_uri,scope:a.scope,contacts:a.contacts,tos_uri:a.tos_uri,policy_uri:a.policy_uri,jwks_uri:a.jwks_uri,jwks:a.jwks,software_id:a.software_id,software_version:a.software_version,software_statement:a.software_statement,metadata:a.metadata},{status:201,headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),getOAuthClient:K("/oauth2/client/:id",{method:"GET",use:[st],metadata:{openapi:{description:"Get OAuth2 client details",responses:{200:{description:"OAuth2 client retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{clientId:{type:"string",description:"Unique identifier for the client"},name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"}},required:["clientId","name"]}}}}}}}},async i=>{const a=await At(i.params.id,n);if(!a)throw new g("NOT_FOUND",{error_description:"client not found",error:"not_found"});return i.json({clientId:a.clientId,name:a.name,icon:a.icon||null})}),endSession:K("/oauth2/endsession",{method:["GET","POST"],operationId:"oauth2EndSession",query:B({id_token_hint:_().optional(),logout_hint:_().optional(),client_id:_().optional(),post_logout_redirect_uri:_().optional(),state:_().optional(),ui_locales:_().optional()}).optional(),metadata:{isAction:!1,openapi:{description:"RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.",parameters:[{name:"id_token_hint",in:"query",description:"Previously issued ID Token passed as a hint about the End-User's current authenticated session",required:!1,schema:{type:"string"}},{name:"logout_hint",in:"query",description:"Hint to the Authorization Server about the End-User that is logging out",required:!1,schema:{type:"string"}},{name:"client_id",in:"query",description:"OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint",required:!1,schema:{type:"string"}},{name:"post_logout_redirect_uri",in:"query",description:"URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed",required:!1,schema:{type:"string",format:"uri"}},{name:"state",in:"query",description:"Opaque value used by the RP to maintain state between the logout request and the callback",required:!1,schema:{type:"string"}},{name:"ui_locales",in:"query",description:"End-User's preferred languages and scripts for the user interface",required:!1,schema:{type:"string"}}],responses:{302:{description:"Redirect to post_logout_redirect_uri or logout confirmation page"},200:{description:"Logout completed successfully"}}}}},async i=>{const{id_token_hint:a,logout_hint:c,client_id:u,post_logout_redirect_uri:d,state:l,ui_locales:f}=i.query||{};let p=null,h=null;if(a)try{const y=Vo(i);if(y&&y.options&&e?.useJWTPlugin){const b=await ed(a,y.options);b&&(h=b.sub,p=b.aud?typeof b.aud=="string"?b.aud:b.aud[0]:null)}else if(u){const b=await At(u,n);if(b&&b.clientSecret)try{const{payload:k}=await Rt(a,new TextEncoder().encode(b.clientSecret));h=k.sub,p=k.aud}catch{}}}catch{i.context.logger.debug("Invalid id_token_hint provided to end_session endpoint")}if(u){if(!await At(u,n))throw new g("BAD_REQUEST",{error:"invalid_client",error_description:"Invalid client_id"});if(p&&p!==u)throw new g("BAD_REQUEST",{error:"invalid_request",error_description:"client_id does not match the ID Token's audience"});p=u}if(d){if(!p)throw new g("BAD_REQUEST",{error:"invalid_request",error_description:"client_id is required when using post_logout_redirect_uri without a valid id_token_hint"});const y=await At(p,n);if(!y)throw new g("BAD_REQUEST",{error:"invalid_client",error_description:"Invalid client"});if(!y.redirectUrls.some(b=>d===b))throw new g("BAD_REQUEST",{error:"invalid_request",error_description:"post_logout_redirect_uri is not registered for this client"})}const m=await De(i);if(h||m){const y=h||m?.user.id;y&&await i.context.adapter.deleteMany({model:t.oauthAccessToken,where:[{field:"userId",value:y}]})}if(m&&(await i.context.internalAdapter.deleteSession(m.session.token),i.setSignedCookie(i.context.authCookies.sessionToken.name,"",i.context.secret,{maxAge:0})),d)try{const y=new URL(d);return l&&y.searchParams.set("state",l),i.redirect(y.toString())}catch{throw new g("BAD_REQUEST",{error:"invalid_request",error_description:"Invalid post_logout_redirect_uri format"})}return i.json({success:!0,message:"Logout successful"})})},schema:Xc(Gk,e?.schema),get options(){return r}}};er(B({disableCookieCache:He().meta({description:"Disable cookie cache and fetch session from database"}).or(_().transform(e=>e==="true")).optional(),disableRefresh:He().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));B({id:_(),deviceCode:_(),userCode:_(),userId:_().optional(),expiresAt:Pe(),status:_(),lastPolledAt:Pe().optional(),pollingInterval:hr().optional(),clientId:_().optional(),scope:_().optional()});const oa=qt(e=>{try{tu(e)}catch{return!1}return!0},{message:"Invalid time string format. Use formats like '30m', '5s', '1h', etc."});B({expiresIn:oa.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),interval:oa.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),deviceCodeLength:hr().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),userCodeLength:hr().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),generateDeviceCode:qt(e=>typeof e=="function",{message:"generateDeviceCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),generateUserCode:qt(e=>typeof e=="function",{message:"generateUserCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),validateClient:qt(e=>typeof e=="function",{message:"validateClient must be a function that returns a boolean or a promise that resolves to a boolean."}).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),onDeviceAuthRequest:qt(e=>typeof e=="function",{message:"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."}).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),verificationUri:_().optional().describe("The URI where users verify their device code. Can be an absolute URL (https://example.com/device) or relative path (/custom-path). This will be returned as verification_uri in the device code response. If not provided, defaults to /device."),schema:qt(()=>!0)});et(async()=>({}));et({use:[st]},async e=>({session:e.context.session}));const td=_(),Yk=dt(["pending","accepted","rejected","canceled"]).default("pending");B({id:_().default(ht),name:_(),slug:_(),logo:_().nullish().optional(),metadata:xe(_(),cn()).or(_().transform(e=>JSON.parse(e))).optional(),createdAt:Pe()});B({id:_().default(ht),organizationId:_(),userId:Wc(),role:td,createdAt:Pe().default(()=>new Date)});B({id:_().default(ht),organizationId:_(),email:_(),role:td,status:Yk,teamId:_().nullish(),inviterId:_(),expiresAt:Pe(),createdAt:Pe().default(()=>new Date)});B({id:_().default(ht),name:_().min(1),organizationId:_(),createdAt:Pe(),updatedAt:Pe().optional()});B({id:_().default(ht),teamId:_(),userId:_(),createdAt:Pe().default(()=>new Date)});B({id:_().default(ht),organizationId:_(),role:_(),permission:xe(_(),Qe(_())),createdAt:Pe().default(()=>new Date),updatedAt:Pe().optional()});const sa=["admin","member","owner"];Hc([dt(sa),Qe(dt(sa))]);const Xk=()=>({id:"convex",$InferServerPlugin:{}}),eT=()=>({id:"one-time-token",$InferServerPlugin:{}}),tT=e=>{const t={admin:Fu,user:Ju,...e?.roles};return{id:"admin-client",$InferServerPlugin:{},getActions:()=>({admin:{checkRolePermission:r=>jk({role:r.role,options:{ac:e?.ac,roles:t},permissions:r.permissions??r.permission})}}),pathMethods:{"/admin/list-users":"GET","/admin/stop-impersonating":"POST"}}},IT=pl({baseURL:"https://majestic-oriole-711.convex.site",plugins:[Xk(),eT(),tT()]});export{Ce as $,g as A,Y as B,AT as C,ET as D,sT as E,vT as F,FE as G,Aw as H,lT as I,dT as J,aa as K,et as L,De as M,Xc as N,iT as O,K as P,B as Q,_ as R,Wc as S,Hc as T,_T as U,xe as V,Qe as W,hr as X,dt as Y,He as Z,gl as _,IT as a,jk as a0,Le as a1,gr as a2,sr as a3,rr as a4,vw as a5,Mp as a6,eu as a7,ST as a8,TT as a9,st as aa,Ge as ab,ud as ac,ze as ad,Or as b,fd as c,sc as d,bT as e,ht as f,fT as g,uw as h,un as i,oT as j,id as k,Q as l,$e as m,re as n,An as o,nt as p,Ke as q,_p as r,xn as s,Ga as t,zk as u,j as v,md as w,fr as x,kT as y,pT as z};
