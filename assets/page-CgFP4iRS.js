import{a as i,p as e,w as se}from"./chunk-JMJ3UQ3L-DLa4wvEN.js";import{a as u}from"./auth-client-CoRsmko_.js";import{u as ae,T as re,a as le,b as k,c as te,f as K,d as ne,e as L,g as ie,h as oe,j as ce,i as de}from"./table-BAv9pTwu.js";import{k as me,aa as A}from"./index-Dr94eIYd.js";import{B as d}from"./button-D7tyPeF-.js";import{e as he,f as ue,g as xe,j as ge,D as je,d as pe,a as fe,b as ve,c as Ce,S as E}from"./dropdown-menu-U7x9GUHW.js";import{I as $}from"./input-DE-BWp1k.js";import{t}from"./index-Bqq4DHLr.js";import{A as F,b as V,c as M,d as P,e as B,f as z,g as I,h as T}from"./alert-dialog-C5z3n2hc.js";import{C as Ne,c as we}from"./card-BpPdZkTd.js";import{S as O}from"./spinner-VocTvHE6.js";import"./sha2-CO3l0I8W.js";import"./utils-BB8OEnXs.js";import"./bundle-mjs-BNe0Xlio.js";import"./index-CPvIzByb.js";import"./index-DVeKyYZy.js";import"./index-vAMRNKaC.js";import"./index-CeJ37sa3.js";import"./index-DFapR5wA.js";import"./index-RdSmrbPg.js";import"./index-BoNYA7lJ.js";import"./index-DhSUr4ds.js";import"./index-CFCRIzy5.js";import"./state-DJ_Xbwdm.js";function ye({columns:r,data:m,onRowClick:y}){const[S,v]=i.useState([]),[C,x]=i.useState([]),[a,h]=i.useState({}),[b,g]=i.useState({}),o=ae({data:m,columns:r,onSortingChange:v,onColumnFiltersChange:x,getCoreRowModel:de(),getPaginationRowModel:ce(),getSortedRowModel:oe(),getFilteredRowModel:ie(),onColumnVisibilityChange:h,onRowSelectionChange:g,state:{sorting:S,columnFilters:C,columnVisibility:a,rowSelection:b}});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx($,{placeholder:"Filter emails...",value:o.getColumn("email")?.getFilterValue()??"",onChange:l=>o.getColumn("email")?.setFilterValue(l.target.value),className:"max-w-sm"}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.getFilteredRowModel().rows.length," user(s) total"]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:"Next"}),e.jsxs(he,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",children:["Columns ",e.jsx(me,{className:"ml-2 h-4 w-4"})]})}),e.jsx(xe,{align:"end",children:o.getAllColumns().filter(l=>l.getCanHide()).map(l=>e.jsx(ge,{className:"capitalize",checked:l.getIsVisible(),onCheckedChange:c=>l.toggleVisibility(!!c),children:l.id},l.id))})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(re,{children:[e.jsx(le,{children:o.getHeaderGroups().map(l=>e.jsx(k,{children:l.headers.map(c=>e.jsx(te,{children:c.isPlaceholder?null:K(c.column.columnDef.header,c.getContext())},c.id))},l.id))}),e.jsx(ne,{children:o.getRowModel().rows?.length?o.getRowModel().rows.map(l=>e.jsx(k,{"data-state":l.getIsSelected()&&"selected",className:"cursor-pointer",onClick:()=>y?.(l.original),children:l.getVisibleCells().map(c=>e.jsx(L,{children:K(c.column.columnDef.cell,c.getContext())},c.id))},l.id)):e.jsx(k,{children:e.jsx(L,{colSpan:r.length,className:"h-24 text-center",children:"No results."})})})]})})]})}const Se=()=>[{accessorKey:"email",header:({column:r})=>e.jsxs(d,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),children:["Email",e.jsx(A,{className:"ml-2 h-4 w-4"})]}),cell:({row:r})=>e.jsx("div",{className:"lowercase",children:r.getValue("email")})},{accessorKey:"name",header:({column:r})=>e.jsxs(d,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),children:["Name",e.jsx(A,{className:"ml-2 h-4 w-4"})]}),cell:({row:r})=>e.jsx("div",{children:r.getValue("name")})},{accessorKey:"role",header:"Role",cell:({row:r})=>e.jsx("div",{className:"capitalize",children:r.getValue("role")||"user"})},{accessorKey:"banned",header:"Status",cell:({row:r})=>{const m=r.getValue("banned");return e.jsx("div",{className:`font-medium ${m?"text-red-600":"text-green-600"}`,children:m?"Banned":"Active"})}},{accessorKey:"emailVerified",header:"Verified",cell:({row:r})=>{const m=r.getValue("emailVerified");return e.jsx("div",{className:m?"text-green-600":"text-yellow-600",children:m?"Yes":"No"})}},{accessorKey:"createdAt",header:({column:r})=>e.jsxs(d,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),children:["Created",e.jsx(A,{className:"ml-2 h-4 w-4"})]}),cell:({row:r})=>{const m=new Date(r.getValue("createdAt"));return e.jsx("div",{children:m.toLocaleDateString()})}}],Qe=se(function(){const[m,y]=i.useState([]),[S,v]=i.useState(!0),[C,x]=i.useState([]),[a,h]=i.useState(null),[b,g]=i.useState(!1),[o,l]=i.useState(!1),[c,D]=i.useState(!1),[Y,R]=i.useState(!1),[q,N]=i.useState(!1),[j,p]=i.useState(null),[U,w]=i.useState(""),f=async()=>{try{v(!0);const s=await u.admin.listUsers({query:{limit:1e3}});s.data?y(s.data.users):s.error&&t.error("Failed to load users: "+s.error.message)}catch(s){t.error("Failed to load users"),console.error(s)}finally{v(!1)}};i.useEffect(()=>{f()},[]);const G=async()=>{if(!(!a||!j))try{const s=await u.admin.setRole({userId:a.id,role:j});s.error?t.error("Failed to set role: "+s.error.message):(t.success(`Role updated to ${j}`),N(!1),p(null),a&&h({...a,role:j}),f())}catch(s){t.error("Failed to set role"),console.error(s)}},J=async()=>{if(a)try{const s=await u.admin.banUser({userId:a.id,banReason:U||void 0});s.error?t.error("Failed to ban user: "+s.error.message):(t.success("User banned successfully"),D(!1),w(""),a&&h({...a,banned:!0,banReason:U}),f())}catch(s){t.error("Failed to ban user"),console.error(s)}},Q=async s=>{try{const n=await u.admin.unbanUser({userId:s});n.error?t.error("Failed to unban user: "+n.error.message):(t.success("User unbanned successfully"),f())}catch(n){t.error("Failed to unban user"),console.error(n)}},H=async s=>{try{l(!0);const n=await u.admin.listUserSessions({userId:s});n.data?x(n.data.sessions):n.error&&t.error("Failed to load sessions: "+n.error.message)}catch(n){t.error("Failed to load sessions"),console.error(n)}finally{l(!1)}},W=async s=>{try{const n=await u.admin.revokeUserSession({sessionToken:s});n.error?t.error("Failed to revoke session: "+n.error.message):(t.success("Session revoked successfully"),a&&H(a.id))}catch(n){t.error("Failed to revoke session"),console.error(n)}},X=async()=>{if(a)try{const s=await u.admin.removeUser({userId:a.id});s.error?t.error("Failed to delete user: "+s.error.message):(t.success("User deleted successfully"),R(!1),g(!1),h(null),f())}catch(s){t.error("Failed to delete user"),console.error(s)}},Z=s=>{h(s),x([]),g(!0),H(s.id)},_=()=>{g(!1),h(null),x([]),l(!1),w("")},ee=Se();return e.jsxs("div",{className:"p-6",children:[S?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(O,{className:"size-6"})}):e.jsx(ye,{columns:ee,data:m,onRowClick:Z}),e.jsx(je,{open:b,onOpenChange:_,children:e.jsx(pe,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:a.name}),e.jsx(Ce,{children:a.email})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"User Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Role:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:a.role||"user"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:`ml-2 font-medium ${a.banned?"text-red-600":"text-green-600"}`,children:a.banned?"Banned":"Active"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Verified:"}),e.jsx("span",{className:`ml-2 font-medium ${a.emailVerified?"text-green-600":"text-yellow-600"}`,children:a.emailVerified?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(a.createdAt).toLocaleDateString()})]}),a.banned&&a.banReason&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ban Reason:"}),e.jsx("span",{className:"ml-2",children:a.banReason})]})]})]}),e.jsx(E,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.role==="admin"?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{p("user"),N(!0)},children:"Set as User"}):e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{p("admin"),N(!0)},children:"Set as Admin"}),a.banned?e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Q(a.id),children:"Unban User"}):e.jsx(d,{variant:"outline",size:"sm",onClick:()=>D(!0),children:"Ban User"}),e.jsx(d,{variant:"destructive",size:"sm",onClick:()=>R(!0),children:"Delete User"})]})]}),e.jsx(E,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Active Sessions"}),o?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(O,{})}):C.length>0?e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx(Ne,{children:e.jsx(we,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm flex-wrap",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"ml-2",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expires:"}),e.jsx("span",{className:"ml-2",children:new Date(s.expiresAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"IP:"}),e.jsx("span",{className:"ml-2",children:s.ipAddress||"N/A"})]}),e.jsxs("div",{className:"text-sm break-all",children:[e.jsx("span",{className:"text-muted-foreground",children:"User Agent:"}),e.jsx("span",{className:"ml-2",children:s.userAgent||"N/A"})]})]}),e.jsx(d,{variant:"destructive",size:"sm",className:"shrink-0",onClick:()=>W(s.token),children:"Revoke"})]})})},s.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No active sessions"})]})]})]})})}),e.jsx(F,{open:c,onOpenChange:D,children:e.jsxs(V,{children:[e.jsxs(M,{children:[e.jsx(P,{children:"Ban User"}),e.jsxs(B,{children:["Are you sure you want to ban ",a?.email,"? You can provide an optional reason below."]})]}),e.jsx("div",{className:"py-4",children:e.jsx($,{placeholder:"Ban reason (optional)",value:U,onChange:s=>w(s.target.value)})}),e.jsxs(z,{children:[e.jsx(I,{onClick:()=>w(""),children:"Cancel"}),e.jsx(T,{onClick:J,children:"Ban User"})]})]})}),e.jsx(F,{open:Y,onOpenChange:R,children:e.jsxs(V,{children:[e.jsxs(M,{children:[e.jsx(P,{children:"Delete User"}),e.jsxs(B,{children:["Are you sure you want to permanently delete ",a?.email,"? This action cannot be undone and will remove all user data from the system."]})]}),e.jsxs(z,{children:[e.jsx(I,{children:"Cancel"}),e.jsx(T,{onClick:X,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete User"})]})]})}),e.jsx(F,{open:q,onOpenChange:s=>{N(s),s||p(null)},children:e.jsxs(V,{children:[e.jsxs(M,{children:[e.jsx(P,{children:"Change User Role"}),e.jsxs(B,{children:["Are you sure you want to change ",a?.email,"'s role to"," ",e.jsx("span",{className:"font-semibold",children:j}),"?"]})]}),e.jsxs(z,{children:[e.jsx(I,{onClick:()=>p(null),children:"Cancel"}),e.jsx(T,{onClick:G,children:"Change Role"})]})]})})]})});export{Qe as default};
