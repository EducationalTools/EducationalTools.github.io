const v={account:["accountId",["accountId","providerId"],["providerId","userId"]],rateLimit:["key"],session:["expiresAt",["expiresAt","userId"]],verification:["expiresAt","identifier"],user:[["email","name"],"name","userId"],passkey:["credentialID"],oauthConsent:[["clientId","userId"]]},j=s=>Object.fromEntries(Object.entries(s).map(([t,o])=>{const i=Object.fromEntries(Object.entries(o.fields).map(([c,e])=>[e.fieldName??c,{...e.sortable?{sortable:!0}:{},...e.unique?{unique:!0}:{},...e.references?{references:e.references}:{}}]).filter(([c,e])=>typeof e=="object"?Object.keys(e).length>0:!0));return[t,i]}).filter(([t,o])=>typeof o=="object"?Object.keys(o).length>0:!0)),g=s=>Object.fromEntries(Object.entries(s).map(([t,o])=>{const i=v[t]?.map(e=>typeof e=="string"?o.fields[e]?.fieldName??e:e.map(n=>o.fields[n]?.fieldName??n))||[],c=Object.keys(j(s)[t]||{}).filter(e=>!i.some(n=>Array.isArray(n)?n[0]===e:n===e));return[t,i.concat(c)]})),I=async({file:s,tables:t})=>{const i=await import("path");if(i.basename(i.resolve(process.cwd(),s??""))==="convex")throw new Error("Better Auth schema must be generated in the Better Auth component directory.");let e=`// This file is auto-generated. Do not edit this file manually.
// To regenerate the schema, run:
// \`npx @better-auth/cli generate --output ${s} -y\`

import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export const tables = {
`;for(const n in t){let y=function(r,a){const m=a.type;return{string:"v.string()",boolean:"v.boolean()",number:"v.number()",date:"v.number()",json:"v.string()","number[]":"v.array(v.number())","string[]":"v.array(v.string())"}[m]};const p=t[n],f=p.modelName,u=Object.fromEntries(Object.entries(p.fields).filter(([r])=>r!=="id")),d=g(t)[n]?.map(r=>{const a=Array.isArray(r)?r.sort():[r];return`.index("${a.join("_")}", ${JSON.stringify(a)})`})||[],h=`${f}: defineTable({
${Object.keys(u).map(r=>{const a=u[r],m=y(r,a),l=b=>a.required?b:`v.optional(v.union(v.null(), ${b}))`;return`    ${a.fieldName??r}: ${l(m)},`}).join(`
`)}
  })${d.length>0?`
    ${d.join(`
    `)}`:""},
`;e+=`  ${h}`}return e+=`};

const schema = defineSchema(tables);

export default schema;
`,{code:e,path:s??"./schema.ts",overwrite:!0}};export{I as createSchema,v as indexFields};
